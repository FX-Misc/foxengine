
基本准备
插入年报/股本测试数据tstock_id=20
insert into dune_report(id,tstock_id,announce_day,tperiod,zgb,ag,bg,hg,mgwfplr,mggjj,mgjzc,mgsy) values(1,20,20010101,200101,1000,500,0,0,0,0,0,0)

#2008-12-10
基本确认以list内含np.array 1d为主
只有在需要用到集合运算时，才以np.array的二维形式，但结果仍然要转换为1d

数据流向

db ==> 2d arrays ==> 1d arrays ==> 普通运算(等长)
   ==>集合运算(指数、排序;来源包括基础数据和计算数据)
   ==> 1d arrays  ==>  普通运算
   ==> (运算结果的)集合运算 ==> 1d arrays

在这里，第一次普通运算是等长序列的运算，第二次普通运算中已经抛掉非交易日

#2009-02-08
#todo: 
#1.优势率
#2.净值衰落 值和周期
#

#2009-02-17
kwargs的妙用，当关键字默认参数和*args并用时，需要用kwargs解决问题。应用场景是类似于dispatch这样的decrator
kwargs的慎用，如果有**kwargs，并且存在有默认值的关键字参数，则会因为拼写错误引入很难测试的隐患
    如 def foo(a,bnext=1,kwargs): ...
    如下调用
        foo(a,bnetx=12)
    并不会检查出这个拼写错误，如果这个参数不是非常敏感的参数或者在复杂情形下，则这类错误非常难以判断

#2009-02-25
#1 筛选思路
1.1 先用相关的cruiser进行巡游，时间段为20010701-20060101
    只有那些在这段时间内仍然能够保持MM优势率>1500-2000的才进入下一步
1.2 进入run过程，对候选就20071001-20090101进行遍历，仍然要求优势率>1500-2000
1.3 对候选就20020101-20090101进行遍历，要求1.2的优势率不降低，即不能在主升段降低优势率
1.4 进行分段ev检验，20010701-20060101,20050701-20070930,20071001-20090101,20010701-20090101

#2009-03-07
#1 进行run_merge
#2 Finished 进行vama2x的第二次巡游
   并整理svama2x和vama2x的巡游结果 
#3 考虑对ma120的强制约束，以及ma分类约束
#4 考虑各选出的算法的实际含义，逐个研究每个算法选出股票的方式方法，细致观察其选出的股票
   用excel来做
#5 Finished 核对600433 20071204买入，次日卖出的原因  
    name:Mediator:<svama2x:ma_standard=20,base=82,fast=1,sma=33,slow=8:atr_seller:covered=10,up_sector=2,trace_times=3000,stop_times=600,buy_sector=0:make_trade_signal_advanced:B1S1>
    消除此类现象
#6 计算板块在上升过程中前三甲的龙头股 > 8500     
#7 transform重大修正之后对受影响不分的重新巡游
   Finshed: svama2,svama3,svama2s,svama2c,svama2x,vama3,vama2,vama2x, 是否逐渐淘汰掉vama系列


#2009-03-12
#诡异
begin,xbegin,end,lbegin = 20060101,20070901,20090327,20081101
name:Mediator:<vama3:ma_standard=500,slow=45,extend_days=17,fast=32,mid=79:atr_seller:up_sector=2,trace_times=3000,stop_times=600,covered=10:make_trade_signal_advanced:B0S0>
应当在第三天退出，但是到0312也没有卖出
SH600370	B	20090224	price=4500	volume=1000
bug已经修正

另
name:Mediator:<vama3:ma_standard=500,slow=50,extend_days=31,fast=30,mid=67:atr_seller:up_sector=2,trace_times=3000,stop_times=600,covered=10:make_trade_signal_advanced:B0S0>
SH600766	B	20081224	price=3490	volume=1000
这个是正确的

#2009-03-14
#1 catalog单项测试
发现一个诡异的现象，渐涨板块中的龙头股(>8500)的表现不如中间股(3300-6600). 
这里的环境是没有加持g的20,60,120,250的持续增长。单项加持c, 这之中又以c60表现最好。

最佳表最先比g的单项加持要好很多，成功率从333->520,R从1025->2700,times从245->67

# g与catalog共同加持，结果导致次数以2个数量级锐减，缺乏实际意义，而且结果也不如单独的c加持
#
#2 另一个重要发现
以19980101为起始日，对vama3的unit计算有重大影响，大大优于20000101. 仅对
fcustom(vama3,fast= 33,mid= 84,slow=345,ma_standard=500,extend_days= 27,dates=dates,cextractor=ext_factory(3300,6600))
而言

#3 检验g60的5和60上叉的效果
基本确定g不能单独作为主要条件，只能做为筛选条件

另对g作筛选时的
g = gand(stock.g5 >= stock.g20,stock.g20 >= stock.g60,stock.g60 >= stock.g120,stock.g120 >= stock.g250)
进行放宽测试，发现删除第一/第二个/第三/第四个都会有问题

但没有测试 g5>g60而绕过g20的情形,只是单纯的删除

#4 考虑对vama3族的筛选方式


#2009-03-16
#1 对行业选择进行调整，从之前的证监会行业调整为行业。证监会行业太过细化
   从新评估已有的数据
    configs.append(config(buyer=fcustom(csvama2,fast= 13,slow=125,rstart= 1000,rend=5000))) 	#3315-252-593-32    #9078/988
    configs.append(config(buyer=fcustom(csvama2,fast=  2,slow=250,rstart=7000,rend=9000))) 	#1625-117-500-22 #3379/792
    configs.append(config(buyer=fcustom(csvama3,fast= 12,mid= 27,slow=250,rstart=5000,rend=8000))) 	#1000-71-473-19
    configs.append(config(buyer=fcustom(csvama3,fast= 12,mid= 27,slow=330,rstart=3000,rend=6000))) 	#5270-195-714-7
    configs.append(config(buyer=fcustom(csvama3,fast= 16,mid= 21,slow=250,rstart=5000,rend=8000))) 	#1061-69-433-30 
    configs.append(config(buyer=fcustom(csvama3,fast= 12,mid= 19,slow=250,rstart=7000,rend=8000))) 	#939-77-538-13
    configs.append(config(buyer=fcustom(csvama3,fast=  8,mid= 21,slow=385,rstart=1500,rend=8000))) 	#688-64-478-23
    configs.append(config(buyer=fcustom(csvama3,fast= 12,mid= 23,slow=250,rstart=5000,rend=8000))) 	#845-60-392-28
    configs.append(config(buyer=fcustom(csvama3,fast= 44,mid= 23,slow=250,rstart=7500,rend=8000))) 	#1049-85-666-3
    configs.append(config(buyer=fcustom(csvama3,fast= 10,mid= 85,slow=250,rstart=5000,rend=8000))) 	#2185-153-333-3
    configs.append(config(buyer=fcustom(csvama2,fast= 37,slow=115,rstart=3000,rend=8000))) 	#2059-138-327-58
    configs.append(config(buyer=fcustom(csvama3,fast= 12,mid= 27,slow=350,rstart=4500,rend=6000))) 	#913-53-375-8
基本上这些数据已经失效,只剩下三个
    configs.append(config(buyer=fcustom(csvama2,fast= 13,slow=125,rstart= 1000,rend=5000))) 	#2268-188-609-41    #9078/988
    configs.append(config(buyer=fcustom(csvama3,fast= 44,mid= 23,slow=250,rstart=7500,rend=8000))) 	#1948-152-500-2 #383/78
    configs.append(config(buyer=fcustom(csvama2,fast= 37,slow=115,rstart=3000,rend=8000))) 	#1202-95-367-68


#2009-03-19
#1 考虑svap/vap的macd的筛选作用
   macd的标的可以是ma(svap,n),而不仅仅是svap,暂定为5

#2 用nmedaitor排除原先在设置atr的downlimit时不考虑B1/B0的买入信号偏移的问题
    该问题导致B1系列下信号日次日高开时止损点离买入点距离为高开值+设定atr,而非设定atr)

#3 观察，发现atr5叉20也是选股器
    且strend(atr20)>0是筛选器,但更加有效的是strend(atr5/atr20),且<1.2,大的趋势向上(不是小向上但大一顶比一顶低)
    但还是有些模棱两可
    

#4 对atr的止损进行细分，划分为1000(1200?)和2000两档


#5  发现psy的信号效果不错
    PSY:COUNT(CLOSE>REF(CLOSE,1),N)/N*100;
    PSYMA:MA(PSY,M);
    N=12,M=6
    当psy,psyma趋势向上且psy上叉时买入
 
    单独成为信号还是能力有限，但是strend(psy12)>0成为筛选器倒是比较有前途

    但筛选器还只能目测，统计上无法做到筛掉有些目测可以去掉的趋势

    找到一个统计学上的过滤器对svama2,fast=  9,slow=1160,630-46-382-251
    a. psy12<300, ==> 1432-96-516-31  但次数消散很多
    b. psy12<500, ==> 1129-61-327-116 成功率还是不行
    c. psy12在500-600之间 ==> 195-9-408-71 属于负分支

    如果以psy不做ma直接过滤，则
    a.  1101-76-521-23
    b.  264-14-291-48
    c.  146-6-375-64
    d. >600,-99/-5/272/77

#2009-03-23
将基金板块纳入到行业
select * from dune_stockcode_catalogs where catalog_id = 286
select * from dune_catalog where subject_id = '其它板块'

288	ETF基金	其它板块
289	LOF基金	其它板块
291	基金板块	其它板块
292	开放基金	其它板块
293	权证板块	其它板块

#发现深圳基金居然没有在里面，找到问题，需要解决
insert into dune_stockcode_catalogs(stockcode_id,catalog_id) 
select id,291,* from dune_stockcode where code like 'SZ18%'

#1 代码添加 
#采用django的方法
cs = CatalogSubject.objects.get(code='HY')
jjbk2 = Catalog(name=u'基金板块A',subject=cs)
jjbk2.save()
szjjs = StockCode.objects.filter(code__startswith='SZ18')
shjjs = StockCode.objects.filter(code__startswith='SH50')
szetfs = StockCode.objects.filter(code__startswith='SZ159')
shetfs = StockCode.objects.filter(code__startswith='SH510')
jjbk2.stocks.add(*szjjs)
jjbk2.stocks.add(*shjjs)
jjbk2.stocks.add(*szetfs)
jjbk2.stocks.add(*shetfs)

#2 数据添加
#原始数据已经位于dune_sdayquote中，故只需要转换

因此，继续处理
ss = [str(stock.code) for stock in jjbk2.stocks.all()]
['SH500001', 'SH500002', 'SH500003', 'SH500005', 'SH500006', 'SH500007', 'SH500008', 'SH500009', 'SH500010', 'SH500011', 'SH500013', 'SH500015', 'SH500016', 'SH500017', 'SH500018', 'SH500019', 'SH500021', 'SH500025', 'SH500028', 'SH500029','SH500035', 'SH500038', 'SH500039', 'SH500056', 'SH500058', 'SZ184688', 'SZ184689', 'SZ184690', 'SZ184691', 'SZ184692', 'SZ184693', 'SZ184698', 'SZ184699', 'SZ184700', 'SZ184701', 'SZ184703', 'SZ184705', 'SZ184706', 'SZ184712', 'SZ184713', 'SZ184721', 'SZ184722', 'SZ184728', 'SH510050', 'SH510180', 'SH510880', 'SZ159901', 'SZ159902']
即
('SH500001', 'SH500002', 'SH500003', 'SH500005', 'SH500006', 'SH500007', 'SH500008', 'SH500009', 'SH500010', 'SH500011', 'SH500013', 'SH500015', 'SH500016', 'SH500017', 'SH500018', 'SH500019', 'SH500021', 'SH500025', 'SH500028', 'SH500029','SH500035', 'SH500038', 'SH500039', 'SH500056', 'SH500058', 'SZ184688', 'SZ184689', 'SZ184690', 'SZ184691', 'SZ184692', 'SZ184693', 'SZ184698', 'SZ184699', 'SZ184700', 'SZ184701', 'SZ184703', 'SZ184705', 'SZ184706', 'SZ184712', 'SZ184713', 'SZ184721', 'SZ184722', 'SZ184728', 'SH510050', 'SH510180', 'SH510880', 'SZ159901', 'SZ159902')
#去掉上海基金的部分
 ('SZ184688', 'SZ184689', 'SZ184690', 'SZ184691', 'SZ184692', 'SZ184693', 'SZ184698', 'SZ184699', 'SZ184700', 'SZ184701', 'SZ184703', 'SZ184705', 'SZ184706', 'SZ184712', 'SZ184713', 'SZ184721', 'SZ184722', 'SZ184728', 'SH510050', 'SH510180', 'SH510880', 'SZ159901', 'SZ159902')
select * from dune_sdayquote where sstock in  ('SZ184688', 'SZ184689', 'SZ184690', 'SZ184691', 'SZ184692', 'SZ184693', 'SZ184698', 'SZ184699', 'SZ184700', 'SZ184701', 'SZ184703', 'SZ184705', 'SZ184706', 'SZ184712', 'SZ184713', 'SZ184721', 'SZ184722', 'SZ184728', 'SH510050', 'SH510180', 'SH510880', 'SZ159901', 'SZ159902')
......

insert into dune_xdayquote(tstock_id,tdate,topen,tclose,thigh,tlow,tavg,tvolume,tamount)
select ds.id,tdate,topen,tclose,thigh,tlow,tavg,tvolume,tamount
from dune_sdayquote sq
join dune_stockcode ds on ds.code = sq.sstock
where sq.sstock in  ('SZ184688', 'SZ184689', 'SZ184690', 'SZ184691', 'SZ184692', 'SZ184693', 'SZ184698', 'SZ184699', 'SZ184700', 'SZ184701', 'SZ184703', 'SZ184705', 'SZ184706', 'SZ184712', 'SZ184713', 'SZ184721', 'SZ184722', 'SZ184728', 'SH510050', 'SH510180', 'SH510880', 'SZ159901', 'SZ159902')


#3 除权数据
上海基金均已经被除权
select * from dune_powerinfo dp
join dune_stockcode ds on dp.tstock_id = ds.id
where code in  ('SZ184688', 'SZ184689', 'SZ184690', 'SZ184691', 'SZ184692', 'SZ184693', 'SZ184698', 'SZ184699', 'SZ184700', 'SZ184701', 'SZ184703', 'SZ184705', 'SZ184706', 'SZ184712', 'SZ184713', 'SZ184721', 'SZ184722', 'SZ184728', 'SH510050', 'SH510180', 'SH510880', 'SZ159901', 'SZ159902')

直接
python fxjtransfer.py -x


#2009-03-24
#1 psy(67)的ma(22)对ma(67)的死叉，以及psy/22/67的走势背离，都是大盘改变趋势的信号，且都有提前期

#2 vmacd的死叉貌似是一个卖出信号？提前期还可以，优于psy,psy太提前了
   而且vmacd即便延后，延后也有限
   vmacd(6,13,9)对于卖出更好 [为正常参数的一半]


原始的组合
def vmacd(stock,dates):
    t = stock.transaction
    vdiff,vdea = cmacd(t[VOLUME])
    dcross = gand(cross(vdea,vdiff),strend(vdiff)>0,strend(vdea>0))
    g = gand(stock.g5 >= stock.g20,stock.g20 >= stock.g60,stock.g60 >= stock.g120,stock.g120 >= stock.g250)
    linelog(stock.code)
    
    #ma_standard = ma(t[CLOSE],60)
    #trend_ma_standard = strend(ma_standard) > 0    
    return gand(dcross,g)


加上
    ma_standard = ma(t[CLOSE],120)
    trend_ma_standard = strend(ma_standard) > 0    
条件
pre_ev:
        评估:总盈亏值=7774,交易次数=2155        期望值=42
                总盈亏率(1/1000)=7774,平均盈亏率(1/1000)=3,盈利交易率(1/1000)=26
8
                赢利次数=579,赢利总值=120077
                亏损次数=1574,亏损总值=112303
                平盘次数=2


c_extractor = lambda c,s:gand(c.g5 >= c.g20,c.g20>=c.g60,c.g60>=c.g120,c.g120>=c.g250,s>=3300,s<=6600)

    cs = catalog_signal_cs(stock.c60,c_extractor)
:
prev:
        评估:总盈亏值=10549,交易次数=84 期望值=1923
                总盈亏率(1/1000)=10549,平均盈亏率(1/1000)=125,盈利交易率(1/1000)=404
                赢利次数=34,赢利总值=13802
                亏损次数=50,亏损总值=3253
                平盘次数=0

vdea:0-12000, 问题是成功率没有上升到>500
pre_ev:
        评估:总盈亏值=8782,交易次数=51  期望值=2915
                总盈亏率(1/1000)=8782,平均盈亏率(1/1000)=172,盈利交易率(1/1000)=431
                赢利次数=22,赢利总值=10521
                亏损次数=29,亏损总值=1739
                平盘次数=0


改为ma60:
pre_ev:
        评估:总盈亏值=9410,交易次数=114 期望值=1281
                总盈亏率(1/1000)=9410,平均盈亏率(1/1000)=82,盈利交易率(1/1000)=350
                赢利次数=40,赢利总值=14189
                亏损次数=74,亏损总值=4779


#

弱化板块条件,去除范围
ma_standard=120
pre_ev:
c_extractor = lambda c,s:gand(c.g5 >= c.g20,c.g20>=c.g60,c.g60>=c.g120,c.g120>=c.g250,s<=3300)
pre_ev:
        评估:总盈亏值=17799,交易次数=200        期望值=1313
                总盈亏率(1/1000)=17799,平均盈亏率(1/1000)=88,盈利交易率(1/1000)=
355
                赢利次数=71,赢利总值=26533
                亏损次数=129,亏损总值=8734
                平盘次数=0


范围改为<3300,ma=120
        评估:总盈亏值=2453,交易次数=33  期望值=1088
                总盈亏率(1/1000)=2453,平均盈亏率(1/1000)=74,盈利交易率(1/1000)=3
33
                赢利次数=11,赢利总值=3957
                亏损次数=22,亏损总值=1504
                平盘次数=0







######3 命令行准备脚本

from wolfox.fengine.core.shortcut import *
from wolfox.fengine.normal.funcs import *
from wolfox.fengine.core.d1match import *
from wolfox.fengine.core.d1idiom import atr_xseller_factory
from wolfox.fengine.core.d1indicator import cmacd
from wolfox.foxit.base.tutils import linelog
from time import time

import logging
logging.basicConfig(filename="xx4c.log",level=logging.DEBUG,format='%(name)s:%(funcName)s:%(lineno)d:%(asctime)s %(levelname)s %(message)s')
#begin,xbegin,end = 19980101,20010701,20091231
#begin,xbegin,end = 20000101,20010701,20090101
#####begin,xbegin,end = 20000101,20010701,20091231
#begin,xbegin,end = 20050101,20060701,20091231
#begin,xbegin,end = 20070101,20080601,20091231
begin,xbegin,end = 20060101,20080601,20091231
#begin,xbegin,end = 20000101,20010701,20090101
#begin,xbegin,end = 19970101,19980101,20010701

tbegin = time()
    
#dates,sdata,idata,catalogs = prepare_all(begin,end,[],[ref_code])
dates,sdata,idata,catalogs = prepare_all(begin,end,[],[])
#sdata.update(idata)
import psyco
psyco.full()

import wolfox.fengine.normal.nrun as nrun
import wolfox.fengine.normal.xrun as x
nrun.prepare_order(sdata.values())
nrun.prepare_order(idata.values())
nrun.prepare_order(catalogs)
nrun.prepare_common(sdata.values(),idata[ref_id])
nrun.prepare_common(idata.values(),idata[ref_id])
nrun.prepare_index(idata[1])
#nrun.prepare_order(idata.values())
dummy_catalogs('catalog',catalogs)
pman = AdvancedATRPositionManager()
dman = DateManager(begin,end)
myMediator=nmediator_factory(trade_strategy=B1S1,pricer = oo_pricer)
seller = atr_xseller_factory(stop_times=1200,trace_times=3000)
seller2000 = atr_xseller_factory(stop_times=2000,trace_times=3000)

import wolfox.fengine.normal.sfuncs as s

#开始计算
reload(x)    #应对脚本修改
buyer = x.prepare_buyer(dates)   
name,tradess = calc_trades(buyer,seller,sdata,dates,xbegin,cmediator=myMediator)
#name,tradess = calc_trades(buyer,seller2000,sdata,dates,xbegin,cmediator=myMediator)
result,strade = ev.evaluate_all(tradess,pman,dman)

#2009-03-28
#ma4的测试
5X10，且5,10,20,60多头排列(向上且越短越上)
pre_ev:
        评估:总盈亏值=9816,交易次数=12366       期望值=0
                总盈亏率(1/1000)=9816,平均盈亏率(1/1000)=0,盈利交易率(1/1000)=263
                赢利次数=3262,赢利总值=633340
                亏损次数=9073,亏损总值=623524
                平盘次数=31

添加120也是向上
pre_ev:
        评估:总盈亏值=90813,交易次数=9428       期望值=130
                总盈亏率(1/1000)=90813,平均盈亏率(1/1000)=9,盈利交易率(1/1000)=287
                赢利次数=2710,赢利总值=559709
                亏损次数=6700,亏损总值=468896
                平盘次数=18

令120在60之下
pre_ev:
        评估:总盈亏值=117256,交易次数=7816      期望值=214
                总盈亏率(1/1000)=117256,平均盈亏率(1/1000)=15,盈利交易率(1/1000)
=301
                赢利次数=2357,赢利总值=501820
                亏损次数=5445,亏损总值=384564
                平盘次数=14

添加g
pre_ev:
        评估:总盈亏值=32886,交易次数=692        期望值=635
                总盈亏率(1/1000)=32886,平均盈亏率(1/1000)=47,盈利交易率(1/1000)=338
                赢利次数=234,赢利总值=66698
                亏损次数=456,亏损总值=33812
                平盘次数=2
                闭合交易明细:

放松120
pre_ev:
        评估:总盈亏值=16834,交易次数=1391       期望值=173
                总盈亏率(1/1000)=16834,平均盈亏率(1/1000)=12,盈利交易率(1/1000)=259
                赢利次数=361,赢利总值=88738
                亏损次数=1028,亏损总值=71904
                平盘次数=2
                闭合交易明细:

不妥
仍然120，添加cs
pre_ev:
        评估:总盈亏值=6230,交易次数=70  期望值=1236
                总盈亏率(1/1000)=6230,平均盈亏率(1/1000)=89,盈利交易率(1/1000)=471
                赢利次数=33,赢利总值=8924
                亏损次数=37,亏损总值=2694
                平盘次数=0

cs中间范围
pre_ev:
        评估:总盈亏值=5530,交易次数=36  期望值=2067
                总盈亏率(1/1000)=5530,平均盈亏率(1/1000)=153,盈利交易率(1/1000)=472
                赢利次数=17,赢利总值=6954
                亏损次数=19,亏损总值=1424
                平盘次数=0

#ma+vmacd的测试
vmacd上叉，3天内ma5X10,且60向上
pre_ev:
        评估:总盈亏值=26976,交易次数=12954      期望值=30
                总盈亏率(1/1000)=26976,平均盈亏率(1/1000)=2,盈利交易率(1/1000)=2
59
                赢利次数=3358,赢利总值=667264
                亏损次数=9564,亏损总值=640288
                平盘次数=32

vmacd上叉，3天内ma5X10,5/10/20/60多头排列
pre_ev:
        评估:总盈亏值=30814,交易次数=10389      期望值=29
                总盈亏率(1/1000)=30814,平均盈亏率(1/1000)=2,盈利交易率(1/1000)=2
60
                赢利次数=2707,赢利总值=551748
                亏损次数=7659,亏损总值=520934
                平盘次数=23

vmacd上叉，3天内ma5X10,5/10/20/60/120多头排列
pre_ev:
        评估:总盈亏值=97535,交易次数=7481       期望值=188
                总盈亏率(1/1000)=97535,平均盈亏率(1/1000)=13,盈利交易率(1/1000)= 284
                赢利次数=2132,赢利总值=468554
                亏损次数=5333,亏损总值=371019
                平盘次数=16
                闭合交易明细:


g
pre_ev:
        评估:总盈亏值=16615,交易次数=895        期望值=260
                总盈亏率(1/1000)=16615,平均盈亏率(1/1000)=18,盈利交易率(1/1000)= 281
                赢利次数=252,赢利总值=61468
                亏损次数=642,亏损总值=44853
                平盘次数=1
                闭合交易明细:

cs
pre_ev:
        评估:总盈亏值=1182,交易次数=83  期望值=215
                总盈亏率(1/1000)=1182,平均盈亏率(1/1000)=14,盈利交易率(1/1000)=2
89
                赢利次数=24,赢利总值=5044
                亏损次数=59,亏损总值=3862
                平盘次数=0

cs中段，不如单独的vmacd和ma4好
        评估:总盈亏值=1871,交易次数=29  期望值=1084
                总盈亏率(1/1000)=1871,平均盈亏率(1/1000)=64,盈利交易率(1/1000)=344
                赢利次数=10,赢利总值=3007
                亏损次数=19,亏损总值=1136
                平盘次数=0
                闭合交易明细:
                        stock=SH600021 盈亏值=-147520:,盈亏率(1/1000):-42

#vmacd+ ma10>ma20>ma60>ma120, g+cs
pre_ev:
        评估:总盈亏值=16796,交易次数=117        期望值=1986
                总盈亏率(1/1000)=16796,平均盈亏率(1/1000)=143,盈利交易率(1/1000)=444
                赢利次数=52,赢利总值=21521
                亏损次数=65,亏损总值=4725
cs中段
pre_ev:
        评估:总盈亏值=10141,交易次数=56 期望值=2549
                总盈亏率(1/1000)=10141,平均盈亏率(1/1000)=181,盈利交易率(1/1000)=517
                赢利次数=29,赢利总值=12074
                亏损次数=27,亏损总值=1933
                平盘次数=0
cs下段 (<3300)
pre_ev:
        评估:总盈亏值=2067,交易次数=14  期望值=2070
                总盈亏率(1/1000)=2067,平均盈亏率(1/1000)=147,盈利交易率(1/1000)= 500
                赢利次数=7,赢利总值=2570
                亏损次数=7,亏损总值=503
                平盘次数=0



放松cs:
pre_ev:
        评估:总盈亏值=26208,交易次数=1143       期望值=297
                总盈亏率(1/1000)=26208,平均盈亏率(1/1000)=22,盈利交易率(1/1000)=316
                赢利次数=362,赢利总值=84148
                亏损次数=779,亏损总值=57940
                平盘次数=2


添加strend(ma120)>0,即ma10>ma20>ma60>ma120, g+cs, strend(ma120)>0
pre_ev:
        评估:总盈亏值=17133,交易次数=113        期望值=2157
                总盈亏率(1/1000)=17133,平均盈亏率(1/1000)=151,盈利交易率(1/1000)=451
                赢利次数=51,赢利总值=21506
                亏损次数=62,亏损总值=4373
                平盘次数=0

cs < 3300:
pre_ev:
        评估:总盈亏值=2067,交易次数=14  期望值=2070
                总盈亏率(1/1000)=2067,平均盈亏率(1/1000)=147,盈利交易率(1/1000)=500
                赢利次数=7,赢利总值=2570
                亏损次数=7,亏损总值=503
                平盘次数=0

cs<=6600:
pre_ev:
        评估:总盈亏值=11756,交易次数=62 期望值=2554
                总盈亏率(1/1000)=11756,平均盈亏率(1/1000)=189,盈利交易率(1/1000)=516
                赢利次数=32,赢利总值=13995
                亏损次数=30,亏损总值=2239
                平盘次数=0


cs:3300-6600:
        评估:总盈亏值=10164,交易次数=54 期望值=2611
                总盈亏率(1/1000)=10164,平均盈亏率(1/1000)=188,盈利交易率(1/1000)=518
                赢利次数=28,赢利总值=12059
                亏损次数=26,亏损总值=1895
                平盘次数=0

cs: > 6600:
pre_ev:
        评估:总盈亏值=5298,交易次数=53  期望值=1523
                总盈亏率(1/1000)=5298,平均盈亏率(1/1000)=99,盈利交易率(1/1000)=358
                赢利次数=19,赢利总值=7511
                亏损次数=34,亏损总值=2213
                平盘次数=0

#放松ma10>ma20
>6600
pre_ev:
        评估:总盈亏值=5489,交易次数=65  期望值=1200
                总盈亏率(1/1000)=5489,平均盈亏率(1/1000)=84,盈利交易率(1/1000)=3
69
                赢利次数=24,赢利总值=8360
                亏损次数=41,亏损总值=2871
                平盘次数=0
                闭合交易明细:

<6600
pre_ev:
        评估:总盈亏值=11136,交易次数=77 期望值=2149
                总盈亏率(1/1000)=11136,平均盈亏率(1/1000)=144,盈利交易率(1/1000)=428
                赢利次数=33,赢利总值=14120
                亏损次数=44,亏损总值=2984
                平盘次数=0
                闭合交易明细:


#120==>60
cs<6600
pre_ev:
        评估:总盈亏值=11733,交易次数=64 期望值=2506
                总盈亏率(1/1000)=11733,平均盈亏率(1/1000)=183,盈利交易率(1/1000)=515
                赢利次数=33,赢利总值=14010
                亏损次数=31,亏损总值=2277
                平盘次数=0

#60,添加ma5>ma10
        评估:总盈亏值=7884,交易次数=54  期望值=2000
                总盈亏率(1/1000)=7884,平均盈亏率(1/1000)=146,盈利交易率(1/1000)=425
                赢利次数=23,赢利总值=10161
                亏损次数=31,亏损总值=2277
                平盘次数=0
                闭合交易明细:

#60 ma5>ma20,去掉ma10
pre_ev:
        评估:总盈亏值=9499,交易次数=68  期望值=1904
                总盈亏率(1/1000)=9499,平均盈亏率(1/1000)=139,盈利交易率(1/1000)=
455
                赢利次数=31,赢利总值=12219
                亏损次数=37,亏损总值=2720
                平盘次数=0

#60,ma10>ma60,去掉ma20
        评估:总盈亏值=11139,交易次数=79 期望值=2073
                总盈亏率(1/1000)=11139,平均盈亏率(1/1000)=141,盈利交易率(1/1000)
=443
                赢利次数=35,赢利总值=14145
                亏损次数=44,亏损总值=3006
                平盘次数=0

vdea<10000
pre_ev:
        评估:总盈亏值=10587,交易次数=68 期望值=2348
                总盈亏率(1/1000)=10587,平均盈亏率(1/1000)=155,盈利交易率(1/1000) =441
                赢利次数=30,赢利总值=13123
                亏损次数=38,亏损总值=2536
                平盘次数=0

#60,10>20>60,vdea<10000
pre_ev:
        评估:总盈亏值=11092,交易次数=54 期望值=2847
                总盈亏率(1/1000)=11092,平均盈亏率(1/1000)=205,盈利交易率(1/1000)=518
                赢利次数=28,赢利总值=12988
                亏损次数=26,亏损总值=1896
                平盘次数=0
                闭合交易明细:

<5000
pre_ev:
        评估:总盈亏值=6638,交易次数=40  期望值=2357
                总盈亏率(1/1000)=6638,平均盈亏率(1/1000)=165,盈利交易率(1/1000)=525
                赢利次数=21,赢利总值=7974
                亏损次数=19,亏损总值=1336
                平盘次数=0


<15000:
pre_ev:
        评估:总盈亏值=11586,交易次数=58 期望值=2842
                总盈亏率(1/1000)=11586,平均盈亏率(1/1000)=199,盈利交易率(1/1000) =500
                赢利次数=29,赢利总值=13633
                亏损次数=29,亏损总值=2047
                平盘次数=0


还是10>20>60>120,120最好
cs < 6600
vdea<15000
pre_ev:
        评估:总盈亏值=11609,交易次数=56 期望值=2915
                总盈亏率(1/1000)=11609,平均盈亏率(1/1000)=207,盈利交易率(1/1000)=500
                赢利次数=28,赢利总值=13618
                亏损次数=28,亏损总值=2009
                平盘次数=0

<12000
pre_ev:
        评估:总盈亏值=11688,交易次数=54 期望值=2918
                总盈亏率(1/1000)=11688,平均盈亏率(1/1000)=216,盈利交易率(1/1000)=518
                赢利次数=28,赢利总值=13618
                亏损次数=26,亏损总值=1930
                平盘次数=0
<10000
pre_ev:
        评估:总盈亏值=11115,交易次数=52 期望值=2878
                总盈亏率(1/1000)=11115,平均盈亏率(1/1000)=213,盈利交易率(1/1000)=519
                赢利次数=27,赢利总值=12973
                亏损次数=25,亏损总值=1858
                平盘次数=0
                闭合交易明细:
<8000
pre_ev:
        评估:总盈亏值=7988,交易次数=45  期望值=2492
                总盈亏率(1/1000)=7988,平均盈亏率(1/1000)=177,盈利交易率(1/1000)=488
                赢利次数=22,赢利总值=9640
                亏损次数=23,亏损总值=1652
                平盘次数=0

<0:
pre_ev:
        评估:总盈亏值=869,交易次数=13   期望值=970
                总盈亏率(1/1000)=869,平均盈亏率(1/1000)=66,盈利交易率(1/1000)=461
                赢利次数=6,赢利总值=1347
                亏损次数=7,亏损总值=478
                平盘次数=0
>0:
pre_ev:
        评估:总盈亏值=11012,交易次数=51 期望值=2756
                总盈亏率(1/1000)=11012,平均盈亏率(1/1000)=215,盈利交易率(1/1000)=529
                赢利次数=27,赢利总值=12903
                亏损次数=24,亏损总值=1891
                平盘次数=0
0-12000:
pre_ev:
        评估:总盈亏值=10944,交易次数=43 期望值=3215
                总盈亏率(1/1000)=10944,平均盈亏率(1/1000)=254,盈利交易率(1/1000)=534
                赢利次数=23,赢利总值=12526
                亏损次数=20,亏损总值=1582
                平盘次数=0

vdea:0-12000,cs:<8500
pre_ev: 
        评估:总盈亏值=16098,交易次数=63 期望值=3311
                总盈亏率(1/1000)=16098,平均盈亏率(1/1000)=255,盈利交易率(1/1000)=507
                赢利次数=32,赢利总值=18509
                亏损次数=31,亏损总值=2411
                平盘次数=0
vdea:0-12000,放松cs
pre_ev:
        评估:总盈亏值=15835,交易次数=68 期望值=3012
                总盈亏率(1/1000)=15835,平均盈亏率(1/1000)=232,盈利交易率(1/1000) =485
                赢利次数=33,赢利总值=18538
                亏损次数=35,亏损总值=2703
                平盘次数=0

cs<=6600,放松g
pre_ev:
        评估:总盈亏值=16026,交易次数=354        期望值=616
                总盈亏率(1/1000)=16026,平均盈亏率(1/1000)=45,盈利交易率(1/1000)=296
                赢利次数=105,赢利总值=34314
                亏损次数=249,亏损总值=18288
                平盘次数=0
cs彻底去掉，g不变
pre_ev:
        评估:总盈亏值=21776,交易次数=637        期望值=472
                总盈亏率(1/1000)=21776,平均盈亏率(1/1000)=34,盈利交易率(1/1000)=343
                赢利次数=219,赢利总值=52205
                亏损次数=417,亏损总值=30429
                平盘次数=1
仍然计算cs，但不进入条件（去掉不计入任何板块的股票）
        评估:总盈亏值=22480,交易次数=626        期望值=486
                总盈亏率(1/1000)=22480,平均盈亏率(1/1000)=35,盈利交易率(1/1000)=345
                赢利次数=216,赢利总值=52056
                亏损次数=409,亏损总值=29576
                平盘次数=1



最终结论 vmacd_ma4: vdea=0-12000,cs<8500


#2009-03-29
#emv交叉平均线(emv为14日累积，ma=9) 10>20>60>120,120向上，g
双叉
pre_ev:
        评估:总盈亏值=13749,交易次数=910        期望值=197
                总盈亏率(1/1000)=13749,平均盈亏率(1/1000)=15,盈利交易率(1/1000)=304
                赢利次数=277,赢利总值=62191
                亏损次数=631,亏损总值=48442
                平盘次数=2
添加cs:<6600
pre_ev:
        评估:总盈亏值=8768,交易次数=65  期望值=1786
                总盈亏率(1/1000)=8768,平均盈亏率(1/1000)=134,盈利交易率(1/1000)=446
                赢利次数=29,赢利总值=11482
                亏损次数=36,亏损总值=2714
                平盘次数=0

上叉
        评估:总盈亏值=4889,交易次数=43  期望值=1430
                总盈亏率(1/1000)=4889,平均盈亏率(1/1000)=113,盈利交易率(1/1000)=441
                赢利次数=19,赢利总值=6802
                亏损次数=24,亏损总值=1913
                平盘次数=0

下叉，但semv向上，说明是寻找支撑
pre_ev:
        评估:总盈亏值=5122,交易次数=26  期望值=3126
                总盈亏率(1/1000)=5122,平均盈亏率(1/1000)=197,盈利交易率(1/1000)=461
                赢利次数=12,赢利总值=6011
                亏损次数=14,亏损总值=889
                平盘次数=0


#emv上叉0
pre_ev:
        评估:总盈亏值=9551,交易次数=38  期望值=3861
                总盈亏率(1/1000)=9551,平均盈亏率(1/1000)=251,盈利交易率(1/1000)=447
                赢利次数=17,赢利总值=10924
                亏损次数=21,亏损总值=1373
                平盘次数=0

3300-6600,双叉
pre_ev:
        评估:总盈亏值=7956,交易次数=22  期望值=5469
                总盈亏率(1/1000)=7956,平均盈亏率(1/1000)=361,盈利交易率(1/1000)=409
                赢利次数=9,赢利总值=8817
                亏损次数=13,亏损总值=861
                平盘次数=0
                闭合交易明细:

只有上叉
<6600
        评估:总盈亏值=9435,交易次数=33  期望值=4130
                总盈亏率(1/1000)=9435,平均盈亏率(1/1000)=285,盈利交易率(1/1000)=454
                赢利次数=15,赢利总值=10694
                亏损次数=18,亏损总值=1259
                平盘次数=0
                闭合交易明细:

3300-6600
pre_ev:
        评估:总盈亏值=7971,交易次数=18  期望值=5972
                总盈亏率(1/1000)=7971,平均盈亏率(1/1000)=442,盈利交易率(1/1000)=444
                赢利次数=8,赢利总值=8718
                亏损次数=10,亏损总值=747
                平盘次数=0

#不设10>20>60>120
pre_ev:
        评估:总盈亏值=7830,交易次数=41  期望值=3015
                总盈亏率(1/1000)=7830,平均盈亏率(1/1000)=190,盈利交易率(1/1000)= 292
                赢利次数=12,赢利总值=9673
                亏损次数=29,亏损总值=1843
                平盘次数=0


g去掉5>20,cs去掉5>20
pre_ev:
        评估:总盈亏值=18589,交易次数=140        期望值=2000
                总盈亏率(1/1000)=18589,平均盈亏率(1/1000)=132,盈利交易率(1/1000)=442
                赢利次数=62,赢利总值=23670
                亏损次数=76,亏损总值=5081
                平盘次数=2

g去掉5>20,cs不变
     评估:总盈亏值=3981,交易次数=42  期望值=1362
    总盈亏率(1/1000)=3981,平均盈亏率(1/1000)=94,盈利交易率(1/1000)=452
                赢利次数=19,赢利总值=5573
                亏损次数=23,亏损总值=1592

g去掉5>20,cs:5<20
pre_ev:
        评估:总盈亏值=8494,交易次数=88  期望值=1454
                总盈亏率(1/1000)=8494,平均盈亏率(1/1000)=96,盈利交易率(1/1000)=454
                赢利次数=40,赢利总值=11701
                亏损次数=48,亏损总值=3207
                平盘次数=0

#emv过零线时vmacd/macd>0且dea向上
cs<6600
pre_ev:
        评估:总盈亏值=8537,交易次数=36  期望值=3537
                总盈亏率(1/1000)=8537,平均盈亏率(1/1000)=237,盈利交易率(1/1000)=444
                赢利次数=16,赢利总值=9892
                亏损次数=20,亏损总值=1355
                平盘次数=0
cs:3300-6600
pre_ev:
        评估:总盈亏值=7974,交易次数=21  期望值=5414
                总盈亏率(1/1000)=7974,平均盈亏率(1/1000)=379,盈利交易率(1/1000)=428
                赢利次数=9,赢利总值=8817
                亏损次数=12,亏损总值=843
                平盘次数=0
                闭合交易明细:




#wvad交叉，(wvad为24日累积，ma=6) 10>20>60>120,120向上
pre_ev:
        评估:总盈亏值=3977,交易次数=7967        期望值=0
                总盈亏率(1/1000)=3977,平均盈亏率(1/1000)=0,盈利交易率(1/1000)=274
                赢利次数=2187,赢利总值=419352
                亏损次数=5763,亏损总值=415375
                平盘次数=17

添加g
pre_ev:
        评估:总盈亏值=1760,交易次数=905 期望值=12
                总盈亏率(1/1000)=1760,平均盈亏率(1/1000)=1,盈利交易率(1/1000)=275
                赢利次数=249,赢利总值=53893
                亏损次数=655,亏损总值=52133
                平盘次数=1
添加cs<6600:
        评估:总盈亏值=2902,交易次数=37  期望值=987
                总盈亏率(1/1000)=2902,平均盈亏率(1/1000)=78,盈利交易率(1/1000)=459
                赢利次数=17,赢利总值=4490
                亏损次数=20,亏损总值=1588
                平盘次数=0

cs:3300-6600
        评估:总盈亏值=3270,交易次数=29  期望值=1417
                总盈亏率(1/1000)=3270,平均盈亏率(1/1000)=112,盈利交易率(1/1000)=482
                赢利次数=14,赢利总值=4465
                亏损次数=15,亏损总值=1195
                平盘次数=0
                闭合交易明细:

之前都是叉，而没有看上叉还是下叉，这次确定是上叉
pre_ev:
        评估:总盈亏值=2333,交易次数=21  期望值=1387
                总盈亏率(1/1000)=2333,平均盈亏率(1/1000)=111,盈利交易率(1/1000)=428
                赢利次数=9,赢利总值=3301
                亏损次数=12,亏损总值=968
                平盘次数=0
                闭合交易明细:


g+cs,g去掉5>20,cs去掉5>20,cs<6600
        评估:总盈亏值=10840,交易次数=66 期望值=2129
                总盈亏率(1/1000)=10840,平均盈亏率(1/1000)=164,盈利交易率(1/1000)=409
                赢利次数=27,赢利总值=13852
                亏损次数=39,亏损总值=3012
                平盘次数=0

g+cs,g去掉5>20,cs<6600
pre_ev:
        评估:总盈亏值=2173,交易次数=21  期望值=1144
                总盈亏率(1/1000)=2173,平均盈亏率(1/1000)=103,盈利交易率(1/1000)=476
                赢利次数=10,赢利总值=3172
                亏损次数=11,亏损总值=999
                平盘次数=0

g+cs,g去掉5>20,cs变为5<20,cs<6600
pre_ev:
        评估:总盈亏值=8662,交易次数=36  期望值=3243
                总盈亏率(1/1000)=8662,平均盈亏率(1/1000)=240,盈利交易率(1/1000)=388
                赢利次数=14,赢利总值=10295
                亏损次数=22,亏损总值=1633
                平盘次数=0

下叉
pre_ev:
        评估:总盈亏值=340,交易次数=24   期望值=200
                总盈亏率(1/1000)=340,平均盈亏率(1/1000)=14,盈利交易率(1/1000)=375
                赢利次数=9,赢利总值=1391
                亏损次数=15,亏损总值=1051
                平盘次数=0


#去掉10>20>60>120
pre_ev:
        评估:总盈亏值=4399,交易次数=57  期望值=1149
                总盈亏率(1/1000)=4399,平均盈亏率(1/1000)=77,盈利交易率(1/1000)=403
                赢利次数=23,赢利总值=6702
                亏损次数=34,亏损总值=2303
                平盘次数=0

#添加20>60>120
pre_ev:
        评估:总盈亏值=3155,交易次数=31  期望值=1311
                总盈亏率(1/1000)=3155,平均盈亏率(1/1000)=101,盈利交易率(1/1000)=451
                赢利次数=14,赢利总值=4465
                亏损次数=17,亏损总值=1310
                平盘次数=0



#清理退市股票
select * from dune_stockcode where is_active=0

#
000765  *ST华信 2005-07-04  2005-09-05   400038    华信3  国泰君安证券
000769  *ST大菲 2005-09-21  2005-11-28   400046    大菲1      国信证券
000827  *ST长兴 2005-09-21  2005-11-28   400043    长兴1  申银万国证券
000832  *ST龙涤 2006-06-29  2006-11-08   400050    龙涤5  申银万国证券
600092 S*ST精密 2006-11-30  2007-02-02   400051    精密1  申银万国证券
600625   PT水仙 2001-04-23  2001-12-10   400008   水仙A3  申银万国证券
600646   ST国嘉 2003-09-22  2004-03-17   400017    国嘉1  申银万国证券
600659  *ST花雕 2006-03-23  2006-06-02   400049    花雕1  申银万国证券
600669  *ST鞍成 2004-09-15  2004-11-22   400031  鞍合成1  申银万国证券
600670  *ST斯达 2004-09-24  2004-12-01   400033    斯达3  国泰君安证券
600672  *ST华圣 2005-08-05  2005-10-12   400039    华圣3      国信证券
600700  *ST数码 2005-09-20  2005-11-25   400041    数码3      兴业证券
600709   ST生态 2003-05-23  2004-05-28   400027    生态1  国泰君安证券
600752  *ST哈慈 2005-09-22  2005-11-29   400044    哈慈1  申银万国证券
600772 S*ST龙昌 2006-11-30  2007-02-09   400052    龙昌1  国泰君安证券
600788  *ST达曼 2005-03-25  2005-06-03   400037  达尔曼3  申银万国证券
600799  *ST龙科 2005-12-31  2006-08-04   400048    龙科1      渤海证券
600813 ST鞍一工 2002-09-16  2004-05-26   400021  鞍一工3  申银万国证券
600852  *ST中川 2005-09-16  2005-11-23   400040    中川3      国信证券
600878  *ST北科 2004-09-15  2004-11-22   400030    北科1      国信证券
600899  *ST信联 2005-09-21  2005-11-28   400042    信联1  国泰君安证券
200003 PT金田Ｂ 2002-06-14  2004-01-16   420016   金田B3      国信证券
200013 *ST石化B 2004-09-20  2004-11-26   420032   石化B3      国信证券
200015  PT中浩B 2001-10-22  2002-11-14   420011   中浩B3      国信证券
200057 *ST大洋B 2005-09-21  2005-11-28   420047   大洋B1      国信证券
900931  PT水仙B 2001-04-23  2001-12-10   420008   水仙B3  申银万国证券
000003 PT金田Ａ 2002-06-14  2004-01-16   400016   金田A3      国信证券
000013 *ST石化A 2004-09-20  2004-11-26   400032   石化A3      国信证券
000015  PT中浩A 2001-10-22  2002-11-14   400011   中浩A3      国信证券
000047   ST中侨 2003-05-30  2004-05-26   400026    中侨3  中国银河证券
000405   ST鑫光 2004-03-19  2004-05-26   400028    鑫光3      广发证券
000412   ST五环 2003-09-19  2004-05-26   400020    五环1      光大证券
000535  *ST猴王 2005-09-21  2005-11-28   400045    猴王1      国信证券
000556   PT南洋 2002-05-29  2004-05-28   400023    南洋3      国信证券
000588 PT粤金曼 2001-06-15  2002-09-20   400012  粤金曼3  申银万国证券
000621  *ST比特 2004-09-27  2004-12-03   400035    比特3      国信证券
000653   ST九州 2002-09-13  2004-05-21   400019    九州1      兴业证券
000658   ST海洋 2002-09-20  2004-05-21   400022    海洋3      长江证券
000660  *ST南华 2004-09-13  2004-11-19   400029    汇集3      国信证券
000675   ST银山 2002-08-20  2004-05-12   400018    银化3  申银万国证券
000689   ST宏业 2002-09-05  2004-05-28   400025    宏业3      海通证券
000730  *ST环保 2004-09-24  2004-12-01   400036    环保1      海通证券

update dune_stockcode set is_active=0 where code in ('SZ000765', 'SZ000769', 'SZ000827', 'SZ000832', 'SH600092', 'SH600625', 'SH600646', 'SH600659', 'SH600669', 'SH600670', 'SH600672', 'SH600700', 'SH600709', 'SH600752', 'SH600772', 'SH600788', 'SH600799', 'SH600813', 'SH600852', 'SH600878', 'SH600899', 'SZ200003', 'SZ200013', 'SZ200015', 'SZ200057', 'SH900931', 'SZ000003', 'SZ000013', 'SZ000015', 'SZ000047', 'SZ000405', 'SZ000412', 'SZ000535', 'SZ000556', 'SZ000588', 'SZ000621', 'SZ000653', 'SZ000658', 'SZ000660', 'SZ000675', 'SZ000689', 'SZ000730')

#ma3
ma3,t120>0
pre_ev:
        评估:总盈亏值=121201,交易次数=10085     期望值=190
                总盈亏率(1/1000)=121201,平均盈亏率(1/1000)=12,盈利交易率(1/1000)=283
                赢利次数=2857,赢利总值=580851
                亏损次数=7199,亏损总值=459650
                平盘次数=29

g + ma3,t120>0
        评估:总盈亏值=3896,交易次数=461 期望值=112
                总盈亏率(1/1000)=3896,平均盈亏率(1/1000)=8,盈利交易率(1/1000)=158
                赢利次数=73,赢利总值=19187
                亏损次数=214,亏损总值=15291
                平盘次数=174
                闭合交易明细:


cs<6600 + ma3,t120>0    没啥效果
pre_ev:
        评估:总盈亏值=2231,交易次数=293 期望值=118
                总盈亏率(1/1000)=2231,平均盈亏率(1/1000)=7,盈利交易率(1/1000)=300
                赢利次数=88,赢利总值=14353
                亏损次数=205,亏损总值=12122
                平盘次数=0

#xma60
10>20>60>120,t120>0
5天内碰ma60*1.15线后拉起
        评估:总盈亏值=204645,交易次数=5269      期望值=481
                总盈亏率(1/1000)=204645,平均盈亏率(1/1000)=38,盈利交易率(1/1000)=306
                赢利次数=1614,赢利总值=492477
                亏损次数=3640,亏损总值=287832
                平盘次数=15

g
pre_ev:
        评估:总盈亏值=23378,交易次数=327        期望值=887
                总盈亏率(1/1000)=23378,平均盈亏率(1/1000)=71,盈利交易率(1/1000)=360
                赢利次数=118,赢利总值=40051
                亏损次数=208,亏损总值=16673
                平盘次数=1
                闭合交易明细:

g+cs<6600
        评估:总盈亏值=7604,交易次数=28  期望值=5211
                总盈亏率(1/1000)=7604,平均盈亏率(1/1000)=271,盈利交易率(1/1000)=642
                赢利次数=18,赢利总值=8131
                亏损次数=10,亏损总值=527
                平盘次数=0
                闭合交易明细:

cs<6600:
pre_ev:
        评估:总盈亏值=40417,交易次数=205        期望值=2940
                总盈亏率(1/1000)=40417,平均盈亏率(1/1000)=197,盈利交易率(1/1000)=517
                赢利次数=106,赢利总值=47061
                亏损次数=99,亏损总值=6644
                平盘次数=0
                闭合交易明细:

g+cs<10000
pre_ev:
        评估:总盈亏值=7680,交易次数=38  期望值=3482
                总盈亏率(1/1000)=7680,平均盈亏率(1/1000)=202,盈利交易率(1/1000)=578
                赢利次数=22,赢利总值=8612
                亏损次数=16,亏损总值=932
                平盘次数=0

原g,简化cs:10>20>60>120>250 #原先是5>20...
pre_ev:
        评估:总盈亏值=5272,交易次数=25  期望值=3559
                总盈亏率(1/1000)=5272,平均盈亏率(1/1000)=210,盈利交易率(1/1000)=600
                赢利次数=15,赢利总值=5871
                亏损次数=10,亏损总值=599
                平盘次数=0

原cs,简化g = gand(stock.g5 >= stock.g20,stock.g20 >= stock.g60)
pre_ev:
        评估:总盈亏值=16275,交易次数=74 期望值=3590
                总盈亏率(1/1000)=16275,平均盈亏率(1/1000)=219,盈利交易率(1/1000)=554
                赢利次数=41,赢利总值=18312
                亏损次数=33,亏损总值=2037
                平盘次数=0

cs,g = gand(stock.g20 >= stock.g60,stock.g60 >= stock.g120,stock.g120 >= stock.g250)    ##最佳
pre_ev:
        评估:总盈亏值=11279,交易次数=40 期望值=5734
                总盈亏率(1/1000)=11279,平均盈亏率(1/1000)=281,盈利交易率(1/1000)=600
                赢利次数=24,赢利总值=12072
                亏损次数=16,亏损总值=793
                平盘次数=0

extend_days 5==>10
pre_ev:
        评估:总盈亏值=13441,交易次数=50 期望值=5360
                总盈亏率(1/1000)=13441,平均盈亏率(1/1000)=268,盈利交易率(1/1000)=580
                赢利次数=29,赢利总值=14504
                亏损次数=21,亏损总值=1063
                平盘次数=0
                闭合交易明细:

extend_days ==>8
pre_ev:
        评估:总盈亏值=13235,交易次数=46 期望值=5627
                总盈亏率(1/1000)=13235,平均盈亏率(1/1000)=287,盈利交易率(1/1000)=608
                赢利次数=28,赢利总值=14170
                亏损次数=18,亏损总值=935
                平盘次数=0

extend_days ==> 7   ###
pre_ev:
        评估:总盈亏值=13321,交易次数=45 期望值=6040
                总盈亏率(1/1000)=13321,平均盈亏率(1/1000)=296,盈利交易率(1/1000)=622
                赢利次数=28,赢利总值=14170
                亏损次数=17,亏损总值=849
                平盘次数=0
        

        
        #金手指
        评估:总盈亏值=33283,交易次数=173        期望值=2493
                总盈亏率(1/1000)=33283,平均盈亏率(1/1000)=192,盈利交易率(1/1000)=526
                赢利次数=91,赢利总值=39607
                亏损次数=82,亏损总值=6324
                平盘次数=0

        #金手指+cs<6600
        评估:总盈亏值=5530,交易次数=17  期望值=8333
                总盈亏率(1/1000)=5530,平均盈亏率(1/1000)=325,盈利交易率(1/1000)=705
                赢利次数=12,赢利总值=5727
                亏损次数=5,亏损总值=197
                平盘次数=0
        
        #银手指
        评估:总盈亏值=23766,交易次数=87 期望值=4706
                总盈亏率(1/1000)=23766,平均盈亏率(1/1000)=273,盈利交易率(1/1000)=574
                赢利次数=50,赢利总值=25929
                亏损次数=37,亏损总值=2163
                平盘次数=0


    #放松cs,cs<10000
    pre_ev:
        评估:总盈亏值=12025,交易次数=85 期望值=2043 
        总盈亏率(1/1000)=12025,平均盈亏率(1/1000)=141,盈利交易率(1/1000)=447
                赢利次数=38,赢利总值=15297
                亏损次数=47,亏损总值=3272
                平盘次数=0

    #g改为原始的5>20>60>120>250
    pre_ev:
        评估:总盈亏值=9592,交易次数=32  期望值=5641
                总盈亏率(1/1000)=9592,平均盈亏率(1/1000)=299,盈利交易率(1/1000)=656
                赢利次数=21,赢利总值=10175
                亏损次数=11,亏损总值=583
                平盘次数=0

去掉t120:
pre_ev:
        评估:总盈亏值=13146,交易次数=50 期望值=5137
                总盈亏率(1/1000)=13146,平均盈亏率(1/1000)=262,盈利交易率(1/1000)=580
                赢利次数=29,赢利总值=14224
                亏损次数=21,亏损总值=1078
                平盘次数=0

去掉g120>g250
pre_ev:
        评估:总盈亏值=23697,交易次数=89 期望值=4433
                总盈亏率(1/1000)=23697,平均盈亏率(1/1000)=266,盈利交易率(1/1000)=573
                赢利次数=51,赢利总值=25979
                亏损次数=38,亏损总值=2282
                平盘次数=0

    #添加t120
    pre_ev:
        评估:总盈亏值=23816,交易次数=88 期望值=4655
                总盈亏率(1/1000)=23816,平均盈亏率(1/1000)=270,盈利交易率(1/1000)=579
                赢利次数=51,赢利总值=25979
                亏损次数=37,亏损总值=2163
                平盘次数=0

    #原始
    pre_ev:
        评估:总盈亏值=13265,交易次数=49 期望值=5744
                总盈亏率(1/1000)=13265,平均盈亏率(1/1000)=270,盈利交易率(1/1000)=591
                赢利次数=29,赢利总值=14224
                亏损次数=20,亏损总值=959
                平盘次数=0
                闭合交易明细:
    

再去掉c120>c250
pre_ev:
        评估:总盈亏值=37822,交易次数=192        期望值=2800
                总盈亏率(1/1000)=37822,平均盈亏率(1/1000)=196,盈利交易率(1/1000)=484
                赢利次数=93,赢利总值=44812
                亏损次数=99,亏损总值=6990
                平盘次数=0

    #添加t120
    pre_ev:
        评估:总盈亏值=37996,交易次数=189        期望值=2913
                总盈亏率(1/1000)=37996,平均盈亏率(1/1000)=201,盈利交易率(1/1000)=486
                赢利次数=92,赢利总值=44741
                亏损次数=97,亏损总值=6745
                平盘次数=0



保留g120>g250,单独去掉c120>c250
pre_ev:
        评估:总盈亏值=18698,交易次数=97 期望值=3428
                总盈亏率(1/1000)=18698,平均盈亏率(1/1000)=192,盈利交易率(1/1000)=494
                赢利次数=48,赢利总值=21447
                亏损次数=49,亏损总值=2749

将c60>c120>c250改成c60>c250
pre_ev:
        评估:总盈亏值=18198,交易次数=86 期望值=3981
                总盈亏率(1/1000)=18198,平均盈亏率(1/1000)=211,盈利交易率(1/1000)=558
                赢利次数=48,赢利总值=20233
                亏损次数=38,亏损总值=2035
                平盘次数=0

保留cs正常,g60>g120>g250改成g60>g250
pre_ev:
        评估:总盈亏值=21783,交易次数=100        期望值=3390
                总盈亏率(1/1000)=21783,平均盈亏率(1/1000)=217,盈利交易率(1/1000)=560
                赢利次数=56,赢利总值=24641
                亏损次数=44,亏损总值=2858
                平盘次数=0

####说明板块的g60>g250有意义，而g的g60>g250无意义，不如g60>g120

extend_days ==>15
pre_ev:
        评估:总盈亏值=13505,交易次数=55 期望值=4537
                总盈亏率(1/1000)=13505,平均盈亏率(1/1000)=245,盈利交易率(1/1000)=563
                赢利次数=31,赢利总值=14821
                亏损次数=24,亏损总值=1316
                平盘次数=0
                闭合交易明细:


extend_days ==>20
pre_ev:
        评估:总盈亏值=13464,交易次数=58 期望值=4218
                总盈亏率(1/1000)=13464,平均盈亏率(1/1000)=232,盈利交易率(1/1000)=551
                赢利次数=32,赢利总值=14899
                亏损次数=26,亏损总值=1435
                平盘次数=0
                闭合交易明细:



cs,g = gand(stock.g5 >= stock.g60,stock.g60 >= stock.g120,stock.g120 >= stock.g250)
pre_ev:
        评估:总盈亏值=8225,交易次数=37  期望值=4111
                总盈亏率(1/1000)=8225,平均盈亏率(1/1000)=222,盈利交易率(1/1000)= 513
                赢利次数=19,赢利总值=9198
                亏损次数=18,亏损总值=973
                平盘次数=0

cs = gand(c.g20>=c.g60,c.g60>=c.g120,c.g120>=c.g250,s<=6600)
g = gand(stock.g5 >= stock.g60,stock.g60 >= stock.g120,stock.g120 >= stock.g250)   
pre_ev:
        评估:总盈亏值=13542,交易次数=103        期望值=1723
                总盈亏率(1/1000)=13542,平均盈亏率(1/1000)=131,盈利交易率(1/1000)=417
                赢利次数=43,赢利总值=18131
                亏损次数=60,亏损总值=4589
                平盘次数=0

cs = gand(c.g20>=c.g60,c.g60>=c.g120,c.g120>=c.g250,s<=6600)
g = gand(stock.g20 >= stock.g60,stock.g60 >= stock.g120,stock.g120 >= stock.g250)   
        评估:总盈亏值=17753,交易次数=116        期望值=2067
                总盈亏率(1/1000)=17753,平均盈亏率(1/1000)=153,盈利交易率(1/1000) =448
                赢利次数=52,赢利总值=22532
                亏损次数=64,亏损总值=4779
                平盘次数=0

cs = gand(c.g5<c.g20,c.g20>=c.g60,c.g60>=c.g120,c.g120>=c.g250,s<=6600) #5/20反手
g = gand(stock.g20 >= stock.g60,stock.g60 >= stock.g120,stock.g120 >= stock.g250)   
pre_ev:
        评估:总盈亏值=12169,交易次数=69 期望值=2146
                总盈亏率(1/1000)=12169,平均盈亏率(1/1000)=176,盈利交易率(1/1000)=420
                赢利次数=29,赢利总值=15475
                亏损次数=40,亏损总值=3306
                平盘次数=0


##2009-04-03
#1 测试四线理顺并冲击60日高点
    c_extractor = lambda c,s:gand(c.g5 >= c.g20,c.g20>=c.g60,c.g60>=c.g120,c.g120>=c.g250,s<=6600)
    g = gand(stock.g5>=stock.g20,stock.g20 >= stock.g60,stock.g60 >= stock.g120,stock.g120 >= stock.g250)
    ma_above = gand(greater(ma10,ma20),greater(ma20,ma60),greater(ma60,ma120))        
    t120

pre_ev:
        评估:总盈亏值=14511,交易次数=109        期望值=1847
                总盈亏率(1/1000)=14511,平均盈亏率(1/1000)=133,盈利交易率(1/1000)=522
                赢利次数=57,赢利总值=18303
                亏损次数=52,亏损总值=3792
                平盘次数=0


    c_extractor = lambda c,s:gand(c.g5 >= c.g20,c.g20>=c.g60,c.g60>=c.g120,c.g120>=c.g250,s>=3300,s<=6600)
pre_ev:
        评估:总盈亏值=12593,交易次数=86 期望值=2000
                总盈亏率(1/1000)=12593,平均盈亏率(1/1000)=146,盈利交易率(1/1000)=523
                赢利次数=45,赢利总值=15619
                亏损次数=41,亏损总值=3026
                平盘次数=0
                闭合交易明细:

去掉t120
pre_ev:
        评估:总盈亏值=14422,交易次数=111        期望值=1816
                总盈亏率(1/1000)=14422,平均盈亏率(1/1000)=129,盈利交易率(1/1000)=513
                赢利次数=57,赢利总值=18303
                亏损次数=54,亏损总值=3881
                平盘次数=0
                闭合交易明细:



#测试macd
    g = gand(stock.g5 >= stock.g20,stock.g20 >= stock.g60,stock.g60 >= stock.g120,stock.g120 >= stock.g250)
    c_extractor = lambda c,s:gand(c.g5 >= c.g20,c.g20>=c.g60,c.g60>=c.g120,c.g120>=c.g250,s>=3300,s<=6600)
    t120

pre_ev:
        评估:总盈亏值=8782,交易次数=51  期望值=2915
                总盈亏率(1/1000)=8782,平均盈亏率(1/1000)=172,盈利交易率(1/1000)=431
                赢利次数=22,赢利总值=10521
                亏损次数=29,亏损总值=1739
                平盘次数=0

添加ma_above
pre_ev:
        评估:总盈亏值=9159,交易次数=37  期望值=3478
                总盈亏率(1/1000)=9159,平均盈亏率(1/1000)=247,盈利交易率(1/1000)= 540
                赢利次数=20,赢利总值=10379
                亏损次数=17,亏损总值=1220
                平盘次数=0

cs<=6600
pre_ev:
        评估:总盈亏值=10899,交易次数=44 期望值=3207
                总盈亏率(1/1000)=10899,平均盈亏率(1/1000)=247,盈利交易率(1/1000)=522
                赢利次数=23,赢利总值=12526
                亏损次数=21,亏损总值=1627
                平盘次数=0

去掉t120:
pre_ev:
        评估:总盈亏值=10914,交易次数=45 期望值=3142
                总盈亏率(1/1000)=10914,平均盈亏率(1/1000)=242,盈利交易率(1/1000=533
                赢利次数=24,赢利总值=12541
                亏损次数=21,亏损总值=1627
                平盘次数=0


#测试gtest
g60:5 X 20
    g = gand(stock.g5 >= stock.g20,stock.g20 >= stock.g60,stock.g60 >= stock.g120,stock.g120 >= stock.g250)
    t120
    ma_above

pre_ev:
        评估:总盈亏值=34261,交易次数=716        期望值=602
                总盈亏率(1/1000)=34261,平均盈亏率(1/1000)=47,盈利交易率(1/1000)=350
                赢利次数=251,赢利总值=70706
                亏损次数=464,亏损总值=36445
                平盘次数=1

添加cs  ###
pre_ev:
        评估:总盈亏值=8645,交易次数=43  期望值=3722
                总盈亏率(1/1000)=8645,平均盈亏率(1/1000)=201,盈利交易率(1/1000)=604
                赢利次数=26,赢利总值=9575
                亏损次数=17,亏损总值=930
                平盘次数=0
去掉ma_above
pre_ev:
        评估:总盈亏值=8253,交易次数=80  期望值=1839
                总盈亏率(1/1000)=8253,平均盈亏率(1/1000)=103,盈利交易率(1/1000)=475
                赢利次数=38,赢利总值=10636
                亏损次数=42,亏损总值=2383
                平盘次数=0
ma_above改为10>20>60 (即去掉60>120) #会导致信号发出时间的变化
        评估:总盈亏值=5666,交易次数=46  期望值=2236
                总盈亏率(1/1000)=5666,平均盈亏率(1/1000)=123,盈利交易率(1/1000)=391
                赢利次数=18,赢利总值=7222
                亏损次数=28,亏损总值=1556
                平盘次数=0
                闭合交易明细:


在此基础上，t120改为t60
pre_ev:
        评估:总盈亏值=7701,交易次数=64  期望值=2105
                总盈亏率(1/1000)=7701,平均盈亏率(1/1000)=120,盈利交易率(1/1000)= 437
                赢利次数=28,赢利总值=9755
                亏损次数=36,亏损总值=2054
                平盘次数=0
    与t120+ma_above相比缺乏意义。

去掉t120:


#g,cs,t120,ma_above
g250:5 X 20
pre_ev:
        评估:总盈亏值=5273,交易次数=39  期望值=2596
                总盈亏率(1/1000)=5273,平均盈亏率(1/1000)=135,盈利交易率(1/1000)=461
                赢利次数=18,赢利总值=6371
                亏损次数=21,亏损总值=1098
                平盘次数=0

g250:5 X 67
pre_ev:
        评估:总盈亏值=3742,交易次数=18  期望值=2875
                总盈亏率(1/1000)=3742,平均盈亏率(1/1000)=207,盈利交易率(1/1000)=555
                赢利次数=10,赢利总值=4322
                亏损次数=8,亏损总值=580
                平盘次数=0
g250:10 X 67
pre_ev:
        评估:总盈亏值=2905,交易次数=17  期望值=2500
                总盈亏率(1/1000)=2905,平均盈亏率(1/1000)=170,盈利交易率(1/1000)=764
                赢利次数=13,赢利总值=3177
                亏损次数=4,亏损总值=272
                平盘次数=0

去掉t120,无变化
pre_ev:
        评估:总盈亏值=2905,交易次数=17  期望值=2500
                总盈亏率(1/1000)=2905,平均盈亏率(1/1000)=170,盈利交易率(1/1000)=
764
                赢利次数=13,赢利总值=3177
                亏损次数=4,亏损总值=272
                平盘次数=0


#g,cs,ma10>20>60>120
pre_ev:
        评估:总盈亏值=28557,交易次数=409        期望值=985
                总盈亏率(1/1000)=28557,平均盈亏率(1/1000)=69,盈利交易率(1/1000)=344
                赢利次数=141,赢利总值=47570
                亏损次数=268,亏损总值=19013
                平盘次数=0


##svama2
20 X 100
    g = gand(stock.g5>=stock.g20,stock.g20 >= stock.g60,stock.g60 >= stock.g120)
    ma_above = gand(greater(ma10,ma20),greater(ma20,ma60),greater(ma60,ma120))    
    t120

        评估:总盈亏值=71417,交易次数=901        期望值=1097
                总盈亏率(1/1000)=71417,平均盈亏率(1/1000)=79,盈利交易率(1/1000)=388
                赢利次数=350,赢利总值=111083
                亏损次数=550,亏损总值=39666
                平盘次数=1

添加cs
pre_ev:
        评估:总盈亏值=20804,交易次数=104        期望值=2777
                总盈亏率(1/1000)=20804,平均盈亏率(1/1000)=200,盈利交易率(1/1000)=538
                赢利次数=56,赢利总值=24219
                亏损次数=47,亏损总值=3415
                平盘次数=1

        #去掉t120
        pre_ev:
        评估:总盈亏值=23229,交易次数=112        期望值=2875
                总盈亏率(1/1000)=23229,平均盈亏率(1/1000)=207,盈利交易率(1/1000)=571
                赢利次数=64,赢利总值=26644
                亏损次数=47,亏损总值=3415
                平盘次数=1
        
        #ma_above改为10>20>60,去掉120
        pre_ev:
        评估:总盈亏值=25824,交易次数=221        期望值=1731
                总盈亏率(1/1000)=25824,平均盈亏率(1/1000)=116,盈利交易率(1/1000)=425
                赢利次数=94,赢利总值=34306
                亏损次数=125,亏损总值=8482
                平盘次数=2


        #ma_above改为 10>20>60>120>250
        pre_ev:
        评估:总盈亏值=17221,交易次数=89 期望值=2608
                总盈亏率(1/1000)=17221,平均盈亏率(1/1000)=193,盈利交易率(1/1000)=550
                赢利次数=49,赢利总值=20129
                亏损次数=39,亏损总值=2908
                平盘次数=1

        #ma_above: 5>10>20>60>120
        pre_ev:
        评估:总盈亏值=14359,交易次数=66 期望值=2893
                总盈亏率(1/1000)=14359,平均盈亏率(1/1000)=217,盈利交易率(1/1000)=560
                赢利次数=37,赢利总值=16536
                亏损次数=29,亏损总值=2177
                平盘次数=0


        #ma_above:20>60>120     #没有意义，相比10>20>60>120，添加的行中得失参半
        pre_ev:
        评估:总盈亏值=24214,交易次数=137        期望值=2478
                总盈亏率(1/1000)=24214,平均盈亏率(1/1000)=176,盈利交易率(1/1000)=532
                赢利次数=73,赢利总值=28713
                亏损次数=63,亏损总值=4499
                平盘次数=1

        #确定ma_above为10>20>60>120
        #测试g,目前为20>60>120
        pre_ev:
        评估:总盈亏值=23229,交易次数=112        期望值=2875
                总盈亏率(1/1000)=23229,平均盈亏率(1/1000)=207,盈利交易率(1/1000)=571
                赢利次数=64,赢利总值=26644
                亏损次数=47,亏损总值=3415
                平盘次数=1
                闭合交易明细:
        
        #添加 5>20,无意义
        pre_ev:
        评估:总盈亏值=11720,交易次数=64 期望值=2731
                总盈亏率(1/1000)=11720,平均盈亏率(1/1000)=183,盈利交易率(1/1000)=562
                赢利次数=36,赢利总值=13605
                亏损次数=28,亏损总值=1885
                平盘次数=0
        #添加120>250    #有意义，但筛除掉部分是26:25/10xxx:16xx，也相当有用
        pre_ev:
        评估:总盈亏值=14626,交易次数=60 期望值=3075
                总盈亏率(1/1000)=14626,平均盈亏率(1/1000)=243,盈利交易率(1/1000)=633
                赢利次数=38,赢利总值=16364
                亏损次数=22,亏损总值=1738
                平盘次数=0
        
        #确定g为20>60>120，且120>250为进一步的确认
        在此基础上，去掉cs
        pre_ev:
        评估:总盈亏值=126956,交易次数=2312      期望值=750
                总盈亏率(1/1000)=126956,平均盈亏率(1/1000)=54,盈利交易率(1/1000)=332
                赢利次数=768,赢利总值=238994
                亏损次数=1539,亏损总值=112038
                平盘次数=5
        


        添加g20:3300-6600
        pre_ev:
        评估:总盈亏值=52550,交易次数=342        期望值=2185
                总盈亏率(1/1000)=52550,平均盈亏率(1/1000)=153,盈利交易率(1/1000)=494
                赢利次数=169,赢利总值=64675
                亏损次数=173,亏损总值=12125
                平盘次数=0

        g20<3300:
        评估:总盈亏值=358,交易次数=50   期望值=162
                总盈亏率(1/1000)=358,平均盈亏率(1/1000)=7,盈利交易率(1/1000)=200

                赢利次数=10,赢利总值=2094
                亏损次数=40,亏损总值=1736
                平盘次数=0

        g20>8500:
        pre_ev:
        评估:总盈亏值=37414,交易次数=1442       期望值=324
                总盈亏率(1/1000)=37414,平均盈亏率(1/1000)=25,盈利交易率(1/1000)=262
                赢利次数=379,赢利总值=119888
                亏损次数=1060,亏损总值=82474
                平盘次数=3
        
        g20:4000-7000
        pre_ev:
        评估:总盈亏值=59399,交易次数=395        期望值=2173
                总盈亏率(1/1000)=59399,平均盈亏率(1/1000)=150,盈利交易率(1/1000)=501
                赢利次数=198,赢利总值=72865
                亏损次数=195,亏损总值=13466
                平盘次数=2
        g20:4000-7000,g60<=3300
        pre_ev:
        评估:总盈亏值=9481,交易次数=38  期望值=6225 ##
                总盈亏率(1/1000)=9481,平均盈亏率(1/1000)=249,盈利交易率(1/1000)=631
                赢利次数=24,赢利总值=10052
                亏损次数=14,亏损总值=571
                平盘次数=0
        
        g20:4500-7500
        pre_ev:
        评估:总盈亏值=68454,交易次数=522        期望值=1871
                总盈亏率(1/1000)=68454,平均盈亏率(1/1000)=131,盈利交易率(1/1000)=513
                赢利次数=268,赢利总值=86268
                亏损次数=252,亏损总值=17814
                平盘次数=2
        g20:4000-7500:
        pre_ev:
        评估:总盈亏值=72372,交易次数=552        期望值=1898
                总盈亏率(1/1000)=72372,平均盈亏率(1/1000)=131,盈利交易率(1/1000)=509
                赢利次数=281,赢利总值=91082
                亏损次数=269,亏损总值=18710
                平盘次数=2

        g20:3000-7500:
        评估:总盈亏值=73390,交易次数=586        期望值=1811
                总盈亏率(1/1000)=73390,平均盈亏率(1/1000)=125,盈利交易率(1/1000)=498
                赢利次数=292,赢利总值=93560
                亏损次数=292,亏损总值=20170
                平盘次数=2

        g20:2500-7500:
        评估:总盈亏值=73724,交易次数=588        期望值=1838
                总盈亏率(1/1000)=73724,平均盈亏率(1/1000)=125,盈利交易率(1/1000)=496
                赢利次数=292,赢利总值=93723
                亏损次数=294,亏损总值=19999
                平盘次数=2

        g20:2000-7000:
        评估:总盈亏值=60820,交易次数=442        期望值=2075
                总盈亏率(1/1000)=60820,平均盈亏率(1/1000)=137,盈利交易率(1/1000)=477
                赢利次数=211,赢利总值=76035
                亏损次数=229,亏损总值=15215
                平盘次数=2
                闭合交易明细:
        g20:3000-8000
        pre_ev:
        评估:总盈亏值=91939,交易次数=721        期望值=1895
                总盈亏率(1/1000)=91939,平均盈亏率(1/1000)=127,盈利交易率(1/1000)=479
                赢利次数=346,赢利总值=117285
                亏损次数=373,亏损总值=25346
                平盘次数=2
        
        g20:3500-8500
        评估:总盈亏值=110975,交易次数=920       期望值=1764
                总盈亏率(1/1000)=110975,平均盈亏率(1/1000)=120,盈利交易率(1/1000)=458
                赢利次数=422,赢利总值=144939
                亏损次数=496,亏损总值=33964
                平盘次数=2
                闭合交易明细:


        g20:4500-7500,g20-g60>1500
        pre_ev:
        评估:总盈亏值=22931,交易次数=94 期望值=3283
                总盈亏率(1/1000)=22931,平均盈亏率(1/1000)=243,盈利交易率(1/1000)=574
                赢利次数=54,赢利总值=25891
                亏损次数=40,亏损总值=2960
                平盘次数=0
                闭合交易明细:
        

        g20:3300-6600,g60:3300-6600
        pre_ev:
        评估:总盈亏值=41782,交易次数=286        期望值=2027
                总盈亏率(1/1000)=41782,平均盈亏率(1/1000)=146,盈利交易率(1/1000)=479
                赢利次数=137,赢利总值=52530
                亏损次数=149,亏损总值=10748
                平盘次数=0
        
        
        g20<=8000,g20-g60>1000,g60-g120>1000
        评估:总盈亏值=38016,交易次数=154        期望值=3514
                总盈亏率(1/1000)=38016,平均盈亏率(1/1000)=246,盈利交易率(1/1000)=577
                赢利次数=89,赢利总值=42593
                亏损次数=65,亏损总值=4577
                平盘次数=0
        

        g20:3000-7000,g20-g60>1000,g60-g120>1000
        评估:总盈亏值=42129,交易次数=220        期望值=2728
                总盈亏率(1/1000)=42129,平均盈亏率(1/1000)=191,盈利交易率(1/1000=536
                赢利次数=118,赢利总值=49293
                亏损次数=102,亏损总值=7164
                平盘次数=0



        g20:3000-8000,g20-g60>1000,g60-g120>1000    ####
        评估:总盈亏值=38016,交易次数=154        期望值=3514
                总盈亏率(1/1000)=38016,平均盈亏率(1/1000)=246,盈利交易率(1/1000)=577
                赢利次数=89,赢利总值=42593
                亏损次数=65,亏损总值=4577
                平盘次数=0

            #不设g20约束，g20:0-10000
            评估:总盈亏值=52821,交易次数=420        期望值=1712
                总盈亏率(1/1000)=52821,平均盈亏率(1/1000)=125,盈利交易率(1/1000)=442
                赢利次数=186,赢利总值=69982
                亏损次数=233,亏损总值=17161
                平盘次数=1


        g20:3000-8000,g20-g60>500,g60-g120>500
        评估:总盈亏值=62697,交易次数=381        期望值=2277
                总盈亏率(1/1000)=62697,平均盈亏率(1/1000)=164,盈利交易率(1/1000)=519
                赢利次数=198,赢利总值=75809
                亏损次数=182,亏损总值=13112
                平盘次数=1

        
        g20:4000-7500,,g20-g60>1000,g60-g120>1000
        评估:总盈亏值=28503,交易次数=117        期望值=3283
                总盈亏率(1/1000)=28503,平均盈亏率(1/1000)=243,盈利交易率(1/1000)=606
                赢利次数=71,赢利总值=31922
                亏损次数=46,亏损总值=3419
                平盘次数=0

        
        g20>g60+1500,g60>g120+1500,g20<7500
        pre_ev:
        评估:总盈亏值=8015,交易次数=32  期望值=2808
                总盈亏率(1/1000)=8015,平均盈亏率(1/1000)=250,盈利交易率(1/1000)=656
                赢利次数=21,赢利总值=8998
                亏损次数=11,亏损总值=983
                平盘次数=0

        g20>g60+2000,g60>g120+1000,g20<7500 #过犹不及
        评估:总盈亏值=6302,交易次数=25  期望值=2520
                总盈亏率(1/1000)=6302,平均盈亏率(1/1000)=252,盈利交易率(1/1000)=720
                赢利次数=18,赢利总值=7002
                亏损次数=7,亏损总值=700
                平盘次数=0
                闭合交易明细:

        g20>g60+2000,g20<8000
        评估:总盈亏值=27179,交易次数=140        期望值=2852
                总盈亏率(1/1000)=27179,平均盈亏率(1/1000)=194,盈利交易率(1/1000)=521
                赢利次数=73,赢利总值=31767
                亏损次数=67,亏损总值=4588
                平盘次数=0

        g20>g60+1000,g60>g120+1000,g20>7000
        评估:总盈亏值=34780,交易次数=356        期望值=1328
                总盈亏率(1/1000)=34780,平均盈亏率(1/1000)=97,盈利交易率(1/1000)=410
                赢利次数=146,赢利总值=50118
                亏损次数=209,亏损总值=15338
                平盘次数=1
        
        g20>g60+1000,g60>g120+1000,g20:3300-6600
        评估:总盈亏值=12060,交易次数=41 期望值=4260
                总盈亏率(1/1000)=12060,平均盈亏率(1/1000)=294,盈利交易率(1/1000)=658
                赢利次数=27,赢利总值=13039
                亏损次数=14,亏损总值=979
                平盘次数=0

        #因此g20>g60+1000,g60>g120+1000,g20:3000-8000 + ma_above(10>20>60>120)是黄金手，区分度为8674/2680705 = 1/309
                #20090416 29915/2682256 = 1/89
        #测试cs
        在此基础上添加cs没有增值效用
    
        #去掉g, cs: 5>20>60>120>250 + ma_above
        评估:总盈亏值=45369,交易次数=689        期望值=890
                总盈亏率(1/1000)=45369,平均盈亏率(1/1000)=65,盈利交易率(1/1000)=345
                赢利次数=238,赢利总值=78509
                亏损次数=448,亏损总值=33140
                平盘次数=3

        #5>20>60>120>250，间隔都是500
        评估:总盈亏值=8416,交易次数=66  期望值=1953
                总盈亏率(1/1000)=8416,平均盈亏率(1/1000)=127,盈利交易率(1/1000)=378
                赢利次数=25,赢利总值=11024
                亏损次数=40,亏损总值=2608
                平盘次数=1
                闭合交易明细:
        #5>20>60>120>250,其中20-60-120间隔为1000
        评估:总盈亏值=6721,交易次数=102 期望值=942
                总盈亏率(1/1000)=6721,平均盈亏率(1/1000)=65,盈利交易率(1/1000)=323
                赢利次数=33,赢利总值=11541
                亏损次数=69,亏损总值=4820
                平盘次数=0

        #20>60>120>250,其中20-60-120间隔为1000
        评估:总盈亏值=15930,交易次数=342        期望值=657
                总盈亏率(1/1000)=15930,平均盈亏率(1/1000)=46,盈利交易率(1/1000)=315
                赢利次数=108,赢利总值=32459
                亏损次数=234,亏损总值=16529
                平盘次数=0

        #20>60>120>250,其中20-60-120间隔为1000,s>=3300,s<=6600
        评估:总盈亏值=11370,交易次数=118        期望值=1371
                总盈亏率(1/1000)=11370,平均盈亏率(1/1000)=96,盈利交易率(1/1000)=398
                赢利次数=47,赢利总值=16381
                亏损次数=71,亏损总值=5011
                平盘次数=0
        
        #cs不能作为单独的筛选条件
        ##只能和g(20>60>120)一起，另作第二筛选条件。等同于g20:3000-8000,但过滤性太强
        c_extractor = lambda c,s:gand(c.g20>=c.g60+1000,c.g60>=c.g120+1000,c.g120>=c.g250,s>=3300,s<=6600)
        ma_above
        评估:总盈亏值=2415,交易次数=13  期望值=3135
                总盈亏率(1/1000)=2415,平均盈亏率(1/1000)=185,盈利交易率(1/1000)=461
                赢利次数=6,赢利总值=2828
                亏损次数=7,亏损总值=413
                平盘次数=0

        cs:5>20>60>120>250,s<=6600,g:20>60>120      ###银手指用法，区分度为4832/2680705 = 1/554，g是否需要添加g5>g20?不需要
        评估:总盈亏值=23229,交易次数=112        期望值=2875     ###
                总盈亏率(1/1000)=23229,平均盈亏率(1/1000)=207,盈利交易率(1/1000)=571
                赢利次数=64,赢利总值=26644
                亏损次数=47,亏损总值=3415
                平盘次数=1
        #0406结果, 不要添加t120，效果会变差
        
        cs:5>20>60>120>250, s:3300-6600, g:20>60+1000,60>120+1000
        评估:总盈亏值=7894,交易次数=24  期望值=4259
                总盈亏率(1/1000)=7894,平均盈亏率(1/1000)=328,盈利交易率(1/1000)=625
                赢利次数=15,赢利总值=8589
                亏损次数=9,亏损总值=695
                平盘次数=0


        cs:5>20>60>120>250, s<=6600, g:20>60+1000,60>120+1000
        评估:总盈亏值=8125,交易次数=28  期望值=3258
                总盈亏率(1/1000)=8125,平均盈亏率(1/1000)=290,盈利交易率(1/1000)=607
                赢利次数=17,赢利总值=9110
                亏损次数=11,亏损总值=985
                平盘次数=0
                闭合交易明细:


12X170
re_ev:
       评估:总盈亏值=15896,交易次数=85 期望值=2710
               总盈亏率(1/1000)=15896,平均盈亏率(1/1000)=187,盈利交易率(1/1000)=458
               赢利次数=39,赢利总值=19036
               亏损次数=45,亏损总值=3140
               平盘次数=1

        #去掉t120
        评估:总盈亏值=17176,交易次数=95 期望值=2608
                总盈亏率(1/1000)=17176,平均盈亏率(1/1000)=180,盈利交易率(1/1000)=494
                赢利次数=47,赢利总值=20419
                亏损次数=47,亏损总值=3243
                平盘次数=1



关于分析
1 
#情形1  g20-60-120温和放大,每次都在1000-1800(1200)以内,或者60-120 快速(>1500),20-60慢速(<1000)，g20低位更佳
#情形2  g20-60-120, 60>120 1000以上,20<60 1500以内
#情形3  g20-60-120, 节奏加快,如20>60+2000,60>120+1000, 这个有风险,而且不小. 加快后仍然是小幅没问题
不能太小,都小于3000就没劲了
而且g60不能比g120小,小了也不行
g20不能超过8000,否则没戏
#情形4 g20-60-120 等幅且大幅,都大于2000
#情形5 始终在4000-7000范围内小幅增长？


#20090406
##测试对象  svama2  20 X 100
#1 反速测试
    g = gand(stock.g20 >= stock.g60,stock.g60 >= stock.g120,stock.g20-stock.g60>=(stock.g60-stock.g120)*3/2)

        评估:总盈亏值=65441,交易次数=903        期望值=947
                总盈亏率(1/1000)=65441,平均盈亏率(1/1000)=72,盈利交易率(1/1000)=374
                赢利次数=338,赢利总值=108764
                亏损次数=563,亏损总值=43323
                平盘次数=2
    
    #反了
    g = gand(stock.g60 >= stock.g20,stock.g60 >= stock.g120,stock.g20>=3000,stock.g20<=8000)
        评估:总盈亏值=37654,交易次数=757        期望值=700
                总盈亏率(1/1000)=37654,平均盈亏率(1/1000)=49,盈利交易率(1/1000)=336
                赢利次数=255,赢利总值=73033
                亏损次数=500,亏损总值=35379
                平盘次数=2
    
    g = gand(stock.g60 >= stock.g20,stock.g60 >= stock.g120,stock.g60-stock.g20>=(stock.g60-stock.g120),stock.g60-stock.g20<=(stock.g60-stock.g120)*2,stock.g20>=3000,stock.g20<=8000)
        评估:总盈亏值=21888,交易次数=302        期望值=1028
                总盈亏率(1/1000)=21888,平均盈亏率(1/1000)=72,盈利交易率(1/1000)=370
                赢利次数=112,赢利总值=35076
                亏损次数=188,亏损总值=13188
                平盘次数=2
                闭合交易明细:
    
#2  调整测试
        g = gand(stock.g20 >= stock.g60,stock.g60 >= stock.g120,stock.g20>=3000,stock.g20<=8000,stock.g20-stock.g60>=stock.g60-stock.g120) 
        评估:总盈亏值=63747,交易次数=440        期望值=2149
                总盈亏率(1/1000)=63747,平均盈亏率(1/1000)=144,盈利交易率(1/1000)=506
                赢利次数=223,赢利总值=78380
                亏损次数=216,亏损总值=14633
                平盘次数=1

        g = gand(stock.g20 >= stock.g60,stock.g60 >= stock.g120,stock.g20>=3000,stock.g20<=8000,stock.g20-stock.g60<=stock.g60-stock.g120)
        评估:总盈亏值=46432,交易次数=355        期望值=1884
                总盈亏率(1/1000)=46432,平均盈亏率(1/1000)=130,盈利交易率(1/1000)=481
                赢利次数=171,赢利总值=59241
                亏损次数=183,亏损总值=12809

        #g = gand(stock.g20 >= stock.g60+1000,stock.g60 >= stock.g120+1000,stock.g20>=3000,stock.g20<=8000,stock.g20-stock.g60>=stock.g60-stock.g120)
        评估:总盈亏值=22365,交易次数=84 期望值=3800
                总盈亏率(1/1000)=22365,平均盈亏率(1/1000)=266,盈利交易率(1/1000)=583
                赢利次数=49,赢利总值=24822
                亏损次数=35,亏损总值=2457
                平盘次数=0
        
        #g = gand(stock.g20 >= stock.g60+1000,stock.g60 >= stock.g120+1000,stock.g20>=3000,stock.g20<=8000,stock.g20-stock.g60<=stock.g60-stock.g120)
        评估:总盈亏值=17594,交易次数=75 期望值=3342
                总盈亏率(1/1000)=17594,平均盈亏率(1/1000)=234,盈利交易率(1/1000)=600
                赢利次数=45,赢利总值=19714
                亏损次数=30,亏损总值=2120
                平盘次数=0

        
        g = gand(stock.g20 >= stock.g60+1200,stock.g60 >= stock.g120+1200,stock.g20>=3000,stock.g20<=8000,stock.g20-stock.g60>=stock.g60-stock.g120)
        评估:总盈亏值=11980,交易次数=42 期望值=4253
                总盈亏率(1/1000)=11980,平均盈亏率(1/1000)=285,盈利交易率(1/1000)=547
                赢利次数=23,赢利总值=13253
                亏损次数=19,亏损总值=1273
                平盘次数=0
                闭合交易明细:

        g = gand(stock.g20 >= stock.g60+1200,stock.g60 >= stock.g120+600,stock.g60<=stock.g120+1200,stock.g20>=3000,stock.g20<=8000)     
        评估:总盈亏值=21795,交易次数=111        期望值=2760
                总盈亏率(1/1000)=21795,平均盈亏率(1/1000)=196,盈利交易率(1/1000)=540
                赢利次数=60,赢利总值=25464
                亏损次数=51,亏损总值=3669
                平盘次数=0
                闭合交易明细:
        


#3 小步测试
    g = gand(stock.g20 >= stock.g60,stock.g60 >= stock.g120,stock.g20-stock.g60<=(stock.g60-stock.g120)*2/3)
pre_ev:
        评估:总盈亏值=48109,交易次数=1209       期望值=527
                总盈亏率(1/1000)=48109,平均盈亏率(1/1000)=39,盈利交易率(1/1000)=291
                赢利次数=352,赢利总值=111729
                亏损次数=855,亏损总值=63620
                平盘次数=2

    g = gand(stock.g20 >= stock.g60,stock.g60 >= stock.g120,stock.g20-stock.g60<=(stock.g60-stock.g120)*2/3,stock.g20-stock.g120>=2000)
        评估:总盈亏值=26720,交易次数=563        期望值=618
                总盈亏率(1/1000)=26720,平均盈亏率(1/1000)=47,盈利交易率(1/1000)=335
                赢利次数=189,赢利总值=55466
                亏损次数=374,亏损总值=28746
                平盘次数=0

    g = gand(stock.g20 >= stock.g60,stock.g60 >= stock.g120,stock.g20-stock.g60<=500,stock.g20-stock.g60<=(stock.g60-stock.g120)*2/3)
        评估:总盈亏值=28872,交易次数=834        期望值=459
                总盈亏率(1/1000)=28872,平均盈亏率(1/1000)=34,盈利交易率(1/1000)=272
                赢利次数=227,赢利总值=73779
                亏损次数=606,亏损总值=44907
                平盘次数=1
                闭合交易明细:

#4 平衡测试
    g = gand(stock.g20 >= stock.g60,stock.g60 >= stock.g120,stock.g20>=3000,stock.g20<=8000,stock.g60>=3000,stock.g120>=3000)
pre_ev:
        评估:总盈亏值=67223,交易次数=576        期望值=1633
                总盈亏率(1/1000)=67223,平均盈亏率(1/1000)=116,盈利交易率(1/1000)=456
                赢利次数=263,赢利总值=89511
                亏损次数=311,亏损总值=22288
                平盘次数=2


#20090406
#对已有的csvamax系列,因为其筛选条件类似银手指,所以不再适用金手指(会导致结果为空),只能起到事后筛选作用


#股票120涨跌家数的线，及其5和20日均线，可以作为非常重要的撤离标志
它在2007.09中旬就发出了显著的下跌信号
同时，5上叉20，并一直在20日上，可作为强势信号
为敏感计，1日上叉20也可

sdatas = srun.extract_collect(sdata.values(),CLOSE)
x120a=(increase(sdatas,120)>0).sum(0)
x120=x120a*1000/length  #规范化为百分比
ma120_5= ma(x120,5)
ma120_20= ma(x120,20)

###
惊呆，大盘的60均线向上居然和金手指暗合？至少对tsvama 20X100，对其中选出的154个交易没有筛选作用
    gfilter = strend(ma(ref.transaction[CLOSE],60))>0
120，250都很符合

#另，尝试选择大盘大跌日实体为攻击态小阴小阳的，小阳为佳，长上影也不错
#比如090408的抚顺特钢，上海梅林，新潮实业，长城电脑、广东甘化、西藏旅游
并且n线理顺之后，大部分时间小阴小阳，并且总体幅度不大

#或者，在裸信号发出后，要求10日内g信号也发出，否则作废。这个相当于宽松了

#对排名都大于8500的，也测试一下 （中国软件20090311）


#2009-04-15
#需要处理指数的成交量问题
因为其成交量很大,会导致在计算中溢出,所以在读入时必须处理
首先修改fxj.py,碰到指数时/1000
然后
select * from dune_sdayquote where sstock like 'SZ399%' or 'SH000%'

select * from dune_xdayquote dx
join dune_stockcode dsc on dx.tstock_id = dsc.id
where code like 'SZ399%' or code like 'SH000%'


select * from dune_xdayquote dx
join dune_stockcode dsc on dx.tstock_id = dsc.id
where code='SH000004'

#select * from dune_sdayquote where tvolume>20000000

update dune_sdayquote set tvolume = tvolume / 1000 where sstock like 'SZ399%' or sstock like 'SH000%'

update dune_xdayquote set tvolume = tvolume / 1000 where tstock_id in (select id from dune_stockcode where code like 'SZ399%' or code like 'SH000%')

select * from dune_sdayquote where sstock='SH000004' and tdate>20090401


#2009-04-16
#1 对筛选条件的再考虑
金手指+ma_above
g20>g60+1000 and g60>g120+1000 and g20>=3000 and g20 <=8000，ma_above
信号: 29915
总数: 2682256
区分度: 1/89

银手指+ma_above
lambda c,s:gand(c.g5 >= c.g20,c.g20>=c.g60,c.g60>=c.g120,c.g120>=c.g250,s<=6600), ma_above
信号:76533
总数: 2682256
区分度:1/35

金手指+银手指+ma_above
信号: 1405
总数: 2682256
区分度: 1/1909  #因此不能同时用于上
评估:总盈亏值=31667,交易次数=290        期望值=1535
                总盈亏率(1/1000)=31667,平均盈亏率(1/1000)=109,盈利交易率(1/1000)=365
                赢利次数=106,赢利总值=44814
                亏损次数=183,亏损总值=13147
                平盘次数=1

金手指+银手指
信号: 7732
总数: 2682256
区分度: 1/346
期望为负，不能用于直接交易


金手指+银手指+t120
信号: 1590
总数: 2682256
区分度: 1/1686
评估:总盈亏值=39290,交易次数=477        期望值=1154
                总盈亏率(1/1000)=39290,平均盈亏率(1/1000)=82,盈利交易率(1/1000)=314
                赢利次数=150,赢利总值=62705
                亏损次数=326,亏损总值=23415
                平盘次数=1

金手指+银手指+ref.t120
信号: 3800
总数: 2682256
区分度: 1/705
        评估:总盈亏值=35317,交易次数=1322       期望值=426
                总盈亏率(1/1000)=35317,平均盈亏率(1/1000)=26,盈利交易率(1/1000)=298
                赢利次数=395,赢利总值=92452
                亏损次数=922,亏损总值=57135
                平盘次数=5
                闭合交易明细:


金手指+银手指+ma_above+ma5>ma10
信号: 516
总数: 2682256
区分度: 1/5198
评估:总盈亏值=29163,交易次数=206        期望值=1880
                总盈亏率(1/1000)=29163,平均盈亏率(1/1000)=141,盈利交易率(1/1000)=422
                赢利次数=87,赢利总值=38080
                亏损次数=118,亏损总值=8917
                平盘次数=1
                闭合交易明细:


拇指+银手指+ma_above+ma5>ma10
信号: 6508
总数: 2682256
区分度: 1/412
评估:总盈亏值=24639,交易次数=413        期望值=880
                总盈亏率(1/1000)=24639,平均盈亏率(1/1000)=59,盈利交易率(1/1000)=334
                赢利次数=138,赢利总值=42948
                亏损次数=273,亏损总值=18309
                平盘次数=2


拇指+银手指+ma_above        #以此为筛网为好,t120可自愿加入
信号: 16779
总数: 2682256
区分度: 1/159
pre_ev:
        评估:总盈亏值=21037,交易次数=508        期望值=611
                总盈亏率(1/1000)=21037,平均盈亏率(1/1000)=41,盈利交易率(1/1000)=301
                赢利次数=153,赢利总值=44705
                亏损次数=353,亏损总值=23668
                平盘次数=2


拇指+银手指+ma_above+t120
信号: 2695
总数: 2682256
区分度: 1/995
        评估:总盈亏值=21028,交易次数=466        期望值=681
                总盈亏率(1/1000)=21028,平均盈亏率(1/1000)=45,盈利交易率(1/1000)=311
                赢利次数=145,赢利总值=42395
                亏损次数=319,亏损总值=21367
                平盘次数=2
                闭合交易明细:


gauze:

pre_ev:
        评估:总盈亏值=15035,交易次数=783        期望值=271
                总盈亏率(1/1000)=15035,平均盈亏率(1/1000)=19,盈利交易率(1/1000)=268
                赢利次数=210,赢利总值=55529
                亏损次数=573,亏损总值=40494
                平盘次数=0

#2 新的测试
#2.1 大盘大跌日实体为攻击态小阴小阳的，小阳为佳，长上影也不错
    signals = gand(stock.ks >= -5,stock.ks<=5,stock.ref.ks<-30)

#a      sbuy = gand(signals,stock.thumb,stock.t120)
        评估:总盈亏值=11226,交易次数=82 期望值=1789
                总盈亏率(1/1000)=11226,平均盈亏率(1/1000)=136,盈利交易率(1/1000)=512
                赢利次数=42,赢利总值=14291
                亏损次数=40,亏损总值=3065
                平盘次数=0

        #若去掉ks<=5上限,则
        评估:总盈亏值=28988,交易次数=185        期望值=2136
                总盈亏率(1/1000)=28988,平均盈亏率(1/1000)=156,盈利交易率(1/1000)=481
                赢利次数=89,赢利总值=36047
                亏损次数=96,亏损总值=7059
                平盘次数=0
        
        #[-5,101)
        评估:总盈亏值=37026,交易次数=218        期望值=2380
                总盈亏率(1/1000)=37026,平均盈亏率(1/1000)=169,盈利交易率(1/1000)=504
                赢利次数=110,赢利总值=44760
                亏损次数=108,亏损总值=7734
                平盘次数=0

        #ks改为[-5,20]
        评估:总盈亏值=25628,交易次数=124        期望值=2861
                总盈亏率(1/1000)=25628,平均盈亏率(1/1000)=206,盈利交易率(1/1000)=540
                赢利次数=67,赢利总值=29767
                亏损次数=57,亏损总值=4139
                平盘次数=0

        #ks:[0,20)
        评估:总盈亏值=19315,交易次数=108        期望值=2405
                总盈亏率(1/1000)=19315,平均盈亏率(1/1000)=178,盈利交易率(1/1000)=527
                赢利次数=57,赢利总值=23101
                亏损次数=51,亏损总值=3786
                平盘次数=0

        #ks:(5,20)          #ref.ks<=-30
        评估:总盈亏值=18651,交易次数=53 期望值=5571
                总盈亏率(1/1000)=18651,平均盈亏率(1/1000)=351,盈利交易率(1/1000)=603
                赢利次数=32,赢利总值=19981
                亏损次数=21,亏损总值=1330
                平盘次数=0

                #ref.ks < -30
                评估:总盈亏值=16664,交易次数=44 期望值=6000
                    总盈亏率(1/1000)=16664,平均盈亏率(1/1000)=378,盈利交易率(1/1000)=613
                    赢利次数=27,赢利总值=17738
                    亏损次数=17,亏损总值=1074
                    平盘次数=0
        #ks:[5,20)      
        评估:总盈亏值=18670,交易次数=56 期望值=5123
                总盈亏率(1/1000)=18670,平均盈亏率(1/1000)=333,盈利交易率(1/1000)=589
                赢利次数=33,赢利总值=20185
                亏损次数=23,亏损总值=1515
                平盘次数=0


        #ks:[5,20]          ####最佳
        评估:总盈亏值=20610,交易次数=66 期望值=4394
                总盈亏率(1/1000)=20610,平均盈亏率(1/1000)=312,盈利交易率(1/1000)=590
                赢利次数=39,赢利总值=22542
                亏损次数=27,亏损总值=1932
                平盘次数=0

        #ks:[5,30)
        评估:总盈亏值=18983,交易次数=71 期望值=3814
                总盈亏率(1/1000)=18983,平均盈亏率(1/1000)=267,盈利交易率(1/1000)=521
                赢利次数=37,赢利总值=21377
                亏损次数=34,亏损总值=2394
                平盘次数=0

        #ks:[5,25)
        评估:总盈亏值=18699,交易次数=61 期望值=4250
                总盈亏率(1/1000)=18699,平均盈亏率(1/1000)=306,盈利交易率(1/1000)=540
                赢利次数=33,赢利总值=20729
                亏损次数=28,亏损总值=2030
                平盘次数=0

        #ks:[-5:0):
        评估:总盈亏值=6313,交易次数=16  期望值=6793
                总盈亏率(1/1000)=6313,平均盈亏率(1/1000)=394,盈利交易率(1/1000)=625
                赢利次数=10,赢利总值=6666
                亏损次数=6,亏损总值=353
                平盘次数=0
                闭合交易明细:

        #ks:[-10:0)
        评估:总盈亏值=14156,交易次数=87 期望值=2025
                总盈亏率(1/1000)=14156,平均盈亏率(1/1000)=162,盈利交易率(1/1000)=540
                赢利次数=47,赢利总值=17357
                亏损次数=40,亏损总值=3201
                平盘次数=0
                闭合交易明细:

        #ks:[-7:0]
        评估:总盈亏值=9877,交易次数=69  期望值=1743
                总盈亏率(1/1000)=9877,平均盈亏率(1/1000)=143,盈利交易率(1/1000)=507
                赢利次数=35,赢利总值=12686
                亏损次数=34,亏损总值=2809
                平盘次数=0
        
        #ks:[-6:0]
        评估:总盈亏值=9396,交易次数=64  期望值=1848
                总盈亏率(1/1000)=9396,平均盈亏率(1/1000)=146,盈利交易率(1/1000)=500
                赢利次数=32,赢利总值=11934
                亏损次数=32,亏损总值=2538
                平盘次数=0

        #ks:[-5,0]+[5,20] ref.ks<=-30
        评估:总盈亏值=27336,交易次数=123        期望值=3000
                总盈亏率(1/1000)=27336,平均盈亏率(1/1000)=222,盈利交易率(1/100=544
                赢利次数=67,赢利总值=31496
                亏损次数=56,亏损总值=4160
                平盘次数=0
                闭合交易明细:

        #ks:[-5,0)+[5,20)   ref.ks<=-30     ########选择A
        评估:总盈亏值=26818,交易次数=74 期望值=5838
                总盈亏率(1/1000)=26818,平均盈亏率(1/1000)=362,盈利交易率(1/1000)=621
                赢利次数=46,赢利总值=28575
                亏损次数=28,亏损总值=1757
                平盘次数=0

        #ks:[-5,0)+[5,20)   ref.ks<-30
        评估:总盈亏值=22792,交易次数=62 期望值=5734
                总盈亏率(1/1000)=22792,平均盈亏率(1/1000)=367,盈利交易率(1/1000)=596
                赢利次数=37,赢利总值=24404
                亏损次数=25,亏损总值=1612
                平盘次数=0



        #[20,101)
        评估:总盈亏值=14412,交易次数=88 期望值=2263
                总盈亏率(1/1000)=14412,平均盈亏率(1/1000)=163,盈利交易率(1/1000)=488
                赢利次数=43,赢利总值=17660
                亏损次数=45,亏损总值=3248
                平盘次数=0

        #[5,101)
        评估:总盈亏值=32942,交易次数=145        期望值=3242
                总盈亏率(1/1000)=32942,平均盈亏率(1/1000)=227,盈利交易率(1/1000)=517
                赢利次数=75,赢利总值=37904
                亏损次数=70,亏损总值=4962
                平盘次数=0


#a1     去掉thumb
        signals = gand(stock.ks >=5,stock.ks<=20,stock.ref.ks<=-30)
        sbuy = gand(signals,stock.t120)

        评估:总盈亏值=113108,交易次数=1476      期望值=894
                总盈亏率(1/1000)=113108,平均盈亏率(1/1000)=76,盈利交易率(1/1000)=344
                赢利次数=509,赢利总值=195478
                亏损次数=966,亏损总值=82370
                平盘次数=1
        


#a2 添加g
    signals = gand(stock.ks >=5,stock.ks<=20,stock.ref.ks<=-30)
    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g120 >= s.g250)
    sbuy = gand(signals,stock.t120,g)

        评估:总盈亏值=30914,交易次数=256        期望值=1481
                总盈亏率(1/1000)=30914,平均盈亏率(1/1000)=120,盈利交易率(1/1000)=386
                赢利次数=99,赢利总值=43783
                亏损次数=157,亏损总值=12869
                平盘次数=0
                闭合交易明细:


    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g120 >= s.g250,s.g20<=8500)
        评估:总盈亏值=21872,交易次数=92 期望值=3338
                总盈亏率(1/1000)=21872,平均盈亏率(1/1000)=237,盈利交易率(1/1000)=521
                赢利次数=48,赢利总值=25035
                亏损次数=44,亏损总值=3163
                平盘次数=0
    

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g120 >= s.g250,s.g20<=8500,s.g20>3000)
        评估:总盈亏值=21955,交易次数=90 期望值=3328
                总盈亏率(1/1000)=21955,平均盈亏率(1/1000)=243,盈利交易率(1/1000)=533
                赢利次数=48,赢利总值=25035
                亏损次数=42,亏损总值=3080
                平盘次数=0

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g120 >= s.g250,s.g20<=8000,s.g20>=3000)   #等效于thumb,果然thumb最佳
        评估:总盈亏值=20610,交易次数=66 期望值=4394
                总盈亏率(1/1000)=20610,平均盈亏率(1/1000)=312,盈利交易率(1/1000)=590
                赢利次数=39,赢利总值=22542
                亏损次数=27,亏损总值=1932
                平盘次数=0



#b      
    signals = gand(stock.ks >=5,stock.ks<=20,stock.ref.ks<=-30)
    sbuy = gand(signals,stock.thumb,stock.above)
        ks:[-5,5]
        评估:总盈亏值=9662,交易次数=60  期望值=1987
                总盈亏率(1/1000)=9662,平均盈亏率(1/1000)=161,盈利交易率(1/1000)=516
                赢利次数=31,赢利总值=12029
                亏损次数=29,亏损总值=2367
                平盘次数=0
                闭合交易明细:

        #[-5,100)
        评估:总盈亏值=20375,交易次数=124        期望值=2309
                总盈亏率(1/1000)=20375,平均盈亏率(1/1000)=164,盈利交易率(1/1000=516
                赢利次数=64,赢利总值=24645
                亏损次数=60,亏损总值=4270
                平盘次数=0
        
        #[5,20]
        评估:总盈亏值=12328,交易次数=43 期望值=4468
                总盈亏率(1/1000)=12328,平均盈亏率(1/1000)=286,盈利交易率(1/1000)=534
                赢利次数=23,赢利总值=13611
                亏损次数=20,亏损总值=1283
                平盘次数=0

        #[-5,0]
        评估:总盈亏值=8628,交易次数=48  期望值=2130
                总盈亏率(1/1000)=8628,平均盈亏率(1/1000)=179,盈利交易率(1/1000)=500
                赢利次数=24,赢利总值=10649
                亏损次数=24,亏损总值=2021
        
        #[20,101)
        评估:总盈亏值=13800,交易次数=59 期望值=3426
                总盈亏率(1/1000)=13800,平均盈亏率(1/1000)=233,盈利交易率(1/1000)=610
                赢利次数=36,赢利总值=15365
                亏损次数=23,亏损总值=1565
                平盘次数=0

        #[5,101)
        评估:总盈亏值=24578,交易次数=95 期望值=4095
                总盈亏率(1/1000)=24578,平均盈亏率(1/1000)=258,盈利交易率(1/1000)=578
                赢利次数=55,赢利总值=27125
                亏损次数=40,亏损总值=2547
                平盘次数=0

        #[5,60]
        评估:总盈亏值=23714,交易次数=87 期望值=4533
                总盈亏率(1/1000)=23714,平均盈亏率(1/1000)=272,盈利交易率(1/1000)=574
                赢利次数=50,赢利总值=25961
                亏损次数=37,亏损总值=2247
                平盘次数=0

        #[5,75], ref:[,-30]     #同[5,75)
        评估:总盈亏值=23919,交易次数=92 期望值=4111
                总盈亏率(1/1000)=23919,平均盈亏率(1/1000)=259,盈利交易率(1/1000)=565
                赢利次数=52,赢利总值=26461
                亏损次数=40,亏损总值=2542
                平盘次数=0

        #(5,75]
        评估:总盈亏值=24187,交易次数=89 期望值=4442     ###
                总盈亏率(1/1000)=24187,平均盈亏率(1/1000)=271,盈利交易率(1/1000)=584
                赢利次数=52,赢利总值=26461
                亏损次数=37,亏损总值=2274
                平盘次数=0

        #[5,75),ref.ks<=-30


        [-5,75]
        评估:总盈亏值=27067,交易次数=140        期望值=2838
                总盈亏率(1/1000)=27067,平均盈亏率(1/1000)=193,盈利交易率(1/1000)=542
                赢利次数=76,赢利总值=31440
                亏损次数=64,亏损总值=4373
                平盘次数=0

        [-1,75]
        评估:总盈亏值=23768,交易次数=130        期望值=2600
                总盈亏率(1/1000)=23768,平均盈亏率(1/1000)=182,盈利交易率(1/1000)=538
                赢利次数=70,赢利总值=27994
                亏损次数=60,亏损总值=4226
                平盘次数=0
        
        ##[0,75]          #####选择此处
        评估:总盈亏值=27223,交易次数=106        期望值=4063
                总盈亏率(1/1000)=27223,平均盈亏率(1/1000)=256,盈利交易率(1/1000)=584
                赢利次数=62,赢利总值=30004
                亏损次数=44,亏损总值=2781
                平盘次数=0
        
        
        #去掉thumb
        signals = gand(stock.ks >0,stock.ks<=75,stock.ref.ks<=-30)
        sbuy = gand(signals,stock.above)

        评估:总盈亏值=120425,交易次数=1964      期望值=701
                总盈亏率(1/1000)=120425,平均盈亏率(1/1000)=61,盈利交易率(1/1000)=384
                赢利次数=755,赢利总值=225451
                亏损次数=1204,亏损总值=105026
                平盘次数=5


#b.1    above + t120
    signals = gand(stock.ks >-5,stock.ks<=75,stock.ref.ks<=-30)
    sbuy = gand(signals,stock.above,stock.thumb,stock.t120)


        #(0,75] 添加t120
        评估:总盈亏值=27306,交易次数=105        期望值=4193
                总盈亏率(1/1000)=27306,平均盈亏率(1/1000)=260,盈利交易率(1/1000)=590
                赢利次数=62,赢利总值=30004
                亏损次数=43,亏损总值=2698
                平盘次数=0

        #(-5,75]
        评估:总盈亏值=27280,交易次数=138        期望值=2940
                总盈亏率(1/1000)=27280,平均盈亏率(1/1000)=197,盈利交易率(1/1000)=550
                赢利次数=76,赢利总值=31440
                亏损次数=62,亏损总值=4160
                平盘次数=0


#c      sbuy = gand(signals,stock.golden,stock.above)

#d      单独使用silver
        signals = gand(stock.ks >=5,stock.ks<=20,stock.ref.ks<=-30)
        sbuy = gand(signals,stock.silver,stock.t120)
        评估:总盈亏值=8297,交易次数=65  期望值=2540
                总盈亏率(1/1000)=8297,平均盈亏率(1/1000)=127,盈利交易率(1/1000)=353
                赢利次数=23,赢利总值=10422
                亏损次数=42,亏损总值=2125
                平盘次数=0
                闭合交易明细:

#d1 thumb+silver+t120   #反作用
        评估:总盈亏值=998,交易次数=8    期望值=1512
                总盈亏率(1/1000)=998,平均盈亏率(1/1000)=124,盈利交易率(1/1000)=500
                赢利次数=4,赢利总值=1326
                亏损次数=4,亏损总值=328
                平盘次数=0
                闭合交易明细:


#e  合并结果
    threshold = -30
    s11 = gand(stock.ks >=-5,stock.ks<0,stock.ref.ks<=threshold)
    s12 = gand(stock.ks >=5,stock.ks<20,stock.ref.ks<=threshold)
    s1 = bor(s11,s12)
    s_tt = gand(s1,stock.thumb,stock.t120)
    s21 = gand(stock.ks>=5,stock.ks<75,stock.ref.ks<=threshold)
    s_aa = gand(s21,stock.thumb,stock.above)
    sbuy = bor(s_aa,s_tt)

        评估:总盈亏值=40450,交易次数=132        期望值=4935
                总盈亏率(1/1000)=40450,平均盈亏率(1/1000)=306,盈利交易率(1/1000)=606
                赢利次数=80,赢利总值=43722
                亏损次数=52,亏损总值=3272
                平盘次数=0

            #thumb改为golden
            评估:总盈亏值=23213,交易次数=76 期望值=4919
                总盈亏率(1/1000)=23213,平均盈亏率(1/1000)=305,盈利交易率(1/1000)=592
                赢利次数=45,赢利总值=25162
                亏损次数=31,亏损总值=1949
                平盘次数=0
            
            #都改成above
            评估:总盈亏值=32075,交易次数=107        期望值=4901
                总盈亏率(1/1000)=32075,平均盈亏率(1/1000)=299,盈利交易率(1/1000)=588
                赢利次数=63,赢利总值=34764
                亏损次数=44,亏损总值=2689
                平盘次数=0
            #都改成t120
            评估:总盈亏值=41157,交易次数=154        期望值=3985
                总盈亏率(1/1000)=41157,平均盈亏率(1/1000)=267,盈利交易率(1/1000)=551
                赢利次数=85,赢利总值=45793
                亏损次数=69,亏损总值=4636
                平盘次数=0
        #添加条件ref.t120
            评估:总盈亏值=40533,交易次数=131        期望值=4983
                总盈亏率(1/1000)=40533,平均盈亏率(1/1000)=309,盈利交易率(1/1000)=610
                赢利次数=80,赢利总值=43722
                亏损次数=51,亏损总值=3189
                平盘次数=0
            将ref.t120改为strend(ref.ma60)>0        #貌似一样
                评估:总盈亏值=40533,交易次数=131        期望值=4983
                    总盈亏率(1/1000)=40533,平均盈亏率(1/1000)=309,盈利交易率(1/1000)=610
                    赢利次数=80,赢利总值=43722
                    亏损次数=51,亏损总值=3189
                    平盘次数=0
        
        #添加条件ref.above              ##########
        评估:总盈亏值=40697,交易次数=129        期望值=5163
                总盈亏率(1/1000)=40697,平均盈亏率(1/1000)=315,盈利交易率(1/1000)=620
                赢利次数=80,赢利总值=43722
                亏损次数=49,亏损总值=3025
                平盘次数=0
                闭合交易明细:


        #改为    sbuy = gand(signals,greater(ref.ma10,ref.ma20),greater(ref.ma20,ref.ma60))，效果同上
            评估:总盈亏值=40697,交易次数=129        期望值=5163
                总盈亏率(1/1000)=40697,平均盈亏率(1/1000)=315,盈利交易率(1/1000)=620
                赢利次数=80,赢利总值=43722
                亏损次数=49,亏损总值=3025
                平盘次数=0

        #添加范围删除       below = (t[CLOSE] - t[LOW]) * BASE / t[CLOSE]
            sbuy = gand(signals,greater(ref.ma10,ref.ma20),greater(ref.ma20,ref.ma60),below<10)
            评估:总盈亏值=5753,交易次数=13  期望值=13000
                总盈亏率(1/1000)=5753,平均盈亏率(1/1000)=442,盈利交易率(1/1000)=692
                赢利次数=9,赢利总值=5891
                亏损次数=4,亏损总值=138
                平盘次数=0

            #sbuy = gand(signals,greater(ref.ma10,ref.ma20),greater(ref.ma20,ref.ma60),below<20)
            评估:总盈亏值=11835,交易次数=26 期望值=17500
                总盈亏率(1/1000)=11835,平均盈亏率(1/1000)=455,盈利交易率(1/1000)=769
                赢利次数=20,赢利总值=11993
                亏损次数=6,亏损总值=158
                平盘次数=0
                闭合交易明细:
            
            #sbuy = gand(signals,greater(ref.ma10,ref.ma20),greater(ref.ma20,ref.ma60),below<50)
            评估:总盈亏值=33137,交易次数=99 期望值=5964
                总盈亏率(1/1000)=33137,平均盈亏率(1/1000)=334,盈利交易率(1/1000)=626
                赢利次数=62,赢利总值=35238
                亏损次数=37,亏损总值=2101
                平盘次数=0
                闭合交易明细:

        #添加下影线删除     oc = np.select([t[CLOSE]<t[OPEN]],[t[CLOSE]],default=t[OPEN])
                            below = (oc - t[LOW]) * BASE / rollx(t[CLOSE])
        
            sbuy = gand(signals,greater(ref.ma10,ref.ma20),greater(ref.ma20,ref.ma60),below<10)
            评估:总盈亏值=15007,交易次数=35 期望值=7379
                总盈亏率(1/1000)=15007,平均盈亏率(1/1000)=428,盈利交易率(1/1000)=657
                赢利次数=23,赢利总值=15704
                亏损次数=12,亏损总值=697
                平盘次数=0

            sbuy = gand(signals,greater(ref.ma10,ref.ma20),greater(ref.ma20,ref.ma60),below<20)
            评估:总盈亏值=27839,交易次数=73 期望值=6927
                总盈亏率(1/1000)=27839,平均盈亏率(1/1000)=381,盈利交易率(1/1000)=739
                赢利次数=54,赢利总值=28885
                亏损次数=19,亏损总值=1046
                平盘次数=0

            sbuy = gand(signals,greater(ref.ma10,ref.ma20),greater(ref.ma20,ref.ma60),below<30)
            评估:总盈亏值=32960,交易次数=93 期望值=5900
                总盈亏率(1/1000)=32960,平均盈亏率(1/1000)=354,盈利交易率(1/1000)=666
                赢利次数=62,赢利总值=34836
                亏损次数=31,亏损总值=1876
                平盘次数=0

            sbuy = gand(signals,greater(ref.ma10,ref.ma20),greater(ref.ma20,ref.ma60),below<40)
            评估:总盈亏值=38145,交易次数=116        期望值=5655
                总盈亏率(1/1000)=38145,平均盈亏率(1/1000)=328,盈利交易率(1/1000)=629
                赢利次数=73,赢利总值=40644
                亏损次数=43,亏损总值=2499
                平盘次数=0
                闭合交易明细:


    threshold=-25   #增加部分无意义
        评估:总盈亏值=47521,交易次数=203        期望值=3391
                总盈亏率(1/1000)=47521,平均盈亏率(1/1000)=234,盈利交易率(1/1000)=571
                赢利次数=116,赢利总值=53608
                亏损次数=87,亏损总值=6087
                平盘次数=0
                闭合交易明细:
    
    threshold = -35     #说明大盘跌幅越大,这类选出的股票其弹性越好
        评估:总盈亏值=25820,交易次数=75 期望值=5212
                总盈亏率(1/1000)=25820,平均盈亏率(1/1000)=344,盈利交易率(1/1000)=626
                赢利次数=47,赢利总值=27682
                亏损次数=28,亏损总值=1862
                平盘次数=0
                闭合交易明细:


    threshold = -40     
        评估:总盈亏值=24145,交易次数=56 期望值=7305
                总盈亏率(1/1000)=24145,平均盈亏率(1/1000)=431,盈利交易率(1/1000)=642
                赢利次数=36,赢利总值=25336
                亏损次数=20,亏损总值=1191
                平盘次数=0


    threshold = -50                 #再往上,意义就不大. 很大程度上昭示着大盘崩溃
        评估:总盈亏值=4950,交易次数=14  期望值=4525
                总盈亏率(1/1000)=4950,平均盈亏率(1/1000)=353,盈利交易率(1/1000)=642
                赢利次数=9,赢利总值=5343
                亏损次数=5,亏损总值=393
    

#比如090408的抚顺特钢，上海梅林，新潮实业，长城电脑、广东甘化、西藏旅游
并且n线理顺之后，大部分时间小阴小阳，并且总体幅度不大

#或者，在裸信号发出后，要求10日内g信号也发出，否则作废。这个相当于宽松了
#对排名都大于8500的，也测试一下 （中国软件20090311）



### 探查它20090218之后的downlimit,看为什么没有卖出
SH600565	B	20090218	price=4710	volume=1000

没问题，其当日(o+c)/2=5.12, atr=0.305, 5.12-.305*1.2 = 4.75左右

#2009-04-24
#大跌后不靠spring和gcs选出的股票，尤其是vama系列(s,cs,v)选出的，很有前途
如 0423选出的600146

#2009-04-25
大盘
一根放量阳线，是上涨信号。所谓放量，貌似应当在前日110%以上？还是仅仅大于即可？
连续上量阳线，是强势信号
单根放量阴线或两根缩量阴线，都是下跌信号，如果是连续两根阴线，后者放量，则是强势下跌信号
另，设置强势数：
    阳为1，增量阳为2
    阴为-1，增量阴为-2
    然后统计最近7/13天内的总数，看有无筛选作用



#20090428

golden/thumb
    si = score2(t[CLOSE],t[VOLUME])
    mxi = gand(msum(si,5)>=-2,msum(si,5)<=1)
    sbuy = gand(stock.golden,stock.silver,stock.above,ma5>stock.ma10,stock.ref.t120,mxi)

[-2,1]
        评估:总盈亏值=20915,交易次数=97 期望值=3028
                总盈亏率(1/1000)=20915,平均盈亏率(1/1000)=215,盈利交易率(1/1000)=474
                赢利次数=46,赢利总值=24573
                亏损次数=51,亏损总值=3658
                平盘次数=0
[-2,0]
        评估:总盈亏值=14094,交易次数=71 期望值=2911
                总盈亏率(1/1000)=14094,平均盈亏率(1/1000)=198,盈利交易率(1/1000)=492
                赢利次数=35,赢利总值=16562
                亏损次数=36,亏损总值=2468
                平盘次数=0

[-3,0]
        评估:总盈亏值=17333,交易次数=83 期望值=3200
                总盈亏率(1/1000)=17333,平均盈亏率(1/1000)=208,盈利交易率(1/1000)=542
                赢利次数=45,赢利总值=19747
                亏损次数=37,亏损总值=2414
                平盘次数=1

[:0]    ####    xgcs
        评估:总盈亏值=19350,交易次数=87 期望值=3313
                总盈亏率(1/1000)=19350,平均盈亏率(1/1000)=222,盈利交易率(1/1000)=540
                赢利次数=47,赢利总值=21991
                亏损次数=39,亏损总值=2641
                平盘次数=1

    thumb:
        评估:总盈亏值=20131,交易次数=173        期望值=2000
                总盈亏率(1/1000)=20131,平均盈亏率(1/1000)=116,盈利交易率(1/1000)=456
                赢利次数=79,赢利总值=25626
                亏损次数=94,亏损总值=5495
                平盘次数=0
    

[:1]
        评估:总盈亏值=22924,交易次数=111        期望值=2942
                总盈亏率(1/1000)=22924,平均盈亏率(1/1000)=206,盈利交易率(1/1000)=486
                赢利次数=54,赢利总值=26868
                亏损次数=56,亏损总值=3944
                平盘次数=1
                闭合交易明细:
                        stock=SH600036 盈亏值=10992320:,盈亏率(1/1000):476

[1:]
        评估:总盈亏值=21331,交易次数=160        期望值=1773
                总盈亏率(1/1000)=21331,平均盈亏率(1/1000)=133,盈利交易率(1/1000)=418
                赢利次数=67,赢利总值=28310
                亏损次数=93,亏损总值=6979
                平盘次数=0
                闭合交易明细:

[3:]
        评估:总盈亏值=12813,交易次数=128        期望值=1282
                总盈亏率(1/1000)=12813,平均盈亏率(1/1000)=100,盈利交易率(1/1000)=421
                赢利次数=54,赢利总值=18606
                亏损次数=74,亏损总值=5793
                平盘次数=0
                闭合交易明细:


#2009-04-30
#对于check2的结果
目测感觉
g20-60-120的数据，首先间隔>1000(至少500)为好
其次，g20>5000为好
再次，三者均衡为好，g120不能太小。g20-60-120的差距也不能太大，临近减法大于被减数
    另，如果有差值大于2000，貌似也有问题？
第四，弱市里面g120不能太高？>4000可能是个问题？

评估结果:   
    g20:[g60:g60+500],g60:[g120:g120+500] 较好,且此时g120:[6000-8000]为好

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g120 >= s.g250,s.g20>=3000,s.g20<=8000)
    signals = gand(g,stock.above,stock.ref.t120)

        评估:总盈亏值=-4839,交易次数=2749       期望值=-31
                总盈亏率(1/1000)=-4839,平均盈亏率(1/1000)=-2,盈利交易率(1/1000)=332
                赢利次数=914,赢利总值=113674
                亏损次数=1822,亏损总值=118513
                平盘次数=13



    g = gand(s.g20 >= s.g60+500,s.g60 >= s.g120+500,s.g120 >= s.g250,s.g20>=3000,s.g20<=8000)
        评估:总盈亏值=-7268,交易次数=1503       期望值=-76
                总盈亏率(1/1000)=-7268,平均盈亏率(1/1000)=-5,盈利交易率(1/1000)=324
                赢利次数=487,赢利总值=59817
                亏损次数=1011,亏损总值=67085
                平盘次数=5
                闭合交易明细:


    g = gand(s.g20 >= s.g60+1000,s.g60 >= s.g120+1000,s.g120 >= s.g250,s.g20>=3000,s.g20<=8000)
        评估:总盈亏值=9947,交易次数=693 期望值=212
                总盈亏率(1/1000)=9947,平均盈亏率(1/1000)=14,盈利交易率(1/1000)=307
                赢利次数=213,赢利总值=41663
                亏损次数=479,亏损总值=31716
                平盘次数=1
                闭合交易明细:

    g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120 >= s.g250,s.g20>=3000,s.g20<=8000)
        评估:总盈亏值=23806,交易次数=595        期望值=579
                总盈亏率(1/1000)=23806,平均盈亏率(1/1000)=40,盈利交易率(1/1000)=321
                赢利次数=191,赢利总值=51485
                亏损次数=401,亏损总值=27679
                平盘次数=3

    g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120 >= s.g250,s.g120>=2000,s.g20<=8000)
        评估:总盈亏值=25475,交易次数=613        期望值=594
                总盈亏率(1/1000)=25475,平均盈亏率(1/1000)=41,盈利交易率(1/1000)=327
                赢利次数=201,赢利总值=53787
                亏损次数=409,亏损总值=28312
                平盘次数=3

    g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120 >= s.g250,s.g120>=3000,s.g20<=8000)
        评估:总盈亏值=25429,交易次数=583        期望值=623
                总盈亏率(1/1000)=25429,平均盈亏率(1/1000)=43,盈利交易率(1/1000)=325
                赢利次数=190,赢利总值=52470
                亏损次数=390,亏损总值=27041
                平盘次数=3


        g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120 >= s.g250,s.g20>=3000,s.g20<=5000)
        评估:总盈亏值=7627,交易次数=144 期望值=693
                总盈亏率(1/1000)=7627,平均盈亏率(1/1000)=52,盈利交易率(1/1000)=333
                赢利次数=48,赢利总值=14870
                亏损次数=96,亏损总值=7243
                平盘次数=0

    g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120 >= s.g250,s.g120>=s.g250+500,s.g120>=3000,s.g20<=8000)
        评估:总盈亏值=24720,交易次数=485        期望值=735
                总盈亏率(1/1000)=24720,平均盈亏率(1/1000)=50,盈利交易率(1/1000)=329
                赢利次数=160,赢利总值=46767
                亏损次数=322,亏损总值=22047
                平盘次数=3
                闭合交易明细:

    g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120>=s.g250+500,s.g250>=1000,s.g20<=8000)
        评估:总盈亏值=26343,交易次数=489        期望值=768
                总盈亏率(1/1000)=26343,平均盈亏率(1/1000)=53,盈利交易率(1/1000)=333
                赢利次数=163,赢利总值=48716
                亏损次数=323,亏损总值=22373
                平盘次数=3

    g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120>=s.g250+500,s.g250>=1500,s.g20<=8000)
        评估:总盈亏值=25007,交易次数=476        期望值=753
                总盈亏率(1/1000)=25007,平均盈亏率(1/1000)=52,盈利交易率(1/1000)=329
                赢利次数=157,赢利总值=46857
                亏损次数=316,亏损总值=21850
                平盘次数=3

        g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120 >= s.g250,s.g60>=3000,s.g60<=5000)
        评估:总盈亏值=9850,交易次数=169 期望值=840
                总盈亏率(1/1000)=9850,平均盈亏率(1/1000)=58,盈利交易率(1/1000)=343
                赢利次数=58,赢利总值=17559
                亏损次数=111,亏损总值=7709
                平盘次数=0


    g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120 >= s.g250,s.g20>=3000,s.g20<=8000,s.g120>=3000)
            评估:总盈亏值=25429,交易次数=583        期望值=623
                总盈亏率(1/1000)=25429,平均盈亏率(1/1000)=43,盈利交易率(1/1000)=325
                    赢利次数=190,赢利总值=52470
                    亏损次数=390,亏损总值=27041
                    平盘次数=3

    g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120 >= s.g250,s.g20>=3000,s.g20<=8000,s.g120>=4000)
        评估:总盈亏值=22006,交易次数=520        期望值=608
                总盈亏率(1/1000)=22006,平均盈亏率(1/1000)=42,盈利交易率(1/1000)=325
                赢利次数=169,赢利总值=46039
                亏损次数=348,亏损总值=24033
                平盘次数=3

    g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120 >= s.g250,s.g20>=3000,s.g20<=8000,s.g120>=5000)
            交易次数=423    期望值=823
                总盈亏率(1/1000)=23783,平均盈亏率(1/1000)=56,盈利交易率(1/1000)=328
                赢利次数=139,赢利总值=43134
                亏损次数=281,亏损总值=19351
                平盘次数=3
                闭合交易明细:

    g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120 >= s.g250,s.g20>=6000,s.g20<=8000)
        评估:总盈亏值=21385,交易次数=379        期望值=811
                总盈亏率(1/1000)=21385,平均盈亏率(1/1000)=56,盈利交易率(1/1000)=329
                赢利次数=125,赢利总值=38956
                亏损次数=252,亏损总值=17571
                平盘次数=2

    g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120 >= s.g250,s.g20>=6000,s.g20<=8500)
        评估:总盈亏值=25722,交易次数=541        期望值=671
                总盈亏率(1/1000)=25722,平均盈亏率(1/1000)=47,盈利交易率(1/1000)=301
                赢利次数=163,赢利总值=52067
                亏损次数=375,亏损总值=26345
                平盘次数=3

    g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120 >= s.g250,s.g20>=5000,s.g20<=8000)

        评估:总盈亏值=22458,交易次数=480        期望值=686
                总盈亏率(1/1000)=22458,平均盈亏率(1/1000)=46,盈利交易率(1/1000)=331
                赢利次数=159,赢利总值=43953
                亏损次数=318,亏损总值=21495
                平盘次数=3

    g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120 >= s.g250,s.g20>=3000,s.g20<=8000,s.g120>=6000)
        评估:总盈亏值=19280,交易次数=329        期望值=828
                总盈亏率(1/1000)=19280,平均盈亏率(1/1000)=58,盈利交易率(1/1000)=316
                赢利次数=104,赢利总值=34921
                亏损次数=223,亏损总值=15641

    g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120 >= s.g250)
        评估:总盈亏值=-20249,交易次数=2095      期望值=-141
                总盈亏率(1/1000)=-20249,平均盈亏率(1/1000)=-10,盈利交易率(1/1000)=262
                赢利次数=550,赢利总值=89475
                亏损次数=1537,亏损总值=109724
                平盘次数=8

    g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120 >= s.g250,s.g20>=2000,s.g20<=9000)
        评估:总盈亏值=26696,交易次数=1025       期望值=371
                总盈亏率(1/1000)=26696,平均盈亏率(1/1000)=26,盈利交易率(1/1000)=293
                赢利次数=301,赢利总值=77069
                亏损次数=719,亏损总值=50373
                平盘次数=5

    g = gand(s.g20 >= s.g60-500,s.g20 <= s.g60+500,s.g60 >= s.g120-500,s.g60<=s.g120+500,s.g120 >= s.g250,s.g20>=3000,s.g20<=8000)
        评估:总盈亏值=19268,交易次数=1463       期望值=203
                总盈亏率(1/1000)=19268,平均盈亏率(1/1000)=13,盈利交易率(1/1000)=304
                赢利次数=446,赢利总值=84428
                亏损次数=1013,亏损总值=65160
                平盘次数=4

    g = gand(s.g20 >= s.g60-100,s.g20 <= s.g60+500,s.g60 >= s.g120-100,s.g60<=s.g120+500,s.g120 >= s.g250,s.g20>=3000,s.g20<=8000)
        评估:总盈亏值=18960,交易次数=751        期望值=378
                总盈亏率(1/1000)=18960,平均盈亏率(1/1000)=25,盈利交易率(1/1000)=296
                赢利次数=223,赢利总值=54139
                亏损次数=526,亏损总值=35179
                平盘次数=2
                闭合交易明细:

    g = gand(s.g20 >= s.g60+1000,s.g60 >= s.g120+1000,s.g120 >= s.g250,s.g120>=1000,s.g20<=2*s.g60,s.g60<=2*s.g120,s.g20>=3000,s.g20<=8000)
        评估:总盈亏值=11945,交易次数=604        期望值=279
                总盈亏率(1/1000)=11945,平均盈亏率(1/1000)=19,盈利交易率(1/1000)=329
                赢利次数=199,赢利总值=39745
                亏损次数=404,亏损总值=27800
                平盘次数=1


    g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120 >= s.g250,s.g120>=2000,s.g120<=7000)
        评估:总盈亏值=24568,交易次数=499        期望值=700
                总盈亏率(1/1000)=24568,平均盈亏率(1/1000)=49,盈利交易率(1/1000)=336
                赢利次数=168,赢利总值=47556
                亏损次数=328,亏损总值=22988
                平盘次数=3

g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120>=s.g250+500,s.g250>=1000,s.g20<=8000)
signals = gand(g,stock.ref.t120)
        评估:总盈亏值=21145,交易次数=1000       期望值=350
                总盈亏率(1/1000)=21145,平均盈亏率(1/1000)=21,盈利交易率(1/1000)=290
                赢利次数=290,赢利总值=64051
                亏损次数=707,亏损总值=42906
                平盘次数=3


g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120>=s.g250+500,s.g250>=1000,s.g20<=8000)   ###
signals = gand(g,stock.t120)
        评估:总盈亏值=20139,交易次数=892        期望值=349
                总盈亏率(1/1000)=20139,平均盈亏率(1/1000)=22,盈利交易率(1/1000)=282
                赢利次数=252,赢利总值=60354
                亏损次数=637,亏损总值=40215
                平盘次数=3
                闭合交易明细:

signals = gand(g,stock.ref.t120,strend(stock.ref.ma60)>0)
        评估:总盈亏值=25281,交易次数=861        期望值=475
                总盈亏率(1/1000)=25281,平均盈亏率(1/1000)=29,盈利交易率(1/1000)=304
                赢利次数=262,赢利总值=62056
                亏损次数=597,亏损总值=36775
                平盘次数=2

signals = gand(g,stock.ref.t120,strend(ma(stock.ref.transaction[CLOSE],250))>0)
        评估:总盈亏值=25635,交易次数=786        期望值=507
                总盈亏率(1/1000)=25635,平均盈亏率(1/1000)=32,盈利交易率(1/1000)=311
                赢利次数=245,赢利总值=59696
                亏损次数=539,亏损总值=34061
                平盘次数=2

signals = gand(g,stock.ref.t120,strend(stock.ref.ma60)>0,strend(stock.ref.ma20)>0)
        评估:总盈亏值=26334,交易次数=751        期望值=564
                总盈亏率(1/1000)=26334,平均盈亏率(1/1000)=35,盈利交易率(1/1000)=310
                赢利次数=233,赢利总值=58738
                亏损次数=516,亏损总值=32404
                平盘次数=2

signals = gand(g,stock.ref.t120,strend(stock.ref.ma60)>0,strend(ma(stock.ref.transaction[CLOSE],250))>0)    ###
        评估:总盈亏值=31517,交易次数=719        期望值=661
                总盈亏率(1/1000)=31517,平均盈亏率(1/1000)=43,盈利交易率(1/1000)=346
                赢利次数=249,赢利总值=62206
                亏损次数=468,亏损总值=30689
                平盘次数=2


g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120>=s.g250+500,s.g250>=1000,s.g20<=8000)
signals = gand(g,stock.above)
        评估:总盈亏值=25297,交易次数=508        期望值=710
                总盈亏率(1/1000)=25297,平均盈亏率(1/1000)=49,盈利交易率(1/1000)=324
                赢利次数=165,赢利总值=48786
                亏损次数=340,亏损总值=23489
                平盘次数=3
                闭合交易明细:

g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120>=s.g250+500,s.g250>=1000,s.g20<=8000)
signals = gand(g,stock.above,stock.t120)
        评估:总盈亏值=24554,交易次数=492        期望值=720
                总盈亏率(1/1000)=24554,平均盈亏率(1/1000)=49,盈利交易率(1/1000)=323
                赢利次数=159,赢利总值=47132
                亏损次数=330,亏损总值=22578
                平盘次数=3


####
g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120>=s.g250+500,s.g250>=1000,s.g20<=8000)
signals = gand(g,stock.ref.t120,strend(stock.ref.ma60)>0,strend(stock.ref.ma20)>0,strend(ma(stock.ref.transaction[CLOSE],250))>0)
        评估:总盈亏值=30205,交易次数=641        期望值=712
                总盈亏率(1/1000)=30205,平均盈亏率(1/1000)=47,盈利交易率(1/1000)=344
                赢利次数=221,赢利总值=57951
                亏损次数=419,亏损总值=27746
                平盘次数=1
                闭合交易明细:

signals = gand(g,stock.ref.t120,strend(stock.ref.ma60)>0,strend(stock.ref.ma10)>0,strend(stock.ref.ma20)>0,strend(ma(stock.ref.transaction[CLOSE],250))>0)
        评估:总盈亏值=28528,交易次数=589        期望值=716
                总盈亏率(1/1000)=28528,平均盈亏率(1/1000)=48,盈利交易率(1/1000)=351
                赢利次数=207,赢利总值=54156
                亏损次数=382,亏损总值=25628
                平盘次数=0
                闭合交易明细:

g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120>=s.g250+500,s.g250>=1000,s.g20<=8000)
    signals = gand(g,stock.ref.above)
        评估:总盈亏值=29664,交易次数=639        期望值=686
                总盈亏率(1/1000)=29664,平均盈亏率(1/1000)=46,盈利交易率(1/1000)=320
                赢利次数=205,赢利总值=58805
                亏损次数=433,亏损总值=29141
                平盘次数=1

g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) #####
signals = gand(g,stock.above,ma5>stock.ma10,stock.ref.t120)

        评估:总盈亏值=50190,交易次数=1139       期望值=676
                总盈亏率(1/1000)=50190,平均盈亏率(1/1000)=44,盈利交易率(1/1000)=345
                赢利次数=394,赢利总值=98983
                亏损次数=741,亏损总值=48793
                平盘次数=4

g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) #####
signals = gand(g,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120)
        评估:总盈亏值=64216,交易次数=1383       期望值=707
                总盈亏率(1/1000)=64216,平均盈亏率(1/1000)=46,盈利交易率(1/1000)=365
                赢利次数=505,赢利总值=121672
                亏损次数=873,亏损总值=57456
                平盘次数=5

g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) #####
signals = gand(g,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=64753,交易次数=1242       期望值=787
                总盈亏率(1/1000)=64753,平均盈亏率(1/1000)=52,盈利交易率(1/1000)=370
                赢利次数=460,赢利总值=116551
                亏损次数=777,亏损总值=51798
                平盘次数=5


#2009-05-03
#1 ！！！强
def xgcs0(stock,dates):
    ''' 下穿0线
        评估:总盈亏值=23464,交易次数=81 期望值=4013
                总盈亏率(1/1000)=23464,平均盈亏率(1/1000)=289,盈利交易率(1/1000)=617
                赢利次数=50,赢利总值=25703
                亏损次数=31,亏损总值=2239
                平盘次数=0
    '''
    t = stock.transaction
    ma5 = ma(t[CLOSE],5)
    linelog(stock.code)

    si = score2(t[CLOSE],t[VOLUME])
    zs = cached_zeros(len(t[CLOSE]))
    mxi = cross(zs,si)<0

    sbuy = gand(stock.golden,stock.silver,stock.above,ma5>stock.ma10,stock.ref.t120,mxi)
    return sbuy

#2 就单独条件而言
g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120>=s.g250+500,s.g250>=1000,s.g20<=8000)
要优于golden
但几乎被筛光了

g = gand(s.g20 >= s.g60+1000,s.g60 >= s.g120+1000,s.g20>=3000,s.g20<=8000)  #golden
signals = gand(g,stock.ref.t120,strend(stock.ref.ma60)>0,strend(stock.ref.ma20)>0,strend(ma(stock.ref.transaction[CLOSE],250))>0)
        评估:总盈亏值=17955,交易次数=4429       期望值=63
                总盈亏率(1/1000)=17955,平均盈亏率(1/1000)=4,盈利交易率(1/1000)=319
                赢利次数=1414,赢利总值=208864
                亏损次数=3000,亏损总值=190909
                平盘次数=15
                闭合交易明细:


g = gand(s.g20 >= s.g60+1000,s.g60 >= s.g120+1000,s.g20>=3000,s.g20<=8000)  #golden
signals = gand(g,stock.ref.t120,stock.above)
        评估:总盈亏值=26962,交易次数=1472       期望值=276
                总盈亏率(1/1000)=26962,平均盈亏率(1/1000)=18,盈利交易率(1/1000)=341
                赢利次数=502,赢利总值=90618
                亏损次数=967,亏损总值=63656
                平盘次数=3
                闭合交易明细:

ks = np.abs((s.g20-s.g60) * 1000/(s.g60-s.g120))
g = gand(s.g20 >= s.g60+1000,s.g60 >= s.g120+1000,s.g20>=3000,s.g20<=8000,ks>=900,ks<=1100)
signals = gand(g,stock.ref.t120,strend(stock.ref.ma60)>0,strend(stock.ref.ma20)>0,strend(ma(stock.ref.transaction[CLOSE],250))>0)
        评估:总盈亏值=43064,交易次数=1291       期望值=507
                总盈亏率(1/1000)=43064,平均盈亏率(1/1000)=33,盈利交易率(1/1000)=340
                赢利次数=439,赢利总值=98455
                亏损次数=851,亏损总值=55391
                平盘次数=1


g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) #####
signals = gand(g,stock.ref.t120,strend(stock.ref.ma60)>0,strend(stock.ref.ma20)>0,strend(ma(stock.ref.transaction[CLOSE],250))>0)
    评估:总盈亏值=80002,交易次数=2217       期望值=580
                总盈亏率(1/1000)=80002,平均盈亏率(1/1000)=36,盈利交易率(1/1000)=356
                赢利次数=790,赢利总值=169139
                亏损次数=1422,亏损总值=89137
                平盘次数=5
                闭合交易明细:


g = gand(s.g20 >= s.g60-1000,s.g60 >= s.g120-1000,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000)
signals = gand(g,stock.ref.t120,strend(stock.ref.ma60)>0,strend(stock.ref.ma20)>0,strend(ma(stock.ref.transaction[CLOSE],250))>0)
        评估:总盈亏值=132464,交易次数=9171      期望值=215
                总盈亏率(1/1000)=132464,平均盈亏率(1/1000)=14,盈利交易率(1/1000)=342
                赢利次数=3142,赢利总值=527380
                亏损次数=6004,亏损总值=394916
                平盘次数=25


g = gand(s.g20 >= s.g60-500,s.g60 >= s.g120-500,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000,s.g20>=s.g120)
signals = gand(g,stock.ref.t120,strend(stock.ref.ma60)>0,strend(stock.ref.ma20)>0,strend(ma(stock.ref.transaction[CLOSE],250))>0)

        评估:总盈亏值=100430,交易次数=4785      期望值=322
                总盈亏率(1/1000)=100430,平均盈亏率(1/1000)=20,盈利交易率(1/1000)=340
                赢利次数=1629,赢利总值=296962
                亏损次数=3140,亏损总值=196532
                平盘次数=16

g = gand(s.g20 >= s.g60-500,s.g60 >= s.g120-500,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+500,s.g20>=s.g120-500)
signals = gand(g,stock.ref.t120,strend(stock.ref.ma60)>0,strend(stock.ref.ma20)>0,strend(ma(stock.ref.transaction[CLOSE],250))>0)
        评估:总盈亏值=78909,交易次数=3458       期望值=349
                总盈亏率(1/1000)=78909,平均盈亏率(1/1000)=22,盈利交易率(1/1000)=332
                赢利次数=1151,赢利总值=225152
                亏损次数=2298,亏损总值=146243
                平盘次数=9


#测试  g20/g60,g60/g120都在90-110%,但g20-g120:[0-1000]?
    ks20 = s.g20 * 1000 / s.g60
    ks60 = s.g60 * 1000 / s.g120
    g = gand(ks20>=900,ks20<=1100,ks60>=900,ks60<=1100,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+500,s.g20>=s.g120-500)
    signals = gand(g,stock.ref.t120,strend(stock.ref.ma60)>0,strend(stock.ref.ma20)>0,strend(ma(stock.ref.transaction[CLOSE],250))>0)
        评估:总盈亏值=72685,交易次数=3129       期望值=359
                总盈亏率(1/1000)=72685,平均盈亏率(1/1000)=23,盈利交易率(1/1000)=323
                赢利次数=1012,赢利总值=208869
                亏损次数=2112,亏损总值=136184
                平盘次数=5
                闭合交易明细:

    ks20 = s.g20 * 1000 / s.g60
    ks60 = s.g60 * 1000 / s.g120
    g = gand(ks20>=900,ks20<=1100,ks60>=900,ks60<=1100,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000,s.g20>=s.g120)
    signals = gand(g,stock.ref.t120,strend(stock.ref.ma60)>0,strend(stock.ref.ma20)>0,strend(ma(stock.ref.transaction[CLOSE],250))>0)
        评估:总盈亏值=58978,交易次数=2310       期望值=390
                总盈亏率(1/1000)=58978,平均盈亏率(1/1000)=25,盈利交易率(1/1000)=328
                赢利次数=758,赢利总值=159543
                亏损次数=1549,亏损总值=100565
                平盘次数=3

    ks20 = s.g20 * 1000 / s.g60
    ks60 = s.g60 * 1000 / s.g120
    g = gand(ks20>=990,ks20<=1100,ks60>=990,ks60<=1100,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000,s.g20>=s.g120)
    signals = gand(g,stock.ref.t120,strend(stock.ref.ma60)>0,strend(stock.ref.ma20)>0,strend(ma(stock.ref.transaction[CLOSE],250))>0)
        评估:总盈亏值=63138,交易次数=1559       期望值=597
                总盈亏率(1/1000)=63138,平均盈亏率(1/1000)=40,盈利交易率(1/1000)=347
                赢利次数=542,赢利总值=131155
                亏损次数=1014,亏损总值=68017
                平盘次数=3

    ks20 = s.g20 * 1000 / s.g60
    ks60 = s.g60 * 1000 / s.g120
    g = gand(ks20>=950,ks20<=1100,ks60>=950,ks60<=1100,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000,s.g20>=s.g120)
    signals = gand(g,stock.ref.t120,strend(stock.ref.ma60)>0,strend(stock.ref.ma20)>0,strend(ma(stock.ref.transaction[CLOSE],250))>0)
    评估:总盈亏值=68385,交易次数=2081       期望值=500
                总盈亏率(1/1000)=68385,平均盈亏率(1/1000)=32,盈利交易率(1/1000)=340
                赢利次数=708,赢利总值=156837
                亏损次数=1370,亏损总值=88452
                平盘次数=3

    ks20 = s.g20 * 1000 / s.g60
    ks60 = s.g60 * 1000 / s.g120
    ks120 = s.g20 * 1000 / s.g120
    g = gand(ks20>=950,ks20<=1100,ks60>=950,ks60<=1100,s.g20>=3000,s.g20<=8000,ks120<=1100,s.g20>=s.g120)
    signals = gand(g,stock.ref.t120,strend(stock.ref.ma60)>0,strend(stock.ref.ma20)>0,strend(ma(stock.ref.transaction[CLOSE],250))>0)
        评估:总盈亏值=55052,交易次数=1708       期望值=484
                总盈亏率(1/1000)=55052,平均盈亏率(1/1000)=32,盈利交易率(1/1000)=326
                赢利次数=557,赢利总值=131015
                亏损次数=1146,亏损总值=75963
                平盘次数=5

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+2000) 
    signals = gand(g,stock.ref.t120,strend(stock.ref.ma60)>0,strend(stock.ref.ma20)>0,strend(ma(stock.ref.transaction[CLOSE],250))>0)
        评估:总盈亏值=90736,交易次数=5376       期望值=253
                总盈亏率(1/1000)=90736,平均盈亏率(1/1000)=16,盈利交易率(1/1000)=354
                赢利次数=1904,赢利总值=309028
                亏损次数=3452,亏损总值=218292
                平盘次数=20
                闭合交易明细:

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20>=s.g120+2000) 
        评估:总盈亏值=71008,交易次数=8127       期望值=125
                总盈亏率(1/1000)=71008,平均盈亏率(1/1000)=8,盈利交易率(1/1000)=339
                赢利次数=2756,赢利总值=412980
                亏损次数=5335,亏损总值=341972
                平盘次数=36

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20>=s.g120+2000,s.g20-s.g60<=s.g60-s.g120) 
        评估:总盈亏值=39728,交易次数=4980       期望值=112
                总盈亏率(1/1000)=39728,平均盈亏率(1/1000)=7,盈利交易率(1/1000)=326
                赢利次数=1626,赢利总值=246904
                亏损次数=3334,亏损总值=207176


    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    ma5=ma(t[CLOSE],5)
    signals = gand(g,stock.silver,stock.above,ma5>stock.ma10,stock.ref.t120)
        评估:总盈亏值=16743,交易次数=145        期望值=1575
                总盈亏率(1/1000)=16743,平均盈亏率(1/1000)=115,盈利交易率(1/1000)=406
                赢利次数=59,赢利总值=23024
                亏损次数=86,亏损总值=6281
                平盘次数=0


    ma5=ma(t[CLOSE],5)
    signals = gand(stock.golden,stock.silver,stock.above,ma5>stock.ma10,stock.ref.t120)
        评估:总盈亏值=27398,交易次数=202        期望值=1800
                总盈亏率(1/1000)=27398,平均盈亏率(1/1000)=135,盈利交易率(1/1000)=420
                赢利次数=85,赢利总值=36101
                亏损次数=116,亏损总值=8703
                平盘次数=1


    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    signals = gand(g,stock.silver,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120)
        评估:总盈亏值=21405,交易次数=156        期望值=1876
                总盈亏率(1/1000)=21405,平均盈亏率(1/1000)=137,盈利交易率(1/1000)=442
                赢利次数=69,赢利总值=27836
                亏损次数=87,亏损总值=6431
                平盘次数=0
                闭合交易明细:


#加上macd
    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[VOLUME])
    signals = gand(g,strend(pdiff-pdea)<0,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=71376,交易次数=936        期望值=1151
                总盈亏率(1/1000)=71376,平均盈亏率(1/1000)=76,盈利交易率(1/1000)=383
                赢利次数=359,赢利总值=109855
                亏损次数=575,亏损总值=38479
                平盘次数=2

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,strend(pdiff-pdea)<0,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=79049,交易次数=835        期望值=1382
                总盈亏率(1/1000)=79049,平均盈亏率(1/1000)=94,盈利交易率(1/1000)=431
                赢利次数=360,赢利总值=111362
                亏损次数=473,亏损总值=32313
                平盘次数=2

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdiff>=pdea,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=48396,交易次数=946        期望值=761
                总盈亏率(1/1000)=48396,平均盈亏率(1/1000)=51,盈利交易率(1/1000)=361
                赢利次数=342,赢利总值=88906
                亏损次数=599,亏损总值=40510
                平盘次数=5


    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdiff-pdea>=-200,pdiff<=pdea,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=55365,交易次数=490        期望值=1696
                总盈亏率(1/1000)=55365,平均盈亏率(1/1000)=112,盈利交易率(1/1000)=418
                赢利次数=205,赢利总值=73990
                亏损次数=282,亏损总值=18625
                平盘次数=3

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdiff<pdea,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=53529,交易次数=483        期望值=1617
                总盈亏率(1/1000)=53529,平均盈亏率(1/1000)=110,盈利交易率(1/1000)=420
                赢利次数=203,赢利总值=72522
                亏损次数=278,亏损总值=18993
                平盘次数=2

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[VOLUME])
    signals = gand(g,pdiff<pdea,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=67461,交易次数=758        期望值=1257
                总盈亏率(1/1000)=67461,平均盈亏率(1/1000)=88,盈利交易率(1/1000)=412
                赢利次数=313,赢利总值=98417
                亏损次数=442,亏损总值=30956
                平盘次数=3


    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[VOLUME])
    signals = gand(g,pdea<0,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=50440,交易次数=483        期望值=1552
                总盈亏率(1/1000)=50440,平均盈亏率(1/1000)=104,盈利交易率(1/1000)=412
                赢利次数=199,赢利总值=69525
                亏损次数=281,亏损总值=19085
                平盘次数=3


    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdea>100,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=76053,交易次数=775        期望值=1342
                总盈亏率(1/1000)=76053,平均盈亏率(1/1000)=98,盈利交易率(1/1000)=416
                赢利次数=323,赢利总值=109334
                亏损次数=450,亏损总值=33281
                平盘次数=2

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdea>300,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=29722,交易次数=369        期望值=930
                总盈亏率(1/1000)=29722,平均盈亏率(1/1000)=80,盈利交易率(1/1000)=476
                赢利次数=176,赢利总值=46456
                亏损次数=193,亏损总值=16734
                平盘次数=0

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000)     #####
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdea>300,pdea<500,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=30021,交易次数=215        期望值=1759
                总盈亏率(1/1000)=30021,平均盈亏率(1/1000)=139,盈利交易率(1/1000)=544
                赢利次数=117,赢利总值=37812
                亏损次数=98,亏损总值=7791
                平盘次数=0

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdea>100,pdea<500,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=72240,交易次数=607        期望值=1750
                总盈亏率(1/1000)=72240,平均盈亏率(1/1000)=119,盈利交易率(1/1000)=418
                赢利次数=254,赢利总值=96440
                亏损次数=351,亏损总值=24200
                平盘次数=2
                闭合交易明细:

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdea>=0,pdea<=500,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=59899,交易次数=1054       期望值=888
                总盈亏率(1/1000)=59899,平均盈亏率(1/1000)=56,盈利交易率(1/1000)=363
                赢利次数=383,赢利总值=101952
                亏损次数=666,亏损总值=42053
                平盘次数=5
                闭合交易明细:

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdea>=150,pdea<=500,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=64304,交易次数=439        期望值=2000
                总盈亏率(1/1000)=64304,平均盈亏率(1/1000)=146,盈利交易率(1/1000)=446
                赢利次数=196,赢利总值=82162
                亏损次数=242,亏损总值=17858
                平盘次数=1

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000)     ####
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdea>=200,pdea<=500,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=47842,交易次数=336        期望值=1893
                总盈亏率(1/1000)=47842,平均盈亏率(1/1000)=142,盈利交易率(1/1000)=502
                赢利次数=169,赢利总值=60375
                亏损次数=166,亏损总值=12533
                平盘次数=1

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdea>=250,pdea<=500,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=38651,交易次数=270        期望值=1833
                总盈亏率(1/1000)=38651,平均盈亏率(1/1000)=143,盈利交易率(1/1000)=511
                赢利次数=138,赢利总值=48917
                亏损次数=131,亏损总值=10266
                平盘次数=1

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdiff>=200,pdiff<=500,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=58796,交易次数=366        期望值=2191
                总盈亏率(1/1000)=58796,平均盈亏率(1/1000)=160,盈利交易率(1/1000)=464
                赢利次数=170,赢利总值=73051
                亏损次数=195,亏损总值=14255
                平盘次数=1


    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdiff>=250,pdiff<=500,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=45005,交易次数=283        期望值=2148
                总盈亏率(1/1000)=45005,平均盈亏率(1/1000)=159,盈利交易率(1/1000)=494
                赢利次数=140,赢利总值=55657
                亏损次数=143,亏损总值=10652
                平盘次数=0
                闭合交易明细:

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000)     ######
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdiff>=300,pdiff<=500,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=33206,交易次数=222        期望值=2013
                总盈亏率(1/1000)=33206,平均盈亏率(1/1000)=149,盈利交易率(1/1000)=513
                赢利次数=114,赢利总值=41288
                亏损次数=108,亏损总值=8082
                平盘次数=0


    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdiff>=250,pdiff<=450,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=46127,交易次数=250        期望值=2591
                总盈亏率(1/1000)=46127,平均盈亏率(1/1000)=184,盈利交易率(1/1000)=512
                赢利次数=128,赢利总值=54846
                亏损次数=122,亏损总值=8719
                平盘次数=0
                闭合交易明细:

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdiff>=200,pdiff<=400,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=56343,交易次数=302        期望值=2657
                总盈亏率(1/1000)=56343,平均盈亏率(1/1000)=186,盈利交易率(1/1000)=456
                赢利次数=138,赢利总值=67889
                亏损次数=163,亏损总值=11546
                平盘次数=1


    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdiff>=250,pdiff<=400,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=44213,交易次数=222        期望值=2802
                总盈亏率(1/1000)=44213,平均盈亏率(1/1000)=199,盈利交易率(1/1000)=504
                赢利次数=112,赢利总值=52066
                亏损次数=110,亏损总值=7853
                平盘次数=0

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdiff>=300,pdiff<=400,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=33066,交易次数=160        期望值=3029
                总盈亏率(1/1000)=33066,平均盈亏率(1/1000)=206,盈利交易率(1/1000)=537
                赢利次数=86,赢利总值=38147
                亏损次数=74,亏损总值=5081
                平盘次数=0

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdiff>=250,pdiff<=350,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=45663,交易次数=187        期望值=3297
                总盈亏率(1/1000)=45663,平均盈亏率(1/1000)=244,盈利交易率(1/1000)=550
                赢利次数=103,赢利总值=51902
                亏损次数=84,亏损总值=6239
                平盘次数=0

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdiff>=250,pdiff<=360,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=47020,交易次数=195        期望值=3301
                总盈亏率(1/1000)=47020,平均盈亏率(1/1000)=241,盈利交易率(1/1000)=543
                赢利次数=106,赢利总值=53522
                亏损次数=89,亏损总值=6502
                平盘次数=0

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdiff>=240,pdiff<=360,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=52352,交易次数=211        期望值=3444
                总盈亏率(1/1000)=52352,平均盈亏率(1/1000)=248,盈利交易率(1/1000)=545
                赢利次数=115,赢利总值=59318
                亏损次数=96,亏损总值=6966
                平盘次数=0

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdiff>=225,pdiff<=350,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=58352,交易次数=229        期望值=3577
                总盈亏率(1/1000)=58352,平均盈亏率(1/1000)=254,盈利交易率(1/1000)=545
                赢利次数=125,赢利总值=65828
                亏损次数=104,亏损总值=7476
                平盘次数=0


#2009-05-07
#1 从-1.2R-->3R的止损曲线处理, 如将上升的1/3用来提升止损位
   用tracelimit_r来表现 
   proportion=400时(涨幅的0.4用于提升止损位)，效果比原先的差很多，成功率和R都明显下降
#2 新高周期。已经实现，还没找到如何应用,貌似简单方式没有价值.
    down_period
#3 60日均线上方的股票总数/60日新高家数.
   非常有借鉴意义

stocks = sdata.values()
for s in stocks:
    x.shigh(s,dates,CLOSE)

from wolfox.fengine.core.source import extract_collect as ec
nx = ec(stocks,'shigh') 
nv = ec(stocks,VOLUME)
nn = (nv>0).sum(axis=0)
sx = np.sum(nx,0) * 1000 / nn       #新高比例
xdif,xdea = cmacd(sx)
xdif2,xdea2 = cmacd(sx,19,39,9)
s5 = ma(sx,5)
s60 = ma(sx,60)
t60 = strend(s60)

for d,i,xf,xa,i5,i60,it60 in zip(dates,sx,xdif,xdea,s5,s60,t60)[:-200]:
    print d,i,xf,xa,i5,i60,it60

    
    上升形态中,s60拐头确认(strend=-3)是非常重要的信号(070528), 调整之后的拐头没有意义
               diff 死叉 dea, diff拐头, dea穿越0线,都是重要信号
               其中dea上穿0线是典型走好信号,下穿零线是典型走坏信号 (cmacd12/26/9和19/39/9单独发出的均可)
               s5死叉/金叉s60,diff金叉/diff死叉dea和diff/dea拐头是需要验证的信号,但一旦与其它信号加强,则很重要
               作为先导信号,则可逐步出货,但作为大盘调整同时的信号,则需立即出货
    另, 中等尺度下创新高家数与大盘新高的背离,也是应该谨慎的信号. 
        即大盘调整后创新高,但新高家数比上一次新高时少了
        或者5/20日新高数高点(或极值点,续走5日后判断出极点)比上一个5/20日新高数高点要小,而大盘在创新高. 

    另,其它的数据透视,新高数未创新高的周期
from wolfox.fengine.core.d1idiom import down_period as dp
dx = dp(sx,5)
    新低数
for s in sdata.values():
    srun.slow(s,dates)
from wolfox.fengine.core.source import extract_collect as ec
nl = ec(sdata.values(),'slow')   
sl = np.sum(nl,0)
l60 = ma(sl,60)
ldif,ldea = cmacd(sl)
for d,i,xf,xa,i5,i60,it60,il,il60 in zip(dates,sx,xdif,xdea,s5,s60,t60,sl,l60)[:-200]:
    print d,i,xf,xa,i5,i60,it60,il,il60

sl大于1000时是短期见底信号

#3.1 待实现
板块新高指数
不知道计算出来之后怎么应用

#4 攻击日形态
   连续下跌(>=3)过程中，某日的收盘价低于前一日最低价，若次日冲破改日最高价，则为攻击日
   缺乏价值 

#5 macd的转向应用,以strend穿越3时为信号？
   实战价值不高. strend(dea)穿越3时，结合其他条件，准确率为50X，R=13XX.

####发现除权对算法的敏感性
有些算法具有除权敏感性，有些比较鲁棒
总的来说，交易次数越少的，敏感性越高。而交易次数多的，即便有大比例替换效应出现，成功率和R仍然比较稳定。
但交易次数非常少的，倒也有稳定性
csvama系列受到影响最大，这个对g排名也有影响。 导致gx250变化非常大
原因也比较简单，因为除权导致某些板块的放大巨大（如基金变成1分，那么本来从1.00-1.01是1%，现在从0.01-0.02变成100%）
影响最大的是基金，很多基金除权以后2005-2007的价格变成负数了。另一个就是600497驰宏锌锗,2005之前的也变成负数
必须妥善解决这个问题。
或者只对股份变化除权？不对分红除权？
需要一种对价格进行标准化的方法来消除除权效应，这个标准化的基础应当是每日的涨跌幅度，只在除权日进行衔接特殊处理。
或者粗略的做法是计算距离涨幅前(甚至是)
    对股票<600的都改成600
    对基金<300的数据都改成300
这样作以后，丧失了算法的历史稳定性，特别是本来选出的股票如果被影响到，则可能就选不出来了

#2009-05-13
#退出问题
利用 买入后每日高点 - 当日atr* times 作为比较止损线的基准
还是    买入后最高点 - 每日atr * times 作为比较基准
两者区别不大。


#2009-05-16
#extend修正后的重新发现
#tsvama2x: 历史表现差于tsvama2,近期表现优于tsvama2

#xgcsx
近期表现优于xgcs

#cma_330:
gand(sync,stock.above,stock.t120,stock.thumb)
20080701->20090515
        评估:总盈亏值=1612,交易次数=26  期望值=1050
                总盈亏率(1/1000)=1612,平均盈亏率(1/1000)=62,盈利交易率(1/1000)=576
                赢利次数=15,赢利总值=2266
                亏损次数=11,亏损总值=654
                平盘次数=0
20010701->20090515,非常差
        评估:总盈亏值=4813,交易次数=158 期望值=468
                总盈亏率(1/1000)=4813,平均盈亏率(1/1000)=30,盈利交易率(1/1000)=246
                赢利次数=39,赢利总值=12445
                亏损次数=118,亏损总值=7632
                平盘次数=1
                闭合交易明细:


#cma_30
    water_line = ma(t[CLOSE],30)
    dcross = cross(water_line,t[LOW])
    up_cross = dcross > 0
    down_cross = dcross < 0
    sync = sfollow(down_cross,up_cross,7)
    return gand(sync,stock.above,stock.t120,stock.thumb,stock.silver)
    20010701-20090515
        评估:总盈亏值=5302,交易次数=36  期望值=3000
                总盈亏率(1/1000)=5302,平均盈亏率(1/1000)=147,盈利交易率(1/1000)=583
                赢利次数=21,赢利总值=6044
                亏损次数=15,亏损总值=742
                平盘次数=0
    20080701->
        评估:总盈亏值=782,交易次数=12   期望值=1756
                总盈亏率(1/1000)=782,平均盈亏率(1/1000)=65,盈利交易率(1/1000)=666
                赢利次数=8,赢利总值=930
                亏损次数=4,亏损总值=148
                平盘次数=0
        初始条件敏感,20070101趋差,但可以接受,20050101趋好

#tsvama2x:
    fast=20
    slow=100
    t = stock.transaction
    g = stock.golden
    svap,v2i = stock.svap_ma_67
    ma_svapfast = ma(svap,fast)
    ma_svapslow = ma(svap,slow)
    trend_ma_svapfast = strend(ma_svapfast) > 0
    trend_ma_svapslow = strend(ma_svapslow) > 0
    cross_fast_slow = gand(cross(ma_svapslow,ma_svapfast)>0,trend_ma_svapfast,trend_ma_svapslow)
    msvap = transform(cross_fast_slow,v2i,len(t[VOLUME]))
    signal = msvap
    s2 = x30(t)
    sbuy = sfollow(signal,s2,10)
    linelog('%s:%s' % (tsvama2x.__name__,stock.code))
    return gand(sbuy,stock.above,stock.thumb,stock.silver)
    20080701-->
    评估:总盈亏值=87,交易次数=4     期望值=677
               总盈亏率(1/1000)=87,平均盈亏率(1/1000)=21,盈利交易率(1/1000)=500

               赢利次数=2,赢利总值=150
               亏损次数=2,亏损总值=63
               平盘次数=0
               闭合交易明细:
        初始条件敏感,20070101趋差,可以接受,20050101趋好
               
    20010701->
        评估:总盈亏值=1910,交易次数=14  期望值=2060
                总盈亏率(1/1000)=1910,平均盈亏率(1/1000)=136,盈利交易率(1/1000)=642
                赢利次数=9,赢利总值=2243
                亏损次数=5,亏损总值=333
 



####用xseller对各算法进行平仓评估
ma4:
        评估:总盈亏值=265,交易次数=3    期望值=1142
                总盈亏率(1/1000)=265,平均盈亏率(1/1000)=88,盈利交易率(1/1000)=333
                赢利次数=1,赢利总值=419
                亏损次数=2,亏损总值=154
                平盘次数=0
                闭合交易明细:
 
        初始条件敏感,20050101成功率提高, R下降
xma60:
        评估:总盈亏值=95,交易次数=6     期望值=220
                总盈亏率(1/1000)=95,平均盈亏率(1/1000)=15,盈利交易率(1/1000)=333

                赢利次数=2,赢利总值=369
                亏损次数=4,亏损总值=274
                平盘次数=0

        初始条件敏感,20050101非常差
fcustom(s.tsvama2,fast=20,slow=100)
        评估:总盈亏值=-1207,交易次数=81 期望值=-206
                总盈亏率(1/1000)=-1207,平均盈亏率(1/1000)=-15,盈利交易率(1/1000)=296
                赢利次数=24,赢利总值=2995
                亏损次数=57,亏损总值=4202
                平盘次数=0
        初始条件无关
spring:
        评估:总盈亏值=740,交易次数=21   期望值=416
                总盈亏率(1/1000)=740,平均盈亏率(1/1000)=35,盈利交易率(1/1000)=380
                赢利次数=8,赢利总值=1840
                亏损次数=13,亏损总值=1100
                平盘次数=0
        初始条件无关
fcustom(s.cma2,fast=5,slow=13,gfrom=7000,gto=8500):
        评估:总盈亏值=-566,交易次数=30  期望值=-293
                总盈亏率(1/1000)=-566,平均盈亏率(1/1000)=-19,盈利交易率(1/1000)=300
                赢利次数=9,赢利总值=739
                亏损次数=20,亏损总值=1305
                平盘次数=1
                闭合交易明细:
        初始条件无关

fcustom(s.cma2,fast=5,slow=20,gfrom=4000,gto=8000):
        评估:总盈亏值=728,交易次数=21   期望值=693
                总盈亏率(1/1000)=728,平均盈亏率(1/1000)=34,盈利交易率(1/1000)=666
                赢利次数=14,赢利总值=1071
                亏损次数=7,亏损总值=343
        初始条件无关

xgcs:
        评估:总盈亏值=99,交易次数=30    期望值=50
                总盈亏率(1/1000)=99,平均盈亏率(1/1000)=3,盈利交易率(1/1000)=333
                赢利次数=10,赢利总值=1232
                亏损次数=19,亏损总值=1133
                平盘次数=1
        初始条件敏感    20070101趋好

xgcs0:
        评估:总盈亏值=1000,交易次数=28  期望值=593
                总盈亏率(1/1000)=1000,平均盈亏率(1/1000)=35,盈利交易率(1/1000)=500
                赢利次数=14,赢利总值=1838
                亏损次数=14,亏损总值=838
                平盘次数=0
        初始条件敏感    20070101趋差,20050101趋差,但可接受

mgcs:
        评估:总盈亏值=-262,交易次数=49  期望值=-90
                总盈亏率(1/1000)=-262,平均盈亏率(1/1000)=-6,盈利交易率(1/1000)=346
                赢利次数=17,赢利总值=1909
                亏损次数=32,亏损总值=2171
                平盘次数=0
        初始条件无关
        
fcustom(csvama2,fast= 14,slow=170,rstart=4000,rend=6500)
        评估:总盈亏值=183,交易次数=1    期望值=1000
                总盈亏率(1/1000)=183,平均盈亏率(1/1000)=183,盈利交易率(1/1000)=1000
                赢利次数=1,赢利总值=183
                亏损次数=0,亏损总值=0
                平盘次数=0

        初始条件敏感,20070101趋好,20050101极好

fcustom(csvama2,fast= 12,slow=170,rstart=3000,rend=6500)
        评估:总盈亏值=368,交易次数=5    期望值=924
                总盈亏率(1/1000)=368,平均盈亏率(1/1000)=73,盈利交易率(1/1000)=600
                赢利次数=3,赢利总值=527
                亏损次数=2,亏损总值=159
                平盘次数=0
        初始条件敏感,20070101趋好,20050101更好    

#其它
wvad6
        评估:总盈亏值=-106,交易次数=5   期望值=-537
                总盈亏率(1/1000)=-106,平均盈亏率(1/1000)=-22,盈利交易率(1/1000)=200
                赢利次数=1,赢利总值=61
                亏损次数=4,亏损总值=167
                平盘次数=0
        初始条件敏感,20070101趋好    
pmacd:  ###
        评估:总盈亏值=1229,交易次数=12  期望值=1789
                总盈亏率(1/1000)=1229,平均盈亏率(1/1000)=102,盈利交易率(1/1000)=583
                赢利次数=7,赢利总值=1515
                亏损次数=5,亏损总值=286
                平盘次数=0
        初始条件敏感,20070101趋差,比较差,20050101成功率上升,R下降

nhigh:
        评估:总盈亏值=-462,交易次数=16  期望值=-447
                总盈亏率(1/1000)=-462,平均盈亏率(1/1000)=-29,盈利交易率(1/1000)=187
                赢利次数=3,赢利总值=394
                亏损次数=13,亏损总值=856
                平盘次数=0
        初始条件敏感,20070101趋差

gx60:
        评估:总盈亏值=373,交易次数=7    期望值=1081
                总盈亏率(1/1000)=373,平均盈亏率(1/1000)=53,盈利交易率(1/1000)=428
                赢利次数=3,赢利总值=571
                亏损次数=4,亏损总值=198
                平盘次数=0
        初始条件敏感,20070101非常差


gx250:
        评估:总盈亏值=27,交易次数=2     期望值=361
                总盈亏率(1/1000)=27,平均盈亏率(1/1000)=13,盈利交易率(1/1000)=500

                赢利次数=1,赢利总值=63
                亏损次数=1,亏损总值=36
                平盘次数=0
        初始条件敏感,20070101趋差

vmacd_ma4
       评估:总盈亏值=-141,交易次数=5   期望值=-403
               总盈亏率(1/1000)=-141,平均盈亏率(1/1000)=-29,盈利交易率(1/1000)=400
               赢利次数=2,赢利总值=75
               亏损次数=3,亏损总值=216
               平盘次数=0

fcustom(s.tsvama2,fast=12,slow=170)
        评估:总盈亏值=4306,交易次数=77  期望值=1122
                总盈亏率(1/1000)=4306,平均盈亏率(1/1000)=55,盈利交易率(1/1000)=467
                赢利次数=36,赢利总值=6288
                亏损次数=40,亏损总值=1982
                平盘次数=1
    #初始条件无关

gcs:
        评估:总盈亏值=2505,交易次数=79  期望值=659
                总盈亏率(1/1000)=2505,平均盈亏率(1/1000)=31,盈利交易率(1/1000)=405
                赢利次数=32,赢利总值=4655
                亏损次数=45,亏损总值=2150
                平盘次数=2

        初始条件敏感,20070101趋差

temv:
        评估:总盈亏值=1861,交易次数=14  期望值=4400
                总盈亏率(1/1000)=1861,平均盈亏率(1/1000)=132,盈利交易率(1/1000)=714
                赢利次数=10,赢利总值=1953
                亏损次数=3,亏损总值=92
                平盘次数=1

            初始条件敏感,20070101趋差,但可接受,20050101不可接受的差

        temv: 20010701->
        评估:总盈亏值=3964,交易次数=49  期望值=1311
                总盈亏率(1/1000)=3964,平均盈亏率(1/1000)=80,盈利交易率(1/1000)=510
                赢利次数=25,赢利总值=5314
                亏损次数=22,亏损总值=1350
                平盘次数=2


##2009-05-17
#发现对初始条件敏感的原因在于stock.silver(当然vama系列的情况除外)
但是silver的初始条件敏感性是天生的,源自catalog.index的初始条件敏感性
而catalog.index关键在于相对稳定性,即左右的比较关系的稳定性,而不在于数值稳定性,所以导致在计算中积累差异
这是系统差异,但这种差异只有偏移作用,没有太大的其它作用
但会导致catalog.gxx的敏感性,因为gxx对初始条件敏感,本质上是对分母敏感
而且,这里还有新添加个股的影响问题
但仍然具备相对稳定性
不过长久来看,需要妥善解决这个问题. 可通过数据存储解决.
另外,除权也会引起个股的gxx稳定性问题. 也需要进一步的解决.


####关于下一个版本v3.0的设想
1. 解决个股计算的除权稳定性问题, 包括收益,排名等等, 用即时的后向除权来解决
    这个也不对,把当前的价格虚妄抬高了
    只有在排名/计算收益的的时候才需要如此.
    看看有没有别的好办法
    采用比例法除权,比如说送1块钱,则按照当前价格转换为送股, 这样,保持追溯回去的数据的比例不变.即复权稳定性。
        先按普通法计算出最后一日除权后的股价,然后和原始股价相比较,得到比例数
        最后将这个比例数应用到之前的所有数据
        这个方式类似于指数的衔接,但指数不能这么衔接,因为还有临时停牌的情况

        内涵分析：
            假设有一个基金，从A点1元涨到B点2元，分红1元后价格变为1元，然后又涨至C点1.5元
            则，按照普通复权，A点复权后成为0元，从A->C点涨幅为无穷大
                按照未来复权，A点1元不变，C点成为2.5元，涨幅为150%。
                按照比例复权，A点变为0.5元，涨幅为200%.
            普通复权方式，未考虑投入成本，虽然成本在B点收回，但仍应计入
            未来复权方式，未考虑B点的成本回收，如果B点距A点很近，实际上成本确实趋近于0
            比例复权为折中方案
        假设B点分红0.5元，C点为2元
            则普通复权，A:0.5, 涨幅300%
              未来复权，C:2.5元，涨幅150%
              比例复权，A:0.75, 涨幅125/75=166%
        假设B点分红0.2元, C点为2.3元
            则普通复权，A:0.8,涨幅为 1.5/0.8 - 1 = 87.5%
              未来复权, C:2.5,涨幅为 1.5/1 - 1 = 50%
              比例复权，A:0.9,涨幅为 1.6/0.9 - 1 = 77.7%

        实际上，比例复权最类似于自然复权。
        自然复权的含义是，以最后交易日收盘价LC和除权日NO开盘价为基准，rate=NO/LC，所有之前的价格数据都*rate
            成交量/rate. 相当于衔接了这两个价格。因此，缺点是如果大盘波动大或当日价格波动大，会失真。
            而比例除权是理论上的自然复权。没有这个问题
            自然复权其实相当于以固定持仓量量VO乘以当日收盘价LC得到持仓额AO，然后除权日再除以NO，得到除权后的持仓量VX
            则rate = VO/VX ( = VO/ (VO * LC / NO)) = NO/LC
            遵照的是持仓额不变原则，即如果有分红，则将分红按照除权日开盘价转为持仓


2. 解决catalog指数计算的初始条件稳定性问题. 用catalog指数的持久化处理来解决
    这里的主要问题是算法不具备相对稳定性
    按照理论上，即便初始日期不同，但指数的相对幅度应该是一致的
    用碾转相乘法解决相对稳定性
    调整calc_index
3. 设计策略==>股票池==>池策略==>优选的第二套机制
   以及进入和退出股票池的自动+手动机制


#2009-05-18B
#重新设计除权，采用比例除权法

#删除数据
delete from dune_xdayquote
#倒入原始数据
insert into dune_xdayquote(tstock_id,tdate,topen,tclose,thigh,tlow,tavg,tvolume,tamount)
select ds.id,tdate,topen,tclose,thigh,tlow,tavg,tvolume,tamount
from dune_sdayquote sq
join dune_stockcode ds on ds.code = sq.sstock


#恢复除权项
#select * from dune_powerinfo dp join dune_stockcode ds on ds.id = dp.tstock_id where state=0
update dune_powerinfo set state=0

#除权
python fxjtransfer.py --xit

##2009-05-20
#初始时间测试， 20080701开始选择，初始时间分别是20060101,20070101
    变化不是很大
20070101
xgcs:
        评估:总盈亏值=212,交易次数=17   期望值=363
                总盈亏率(1/1000)=212,平均盈亏率(1/1000)=12,盈利交易率(1/1000)=411
                赢利次数=7,赢利总值=510
                亏损次数=9,亏损总值=298
                平盘次数=1
                闭合交易明细:

xgcs0:
        评估:总盈亏值=1462,交易次数=20  期望值=1351
                总盈亏率(1/1000)=1462,平均盈亏率(1/1000)=73,盈利交易率(1/1000)=550
                赢利次数=11,赢利总值=1953
                亏损次数=9,亏损总值=491
                平盘次数=0

mgcs:
        评估:总盈亏值=1408,交易次数=57  期望值=406
                总盈亏率(1/1000)=1408,平均盈亏率(1/1000)=24,盈利交易率(1/1000)=385
                赢利次数=22,赢利总值=3496
                亏损次数=35,亏损总值=2088
                平盘次数=0


20060101:
xgcs
    评估:总盈亏值=119,交易次数=19   期望值=153
                总盈亏率(1/1000)=119,平均盈亏率(1/1000)=6,盈利交易率(1/1000)=421

                赢利次数=8,赢利总值=516
                亏损次数=10,亏损总值=397
                平盘次数=1
                闭合交易明细:

xgcs0:
        评估:总盈亏值=1495,交易次数=22  期望值=1240
                总盈亏率(1/1000)=1495,平均盈亏率(1/1000)=67,盈利交易率(1/1000)=590
                赢利次数=13,赢利总值=1986
                亏损次数=9,亏损总值=491
                平盘次数=0

mgcs:
        评估:总盈亏值=1408,交易次数=57  期望值=406
                总盈亏率(1/1000)=1408,平均盈亏率(1/1000)=24,盈利交易率(1/1000)=385
                赢利次数=22,赢利总值=3496
                亏损次数=35,亏损总值=2088
                平盘次数=0

#2009-05-21
#测试g60的macd
    mdiff,mdea = cmacd(stock.g60)
    ldiff,ldea = cmacd(stock.g120)
    lldiff,lldea = cmacd(stock.g250)

    xcross = cross(mdea,mdiff) > 0  

    vma30 = ma(t[VOLUME],30)
    vl = t[VOLUME]*1000/vma30   #<100000,消除新股头n天

    gf1 = gand(stock.g20>5000,stock.g20<9500)

    above = gand(ma(c,13) > ma30,ma30>stock.ma60,stock.ma60>stock.ma120)

    ll10 = tmin(t[LOW],15)
    hh10 = tmax(t[HIGH],15)
    rhl10 = hh10 * 1000/ll10

    signal = gand(ss,above,stock.t120,t[VOLUME]>0,gf1,rhl10<1500,mdiff>=mdea,vl<1000,strend(stock.ref.ma60)>0)
 
    这是个金矿，但目前还淘不出啥来
    ma30这个条件究竟如何?


考虑与svama2,vma等其它条件的的结合

#2009-05-26
#1 添加vfilter
    vma_s = ma(t[VOLUME],13)
    vma_l = ma(t[VOLUME],30)

    vfilter = gand(vma_s > vma_l,vma_s < 1.2 * vma_l)
    
    xcross = cross(mdea,mdiff) > 0  

    ll10 = rollx(t[LOW],10)
    hh10 = tmax(t[HIGH],10)
    rhl10 = hh10 * 1000/ll10

    x2 = cross(ma(t[CLOSE],30),t[LOW]) < 0
    
    ss = sfollow(xcross,x2,10)

    gf1 = gand(stock.g20>5000,stock.g20<9500)

    c = t[CLOSE]
    ma30 = ma(c,30)
    above = gand(ma(c,13) > ma30,ma30>stock.ma60,stock.ma60>stock.ma120)

    #signal = gand(xcross,stock.above,stock.t120,t[VOLUME]>0,hinc<1200,rhl10<1500,gfilter)
    signal = gand(ss,above,stock.t120,t[VOLUME]>0,gf1,rhl10<1500,mdiff>=mdea,strend(stock.ref.ma60)>0,vfilter)

        评估:总盈亏值=24802,交易次数=135        期望值=3588
                总盈亏率(1/1000)=24802,平均盈亏率(1/1000)=183,盈利交易率(1/1000)=822
                赢利次数=111,赢利总值=25985
                亏损次数=23,亏损总值=1183
                平盘次数=1

#2  添加pdiff<pdea,vdiff<vdea
    signal = gand(ss,above,stock.t120,t[VOLUME]>0,gf1,rhl10<1500,mdiff>=mdea,strend(stock.ref.ma60)>0,vfilter,pdiff<pdea,vdiff<vdea)

        评估:总盈亏值=19716,交易次数=96 期望值=4456
                总盈亏率(1/1000)=19716,平均盈亏率(1/1000)=205,盈利交易率(1/1000)=843
                赢利次数=81,赢利总值=20371
                亏损次数=14,亏损总值=655
                平盘次数=1

#3  添加strend(vdiff)>0,strend(vdea)<0
    signal = gand(ss,above,stock.t120,t[VOLUME]>0,gf1,rhl10<1500,mdiff>=mdea,strend(stock.ref.ma60)>0,vfilter,pdiff<pdea,vdiff<vdea,strend(vdiff)>0,strend(vdea)<0)

        评估:总盈亏值=3122,交易次数=10  期望值=9176
                总盈亏率(1/1000)=3122,平均盈亏率(1/1000)=312,盈利交易率(1/1000)=800
                赢利次数=8,赢利总值=3190
                亏损次数=2,亏损总值=68
                平盘次数=0

#4 添加pdiff
    signal = gand(ss,above,stock.t120,t[VOLUME]>0,gf1,rhl10<1500,mdiff>=mdea,strend(stock.ref.ma60)>0,vfilter,pdiff<pdea,vdiff<vdea,strend(vdiff)>0,strend(pdiff)>0)

        评估:总盈亏值=1963,交易次数=3   期望值=1000
                总盈亏率(1/1000)=1963,平均盈亏率(1/1000)=654,盈利交易率(1/1000)=1000
                赢利次数=3,赢利总值=1963
                亏损次数=0,亏损总值=0
                平盘次数=0
    
    去掉pdiff<pdea也相同
    signal = gand(ss,above,stock.t120,t[VOLUME]>0,gf1,rhl10<1500,mdiff>=mdea,strend(stock.ref.ma60)>0,vfilter,vdiff<vdea,strend(vdiff)>0,strend(pdiff)>0)

#5 去掉一个条件
    signal = gand(ss,above,stock.t120,t[VOLUME]>0,gf1,rhl10<1500,mdiff>=mdea,strend(stock.ref.ma60)>0,vfilter,strend(vdiff)>0,strend(pdiff)>0)
        评估:总盈亏值=1966,交易次数=5   期望值=9585
                总盈亏率(1/1000)=1966,平均盈亏率(1/1000)=393,盈利交易率(1/1000)=800
                赢利次数=4,赢利总值=2007
                亏损次数=1,亏损总值=41

#6 添加svap
    svap,v2i = stock.svap_ma_67
    sdiff,sdea = cmacd(svap)
    ssignal = gand(sdiff < sdea,strend(sdiff)<0,strend(sdiff-sdea)>0)
    msvap = transform(ssignal,v2i,len(t[VOLUME]))

    x2 = cross(ma(t[CLOSE],30),t[LOW]) < 0
    ss = sfollow(xcross,x2,10)
    gf1 = gand(stock.g20>5000,stock.g20<9500)

    signal = gand(ss,above,stock.t120,t[VOLUME]>0,gf1,rhl10<1500,mdiff>=mdea,strend(stock.ref.ma60)>0,msvap,vfilter)

        评估:总盈亏值=43688,交易次数=220        期望值=4500
                总盈亏率(1/1000)=43688,平均盈亏率(1/1000)=198,盈利交易率(1/1000)=863
                赢利次数=190,赢利总值=44990
                亏损次数=29,亏损总值=1302
                平盘次数=1
                闭合交易明细:
#7 改变vfilter,成功率增加
    vfilter = gand(vma_s > vma_l * 1.2)

    signal = gand(ss,above,stock.t120,t[VOLUME]>0,gf1,rhl10<1500,mdiff>=mdea,strend(stock.ref.ma60)>0,msvap,vfilter)
    
        评估:总盈亏值=19673,交易次数=87 期望值=4185
                总盈亏率(1/1000)=19673,平均盈亏率(1/1000)=226,盈利交易率(1/1000)=908
                赢利次数=79,赢利总值=20108
                亏损次数=8,亏损总值=435
                平盘次数=0

#8 进一步精细范围
    vfilter = gand(vma_s > vma_l * 1.5)
        评估:总盈亏值=1503,交易次数=9   期望值=1000
                总盈亏率(1/1000)=1503,平均盈亏率(1/1000)=167,盈利交易率(1/1000)=1000
                赢利次数=9,赢利总值=1503
                亏损次数=0,亏损总值=0
                平盘次数=0
            #2001.01.01-2008.12.31
            评估:总盈亏值=2689,交易次数=68  期望值=527
                总盈亏率(1/1000)=2689,平均盈亏率(1/1000)=39,盈利交易率(1/1000)=264
                赢利次数=18,赢利总值=6337
                亏损次数=49,亏损总值=3648
                平盘次数=1
                #添加strend(stock.ma60)>0后
                评估:总盈亏值=2709,交易次数=67  期望值=533
                    总盈亏率(1/1000)=2709,平均盈亏率(1/1000)=40,盈利交易率(1/1000)=268
                    赢利次数=18,赢利总值=6337
                    亏损次数=48,亏损总值=3628
                    平盘次数=1
                    #添加psy
                    #    mpsy = ma(psy(t[CLOSE],12),6)
                         spsy =  mpsy<300
                         signal = gand(ss,above,stock.t120,strend(stock.ma60)>0,t[VOLUME]>0,gf1,rhl10<1500,mdiff>=mdea,strend(stock.ref.ma60)>0,vfilter,msvap,spsy)
                        评估:总盈亏值=3254,交易次数=15  期望值=2181
                        总盈亏率(1/1000)=3254,平均盈亏率(1/1000)=216,盈利交易率(1/1000)=333
                        赢利次数=5,赢利总值=4249
                        亏损次数=10,亏损总值=995
                        平盘次数=0

                        #20080701-20090531 为空
                        ?????其它区间       #####

                        psy<500 #20080701-20090531,
                        评估:总盈亏值=193,交易次数=1    期望值=1000
                        总盈亏率(1/1000)=193,平均盈亏率(1/1000)=193,盈利交易率(1/1000)=1000
                        赢利次数=1,赢利总值=193
                        亏损次数=0,亏损总值=0
                        平盘次数=0
                        
                        20010701-20090101
                        评估:总盈亏值=2941,交易次数=54  期望值=675
                        总盈亏率(1/1000)=2941,平均盈亏率(1/1000)=54,盈利交易率(1/1000)=277
                        赢利次数=15,赢利总值=6091
                        亏损次数=39,亏损总值=3150
                        平盘次数=0
                        
                    #换为mxi
                    #    si = score2(t[CLOSE],t[VOLUME])
                         mxi = gand(msum(si,5)>=-100,msum(si,5)<=0)
                    评估:总盈亏值=3070,交易次数=57  期望值=670
                    总盈亏率(1/1000)=3070,平均盈亏率(1/1000)=53,盈利交易率(1/1000)=298
                    赢利次数=17,赢利总值=6164
                    亏损次数=39,亏损总值=3094
                    平盘次数=1
 
                        #20080701-20090531      #####减少最少#### #################
                        评估:总盈亏值=1415,交易次数=8   期望值=1000
                        总盈亏率(1/1000)=1415,平均盈亏率(1/1000)=176,盈利交易率(1/1000)=1000
                        赢利次数=8,赢利总值=1415
                        亏损次数=0,亏损总值=0

 
                        #vfilter: 1.33, mxi:(-100,0]
                        评估:总盈亏值=6520,交易次数=26  期望值=41666
                        总盈亏率(1/1000)=6520,平均盈亏率(1/1000)=250,盈利交易率(1/1000)=961
                        赢利次数=25,赢利总值=6526
                        亏损次数=1,亏损总值=6
                        平盘次数=0
                        
                            #20010701-20090101
                            评估:总盈亏值=3926,交易次数=111 期望值=492
                            总盈亏率(1/1000)=3926,平均盈亏率(1/1000)=35,盈利交易率(1/1000)=279
                            赢利次数=31,赢利总值=9542
                            亏损次数=79,亏损总值=5616
                            平盘次数=1
                        

                        #mxi or rsi12:400-800   
                        signal = gand(ss,above,stock.t120,strend(stock.ma60)>0,t[VOLUME]>0,gf1,rhl10<1500,mdiff>=mdea,strend(stock.ref.ma60)>0,vfilter,msvap,bor(mxi,rx))
                        评估:总盈亏值=1521,交易次数=9   期望值=1000
                        总盈亏率(1/1000)=1521,平均盈亏率(1/1000)=169,盈利交易率(1/1000)=1000
                        赢利次数=9,赢利总值=1521
                        亏损次数=0,亏损总值=0
                        平盘次数=0

                            #20010701-20090101: 不妥
                            评估:总盈亏值=3274,交易次数=135 期望值=338
                            总盈亏率(1/1000)=3274,平均盈亏率(1/1000)=24,盈利交易率(1/1000)=259
                            赢利次数=35,赢利总值=10385
                            亏损次数=99,亏损总值=7111
                            平盘次数=1

                            
                            #尝试放松msvap,不是很妥
                            signal = gand(ss,above,stock.t120,strend(stock.ma60)>0,t[VOLUME]>0,gf1,rhl10<1500,mdiff>=mdea,strend(stock.ref.ma60)>0,vfilter,bor(mxi,rx))
                            评估:总盈亏值=1854,交易次数=10  期望值=1000
                            总盈亏率(1/1000)=1854,平均盈亏率(1/1000)=185,盈利交易率(1/1000)=1000
                            赢利次数=10,赢利总值=1854
                            亏损次数=0,亏损总值=0
                            平盘次数=0
                            
                                vfilter = gand(vma_s > vma_l * 4/3)
                                评估:总盈亏值=8498,交易次数=40  期望值=4076
                                总盈亏率(1/1000)=8498,平均盈亏率(1/1000)=212,盈利交易率(1/1000)=900
                                赢利次数=36,赢利总值=8709
                                亏损次数=4,亏损总值=211
                                平盘次数=0

                           #msvap不变, vfilter = gand(vma_s > vma_l * 4/3), 和加不加bor(mxi,rsi)条件没啥区别
                            评估:总盈亏值=7559,交易次数=31  期望值=40500
                            总盈亏率(1/1000)=7559,平均盈亏率(1/1000)=243,盈利交易率(1/1000)=967
                            赢利次数=30,赢利总值=7565
                            亏损次数=1,亏损总值=6
                            平盘次数=0
                
                #msvap,vfilter = gand(vma_s > vma_l * 4/3),mxi:(-100,0]
                评估:总盈亏值=6520,交易次数=26  期望值=41666
                    总盈亏率(1/1000)=6520,平均盈亏率(1/1000)=250,盈利交易率(1/1000)=961
                    赢利次数=25,赢利总值=6526
                    亏损次数=1,亏损总值=6
                    平盘次数=0
                    闭合交易明细:

                    #msvap: 19,39  vfilter = gand(vma_s > vma_l * 4/3),mxi  #####
                                评估:总盈亏值=7409,交易次数=30  期望值=41000
                                总盈亏率(1/1000)=7409,平均盈亏率(1/1000)=246,盈利交易率(1/1000)=966
                                赢利次数=29,赢利总值=7415
                                亏损次数=1,亏损总值=6
                                平盘次数=0



                    #rsi12
                    signal = gand(ss,above,stock.t120,strend(stock.ma60)>0,t[VOLUME]>0,gf1,rhl10<1500,mdiff>=mdea,strend(stock.ref.ma60)>0,vfilter,msvap,r12<700,r12>500)
                    评估:总盈亏值=3144,交易次数=47  期望值=814
                    总盈亏率(1/1000)=3144,平均盈亏率(1/1000)=66,盈利交易率(1/1000)=319
                    赢利次数=15,赢利总值=5671
                    亏损次数=31,亏损总值=2527
                    平盘次数=1
                    
                    signal = gand(ss,above,stock.t120,strend(stock.ma60)>0,t[VOLUME]>0,gf1,rhl10<1500,mdiff>=mdea,strend(stock.ref.ma60)>0,vfilter,msvap,r12>450,r12<750)
                    评估:总盈亏值=3280,交易次数=58  期望值=717
                    总盈亏率(1/1000)=3280,平均盈亏率(1/1000)=56,盈利交易率(1/1000)=310
                    赢利次数=18,赢利总值=6335
                    亏损次数=39,亏损总值=3055
                    平盘次数=1

                    signal = gand(ss,above,stock.t120,strend(stock.ma60)>0,t[VOLUME]>0,gf1,rhl10<1500,mdiff>=mdea,strend(stock.ref.ma60)>0,vfilter,msvap,r12<800,r12>500)
                    评估:总盈亏值=3072,交易次数=48  期望值=790
                    总盈亏率(1/1000)=3072,平均盈亏率(1/1000)=64,盈利交易率(1/1000)=312
                    赢利次数=15,赢利总值=5671
                    亏损次数=32,亏损总值=2599
                    平盘次数=1

                        #20080701-20090531
                        评估:总盈亏值=155,交易次数=1    期望值=1000
                        总盈亏率(1/1000)=155,平均盈亏率(1/1000)=155,盈利交易率(1/1000)=1000
                        赢利次数=1,赢利总值=155
                        亏损次数=0,亏损总值=0
                        平盘次数=0
                        
                    rsi12:400-800   #20080701-20090531
                    评估:总盈亏值=1095,交易次数=7   期望值=1000
                    总盈亏率(1/1000)=1095,平均盈亏率(1/1000)=156,盈利交易率(1/1000)=1000
                    赢利次数=7,赢利总值=1095
                    亏损次数=0,亏损总值=0
                    平盘次数=0
                    
                        20010601-20090101:
                        评估:总盈亏值=2998,交易次数=63  期望值=626
                        总盈亏率(1/1000)=2998,平均盈亏率(1/1000)=47,盈利交易率(1/1000)=285
                        赢利次数=18,赢利总值=6337
                        亏损次数=44,亏损总值=3339
                        平盘次数=1
                           
        #测试kdj,obv. obv>maobv(30)也不行

#8.1    放宽到1.33     
       vfilter = gand(vma_s > vma_l * 1.33) #*4/3
        评估:总盈亏值=7915,交易次数=33  期望值=39833
                总盈亏率(1/1000)=7915,平均盈亏率(1/1000)=239,盈利交易率(1/1000)=969
                赢利次数=32,赢利总值=7921
                亏损次数=1,亏损总值=6
                平盘次数=0
            #2001.01.01-2008.12.31
            评估:总盈亏值=2614,交易次数=144 期望值=253
                总盈亏率(1/1000)=2614,平均盈亏率(1/1000)=18,盈利交易率(1/1000)=243
                赢利次数=35,赢利总值=10385
                亏损次数=108,亏损总值=7771
                平盘次数=1

            #添加kdj<1000
            signal = gand(ss,above,stock.t120,strend(stock.ma60)>0,t[VOLUME]>0,gf1,rhl10<1500,mdiff>=mdea,strend(stock.ref.ma60)>0,vfilter,msvap,sk)
                评估:总盈亏值=6364,交易次数=26  期望值=40666
                总盈亏率(1/1000)=6364,平均盈亏率(1/1000)=244,盈利交易率(1/1000)=961
                赢利次数=25,赢利总值=6370
                亏损次数=1,亏损总值=6
                平盘次数=0
                闭合交易明细:
            
                #kdj<800
                评估:总盈亏值=2762,交易次数=10  期望值=1000
                总盈亏率(1/1000)=2762,平均盈亏率(1/1000)=276,盈利交易率(1/1000)=1000
                赢利次数=10,赢利总值=2762
                亏损次数=0,亏损总值=0
                平盘次数=0
                闭合交易明细:

                    #20010701-20090101
                    评估:总盈亏值=3127,交易次数=58  期望值=736
                    总盈亏率(1/1000)=3127,平均盈亏率(1/1000)=53,盈利交易率(1/1000)=224
                    赢利次数=13,赢利总值=6383   
                    亏损次数=45,亏损总值=3256
                    平盘次数=0
                    


#8.2        vfilter = gand(vma_s > vma_l * 1.3)
        评估:总盈亏值=9699,交易次数=42  期望值=3593
                总盈亏率(1/1000)=9699,平均盈亏率(1/1000)=230,盈利交易率(1/1000)=928
                赢利次数=39,赢利总值=9892
                亏损次数=3,亏损总值=193
                平盘次数=0


#9 去掉msvap,只用vfilter
    vfilter = gand(vma_s > vma_l * 1.5)
        评估:总盈亏值=1836,交易次数=10  期望值=1000
                总盈亏率(1/1000)=1836,平均盈亏率(1/1000)=183,盈利交易率(1/1000)=1000
                赢利次数=10,赢利总值=1836
                亏损次数=0,亏损总值=0
                平盘次数=0
    vfilter = gand(vma_s > vma_l * 1.33)
        评估:总盈亏值=8885,交易次数=43  期望值=4681
                总盈亏率(1/1000)=8885,平均盈亏率(1/1000)=206,盈利交易率(1/1000)=883
                赢利次数=38,赢利总值=9107
                亏损次数=5,亏损总值=222
                平盘次数=0
    
    vfilter = gand(vma_s > vma_l * 1.3)
        评估:总盈亏值=12479,交易次数=62 期望值=4568
                总盈亏率(1/1000)=12479,平均盈亏率(1/1000)=201,盈利交易率(1/1000)=790
                赢利次数=49,赢利总值=13056
                亏损次数=13,亏损总值=577
                平盘次数=0



#2009-05-28
#1 tsvama2的进化
原来的tsvama2在20080701后萎靡
添加
    vma_s = ma(t[VOLUME],13)
    vma_l = ma(t[VOLUME],30)
    vfilter = gand(vma_s < vma_l * 7 / 8)
    return gand(stock.golden,msvap,stock.above,vfilter)

#1.1 20/100 ##选择
        #20080701-20090531
        评估:总盈亏值=562,交易次数=14   期望值=869
                总盈亏率(1/1000)=562,平均盈亏率(1/1000)=40,盈利交易率(1/1000)=714
                赢利次数=10,赢利总值=748
                亏损次数=4,亏损总值=186
                平盘次数=0
        #20010701-20081231
        评估:总盈亏值=3213,交易次数=24  期望值=2714
                总盈亏率(1/1000)=3213,平均盈亏率(1/1000)=133,盈利交易率(1/1000)=541
                赢利次数=13,赢利总值=3760
                亏损次数=11,亏损总值=547
                平盘次数=0
                闭合交易明细:

#1.2 12/100     #比20/100不妥
        #20080701-20090531
        评估:总盈亏值=699,交易次数=17   期望值=1242
                总盈亏率(1/1000)=699,平均盈亏率(1/1000)=41,盈利交易率(1/1000)=588
                赢利次数=10,赢利总值=934
                亏损次数=7,亏损总值=235
                平盘次数=0
        #20010701-20081231
        评估:总盈亏值=1734,交易次数=21  期望值=1518
                总盈亏率(1/1000)=1734,平均盈亏率(1/1000)=82,盈利交易率(1/1000)=476
                赢利次数=10,赢利总值=2336
                亏损次数=11,亏损总值=602
                平盘次数=0
                闭合交易明细:


#1.3 20/170 ##选择
        #20080701-20090531
        评估:总盈亏值=2655,交易次数=30  期望值=2588
                总盈亏率(1/1000)=2655,平均盈亏率(1/1000)=88,盈利交易率(1/1000)=766
                赢利次数=23,赢利总值=2859
                亏损次数=6,亏损总值=204
                平盘次数=1

        #20010701-20081231
        评估:总盈亏值=1919,交易次数=21  期望值=1568
                总盈亏率(1/1000)=1919,平均盈亏率(1/1000)=91,盈利交易率(1/1000)=380
                赢利次数=8,赢利总值=2684
                亏损次数=13,亏损总值=765
                平盘次数=0


    添加
    sdiff,sdea = cmacd(svap)
    ss = gand(cross_fast_slow,strend(sdiff-sdea)>0)
        #20080701-20090531
        评估:总盈亏值=1718,交易次数=12  期望值=6500
                总盈亏率(1/1000)=1718,平均盈亏率(1/1000)=143,盈利交易率(1/1000)=833
                赢利次数=10,赢利总值=1763
                亏损次数=2,亏损总值=45
                平盘次数=0

            cmacd(svap,19,39)       #退步
            评估:总盈亏值=1810,交易次数=17  期望值=3785
                总盈亏率(1/1000)=1810,平均盈亏率(1/1000)=106,盈利交易率(1/1000)=705
                赢利次数=12,赢利总值=1924
                亏损次数=4,亏损总值=114
                平盘次数=1
            
        #20010701-20081231
        评估:总盈亏值=2315,交易次数=12  期望值=2630
                总盈亏率(1/1000)=2315,平均盈亏率(1/1000)=192,盈利交易率(1/1000)=583
                赢利次数=7,赢利总值=2682
                亏损次数=5,亏损总值=367
                平盘次数=0
            #cmacd(svap,36,78)
            评估:总盈亏值=1973,交易次数=20  期望值=1661
                总盈亏率(1/1000)=1973,平均盈亏率(1/1000)=98,盈利交易率(1/1000)=400
                赢利次数=8,赢利总值=2684
                亏损次数=12,亏损总值=711
                平盘次数=0
            

#1.4 12/170   不好
        #20080701-20090531
        评估:总盈亏值=3127,交易次数=31  期望值=2272
                总盈亏率(1/1000)=3127,平均盈亏率(1/1000)=100,盈利交易率(1/1000)=548
                赢利次数=17,赢利总值=3701
                亏损次数=13,亏损总值=574
                平盘次数=1

        #20010701-20081231
        评估:总盈亏值=669,交易次数=22   期望值=434
                总盈亏率(1/1000)=669,平均盈亏率(1/1000)=30,盈利交易率(1/1000)=272
                赢利次数=6,赢利总值=1777
                亏损次数=16,亏损总值=1108
                平盘次数=0

#2 发现atr_seller中计算down_limit的一个问题
如果买入信号连续发生，中间没有卖出信号，则止损点downlimit会上移，而实际上却应当忽略随后的这些买入信号 
已修正

#3 对cmacd(svap)采用参数cmacd(svap,19,39),至少对于spring有用

spring: #漂亮
    svap,v2i = stock.svap_ma_67
    sdiff,sdea = cmacd(svap,19,39)
    ssignal = gand(strend(sdiff)>0,strend(sdiff-sdea)>0)

    msvap = transform(ssignal,v2i,len(t[VOLUME]))
    return gand(sbuy,msvap)
        #20080701-20090531        
        评估:总盈亏值=1465,交易次数=14  期望值=1253
                总盈亏率(1/1000)=1465,平均盈亏率(1/1000)=104,盈利交易率(1/1000)=571
                赢利次数=8,赢利总值=1968
                亏损次数=6,亏损总值=503
                平盘次数=0
        #20010701-20090101
        评估:总盈亏值=31551,交易次数=100        期望值=5250
                总盈亏率(1/1000)=31551,平均盈亏率(1/1000)=315,盈利交易率(1/1000)=650
                赢利次数=65,赢利总值=33674
                亏损次数=35,亏损总值=2123
                平盘次数=0
                闭合交易明细:
        #添加zfilter
        评估:总盈亏值=30877,交易次数=90 期望值=5913
                总盈亏率(1/1000)=30877,平均盈亏率(1/1000)=343,盈利交易率(1/1000)=644
                赢利次数=58,赢利总值=32749
                亏损次数=32,亏损总值=1872
                平盘次数=0
 

    #36,78,不如
        评估:总盈亏值=25408,交易次数=88 期望值=4800
                总盈亏率(1/1000)=25408,平均盈亏率(1/1000)=288,盈利交易率(1/1000)=602
                赢利次数=53,赢利总值=27532
                亏损次数=35,亏损总值=2124
                平盘次数=0

        评估:总盈亏值=1396,交易次数=14  期望值=1192
                总盈亏率(1/1000)=1396,平均盈亏率(1/1000)=99,盈利交易率(1/1000)=571
                赢利次数=8,赢利总值=1899
                亏损次数=6,亏损总值=503
                平盘次数=0

tsvama2b:
            cmacd(svap,19,39)       #退步
            评估:总盈亏值=1810,交易次数=17  期望值=3785
                总盈亏率(1/1000)=1810,平均盈亏率(1/1000)=106,盈利交易率(1/1000)=705
                赢利次数=12,赢利总值=1924
                亏损次数=4,亏损总值=114
                平盘次数=1


gmacd:  vfilter:4/3 无改进
        #20080701-20090531
        评估:总盈亏值=7409,交易次数=30  期望值=41000
                总盈亏率(1/1000)=7409,平均盈亏率(1/1000)=246,盈利交易率(1/1000)=966
                赢利次数=29,赢利总值=7415
                亏损次数=1,亏损总值=6
                平盘次数=0
        评估:总盈亏值=4461,交易次数=113 期望值=549
                总盈亏率(1/1000)=4461,平均盈亏率(1/1000)=39,盈利交易率(1/1000)=274
                赢利次数=31,赢利总值=10234
                亏损次数=81,亏损总值=5773
                平盘次数=1

        #如果vfilter>1.5,是否成功率更高?
        评估:总盈亏值=2853,交易次数=60  期望值=587
                总盈亏率(1/1000)=2853,平均盈亏率(1/1000)=47,盈利交易率(1/1000)=283
                赢利次数=17,赢利总值=6223
                亏损次数=42,亏损总值=3370
                平盘次数=1

        #无好处

        vfilter:4/3,macd:60,130
        评估:总盈亏值=3567,交易次数=64  期望值=723
                总盈亏率(1/1000)=3567,平均盈亏率(1/1000)=55,盈利交易率(1/1000)=328
                赢利次数=21,赢利总值=6849
                亏损次数=43,亏损总值=3282
                平盘次数=0

        35:77   ####好
        评估:总盈亏值=5074,交易次数=91  期望值=763
                总盈亏率(1/1000)=5074,平均盈亏率(1/1000)=55,盈利交易率(1/1000)=296
                赢利次数=27,赢利总值=9624
                亏损次数=63,亏损总值=4550
                平盘次数=1
        36:78
        评估:总盈亏值=4841,交易次数=84  期望值=780
                总盈亏率(1/1000)=4841,平均盈亏率(1/1000)=57,盈利交易率(1/1000)=297
                赢利次数=25,赢利总值=9103
                亏损次数=58,亏损总值=4262
                平盘次数=1


### 2009-05-30
#1 带量突破250/70/35日线
#2 250带量突破后回踩30日线
#3 
飞吻：短期均线略略走平后继续按原来趋势进行下去。
唇吻：短期均线靠近长期均线但不跌破或升破，然后按原来趋势继续
     下去。
湿吻：短期均线跌破或升破长期均线甚至出现反复缠绕，如胶似漆。
 
     飞吻出现的几率比较少，一般都是在趋势特别强烈的时候，而太火暴的趋势是不可能太长久的，所以其后的震荡经常出现；唇吻，任何一段基本的趋势过程中最常见到的方式，特别在“男上位”的情况下，基本都是这种方式，一旦出现唇吻反弹基本就该结束了，在“女上位”的情况下，调整结束的概率也是很大的，但也要预防唇吻演变成湿吻；湿吻，一段趋势后出现的较大调整中，还有就是在趋势出现转折时，这种情况也很常见，特别是在“男上位”的情况下，如果出现短、中、长各类均线来一个NP的湿吻，这么情色的AV场景往往意味着行情要出现重大转折，要变天了，“男上位”要变成“女上位”了。
 
    注意，任何的行情转折，在很大几率上都是由湿吻引发的，这里分两种情况：一种是先湿吻，然后按原趋势来一个大的高潮，制造一个陷阱，再转折；另一种，反复湿吻，构造一个转折性箱型，其后的高潮，就是体位的转化了。在“男上位”的情况下，一旦出现湿吻，就要密切注意了，特别是这个湿吻是在一个长期“男上位”后出现的，就要更加注意了，其后的下跌往往是介入的良机，因为空头陷阱的概率简直太大了。必须提醒，这一点对趋势形成的第一次湿吻不成立。但湿吻之后必有高潮，唯一的区别只是体位的区别，关键判断的是体位而不是高潮的有无。

例如，女上位趋势出现的第一次缠绕是中继的可能性极大，如果是第三、四次出现，这个缠绕是转折的可能性就会加大；还有，出现第一次缠绕前，5日线的走势必须是十分有力的，不能是疲软的玩意，这样缠绕极大可能是中继，其后至少会有一次上升的过程出现；第三，缠绕出现前的成交量不能放得过大，一旦过大，骗线出现的几率就会大大增加，如果量突然放太大而又萎缩过快，一般即使没有骗线，缠绕的时间也会增加，而且成交量也会现在两次收缩的情况。
女上位选择第一次出现缠绕的中继情况，而男上位的就相反，要寻找最后一次缠绕的转折情况，其后如果出现急跌却背弛，那是最佳的买入时机。抄底不是不可以，但只能选择这种情况。然而，没有人百分百确认那是最后一次缠绕，一般，男上位后的第一次缠绕肯定不是，从第二次开始都有可能，如何判断，最有力的就是利用好背弛制造的空头陷阱。关于如何利用背弛，是一个专门的话题，以后会详细论述

 综合上述，利用均线构成的买卖系统，首先要利用男上位最后一次缠绕后背弛构成的空头陷阱抄底进入，这是第一个值得买入的位置，而第二个值得买入或加码的位置，就是女上位后第一次缠绕形成的低位。站在该系统下，这两个买点的风险是最小的，准确地说，收益和风险之比是最大的，也是唯一值得买入的两个点。但必须指出的，并不是说这两个买点一定没有风险，其风险在于：对于第一个买点，把中继判断为转折，把背弛判断错了；对于第二个买点，把转折判断成中继。这些都构成其风险，但这里的风险很大程度和操作的熟练度有关，对于高手来说，判断的准确率要高多了，而如何成为高手，关键一点还是要多干、看参与，形成一种直觉。但无论高手还是低手，买点的原则是不变的，唯一能高低的地方只是这个中继和转折以及背弛的判断。

   注意，买的时候一般最好在第二个买点，而卖尽量在第一个卖点，这是买和卖不同的地方。

##判断位型, 需要对长短期的上下进行计数?
考察其体位的时间长度和价格幅度情况
上升幅度/时间

##实现趋势力度
缠中说禅趋势力度：前一“吻”的结束与后一“吻”开始由短线均线与长期均线相交所形成的面积。在前后两个同向趋势中,当缠中说禅趋势力度比上一次缠中说禅趋势力度要弱，就形成“背驰”。按这个定义，是最稳妥的办法，但唯一的缺点是必须等再次接吻后才能判断，这时候，走势离真正的转折点会已经有一点距离了。如何解决这个问题：第一种方法，看低一级别的图，从中按该种办法找出相应的转折点。这样和真正的低点基本没有太大的距离。
还有一种方法，技巧比较高，首先再定义一个概念，称为缠中说禅趋势平均力度：当下与前一“吻”的结束时短线均线与长期均线形成的面积除以时间。因为这个概念是即时的，马上就可以判断当下的缠中说禅趋势平均力度与前一次缠中说禅趋势平均力度的强弱对比，一旦这次比上次弱，就可以判断“背驰”即将形成，然后再根据短线均线与长期均线的距离，一旦延伸长度缩短，就意味着真正的低部马上形成。按这种方法，真正的转折点基本就可以完全同时地抓住。但有一个缺陷，就是风险稍微大点，且需要的技巧要高点，对市场的感觉要好点。


#2009-05-31
#1 动力学测试
#1.1 动力学测试1
import wolfox.fengine.core.future as f
import wolfox.fengine.core.d1ex as de
x=f.xpeak_points(t[HIGH],9)
vx = de.rsum2(t[VOLUME],x)
vxl = np.log(vx)
cl = np.log(t[CLOSE])
clx = de.rsub(cl,x)
dx = de.distance2(x)
xd = np.where(x!=0)
e=vxl[xd]/clx[xd]/dx[xd]
for id,ie in zip(dates[xd],e):
    print id,ie
e=vxl[xd]/clx[xd]/dx[xd]/dx[xd]
for id,ie in zip(dates[xd],e):
    print id,ie
貌似后者更好. 数值越小越好,注意同向运动的背离和紧邻反向运动的大小比较
后者的直观含义是 一次趋势运动中的 sum(V)/(距离*t*t)

#1.2 测试2
从 V 等效于 W
P= W/t = fs /t = mas/t = m (2s/t/t)s/t = 2*m* ss/(ttt) = k* ss/ttt

#1.3 测试3
V 等效于 Wup + Wdown
Wup 正比于 sum(h-min(l,last_c))
Wdown 正比于    sum(max(o,last_c)-l)

则 Vup = sum(h-min(l,last_c))/(sum(h-min(l,last_c))+sum(max(o,last_c)-l))V
然后再套用1.1
而且这个可以按日分配然后msum之

#1.3.1 这个可以再细化
以前日收盘和今日开盘指向的方向为运行方向
则若指向下方,运行轨迹为 开盘-->最低-->最高-->收盘
  若指向上方,运行轨迹为 开盘-->最高-->最低-->收盘
平开,则顺着昨天的指向收盘的方向

def supdown(sopen,sclose,shigh,slow):
    '''
        su,sd = supdown(t[OPEN],t[CLOSE],t[HIGH],t[LOW])
    '''
    if len(sopen) == 0:
        return np.array([]),np.array([])
    sc1 = rollx(sclose)
    u_hlc = shigh-sc1+sclose-slow
    u_lhc = shigh - slow
    d_hlc = shigh - slow
    d_lhc = sc1-slow+shigh-sclose
    direct = np.sign(sopen-sc1) #1为向上，-1为向下，0为平
    direct[0] = 1
    direct = extend2next(direct)    #把0都给填充掉，即用昨日指向收盘的方向作为今日的方向
    u = np.select([direct>0,direct<0],[u_hlc,u_lhc])
    d = np.select([direct>0,direct<0],[d_hlc,d_lhc])
    return u,d


import wolfox.fengine.core.future as f
import wolfox.fengine.core.d1ex as de

def vdis(sopen,sclose,shigh,slow,svolume):
    ''' 功率含义的比较，但是很难应用
        up,uf,dp,df = vdis(t[OPEN],t[CLOSE],t[HIGH],t[LOW],t[VOLUME])
    '''
    su,sd = supdown(sopen,sclose,shigh,slow)
    x = f.xpeak_points_2(shigh,slow,11)
    uv = svolume * su / (su+sd)
    ud = svolume - uv
    uvx = de.rsum2(uv,x)
    dvx = de.rsum2(dv,x)
    cl = np.log(sclose)
    clx = de.rsub(cl,x)
    dx = de.distance2(x)
    xd = np.where(x!=0)[0]
    #ue1 = (uv/clx/dx)[xd]
    #ue2 = (uv/clx/dx/dx)[xd]
    #de1 = (dv/clx/dx)[xd]
    #de2 = (dv/clx/dx/dx)[xd]
    #return xd,ue1,ue2,de1,de2
    #e1 = (np.abs((uv-dv))/clx/dx)[xd]
    #e2 = (np.abs((uv-dv))/clx/dx/dx)[xd]
    #return xd,e1,e2,uv-dv
    return (uv/dx)[xd],(uv/clx)[xd],(dv/dx)[xd],(dv/clx)[xd]

def xc_ru(sopen,sclose,shigh,slow,svolume,ma1=13,ma2=9):
    '''
        上升比例的交叉值
        xc = xc_ru(t[OPEN],t[CLOSE],t[HIGH],t[LOW],t[VOLUME])
        如果直接用 ru = uv/(uv+ud) = su/(su+sd),则信号太过频繁
        目前的结果是必须再等一天看看是否有反向信号
    '''
    su,sd = supdown(sopen,sclose,shigh,slow)
    uv = svolume * su / (su+sd)
    ud = svolume - uv
    uvma=nma(uv,ma1)
    dvma=nma(dv,ma1)
    ru = uvma*1.0/(uvma+dvma)
    ruma=msum2(ru,ma2)/ma2
    xc = cross(ruma,ru)
    return np.cast['int32'](xc)

def xc_ru2(sopen,sclose,shigh,slow,svolume,ma1=13,ma2=9):
    '''
        上升比例的交叉值，采用supdown2
        xc = xc_ru(t[OPEN],t[CLOSE],t[HIGH],t[LOW],t[VOLUME])
        如果直接用 ru = uv/(uv+ud) = su/(su+sd),则信号太过频繁
        目前的结果是必须再等一天看看是否有反向信号
    '''
    su,sd = supdown2(sopen,sclose,shigh,slow)
    uv = svolume * su / (su+sd)
    ud = svolume - uv
    uvma=nma(uv,ma1)
    dvma=nma(dv,ma1)
    ru = uvma*1.0/(uvma+dvma)
    ruma=msum2(ru,ma2)/ma2
    xc = cross(ruma,ru)
    return np.cast['int32'](xc)


def macd_ru(sopen,sclose,shigh,slow):
    '''
        上升比例的macd
        vdiff,vdea = macd_ru(t[OPEN],t[CLOSE],t[HIGH],t[LOW])        
        貌似没有xc_ru有效
    '''
    su,sd = supdown(sopen,sclose,shigh,slow)
    ru = su *BASE / (su+sd)
    return cmacd(ru)


def macd_ru2(sopen,sclose,shigh,slow):
    '''
        上升比例的macd
        vdiff,vdea = macd_ru2(t[OPEN],t[CLOSE],t[HIGH],t[LOW])        
        貌似其cross比较有效
        特别是如果1/-1或-1/1近邻时，后面的那一个准确率大大提高
            如果1/-1后为0，则相当于确认了1/-1信号的有效性
        比较有效
    '''
    su,sd = supdown2(sopen,sclose,shigh,slow)
    ru = su *BASE / (su+sd)
    return cmacd(ru)

def macd_ruv(sopen,sclose,shigh,slow,svolume):
    '''
        上升V的macd
        vdiff,vdea = macd_ru2(t[OPEN],t[CLOSE],t[HIGH],t[LOW],t[VOLUME])        
        貌似其cross比较有效
        特别是如果1/-1或-1/1近邻时，后面的那一个准确率大大提高
            如果1/-1后为0，则相当于确认了1/-1信号的有效性
        貌似没啥用
    '''
    su,sd = supdown2(sopen,sclose,shigh,slow)
    ruv = su * svolume / (su+sd)
    return cmacd(ruv)



#1.4 效率
V = abs(Wup)+abs(Wdown)
Wup - Wdown = St = delta(close) * delta(t)
Eup = Wup/V
Edown = Wdown/V

#1.5 W测试
V = Fup * Sup + Fdown * Sdown
F = m a = m* sqrt(2S/T) #每次从v=0开始
V = m* sqrt(2Sup/Tup) * Sup + m* sqrt(2Sdown/Tdown) * Sdown
Tup + Tdown = delta(T)
Sup + Sdown = delta(Close)  #S有方向
这个方程很难解,不论是S方式还是a(加速度)方式
即便采用 Tup = jTdown, Sup = kSdown,最后仍然很难解


#2009-06-03
#1 xu系列的测试
def xru(stock):
    t = stock.transaction
    #mdiff,mdea = macd_ru2(t[OPEN],t[CLOSE],t[HIGH],t[LOW])
    #mxc = cross(mdea,mdiff) > 0
    mxc = xc_ru(t[OPEN],t[CLOSE],t[HIGH],t[LOW],t[VOLUME]) > 0
    vma = ma(t[VOLUME],30)
    svma = ma(t[VOLUME],3)
    vfilter = gand(svma>vma*1/3,svma<vma*2/3)
    signal = gand(mxc,vfilter,stock.thumb,stock.above,strend(stock.ma60)>0,stock.t120)
    linelog(stock.code)
    return signal
#1.0 选中者
xc_ru2: 1/2-2/3
            评估:总盈亏值=5687,交易次数=31  期望值=4066 #20010701-20081231
                总盈亏率(1/1000)=5687,平均盈亏率(1/1000)=183,盈利交易率(1/1000)=612
                赢利次数=19,赢利总值=6231
                亏损次数=12,亏损总值=544
                平盘次数=0
            评估:总盈亏值=2057,交易次数=24  期望值=1700 #20080701-20090602
                总盈亏率(1/1000)=2057,平均盈亏率(1/1000)=85,盈利交易率(1/1000)=708
                赢利次数=17,赢利总值=2407
                亏损次数=7,亏损总值=350
                平盘次数=0
macd_ruv: 1/3-7/8
            评估:总盈亏值=14854,交易次数=158        期望值=1424
                总盈亏率(1/1000)=14854,平均盈亏率(1/1000)=94,盈利交易率(1/1000)=443
                赢利次数=70,赢利总值=20676
                亏损次数=87,亏损总值=5822
                平盘次数=1
            评估:总盈亏值=5311,交易次数=69  期望值=1357
                总盈亏率(1/1000)=5311,平均盈亏率(1/1000)=76,盈利交易率(1/1000)=594
                赢利次数=41,赢利总值=6889
                亏损次数=28,亏损总值=1578
                平盘次数=0
#1.1 macd_ru
        svma < vma*1/2
            评估:总盈亏值=2257,交易次数=37  期望值=1297     #20080601-20090602
                总盈亏率(1/1000)=2257,平均盈亏率(1/1000)=61,盈利交易率(1/1000)=540
                赢利次数=20,赢利总值=3012
                亏损次数=16,亏损总值=755
                平盘次数=1
                闭合交易明细:
            评估:总盈亏值=4074,交易次数=109 期望值=672      #20010701-20081231
                总盈亏率(1/1000)=4074,平均盈亏率(1/1000)=37,盈利交易率(1/1000)=302
                赢利次数=33,赢利总值=8249
                亏损次数=75,亏损总值=4175
        #svma<vma
            评估:总盈亏值=86328,交易次数=899        期望值=1391 #20010701-20081231
                总盈亏率(1/1000)=86328,平均盈亏率(1/1000)=96,盈利交易率(1/1000)=420
                赢利次数=378,赢利总值=122205
                亏损次数=517,亏损总值=35877
                平盘次数=4
            评估:总盈亏值=7037,交易次数=301 期望值=370  #20080601-20090602
                总盈亏率(1/1000)=7037,平均盈亏率(1/1000)=23,盈利交易率(1/1000)=431
                赢利次数=130,赢利总值=17530
                亏损次数=168,亏损总值=10493
                平盘次数=3
        #1/3-1/2
            评估:总盈亏值=2334,交易次数=34  期望值=1416
                总盈亏率(1/1000)=2334,平均盈亏率(1/1000)=68,盈利交易率(1/1000)=588
                赢利次数=20,赢利总值=3012
                亏损次数=14,亏损总值=678
                平盘次数=0
            评估:总盈亏值=3264,交易次数=86  期望值=637
                总盈亏率(1/1000)=3264,平均盈亏率(1/1000)=37,盈利交易率(1/1000)=290
                赢利次数=25,赢利总值=6757
                亏损次数=60,亏损总值=3493
                平盘次数=1
        
        #1/3-2/3
            评估:总盈亏值=5223,交易次数=113 期望值=938
                总盈亏率(1/1000)=5223,平均盈亏率(1/1000)=46,盈利交易率(1/1000)=522
                赢利次数=59,赢利总值=7907
                亏损次数=54,亏损总值=2684
        
            评估:总盈亏值=35252,交易次数=296        期望值=1750
                总盈亏率(1/1000)=35252,平均盈亏率(1/1000)=119,盈利交易率(1/1000)=405
                赢利次数=120,赢利总值=47120
                亏损次数=174,亏损总值=11868
                平盘次数=2
        #1/2-2/3
            评估:总盈亏值=33744,交易次数=217        期望值=2094
            总盈亏率(1/1000)=33744,平均盈亏率(1/1000)=155,盈利交易率(1/1000)=465
                赢利次数=101,赢利总值=42292
                亏损次数=115,亏损总值=8548
                平盘次数=1
            评估:总盈亏值=3138,交易次数=81  期望值=760
                总盈亏率(1/1000)=3138,平均盈亏率(1/1000)=38,盈利交易率(1/1000)=493
                赢利次数=40,赢利总值=5219
                亏损次数=41,亏损总值=2081
                平盘次数=0
#1.2 macd_ru2: 
            1/2-2/3
            评估:总盈亏值=30198,交易次数=215        期望值=2058
                总盈亏率(1/1000)=30198,平均盈亏率(1/1000)=140,盈利交易率(1/1000)=432
                赢利次数=93,赢利总值=38520
                亏损次数=121,亏损总值=8322
                平盘次数=1
            评估:总盈亏值=4399,交易次数=73  期望值=1176
                总盈亏率(1/1000)=4399,平均盈亏率(1/1000)=60,盈利交易率(1/1000)=547
                赢利次数=40,赢利总值=6102
                亏损次数=33,亏损总值=1703
                平盘次数=0
            #svma<vma/2
            评估:总盈亏值=2416,交易次数=36  期望值=1456
                总盈亏率(1/1000)=2416,平均盈亏率(1/1000)=67,盈利交易率(1/1000)=555
                赢利次数=20,赢利总值=3071
                亏损次数=14,亏损总值=655
                平盘次数=2
                闭合交易明细:
        
            评估:总盈亏值=5029,交易次数=108 期望值=793
                总盈亏率(1/1000)=5029,平均盈亏率(1/1000)=46,盈利交易率(1/1000)=324
                赢利次数=35,赢利总值=9257
                亏损次数=72,亏损总值=4228
                平盘次数=1
            #svma: 1/3-1/2
            评估:总盈亏值=2466,交易次数=34  期望值=1565
                总盈亏率(1/1000)=2466,平均盈亏率(1/1000)=72,盈利交易率(1/1000)=588
                赢利次数=20,赢利总值=3071
                亏损次数=13,亏损总值=605
                平盘次数=1
            评估:总盈亏值=4511,交易次数=87  期望值=894
                总盈亏率(1/1000)=4511,平均盈亏率(1/1000)=51,盈利交易率(1/1000)=321
                赢利次数=28,赢利总值=7870
                亏损次数=58,亏损总值=3359
                平盘次数=1
            #1/2-1
            评估:总盈亏值=80090,交易次数=748        期望值=1528
                总盈亏率(1/1000)=80090,平均盈亏率(1/1000)=107,盈利交易率(1/1000)=438
                赢利次数=328,赢利总值=109606
                亏损次数=417,亏损总值=29516
                平盘次数=3
            评估:总盈亏值=6709,交易次数=265 期望值=390
                总盈亏率(1/1000)=6709,平均盈亏率(1/1000)=25,盈利交易率(1/1000)=433
                赢利次数=115,赢利总值=16168
                亏损次数=147,亏损总值=9459
                平盘次数=3
#1.3 macd_ruv
           gand(svma < vma*7/8)
               评估:总盈亏值=5311,交易次数=69  期望值=1357     #20080601-20090602
                总盈亏率(1/1000)=5311,平均盈亏率(1/1000)=76,盈利交易率(1/1000)=594
                赢利次数=41,赢利总值=6889
                亏损次数=28,亏损总值=1578
               评估:总盈亏值=14747,交易次数=160        期望值=1352      #20010701-20081231
                总盈亏率(1/1000)=14747,平均盈亏率(1/1000)=92,盈利交易率(1/1000)=443
                赢利次数=71,赢利总值=20791
                亏损次数=88,亏损总值=6044
                平盘次数=1
           gand(svma < vma*2/3)                        
                评估:总盈亏值=1999,交易次数=14  期望值=3837     #20080601-20090602
                    总盈亏率(1/1000)=1999,平均盈亏率(1/1000)=142,盈利交易率(1/1000)=571
                    赢利次数=8,赢利总值=2221
                    亏损次数=6,亏损总值=222
                    平盘次数=0
                评估:总盈亏值=-36,交易次数=21   期望值=-27      #20010701-20081231
                    总盈亏率(1/1000)=-36,平均盈亏率(1/1000)=-2,盈利交易率(1/1000)=333
                    赢利次数=7,赢利总值=1021
                    亏损次数=14,亏损总值=1057
            svma: 2/3-7/8
            评估:总盈亏值=14942,交易次数=141        期望值=1567     #20010701-20081231
                总盈亏率(1/1000)=14942,平均盈亏率(1/1000)=105,盈利交易率(1/1000=460
                赢利次数=65,赢利总值=20034
                亏损次数=75,亏损总值=5092
                平盘次数=1
                    
            评估:总盈亏值=3312,交易次数=55  期望值=983       #20080601-20090602
                总盈亏率(1/1000)=3312,平均盈亏率(1/1000)=60,盈利交易率(1/1000)=600
                赢利次数=33,赢利总值=4668
                亏损次数=22,亏损总值=1356
                平盘次数=0

            svma:1/2-7/8
            评估:总盈亏值=14711,交易次数=156        期望值=1424 #20010701-20081231
                总盈亏率(1/1000)=14711,平均盈亏率(1/1000)=94,盈利交易率(1/1000)=435
                赢利次数=68,赢利总值=20533
                亏损次数=87,亏损总值=5822
                平盘次数=1
            评估:总盈亏值=5159,交易次数=68  期望值=1339     #20080601-20090602
                总盈亏率(1/1000)=5159,平均盈亏率(1/1000)=75,盈利交易率(1/1000)=588
                赢利次数=40,赢利总值=6737
                亏损次数=28,亏损总值=1578
                平盘次数=0
            1/3-7/8
            评估:总盈亏值=14854,交易次数=158        期望值=1424
                总盈亏率(1/1000)=14854,平均盈亏率(1/1000)=94,盈利交易率(1/1000)=443
                赢利次数=70,赢利总值=20676
                亏损次数=87,亏损总值=5822
                平盘次数=1
            评估:总盈亏值=5311,交易次数=69  期望值=1357
                总盈亏率(1/1000)=5311,平均盈亏率(1/1000)=76,盈利交易率(1/1000)=594
                赢利次数=41,赢利总值=6889
                亏损次数=28,亏损总值=1578
                平盘次数=0
#1.4 xc_ru2
            gand(svma < vma*2/3)
            评估:总盈亏值=2680,交易次数=34  期望值=1322     #20080601-20090602
                总盈亏率(1/1000)=2680,平均盈亏率(1/1000)=78,盈利交易率(1/1000)=676
                赢利次数=23,赢利总值=3336
                亏损次数=11,亏损总值=656
                平盘次数=0
                闭合交易明细:
            评估:总盈亏值=5403,交易次数=51  期望值=1944     #20010701-20081231
                总盈亏率(1/1000)=5403,平均盈亏率(1/1000)=105,盈利交易率(1/1000)=470
                赢利次数=24,赢利总值=6863
                亏损次数=27,亏损总值=1460
                平盘次数=0
            
            1/3-2/3
            评估:总盈亏值=2653,交易次数=31  期望值=1574
                总盈亏率(1/1000)=2653,平均盈亏率(1/1000)=85,盈利交易率(1/1000)=709
                赢利次数=22,赢利总值=3141
                亏损次数=9,亏损总值=488
                平盘次数=0
            评估:总盈亏值=4952,交易次数=44  期望值=2113
                总盈亏率(1/1000)=4952,平均盈亏率(1/1000)=112,盈利交易率(1/1000)=454
                赢利次数=20,赢利总值=6236
                亏损次数=24,亏损总值=1284
                平盘次数=0
            1/2-2/3
            评估:总盈亏值=5687,交易次数=31  期望值=4066
                总盈亏率(1/1000)=5687,平均盈亏率(1/1000)=183,盈利交易率(1/1000)=612
                赢利次数=19,赢利总值=6231
                亏损次数=12,亏损总值=544
                平盘次数=0
            评估:总盈亏值=2057,交易次数=24  期望值=1700
                总盈亏率(1/1000)=2057,平均盈亏率(1/1000)=85,盈利交易率(1/1000)=708
                赢利次数=17,赢利总值=2407
                亏损次数=7,亏损总值=350
                平盘次数=0
            1/2-1
            评估:总盈亏值=3360,交易次数=97  期望值=548
                总盈亏率(1/1000)=3360,平均盈亏率(1/1000)=34,盈利交易率(1/1000)=556
                赢利次数=54,赢利总值=6056
                亏损次数=43,亏损总值=2696
                平盘次数=0
            评估:总盈亏值=26272,交易次数=207        期望值=1909
                总盈亏率(1/1000)=26272,平均盈亏率(1/1000)=126,盈利交易率(1/1000)=487
                赢利次数=101,赢利总值=33217
                亏损次数=105,亏损总值=6945
                平盘次数=1
            1/2-7/8                
            评估:总盈亏值=3070,交易次数=63  期望值=786
                总盈亏率(1/1000)=3070,平均盈亏率(1/1000)=48,盈利交易率(1/1000)=571
                赢利次数=36,赢利总值=4725
                亏损次数=27,亏损总值=1655
                平盘次数=0
            评估:总盈亏值=20889,交易次数=138        期望值=2475
                总盈亏率(1/1000)=20889,平均盈亏率(1/1000)=151,盈利交易率(1/1000)=536
                赢利次数=74,赢利总值=24761
                亏损次数=63,亏损总值=3872
                平盘次数=1

#1.5 xc_ru            
            gand(svma < vma*2/3)
            评估:总盈亏值=1905,交易次数=30  期望值=1260     #20080601-20090602
                总盈亏率(1/1000)=1905,平均盈亏率(1/1000)=63,盈利交易率(1/1000)=600
                赢利次数=18,赢利总值=2457
                亏损次数=11,亏损总值=552
                平盘次数=1
            
            评估:总盈亏值=5049,交易次数=68  期望值=1013     #20010701-20081231
                总盈亏率(1/1000)=5049,平均盈亏率(1/1000)=74,盈利交易率(1/1000)=411
                赢利次数=28,赢利总值=7978
                亏损次数=40,亏损总值=2929
                平盘次数=0
            1/3-2/3
            评估:总盈亏值=1753,交易次数=28  期望值=1240
                总盈亏率(1/1000)=1753,平均盈亏率(1/1000)=62,盈利交易率(1/1000)=607
                赢利次数=17,赢利总值=2262
                亏损次数=10,亏损总值=509
                平盘次数=1
            评估:总盈亏值=4973,交易次数=57  期望值=1279
                总盈亏率(1/1000)=4973,平均盈亏率(1/1000)=87,盈利交易率(1/1000)=403
                赢利次数=23,赢利总值=7303
                亏损次数=34,亏损总值=2330
                平盘次数=0
            1/3-1/2
            评估:总盈亏值=1187,交易次数=10  期望值=4538 #20080601-20090601
                总盈亏率(1/1000)=1187,平均盈亏率(1/1000)=118,盈利交易率(1/1000)=900
                赢利次数=9,赢利总值=1213
                亏损次数=1,亏损总值=26
                平盘次数=0
                闭合交易明细:
            
            评估:总盈亏值=-82,交易次数=15   期望值=-134 #20010701-20081231
                总盈亏率(1/1000)=-82,平均盈亏率(1/1000)=-6,盈利交易率(1/1000)=266
                赢利次数=4,赢利总值=414
                亏损次数=11,亏损总值=496
                平盘次数=0            
        

#2 板块macd计算
for c in catalogs:
    x = c.transaction[0]
    xdiff,xdea = cmacd(x)
    xc = cross(xdea,xdiff)
    c.xc = xc
    if xc[-1]==1:
        print u'macd:',c.name

gmacd:
for c in catalogs:
    x = c.g60
    xdiff,xdea = cmacd(x)
    xc = cross(xdea,xdiff)
    c.xc60 = xc
    if xc[-1]==1:
        print u'xc60:',c.name
    x = c.g20
    xdiff,xdea = cmacd(x)
    xc = cross(xdea,xdiff)
    c.xc20 = xc
    if xc[-1]==1:
        print u'xc20:',c.name

    
发现问题，g20,g60这类的排名，尤其是短期的，受到起始日期影响较大，需要至少ma3一下平衡
或者说需要平衡的是起始日期的收盘价(比较标的)。但直接平衡结果比较简单有效

貌似g5的对于macd比较有意义?

#2009-06-04
#今日板块
macd比较强悍，xc20/60不够稳定，需要结合别的判断

macd: 内蒙古

昨日板块
macd: 安徽
macd: 北京
macd: 甘肃
macd: 黑龙江
macd: 湖北
macd: 山东
macd: 深圳
macd: 新疆
macd: 房地产
macd: 钢铁
macd: 农林牧渔
macd: 基金板块A


0 安徽
1 北京
2 福建
3 甘肃
4 广东
5 广西
6 贵州
7 海南
8 河北
9 河南
10 黑龙江
11 湖北
12 湖南
13 吉林
14 江苏
15 江西
16 辽宁
17 内蒙古
18 宁夏
19 青海
20 山东
21 山西
22 陕西
23 上海
24 深圳
25 四川
26 天津
27 西藏
28 新疆
29 云南
30 浙江
31 重庆
32 电力
33 电力设备
34 电器
35 电子信息
36 房地产
37 纺织服装
38 钢铁
39 工程建筑
40 供水供气
41 化工化纤
42 机械
43 计算机
44 建材
45 交通设施
46 教育传媒
47 旅游酒店
48 煤炭石油
49 酿酒食品
50 农林牧渔
51 其他行业
52 汽车类
53 券商
54 商业连锁
55 通信
56 外贸
57 医药
58 仪电仪表
59 银行类
60 有色金属
61 运输物流
62 造纸印刷
63 基金板块A

2009-06-08
#1 拉>2.5阳线且为60新高，成交量未>10日（正量）新高，是推出标志？
作为附属的，可作差价的暂时退出标志
#2 正成交量>2.5倍30均量，预示无法再持续放量，也是推出标志？ 
    这个有点投机了,但也比较准,貌似

#2009-06-10
#今日板块
macd: 海南
macd: 四川
macd: 电子信息
macd: 纺织服装
macd: 交通设施
macd: 旅游酒店

mxru(1/10,1653-625):600071,600463,600851,000511,000955
xru(1/10,1902-677): 600782,000663,000838
smacd(1/10,961-653):600992,
xgcs0(1/40,608-552):600005,000544,000895

#反趋势
spring
gmacd
gmacd5
ldx
ldx2
ldx2(120)

看起来貌似mxru选出的上涨个股时基本都持续缩量,至少连续5天内有4天小于ma30,至少是3
3亿以下，至多5亿，或者15亿以上的居多

#发现last与main有差异? 很微妙,比如600282,0609/gx250,xgcs0
#找到原因，在main中没有0609的数据，原因是[:-2]=-1这个清盘信号引发的，清盘信号对冲了当日的买入信号.
#只有这个-2日有问题,只要过了-2日，就没有一致性问题

#2009-06-11
macd: 重庆
macd: 通信
macd: 医药
macd: 运输物流

近日选股:
mxru: 000793
xgcs0:600020,600235,600569,000955

#793盘子太大，且非蓝筹股

##2009-06-12
ldx:600567,601005   #提升率较小，R较高，到60日线埋伏下方2%左右处埋伏

#2009-06-13
#1ma调整为 7-13-30-60-120 (之前为5-10-20-60-120)
above调整为 13-30-60-120

重新评估:

####尝试根据601001在20090317附近的情况组织算法


#2 短线交易读书笔记 Secrets to short-term trading
#2.1 三种循环
小价差区间-大价差区间、区间内的移动收盘价、收盘价与开盘价
定律1: 小区间产生大区间，大区间产生小区间
    ???推断: 大-小-大 的趋势,通常是小是第一个大的延续,第二个大是小的反? ???
大区间上涨趋势日，通常最低点附近开盘，最高点附近收盘。大区间下跌日子，则相反。
潜在的大区间上涨日，如果价位一直远低于开盘价时，上涨报收的概率就大为降低。
    #在预期价格会上涨时，不要试图买进开盘后大跌的股票，并且在做多时，要卖出
    #在预期价格会下跌时，不要试图卖出开盘后大涨的股票，并且在做空时，要回补
    搞定这张图，看看A股的规律是否类似

市场不会因为有大批人的买入而形成底部，而是因为没有人卖才成为底部。
最高价向收盘价的偏移代表卖方能力，收盘价减最低价的价差代表买方能力      #####用这个办法处理一下
    大多数市场的高点，会出现在以当日最高价收盘的日子
    大多数市场的低点，会出现在以当日最低价收盘的日子

    U:=(CLOSE-LOW)/(HIGH-LOW);
    MU:EMA(U,60);
    MU2:EMA(U,200);
    这个可用于大盘趋势,如MU>MU2,处于牛市,反之是熊市

    U:=(CLOSE-LOW)/(HIGH-LOW);
    D:=(HIGH-CLOSE)/(HIGH-LOW);
    MU:EMA(U,13);
    MD:EMA(D,13)
    #2

    U:=(HIGH-OPEN)/(HIGH-LOW);
    D:=(OPEN-LOW)/(HIGH-LOW);
    MU:EMA(U,13);
    MD:EMA(D,13)
    #7,13,30,60,120奇妙的分形图形,60是牛熊刻度,mu60<md60为熊,反之为牛

    U:=(HIGH-OPEN+CLOSE-LOW)/(HIGH-LOW);    #上升力，这个更强，更前瞻
    D:=(HIGH-CLOSE+OPEN-LOW)/(HIGH-LOW);    #下降力
    MU:EMA(U,13);
    MD:EMA(D,13)
    #而且还可以考虑异周期穿插，如EMA(U,13)对EMA(D,30)的叉
    #EMA比MA敏感
    #发现U/D实际上是对称的, U+D=2


    #奇异的买卖点
    U:=(HIGH-OPEN)/(HIGH-LOW);  #    U:=(HIGH-OPEN+CLOSE-LOW)/(HIGH-LOW);类似
    D:=(OPEN-LOW)/(HIGH-LOW);   #    D:=(HIGH-CLOSE+OPEN-LOW)/(HIGH-LOW);
    MU:=EMA(U,13);
    MD:=EMA(D,13);
	MUD:MU-MD;
	EMUD:EMA(MUD,9);
    #奇异,MUD上叉EMUD是买入要点,下叉是卖出要点

    U:=(HIGH-OPEN)/(HIGH-LOW);  #    U:=(HIGH-OPEN+CLOSE-LOW)/(HIGH-LOW);类似
    D:=(OPEN-LOW)/(HIGH-LOW);   #    D:=(HIGH-CLOSE+OPEN-LOW)/(HIGH-LOW);
    UV := VOL * U/(U+D);
    DV := VOL - UV;
    MUV:EMA(UV,13);
    MDV:EMA(DV,13);
    #根据MUV上叉/下叉MDV作为买卖点，不敏感但有前瞻性. 周期30更佳，60可以作为大范围的牛熊判断。120是更大范围的牛熊分界

    #UV-DV的macd,DIFF/DEA的叉为买卖点，太频繁
    U:=(HIGH-OPEN)/(HIGH-LOW);
    D:=(OPEN-LOW)/(HIGH-LOW); 
    UV := VOL * U/(U+D);
	DV := VOL-UV;
	DIF:EMA(UV-DV,12)-EMA(UV-DV,26);
	DEA:EMA(DIF,9);
	MACD:(DIF-DEA)*2;
    



#2.2 秘密
交易的时段越短，赚的钱越少
获利需要时间来累积。

#2.3 动能
开盘价是最适合做加减某个波动扩张值的价格点的基准
幅度扩张使用某周期ATR还是前一日的区间？
星期几交易现象是否在A股存在？

用开盘价+平均失败振荡（上涨中的开盘->最低，下跌中的开盘->最高）的倍数作为买入或止损信号. 而不是atr
    最佳天数是1-4

三根直线的高/低点系统

沪市对深市的准价差指数  5周期的价差expma-20周期的价差expma

#2.4 资金管理
股票交易数量 = 帐户余额 * 风险百分比 / 每股最大亏损

#2.5 心理
在价格停止下滑前不要买进,当情绪上觉得价格会大涨时也不能买进

#2.6 国债市场与股票市场的关联性

#2009-06-14
#up/down分量的共振用法
以up/down的5/30均线为基准
如果up5上叉up30,down5下叉down30在3天内共振发生，则上涨几率很大?
up/down分配有三种办法,要分别尝试

如果up上叉时down已经处于5<30状态,可能也是一个信号?

up/down的250周期貌似是牛熊分界的好判断
120比较敏感,可以用来逃大顶(交叉), 30日貌似也可以,但比较频繁

UTR:=HIGH-OPEN;
DTR:=OPEN-LOW;
UATR:MA(UTR,5);
UATR2:MA(UTR,30);
UATR3:MA(UTR,120);
DATR:MA(DTR,5);
DATR2:MA(DTR,30);
DATR3:MA(DTR,120);

另,异周期up/down的比较,比如up13叉down30等
UTR:=HIGH-OPEN;
DTR:=OPEN-LOW;
UATR2:MA(UTR,7);
DATR2:MA(DTR,13);


可以和macd互相验证,通常up7--down13比macd先行

V1:=SUM(IF(TYP>REF(TYP,1),TYP*VOL,0),N)/SUM(IF(TYP<REF(TYP,1),TYP*VOL,0),N);
DTM:=IF(OPEN<=REF(OPEN,1),0,MAX((HIGH-OPEN),(OPEN-REF(OPEN,1))));

UD2:
OC := OPEN-REF(CLOSE,1);
U_HLC := HIGH-OPEN+CLOSE-LOW;
U_LHC := HIGH - LOW;
D_HLC := HIGH - LOW;
D_LHC := OPEN-LOW+HIGH-CLOSE;
UU_HLC := IF(OC>0,U_HLC+OC,U_HLC);
UU_LHC := IF(OC>0,U_LHC+OC,U_LHC);
DD_HLC := IF(OC<0,D_HLC-OC,D_HLC);
DD_LHC := IF(OC<0,D_LHC-OC,D_LHC);
U := IF(HIGH-OPEN<OPEN-LOW,UU_HLC,UU_LHC);
D := IF(HIGH-OPEN<OPEN-LOW,DD_HLC,DD_LHC);
UV := VOL * U / (U+D);
DV := VOL * D / (U+D);
MRU : MA(UV-DV,13)
B0:0

UD:
SC0 := REF(CLOSE,1);
SC := IF(SC0=0,OPEN,SC0);
U_HLC := HIGH-SC+CLOSE-LOW;
U_LHC := HIGH - LOW;
D_HLC := HIGH - LOW;
D_LHC := SC-LOW+HIGH-CLOSE;
U:=IF(OPEN>=SC,U_HLC,U_LHC);
D:=IF(OPEN>=SC,D_HLC,D_LHC);
UV := VOL * U / (U+D);
DV := VOL * D / (U+D);
MUV : MA(UV,13);
MDV : MA(DV,13);
DD:MUV-MDV;
B0:0;
MDD:MA(DD,9)

##这些都不如简单方式
    U:=(HIGH-OPEN)/(HIGH-LOW);  
    D:=(OPEN-LOW)/(HIGH-LOW);   
    UV := VOL * U/(U+D);
    DV := VOL - UV;
    MUV:EMA(UV,13);
    MDV:EMA(DV,13);

    #类似有
    U:=(HIGH-OPEN+CLOSE-LOW)/(HIGH-LOW);
    D:=(HIGH-CLOSE+OPEN-LOW)/(HIGH-LOW);
    UV := VOL * U/(U+D);
    DV := VOL - UV;
    MUV:EMA(UV,13);
    MDV:EMA(DV,13);

##  supdown0的翻译,与u/v的直接版本(不考虑与昨日关系)没有本质区别
    SC1 := REF(CLOSE,1);
    OU := HIGH-OPEN+CLOSE-LOW;
    OD := HIGH-CLOSE+OPEN-LOW;
    OB := HIGH - LOW;
    SU := IF(OPEN>SC1,OU+OPEN-SC1,OU);
    SD := IF(OPEN<SC1,OD-OPEN+SC1,OD);
    SB1 := IF(LOW>SC1,OB+LOW-SC1,OB);
    SB := IF(HIGH<SC1,SB1+SC1-HIGH,SB1);
    U := SU/SB;
    D := SD/SB;
    MU:EMA(U,13);
    MD:EMA(D,13);

##简版,效果好于复杂版
    U:=(HIGH-OPEN+CLOSE-LOW)/(HIGH-LOW);
    D:=(HIGH-CLOSE+OPEN-LOW)/(HIGH-LOW);
    MU:EMA(U,13);
    MD:EMA(D,13);



#2009-06-15
#今日空白
补充:
xud(1/5):    600782###

#2009-06-16
无

#1 准备引入换手率
select tstock_id,ag,max(tperiod) as tpm from dune_report  group by tstock_id
这个是非标准的

标准做法
select x.sid,tpm,dr.ag
from (select tstock_id as sid,ag,max(tperiod) as tpm from dune_report  group by tstock_id) as x,
    dune_report dr on dr.tstock_id = x.sid and dr.tperiod=tpm

###这个做法有问题,这个不是当前的股本结构,而是年报时的股本结构,年报后如果有送股,结构就会不同.所以还需要考虑这方面的情况
   另一方面,解禁也是一个问题,不体现在年报上
   暂停这个使用

#1.1 但也可以不用换手率,用最近3/7天的成交量比30成交量的倍数,如果超过多少倍,就封信号m天
目标是抑制20090616 ldx2的某个最近换手天量的输出 002074

#1.2 对近期比如20天统计,所有超过30日线量的都是上升量

#1.3 发现一个规律
ldx中短期均线的接近,需要atr以较大的为好,如>5%

ldx: >6%, 20080701之后极好
        评估:总盈亏值=6155,交易次数=31  期望值=4714
                总盈亏率(1/1000)=6155,平均盈亏率(1/1000)=198,盈利交易率(1/1000)=967
                赢利次数=30,赢利总值=6197
                亏损次数=1,亏损总值=42
                平盘次数=0
        #20010701-
        评估:总盈亏值=3811,交易次数=9   期望值=7050
                总盈亏率(1/1000)=3811,平均盈亏率(1/1000)=423,盈利交易率(1/1000)=666
                赢利次数=6,赢利总值=3991
                亏损次数=3,亏损总值=180

ldx2(30) >6%
        评估:总盈亏值=4368,交易次数=17  期望值=3938
                总盈亏率(1/1000)=4368,平均盈亏率(1/1000)=256,盈利交易率(1/1000)=764
                赢利次数=13,赢利总值=4631
                亏损次数=4,亏损总值=263
                平盘次数=0
        #20010701-
        评估:总盈亏值=6685,交易次数=23  期望值=6744
                总盈亏率(1/1000)=6685,平均盈亏率(1/1000)=290,盈利交易率(1/1000)=826
                赢利次数=19,赢利总值=6860
                亏损次数=4,亏损总值=175
                平盘次数=0


ldx2(120)    长期均线,则以较小的为好,如<5%
        评估:总盈亏值=1248,交易次数=3   期望值=1000
                总盈亏率(1/1000)=1248,平均盈亏率(1/1000)=416,盈利交易率(1/1000)=1000
                赢利次数=3,赢利总值=1248
                亏损次数=0,亏损总值=0
                平盘次数=0
                闭合交易明细:

        评估:总盈亏值=603,交易次数=9    期望值=1240
                总盈亏率(1/1000)=603,平均盈亏率(1/1000)=67,盈利交易率(1/1000)=777
                赢利次数=7,赢利总值=711
                亏损次数=2,亏损总值=108
                平盘次数=0

xru          >4%为佳
            评估:总盈亏值=5944,交易次数=30  期望值=3735
                总盈亏率(1/1000)=5944,平均盈亏率(1/1000)=198,盈利交易率(1/1000)=700
                赢利次数=21,赢利总值=6422
                亏损次数=9,亏损总值=478
                平盘次数=0
            20010701--
            评估:总盈亏值=7006,交易次数=28  期望值=3787
                总盈亏率(1/1000)=7006,平均盈亏率(1/1000)=250,盈利交易率(1/1000)=642
                赢利次数=18,赢利总值=7674
                亏损次数=10,亏损总值=668
                平盘次数=0

mxru        >4.0%为佳
        评估:总盈亏值=5151,交易次数=19  期望值=5313
                总盈亏率(1/1000)=5151,平均盈亏率(1/1000)=271,盈利交易率(1/1000)=736
                赢利次数=14,赢利总值=5410
                亏损次数=5,亏损总值=259
                平盘次数=0
        #20010701-- >4.0
        评估:总盈亏值=5869,交易次数=47  期望值=1550
                总盈亏率(1/1000)=5869,平均盈亏率(1/1000)=124,盈利交易率(1/1000)=489
                赢利次数=23,赢利总值=7722
                亏损次数=23,亏损总值=1853
                平盘次数=1


        >4.5 丧失精度提高效率
        评估:总盈亏值=4957,交易次数=15  期望值=6470
                总盈亏率(1/1000)=4957,平均盈亏率(1/1000)=330,盈利交易率(1/1000)=666
                赢利次数=10,赢利总值=5216
                亏损次数=5,亏损总值=259
                平盘次数=0
        
xru0       >4.5%
        评估:总盈亏值=4873,交易次数=11  期望值=6815
                总盈亏率(1/1000)=4873,平均盈亏率(1/1000)=443,盈利交易率(1/1000)=909
                赢利次数=10,赢利总值=4938
                亏损次数=1,亏损总值=65
                平盘次数=0


        评估:总盈亏值=3539,交易次数=10  期望值=5983
                总盈亏率(1/1000)=3539,平均盈亏率(1/1000)=353,盈利交易率(1/1000)=800
                赢利次数=8,赢利总值=3657
                亏损次数=2,亏损总值=118
                平盘次数=0


mxru3      >5%
        评估:总盈亏值=1908,交易次数=8   期望值=1000
                总盈亏率(1/1000)=1908,平均盈亏率(1/1000)=238,盈利交易率(1/1000)=1000
                赢利次数=8,赢利总值=1908
                亏损次数=0,亏损总值=0
                平盘次数=0


        评估:总盈亏值=1950,交易次数=19  期望值=1186     #XXXX   急剧变坏, 但换个思路是编号,只不过前后不稳定
                总盈亏率(1/1000)=1950,平均盈亏率(1/1000)=102,盈利交易率(1/1000)=263
                赢利次数=5,赢利总值=3155
                亏损次数=14,亏损总值=1205
                平盘次数=0

        或许中间地带正好?

xud: 
        xc0s: > 40%


        xc0c >4.5%
        评估:总盈亏值=6108,交易次数=23  期望值=15588    ##不错
                总盈亏率(1/1000)=6108,平均盈亏率(1/1000)=265,盈利交易率(1/1000)=956
                赢利次数=22,赢利总值=6125
                亏损次数=1,亏损总值=17
                    平盘次数=0
        20010701--
        评估:总盈亏值=2422,交易次数=16  期望值=2013
                总盈亏率(1/1000)=2422,平均盈亏率(1/1000)=151,盈利交易率(1/1000)=500
                赢利次数=8,赢利总值=3025
                亏损次数=8,亏损总值=603
                平盘次数=0

xc0:    #与xc02基本一致
        评估:总盈亏值=1716,交易次数=13  期望值=7764     #
                总盈亏率(1/1000)=1716,平均盈亏率(1/1000)=132,盈利交易率(1/1000)=846
                赢利次数=11,赢利总值=1733
                亏损次数=1,亏损总值=17
                平盘次数=1

        评估:总盈亏值=1094,交易次数=9   期望值=1551     #不很稳定
                总盈亏率(1/1000)=1094,平均盈亏率(1/1000)=121,盈利交易率(1/1000)=444
                赢利次数=4,赢利总值=1486
                亏损次数=5,亏损总值=392
                平盘次数=0
                闭合交易明细:

xc02
        评估:总盈亏值=1716,交易次数=12  期望值=8411
                总盈亏率(1/1000)=1716,平均盈亏率(1/1000)=143,盈利交易率(1/1000)=916
                赢利次数=11,赢利总值=1733
                亏损次数=1,亏损总值=17
                平盘次数=0
        #20010701--
        评估:总盈亏值=1331,交易次数=10  期望值=2333
                总盈亏率(1/1000)=1331,平均盈亏率(1/1000)=133,盈利交易率(1/1000)=500
                赢利次数=5,赢利总值=1619
                亏损次数=5,亏损总值=288
                平盘次数=0
        xatr>50
        评估:总盈亏值=1516,交易次数=7   期望值=1000
                总盈亏率(1/1000)=1516,平均盈亏率(1/1000)=216,盈利交易率(1/1000)=1000
                赢利次数=7,赢利总值=1516
                亏损次数=0,亏损总值=0
                平盘次数=0
                闭合交易明细:
 
        xatr>45
        评估:总盈亏值=1761,交易次数=10  期望值=1000
                总盈亏率(1/1000)=1761,平均盈亏率(1/1000)=176,盈利交易率(1/1000)=1000
                赢利次数=10,赢利总值=1761
                亏损次数=0,亏损总值=0
                平盘次数=0
        

gmacd:  >6% #提升成功率
        评估:总盈亏值=6678,交易次数=31  期望值=4056
                总盈亏率(1/1000)=6678,平均盈亏率(1/1000)=215,盈利交易率(1/1000)=935
                赢利次数=29,赢利总值=6784
                亏损次数=2,亏损总值=106
                平盘次数=0
        
        去掉msvap
        评估:总盈亏值=8516,交易次数=39  期望值=4113
                总盈亏率(1/1000)=8516,平均盈亏率(1/1000)=218,盈利交易率(1/1000)=948
                赢利次数=37,赢利总值=8622
                亏损次数=2,亏损总值=106
                平盘次数=0

        20010701-
        评估:总盈亏值=5015,交易次数=54  期望值=1057
                总盈亏率(1/1000)=5015,平均盈亏率(1/1000)=92,盈利交易率(1/1000)=388
                赢利次数=21,赢利总值=7906
                亏损次数=33,亏损总值=2891
                平盘次数=0
        

gmacd5: 去掉msvap,xatr>60        目前去掉无影响
        #xatr>50
        评估:总盈亏值=6800,交易次数=25  期望值=1000
                总盈亏率(1/1000)=6800,平均盈亏率(1/1000)=272,盈利交易率(1/1000)=1000
                赢利次数=25,赢利总值=6800
                亏损次数=0,亏损总值=0
                平盘次数=0
 
        #20010701-- xatr>60
        评估:总盈亏值=2395,交易次数=13  期望值=1415
                总盈亏率(1/1000)=2395,平均盈亏率(1/1000)=184,盈利交易率(1/1000)=538
                赢利次数=7,赢利总值=3179
                亏损次数=6,亏损总值=784
                平盘次数=0
        xatr>50
        评估:总盈亏值=3051,交易次数=21  期望值=1250
                总盈亏率(1/1000)=3051,平均盈亏率(1/1000)=145,盈利交易率(1/1000)=571
                赢利次数=12,赢利总值=4097
                亏损次数=9,亏损总值=1046
                平盘次数=0


spring: 无增益

xgcs0:  xatr>50
        评估:总盈亏值=552,交易次数=6    期望值=2421
                总盈亏率(1/1000)=552,平均盈亏率(1/1000)=92,盈利交易率(1/1000)=666
                赢利次数=4,赢利总值=628
                亏损次数=2,亏损总值=76
                平盘次数=0
        #20010701-
        评估:总盈亏值=14241,交易次数=47 期望值=4522
                总盈亏率(1/1000)=14241,平均盈亏率(1/1000)=303,盈利交易率(1/1000)=659
                赢利次数=31,赢利总值=15326
                亏损次数=16,亏损总值=1085
                平盘次数=0
                闭合交易明细:
    
        xatr:[50,60]    #暂不用
        评估:总盈亏值=9157,交易次数=30  期望值=5083
                总盈亏率(1/1000)=9157,平均盈亏率(1/1000)=305,盈利交易率(1/1000)=733
                赢利次数=22,赢利总值=9641
                亏损次数=8,亏损总值=484
                平盘次数=0

tsvama2b:   xatr>40
        评估:总盈亏值=1038,交易次数=7   期望值=2144
                总盈亏率(1/1000)=1038,平均盈亏率(1/1000)=148,盈利交易率(1/1000)=857
                赢利次数=6,赢利总值=1107
                亏损次数=1,亏损总值=69
                平盘次数=0
        #20010701-
        评估:总盈亏值=2096,交易次数=13  期望值=1769
                总盈亏率(1/1000)=2096,平均盈亏率(1/1000)=161,盈利交易率(1/1000)=538
                赢利次数=7,赢利总值=2642
                亏损次数=6,亏损总值=546
                平盘次数=0



#2009-06-17
#1 选股
xud(3/8):       600109
xud/xc0c/xc02:  002201
xru(1/5):       600537,000511,000737

板块：纺织

#2009-06-18
板块:
macd: 重庆
macd: 建材
macd: 教育传媒

xru:    600740

#2009-06-19
1.板块
macd: 甘肃
macd: 广东
macd: 上海
macd: 深圳
macd: 四川
macd: 房地产
macd: 运输物流

个股
mxru:       000838
tsvama2b:   600368

周一操作
关注九鼎新材002201

其实项目实施过程中需求控制的问题，我们也比较苦恼。从我的经验来看，大概有几个重点。首先，需要明确或者潜移默化的在甲方信息部门和用户部门确立是我们帮甲方实施项目，而不是用户部门在帮项目公司的忙，这一点，至少在很多企业里面，用户部门多多少少都有定位偏差，从而碰到很多事情的时候态度和角度就不一样,这个主要还是靠经常性的灌输；其次，有一个合适的项目经理，技术上不用最好，但在协调上必须强，能够和甲方用户部门打成一片，很多话就很容易说，不过这样的人很难找，我也只见到过2、3个，绝大部分技术出身的项目经理，沟通和交际上都不是强项；第三个，在甲方最好配备一个有一定话语权的项目经理或接口人，这样他会是需求的第一道过滤者，有些话从他的角度向用户部门解释更加有说服力，在这个基础上，对进度有重大影响的事情必须尽快升级到双方的更高层面上进行沟通协调，有可能下面折腾个要死,上面比较容易就搞定了,这点我想你们应该做的不错了,不过你们蔡总太义气,有时对项目实施不是好事,hehe；第四个，前期工作的时候尽可能从用户的角度多考虑一些，不要存有侥幸心理，我就见到过这样的项目组，明明已经预料到而且是应该的，嫌麻烦不愿意把它当作一项功能而回避了,而早期的需求其实是个发掘过程，用户其实是不知道系统到底能够做到哪些东西,只有看到实物才会有进一步的要求,结果后期用户在试运行过程中提出来，而且一定要改，最终比麻烦还麻烦，毕竟后期的成本太高，不过这个和经验有关系，或者类似的项目多做几个之后，才会有些积累和直觉；第五个，也是最容易被忽视的一个，千万不要把试运行当作测试阶段的延伸，这个太考验用户的忍受能力了，试运行应当确认和磨合系统的功能方面和实际的差异性，而不是测试功能是不是被正确的实现了，这一点，反过来也是说团队内部的测试管理工作一定要做好，从单元测试到集成测试，能自动化的一定要自动化，手工测试到实施后期肯定变成没测试，而一旦用户部门多多少少承担这些测试之后，在系统的实施进度和后续应用上都会带来很负面的影响, 用户会更早进入实施疲劳期；
暂时就想到这些, 不过我没接触过政府类的项目,可能和企业里面有差别. 项目实施给我的感觉,技术不是最重要的,关键还是顺畅的沟通和资源协调, 有次做甲方的项目负责人时,我曾经对乙方的项目经理说过,哪怕你一行代码都不写,用户部门都交口说你好,也算你实施完成。现在我做乙方了，从这个角度来说，实事要做，沟通和协调更重要。


#2009-06-20
xatr的用处
xatr总是处于高低交替中

对于流通盘40亿，or 总股本50亿以上的股票，xud交叉，xatr确认可以放宽到2.5以上

#2009-06-23
板块：钢铁
无个股

#2009-06-24
板块：无
个股: xud/xc0c: 600887

貌似xatr(20)>mxatr(13/7,7比较灵敏)是一个危险信号，但如果没有别的信号确认，未必紧急。这是一个过滤信号，或者说当xatr<mxatr时，是安全的.
确认信号之一：5日均量上穿30日均量。这个仅适用于大盘

貌似XUD交叉时，XATR<MXATR也是重要的筛选方法？

有意思，反而是xatr>mxatr有效，此时貌似是xatr拐头。
用    ratr = xatr * BASE / mxatr
      ratr >= 1050来区分

#2009-06-25
板块
macd: 安徽
macd: 青海
macd: 电器

股票：
无

关于止损和短差
止损：
1. 3ATR止损
2. 成交量止损
   信号：实际涨幅>2%并且创新高(>60日高点*1.005)，但成交量小于最近10日最大量的1.1倍
   确认：上升阴线，并且成交量大于最近10日最大量的1.1倍
        或 低收，但成交量大于前一日成交量
   信号发出后即刻确认
短差：
   (阴线?)收低，成交量大于5日均线，并且xatr(20)>=mxatr(7)
   (阴线?)收低，成交量大于前一日， 并且xatr(20)>=mxatr(7)

#2009-06-26
板块
macd: 河北
macd: 湖南
macd: 江西
macd: 山西
macd: 陕西
macd: 房地产
macd: 工程建筑


