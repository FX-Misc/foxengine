
#2008-12-10
基本确认以list内含np.array 1d为主
只有在需要用到集合运算时，才以np.array的二维形式，但结果仍然要转换为1d

数据流向

db ==> 2d arrays ==> 1d arrays ==> 普通运算(等长)
   ==>集合运算(指数、排序;来源包括基础数据和计算数据)
   ==> 1d arrays  ==>  普通运算
   ==> (运算结果的)集合运算 ==> 1d arrays

在这里，第一次普通运算是等长序列的运算，第二次普通运算中已经抛掉非交易日

#2009-02-08
#todo: 
#1.优势率
#2.净值衰落 值和周期
#

#2009-02-17
kwargs的妙用，当关键字默认参数和*args并用时，需要用kwargs解决问题。应用场景是类似于dispatch这样的decrator
kwargs的慎用，如果有**kwargs，并且存在有默认值的关键字参数，则会因为拼写错误引入很难测试的隐患
    如 def foo(a,bnext=1,kwargs): ...
    如下调用
        foo(a,bnetx=12)
    并不会检查出这个拼写错误，如果这个参数不是非常敏感的参数或者在复杂情形下，则这类错误非常难以判断

#2009-02-25
#1 筛选思路
1.1 先用相关的cruiser进行巡游，时间段为20010701-20060101
    只有那些在这段时间内仍然能够保持MM优势率>1500-2000的才进入下一步
1.2 进入run过程，对候选就20071001-20090101进行遍历，仍然要求优势率>1500-2000
1.3 对候选就20020101-20090101进行遍历，要求1.2的优势率不降低，即不能在主升段降低优势率
1.4 进行分段ev检验，20010701-20060101,20050701-20070930,20071001-20090101,20010701-20090101

#2009-03-07
#1 进行run_merge
#2 Finished 进行vama2x的第二次巡游
   并整理svama2x和vama2x的巡游结果 
#3 考虑对ma120的强制约束，以及ma分类约束
#4 考虑各选出的算法的实际含义，逐个研究每个算法选出股票的方式方法，细致观察其选出的股票
   用excel来做
#5 Finished 核对600433 20071204买入，次日卖出的原因  
    name:Mediator:<svama2x:ma_standard=20,base=82,fast=1,sma=33,slow=8:atr_seller:covered=10,up_sector=2,trace_times=3000,stop_times=600,buy_sector=0:make_trade_signal_advanced:B1S1>
    消除此类现象
#6 计算板块在上升过程中前三甲的龙头股 > 8500     
#7 transform重大修正之后对受影响不分的重新巡游
   Finshed: svama2,svama3,svama2s,svama2c,svama2x,vama3,vama2,vama2x, 是否逐渐淘汰掉vama系列


#2009-03-12
#诡异
begin,xbegin,end,lbegin = 20060101,20070901,20090327,20081101
name:Mediator:<vama3:ma_standard=500,slow=45,extend_days=17,fast=32,mid=79:atr_seller:up_sector=2,trace_times=3000,stop_times=600,covered=10:make_trade_signal_advanced:B0S0>
应当在第三天退出，但是到0312也没有卖出
SH600370	B	20090224	price=4500	volume=1000
bug已经修正

另
name:Mediator:<vama3:ma_standard=500,slow=50,extend_days=31,fast=30,mid=67:atr_seller:up_sector=2,trace_times=3000,stop_times=600,covered=10:make_trade_signal_advanced:B0S0>
SH600766	B	20081224	price=3490	volume=1000
这个是正确的

#2009-03-14
#1 catalog单项测试
发现一个诡异的现象，渐涨板块中的龙头股(>8500)的表现不如中间股(3300-6600). 
这里的环境是没有加持g的20,60,120,250的持续增长。单项加持c, 这之中又以c60表现最好。

最佳表最先比g的单项加持要好很多，成功率从333->520,R从1025->2700,times从245->67

# g与catalog共同加持，结果导致次数以2个数量级锐减，缺乏实际意义，而且结果也不如单独的c加持
#
#2 另一个重要发现
以19980101为起始日，对vama3的unit计算有重大影响，大大优于20000101. 仅对
fcustom(vama3,fast= 33,mid= 84,slow=345,ma_standard=500,extend_days= 27,dates=dates,cextractor=ext_factory(3300,6600))
而言

#3 检验g60的5和60上叉的效果
基本确定g不能单独作为主要条件，只能做为筛选条件

另对g作筛选时的
g = gand(stock.g5 >= stock.g20,stock.g20 >= stock.g60,stock.g60 >= stock.g120,stock.g120 >= stock.g250)
进行放宽测试，发现删除第一/第二个/第三/第四个都会有问题

但没有测试 g5>g60而绕过g20的情形,只是单纯的删除

#4 考虑对vama3族的筛选方式


#2009-03-16
#1 对行业选择进行调整，从之前的证监会行业调整为行业。证监会行业太过细化
   从新评估已有的数据
    configs.append(config(buyer=fcustom(csvama2,fast= 13,slow=125,rstart= 1000,rend=5000))) 	#3315-252-593-32    #9078/988
    configs.append(config(buyer=fcustom(csvama2,fast=  2,slow=250,rstart=7000,rend=9000))) 	#1625-117-500-22 #3379/792
    configs.append(config(buyer=fcustom(csvama3,fast= 12,mid= 27,slow=250,rstart=5000,rend=8000))) 	#1000-71-473-19
    configs.append(config(buyer=fcustom(csvama3,fast= 12,mid= 27,slow=330,rstart=3000,rend=6000))) 	#5270-195-714-7
    configs.append(config(buyer=fcustom(csvama3,fast= 16,mid= 21,slow=250,rstart=5000,rend=8000))) 	#1061-69-433-30 
    configs.append(config(buyer=fcustom(csvama3,fast= 12,mid= 19,slow=250,rstart=7000,rend=8000))) 	#939-77-538-13
    configs.append(config(buyer=fcustom(csvama3,fast=  8,mid= 21,slow=385,rstart=1500,rend=8000))) 	#688-64-478-23
    configs.append(config(buyer=fcustom(csvama3,fast= 12,mid= 23,slow=250,rstart=5000,rend=8000))) 	#845-60-392-28
    configs.append(config(buyer=fcustom(csvama3,fast= 44,mid= 23,slow=250,rstart=7500,rend=8000))) 	#1049-85-666-3
    configs.append(config(buyer=fcustom(csvama3,fast= 10,mid= 85,slow=250,rstart=5000,rend=8000))) 	#2185-153-333-3
    configs.append(config(buyer=fcustom(csvama2,fast= 37,slow=115,rstart=3000,rend=8000))) 	#2059-138-327-58
    configs.append(config(buyer=fcustom(csvama3,fast= 12,mid= 27,slow=350,rstart=4500,rend=6000))) 	#913-53-375-8
基本上这些数据已经失效,只剩下三个
    configs.append(config(buyer=fcustom(csvama2,fast= 13,slow=125,rstart= 1000,rend=5000))) 	#2268-188-609-41    #9078/988
    configs.append(config(buyer=fcustom(csvama3,fast= 44,mid= 23,slow=250,rstart=7500,rend=8000))) 	#1948-152-500-2 #383/78
    configs.append(config(buyer=fcustom(csvama2,fast= 37,slow=115,rstart=3000,rend=8000))) 	#1202-95-367-68


#2009-03-19
#1 考虑svap/vap的macd的筛选作用
   macd的标的可以是ma(svap,n),而不仅仅是svap,暂定为5

#2 用nmedaitor排除原先在设置atr的downlimit时不考虑B1/B0的买入信号偏移的问题
    该问题导致B1系列下信号日次日高开时止损点离买入点距离为高开值+设定atr,而非设定atr)

#3 观察，发现atr5叉20也是选股器
    且strend(atr20)>0是筛选器,但更加有效的是strend(atr5/atr20),且<1.2,大的趋势向上(不是小向上但大一顶比一顶低)
    但还是有些模棱两可
    

#4 对atr的止损进行细分，划分为1000(1200?)和2000两档


#5  发现psy的信号效果不错
    PSY:COUNT(CLOSE>REF(CLOSE,1),N)/N*100;
    PSYMA:MA(PSY,M);
    N=12,M=6
    当psy,psyma趋势向上且psy上叉时买入
 
    单独成为信号还是能力有限，但是strend(psy12)>0成为筛选器倒是比较有前途

    但筛选器还只能目测，统计上无法做到筛掉有些目测可以去掉的趋势

    找到一个统计学上的过滤器对svama2,fast=  9,slow=1160,630-46-382-251
    a. psy12<300, ==> 1432-96-516-31  但次数消散很多
    b. psy12<500, ==> 1129-61-327-116 成功率还是不行
    c. psy12在500-600之间 ==> 195-9-408-71 属于负分支

    如果以psy不做ma直接过滤，则
    a.  1101-76-521-23
    b.  264-14-291-48
    c.  146-6-375-64
    d. >600,-99/-5/272/77

#2009-03-23
将基金板块纳入到行业
select * from dune_stockcode_catalogs where catalog_id = 286
select * from dune_catalog where subject_id = '其它板块'

288	ETF基金	其它板块
289	LOF基金	其它板块
291	基金板块	其它板块
292	开放基金	其它板块
293	权证板块	其它板块

#发现深圳基金居然没有在里面，找到问题，需要解决
insert into dune_stockcode_catalogs(stockcode_id,catalog_id) 
select id,291,* from dune_stockcode where code like 'SZ18%'

#1 代码添加 
#采用django的方法
cs = CatalogSubject.objects.get(code='HY')
jjbk2 = Catalog(name=u'基金板块A',subject=cs)
jjbk2.save()
szjjs = StockCode.objects.filter(code__startswith='SZ18')
shjjs = StockCode.objects.filter(code__startswith='SH50')
szetfs = StockCode.objects.filter(code__startswith='SZ159')
shetfs = StockCode.objects.filter(code__startswith='SH510')
jjbk2.stocks.add(*szjjs)
jjbk2.stocks.add(*shjjs)
jjbk2.stocks.add(*szetfs)
jjbk2.stocks.add(*shetfs)

#2 数据添加
#原始数据已经位于dune_sdayquote中，故只需要转换

因此，继续处理
ss = [str(stock.code) for stock in jjbk2.stocks.all()]
['SH500001', 'SH500002', 'SH500003', 'SH500005', 'SH500006', 'SH500007', 'SH500008', 'SH500009', 'SH500010', 'SH500011', 'SH500013', 'SH500015', 'SH500016', 'SH500017', 'SH500018', 'SH500019', 'SH500021', 'SH500025', 'SH500028', 'SH500029','SH500035', 'SH500038', 'SH500039', 'SH500056', 'SH500058', 'SZ184688', 'SZ184689', 'SZ184690', 'SZ184691', 'SZ184692', 'SZ184693', 'SZ184698', 'SZ184699', 'SZ184700', 'SZ184701', 'SZ184703', 'SZ184705', 'SZ184706', 'SZ184712', 'SZ184713', 'SZ184721', 'SZ184722', 'SZ184728', 'SH510050', 'SH510180', 'SH510880', 'SZ159901', 'SZ159902']
即
('SH500001', 'SH500002', 'SH500003', 'SH500005', 'SH500006', 'SH500007', 'SH500008', 'SH500009', 'SH500010', 'SH500011', 'SH500013', 'SH500015', 'SH500016', 'SH500017', 'SH500018', 'SH500019', 'SH500021', 'SH500025', 'SH500028', 'SH500029','SH500035', 'SH500038', 'SH500039', 'SH500056', 'SH500058', 'SZ184688', 'SZ184689', 'SZ184690', 'SZ184691', 'SZ184692', 'SZ184693', 'SZ184698', 'SZ184699', 'SZ184700', 'SZ184701', 'SZ184703', 'SZ184705', 'SZ184706', 'SZ184712', 'SZ184713', 'SZ184721', 'SZ184722', 'SZ184728', 'SH510050', 'SH510180', 'SH510880', 'SZ159901', 'SZ159902')
#去掉上海基金的部分
 ('SZ184688', 'SZ184689', 'SZ184690', 'SZ184691', 'SZ184692', 'SZ184693', 'SZ184698', 'SZ184699', 'SZ184700', 'SZ184701', 'SZ184703', 'SZ184705', 'SZ184706', 'SZ184712', 'SZ184713', 'SZ184721', 'SZ184722', 'SZ184728', 'SH510050', 'SH510180', 'SH510880', 'SZ159901', 'SZ159902')
select * from dune_sdayquote where sstock in  ('SZ184688', 'SZ184689', 'SZ184690', 'SZ184691', 'SZ184692', 'SZ184693', 'SZ184698', 'SZ184699', 'SZ184700', 'SZ184701', 'SZ184703', 'SZ184705', 'SZ184706', 'SZ184712', 'SZ184713', 'SZ184721', 'SZ184722', 'SZ184728', 'SH510050', 'SH510180', 'SH510880', 'SZ159901', 'SZ159902')
......

insert into dune_xdayquote(tstock_id,tdate,topen,tclose,thigh,tlow,tavg,tvolume,tamount)
select ds.id,tdate,topen,tclose,thigh,tlow,tavg,tvolume,tamount
from dune_sdayquote sq
join dune_stockcode ds on ds.code = sq.sstock
where sq.sstock in  ('SZ184688', 'SZ184689', 'SZ184690', 'SZ184691', 'SZ184692', 'SZ184693', 'SZ184698', 'SZ184699', 'SZ184700', 'SZ184701', 'SZ184703', 'SZ184705', 'SZ184706', 'SZ184712', 'SZ184713', 'SZ184721', 'SZ184722', 'SZ184728', 'SH510050', 'SH510180', 'SH510880', 'SZ159901', 'SZ159902')


#3 除权数据
上海基金均已经被除权
select * from dune_powerinfo dp
join dune_stockcode ds on dp.tstock_id = ds.id
where code in  ('SZ184688', 'SZ184689', 'SZ184690', 'SZ184691', 'SZ184692', 'SZ184693', 'SZ184698', 'SZ184699', 'SZ184700', 'SZ184701', 'SZ184703', 'SZ184705', 'SZ184706', 'SZ184712', 'SZ184713', 'SZ184721', 'SZ184722', 'SZ184728', 'SH510050', 'SH510180', 'SH510880', 'SZ159901', 'SZ159902')

直接
python fxjtransfer.py -x


#2009-03-24
#1 psy(67)的ma(22)对ma(67)的死叉，以及psy/22/67的走势背离，都是大盘改变趋势的信号，且都有提前期

#2 vmacd的死叉貌似是一个卖出信号？提前期还可以，优于psy,psy太提前了
   而且vmacd即便延后，延后也有限
   vmacd(6,13,9)对于卖出更好 [为正常参数的一半]


原始的组合
def vmacd(stock,dates):
    t = stock.transaction
    vdiff,vdea = cmacd(t[VOLUME])
    dcross = gand(cross(vdea,vdiff),strend(vdiff)>0,strend(vdea>0))
    g = gand(stock.g5 >= stock.g20,stock.g20 >= stock.g60,stock.g60 >= stock.g120,stock.g120 >= stock.g250)
    linelog(stock.code)
    
    #ma_standard = ma(t[CLOSE],60)
    #trend_ma_standard = strend(ma_standard) > 0    
    return gand(dcross,g)


加上
    ma_standard = ma(t[CLOSE],120)
    trend_ma_standard = strend(ma_standard) > 0    
条件
pre_ev:
        评估:总盈亏值=7774,交易次数=2155        期望值=42
                总盈亏率(1/1000)=7774,平均盈亏率(1/1000)=3,盈利交易率(1/1000)=26
8
                赢利次数=579,赢利总值=120077
                亏损次数=1574,亏损总值=112303
                平盘次数=2


c_extractor = lambda c,s:gand(c.g5 >= c.g20,c.g20>=c.g60,c.g60>=c.g120,c.g120>=c.g250,s>=3300,s<=6600)

    cs = catalog_signal_cs(stock.c60,c_extractor)
:
prev:
        评估:总盈亏值=10549,交易次数=84 期望值=1923
                总盈亏率(1/1000)=10549,平均盈亏率(1/1000)=125,盈利交易率(1/1000)=404
                赢利次数=34,赢利总值=13802
                亏损次数=50,亏损总值=3253
                平盘次数=0

vdea:0-12000, 问题是成功率没有上升到>500
pre_ev:
        评估:总盈亏值=8782,交易次数=51  期望值=2915
                总盈亏率(1/1000)=8782,平均盈亏率(1/1000)=172,盈利交易率(1/1000)=431
                赢利次数=22,赢利总值=10521
                亏损次数=29,亏损总值=1739
                平盘次数=0


改为ma60:
pre_ev:
        评估:总盈亏值=9410,交易次数=114 期望值=1281
                总盈亏率(1/1000)=9410,平均盈亏率(1/1000)=82,盈利交易率(1/1000)=350
                赢利次数=40,赢利总值=14189
                亏损次数=74,亏损总值=4779


#

弱化板块条件,去除范围
ma_standard=120
pre_ev:
c_extractor = lambda c,s:gand(c.g5 >= c.g20,c.g20>=c.g60,c.g60>=c.g120,c.g120>=c.g250,s<=3300)
pre_ev:
        评估:总盈亏值=17799,交易次数=200        期望值=1313
                总盈亏率(1/1000)=17799,平均盈亏率(1/1000)=88,盈利交易率(1/1000)=
355
                赢利次数=71,赢利总值=26533
                亏损次数=129,亏损总值=8734
                平盘次数=0


范围改为<3300,ma=120
        评估:总盈亏值=2453,交易次数=33  期望值=1088
                总盈亏率(1/1000)=2453,平均盈亏率(1/1000)=74,盈利交易率(1/1000)=3
33
                赢利次数=11,赢利总值=3957
                亏损次数=22,亏损总值=1504
                平盘次数=0







######3 命令行准备脚本

from wolfox.fengine.core.shortcut import *
from wolfox.fengine.normal.funcs import *
from wolfox.fengine.core.d1match import *
from wolfox.fengine.core.d1indicator import cmacd
from wolfox.foxit.base.tutils import linelog
from time import time

import logging
logging.basicConfig(filename="srun_x4c.log",level=logging.DEBUG,format='%(name)s:%(funcName)s:%(lineno)d:%(asctime)s %(levelname)s %(message)s')
#begin,xbegin,end = 19980101,20010701,20091231
#begin,xbegin,end = 20000101,20010701,20090101
#begin,xbegin,end = 20000101,20010701,20091231
#begin,xbegin,end = 20050101,20060701,20091231
#begin,xbegin,end = 20070101,20080601,20091231
begin,xbegin,end = 20000101,20080701,20091231

tbegin = time()
    
#dates,sdata,idata,catalogs = prepare_all(begin,end,[],[ref_code])
dates,sdata,idata,catalogs = prepare_all(begin,end,[],[])
#sdata.update(idata)
import psyco
psyco.full()

import wolfox.fengine.normal.srun as srun
srun.prepare_order(sdata.values())
srun.prepare_order(idata.values())
srun.prepare_order(catalogs)
srun.prepare_common(sdata.values(),idata[ref_id])
srun.prepare_common(idata.values(),idata[ref_id])
#srun.prepare_order(idata.values())
dummy_catalogs('catalog',catalogs)
pman = AdvancedATRPositionManager()
dman = DateManager(begin,end)
myMediator=nmediator_factory(trade_strategy=B1S1,pricer = oo_pricer)
seller = atr_seller_factory(stop_times=1200,trace_times=3000)
seller2000 = atr_seller_factory(stop_times=2000,trace_times=3000)

import wolfox.fengine.normal.sfuncs as s

#开始计算
reload(srun)    #应对脚本修改
buyer = srun.prepare_buyer(dates)   
name,tradess = calc_trades(buyer,seller,sdata,dates,xbegin,cmediator=myMediator)
#name,tradess = calc_trades(buyer,seller2000,sdata,dates,xbegin,cmediator=myMediator)
result,strade = ev.evaluate_all(tradess,pman,dman)


#2009-03-28
#ma4的测试
5X10，且5,10,20,60多头排列(向上且越短越上)
pre_ev:
        评估:总盈亏值=9816,交易次数=12366       期望值=0
                总盈亏率(1/1000)=9816,平均盈亏率(1/1000)=0,盈利交易率(1/1000)=263
                赢利次数=3262,赢利总值=633340
                亏损次数=9073,亏损总值=623524
                平盘次数=31

添加120也是向上
pre_ev:
        评估:总盈亏值=90813,交易次数=9428       期望值=130
                总盈亏率(1/1000)=90813,平均盈亏率(1/1000)=9,盈利交易率(1/1000)=287
                赢利次数=2710,赢利总值=559709
                亏损次数=6700,亏损总值=468896
                平盘次数=18

令120在60之下
pre_ev:
        评估:总盈亏值=117256,交易次数=7816      期望值=214
                总盈亏率(1/1000)=117256,平均盈亏率(1/1000)=15,盈利交易率(1/1000)
=301
                赢利次数=2357,赢利总值=501820
                亏损次数=5445,亏损总值=384564
                平盘次数=14

添加g
pre_ev:
        评估:总盈亏值=32886,交易次数=692        期望值=635
                总盈亏率(1/1000)=32886,平均盈亏率(1/1000)=47,盈利交易率(1/1000)=338
                赢利次数=234,赢利总值=66698
                亏损次数=456,亏损总值=33812
                平盘次数=2
                闭合交易明细:

放松120
pre_ev:
        评估:总盈亏值=16834,交易次数=1391       期望值=173
                总盈亏率(1/1000)=16834,平均盈亏率(1/1000)=12,盈利交易率(1/1000)=259
                赢利次数=361,赢利总值=88738
                亏损次数=1028,亏损总值=71904
                平盘次数=2
                闭合交易明细:

不妥
仍然120，添加cs
pre_ev:
        评估:总盈亏值=6230,交易次数=70  期望值=1236
                总盈亏率(1/1000)=6230,平均盈亏率(1/1000)=89,盈利交易率(1/1000)=471
                赢利次数=33,赢利总值=8924
                亏损次数=37,亏损总值=2694
                平盘次数=0

cs中间范围
pre_ev:
        评估:总盈亏值=5530,交易次数=36  期望值=2067
                总盈亏率(1/1000)=5530,平均盈亏率(1/1000)=153,盈利交易率(1/1000)=472
                赢利次数=17,赢利总值=6954
                亏损次数=19,亏损总值=1424
                平盘次数=0

#ma+vmacd的测试
vmacd上叉，3天内ma5X10,且60向上
pre_ev:
        评估:总盈亏值=26976,交易次数=12954      期望值=30
                总盈亏率(1/1000)=26976,平均盈亏率(1/1000)=2,盈利交易率(1/1000)=2
59
                赢利次数=3358,赢利总值=667264
                亏损次数=9564,亏损总值=640288
                平盘次数=32

vmacd上叉，3天内ma5X10,5/10/20/60多头排列
pre_ev:
        评估:总盈亏值=30814,交易次数=10389      期望值=29
                总盈亏率(1/1000)=30814,平均盈亏率(1/1000)=2,盈利交易率(1/1000)=2
60
                赢利次数=2707,赢利总值=551748
                亏损次数=7659,亏损总值=520934
                平盘次数=23

vmacd上叉，3天内ma5X10,5/10/20/60/120多头排列
pre_ev:
        评估:总盈亏值=97535,交易次数=7481       期望值=188
                总盈亏率(1/1000)=97535,平均盈亏率(1/1000)=13,盈利交易率(1/1000)= 284
                赢利次数=2132,赢利总值=468554
                亏损次数=5333,亏损总值=371019
                平盘次数=16
                闭合交易明细:


g
pre_ev:
        评估:总盈亏值=16615,交易次数=895        期望值=260
                总盈亏率(1/1000)=16615,平均盈亏率(1/1000)=18,盈利交易率(1/1000)= 281
                赢利次数=252,赢利总值=61468
                亏损次数=642,亏损总值=44853
                平盘次数=1
                闭合交易明细:

cs
pre_ev:
        评估:总盈亏值=1182,交易次数=83  期望值=215
                总盈亏率(1/1000)=1182,平均盈亏率(1/1000)=14,盈利交易率(1/1000)=2
89
                赢利次数=24,赢利总值=5044
                亏损次数=59,亏损总值=3862
                平盘次数=0

cs中段，不如单独的vmacd和ma4好
        评估:总盈亏值=1871,交易次数=29  期望值=1084
                总盈亏率(1/1000)=1871,平均盈亏率(1/1000)=64,盈利交易率(1/1000)=344
                赢利次数=10,赢利总值=3007
                亏损次数=19,亏损总值=1136
                平盘次数=0
                闭合交易明细:
                        stock=SH600021 盈亏值=-147520:,盈亏率(1/1000):-42

#vmacd+ ma10>ma20>ma60>ma120, g+cs
pre_ev:
        评估:总盈亏值=16796,交易次数=117        期望值=1986
                总盈亏率(1/1000)=16796,平均盈亏率(1/1000)=143,盈利交易率(1/1000)=444
                赢利次数=52,赢利总值=21521
                亏损次数=65,亏损总值=4725
cs中段
pre_ev:
        评估:总盈亏值=10141,交易次数=56 期望值=2549
                总盈亏率(1/1000)=10141,平均盈亏率(1/1000)=181,盈利交易率(1/1000)=517
                赢利次数=29,赢利总值=12074
                亏损次数=27,亏损总值=1933
                平盘次数=0
cs下段 (<3300)
pre_ev:
        评估:总盈亏值=2067,交易次数=14  期望值=2070
                总盈亏率(1/1000)=2067,平均盈亏率(1/1000)=147,盈利交易率(1/1000)= 500
                赢利次数=7,赢利总值=2570
                亏损次数=7,亏损总值=503
                平盘次数=0



放松cs:
pre_ev:
        评估:总盈亏值=26208,交易次数=1143       期望值=297
                总盈亏率(1/1000)=26208,平均盈亏率(1/1000)=22,盈利交易率(1/1000)=316
                赢利次数=362,赢利总值=84148
                亏损次数=779,亏损总值=57940
                平盘次数=2


添加strend(ma120)>0,即ma10>ma20>ma60>ma120, g+cs, strend(ma120)>0
pre_ev:
        评估:总盈亏值=17133,交易次数=113        期望值=2157
                总盈亏率(1/1000)=17133,平均盈亏率(1/1000)=151,盈利交易率(1/1000)=451
                赢利次数=51,赢利总值=21506
                亏损次数=62,亏损总值=4373
                平盘次数=0

cs < 3300:
pre_ev:
        评估:总盈亏值=2067,交易次数=14  期望值=2070
                总盈亏率(1/1000)=2067,平均盈亏率(1/1000)=147,盈利交易率(1/1000)=500
                赢利次数=7,赢利总值=2570
                亏损次数=7,亏损总值=503
                平盘次数=0

cs<=6600:
pre_ev:
        评估:总盈亏值=11756,交易次数=62 期望值=2554
                总盈亏率(1/1000)=11756,平均盈亏率(1/1000)=189,盈利交易率(1/1000)=516
                赢利次数=32,赢利总值=13995
                亏损次数=30,亏损总值=2239
                平盘次数=0


cs:3300-6600:
        评估:总盈亏值=10164,交易次数=54 期望值=2611
                总盈亏率(1/1000)=10164,平均盈亏率(1/1000)=188,盈利交易率(1/1000)=518
                赢利次数=28,赢利总值=12059
                亏损次数=26,亏损总值=1895
                平盘次数=0

cs: > 6600:
pre_ev:
        评估:总盈亏值=5298,交易次数=53  期望值=1523
                总盈亏率(1/1000)=5298,平均盈亏率(1/1000)=99,盈利交易率(1/1000)=358
                赢利次数=19,赢利总值=7511
                亏损次数=34,亏损总值=2213
                平盘次数=0

#放松ma10>ma20
>6600
pre_ev:
        评估:总盈亏值=5489,交易次数=65  期望值=1200
                总盈亏率(1/1000)=5489,平均盈亏率(1/1000)=84,盈利交易率(1/1000)=3
69
                赢利次数=24,赢利总值=8360
                亏损次数=41,亏损总值=2871
                平盘次数=0
                闭合交易明细:

<6600
pre_ev:
        评估:总盈亏值=11136,交易次数=77 期望值=2149
                总盈亏率(1/1000)=11136,平均盈亏率(1/1000)=144,盈利交易率(1/1000)=428
                赢利次数=33,赢利总值=14120
                亏损次数=44,亏损总值=2984
                平盘次数=0
                闭合交易明细:


#120==>60
cs<6600
pre_ev:
        评估:总盈亏值=11733,交易次数=64 期望值=2506
                总盈亏率(1/1000)=11733,平均盈亏率(1/1000)=183,盈利交易率(1/1000)=515
                赢利次数=33,赢利总值=14010
                亏损次数=31,亏损总值=2277
                平盘次数=0

#60,添加ma5>ma10
        评估:总盈亏值=7884,交易次数=54  期望值=2000
                总盈亏率(1/1000)=7884,平均盈亏率(1/1000)=146,盈利交易率(1/1000)=425
                赢利次数=23,赢利总值=10161
                亏损次数=31,亏损总值=2277
                平盘次数=0
                闭合交易明细:

#60 ma5>ma20,去掉ma10
pre_ev:
        评估:总盈亏值=9499,交易次数=68  期望值=1904
                总盈亏率(1/1000)=9499,平均盈亏率(1/1000)=139,盈利交易率(1/1000)=
455
                赢利次数=31,赢利总值=12219
                亏损次数=37,亏损总值=2720
                平盘次数=0

#60,ma10>ma60,去掉ma20
        评估:总盈亏值=11139,交易次数=79 期望值=2073
                总盈亏率(1/1000)=11139,平均盈亏率(1/1000)=141,盈利交易率(1/1000)
=443
                赢利次数=35,赢利总值=14145
                亏损次数=44,亏损总值=3006
                平盘次数=0

vdea<10000
pre_ev:
        评估:总盈亏值=10587,交易次数=68 期望值=2348
                总盈亏率(1/1000)=10587,平均盈亏率(1/1000)=155,盈利交易率(1/1000) =441
                赢利次数=30,赢利总值=13123
                亏损次数=38,亏损总值=2536
                平盘次数=0

#60,10>20>60,vdea<10000
pre_ev:
        评估:总盈亏值=11092,交易次数=54 期望值=2847
                总盈亏率(1/1000)=11092,平均盈亏率(1/1000)=205,盈利交易率(1/1000)=518
                赢利次数=28,赢利总值=12988
                亏损次数=26,亏损总值=1896
                平盘次数=0
                闭合交易明细:

<5000
pre_ev:
        评估:总盈亏值=6638,交易次数=40  期望值=2357
                总盈亏率(1/1000)=6638,平均盈亏率(1/1000)=165,盈利交易率(1/1000)=525
                赢利次数=21,赢利总值=7974
                亏损次数=19,亏损总值=1336
                平盘次数=0


<15000:
pre_ev:
        评估:总盈亏值=11586,交易次数=58 期望值=2842
                总盈亏率(1/1000)=11586,平均盈亏率(1/1000)=199,盈利交易率(1/1000) =500
                赢利次数=29,赢利总值=13633
                亏损次数=29,亏损总值=2047
                平盘次数=0


还是10>20>60>120,120最好
cs < 6600
vdea<15000
pre_ev:
        评估:总盈亏值=11609,交易次数=56 期望值=2915
                总盈亏率(1/1000)=11609,平均盈亏率(1/1000)=207,盈利交易率(1/1000)=500
                赢利次数=28,赢利总值=13618
                亏损次数=28,亏损总值=2009
                平盘次数=0

<12000
pre_ev:
        评估:总盈亏值=11688,交易次数=54 期望值=2918
                总盈亏率(1/1000)=11688,平均盈亏率(1/1000)=216,盈利交易率(1/1000)=518
                赢利次数=28,赢利总值=13618
                亏损次数=26,亏损总值=1930
                平盘次数=0
<10000
pre_ev:
        评估:总盈亏值=11115,交易次数=52 期望值=2878
                总盈亏率(1/1000)=11115,平均盈亏率(1/1000)=213,盈利交易率(1/1000)=519
                赢利次数=27,赢利总值=12973
                亏损次数=25,亏损总值=1858
                平盘次数=0
                闭合交易明细:
<8000
pre_ev:
        评估:总盈亏值=7988,交易次数=45  期望值=2492
                总盈亏率(1/1000)=7988,平均盈亏率(1/1000)=177,盈利交易率(1/1000)=488
                赢利次数=22,赢利总值=9640
                亏损次数=23,亏损总值=1652
                平盘次数=0

<0:
pre_ev:
        评估:总盈亏值=869,交易次数=13   期望值=970
                总盈亏率(1/1000)=869,平均盈亏率(1/1000)=66,盈利交易率(1/1000)=461
                赢利次数=6,赢利总值=1347
                亏损次数=7,亏损总值=478
                平盘次数=0
>0:
pre_ev:
        评估:总盈亏值=11012,交易次数=51 期望值=2756
                总盈亏率(1/1000)=11012,平均盈亏率(1/1000)=215,盈利交易率(1/1000)=529
                赢利次数=27,赢利总值=12903
                亏损次数=24,亏损总值=1891
                平盘次数=0
0-12000:
pre_ev:
        评估:总盈亏值=10944,交易次数=43 期望值=3215
                总盈亏率(1/1000)=10944,平均盈亏率(1/1000)=254,盈利交易率(1/1000)=534
                赢利次数=23,赢利总值=12526
                亏损次数=20,亏损总值=1582
                平盘次数=0

vdea:0-12000,cs:<8500
pre_ev: 
        评估:总盈亏值=16098,交易次数=63 期望值=3311
                总盈亏率(1/1000)=16098,平均盈亏率(1/1000)=255,盈利交易率(1/1000)=507
                赢利次数=32,赢利总值=18509
                亏损次数=31,亏损总值=2411
                平盘次数=0
vdea:0-12000,放松cs
pre_ev:
        评估:总盈亏值=15835,交易次数=68 期望值=3012
                总盈亏率(1/1000)=15835,平均盈亏率(1/1000)=232,盈利交易率(1/1000) =485
                赢利次数=33,赢利总值=18538
                亏损次数=35,亏损总值=2703
                平盘次数=0

cs<=6600,放松g
pre_ev:
        评估:总盈亏值=16026,交易次数=354        期望值=616
                总盈亏率(1/1000)=16026,平均盈亏率(1/1000)=45,盈利交易率(1/1000)=296
                赢利次数=105,赢利总值=34314
                亏损次数=249,亏损总值=18288
                平盘次数=0
cs彻底去掉，g不变
pre_ev:
        评估:总盈亏值=21776,交易次数=637        期望值=472
                总盈亏率(1/1000)=21776,平均盈亏率(1/1000)=34,盈利交易率(1/1000)=343
                赢利次数=219,赢利总值=52205
                亏损次数=417,亏损总值=30429
                平盘次数=1
仍然计算cs，但不进入条件（去掉不计入任何板块的股票）
        评估:总盈亏值=22480,交易次数=626        期望值=486
                总盈亏率(1/1000)=22480,平均盈亏率(1/1000)=35,盈利交易率(1/1000)=345
                赢利次数=216,赢利总值=52056
                亏损次数=409,亏损总值=29576
                平盘次数=1



最终结论 vmacd_ma4: vdea=0-12000,cs<8500


#2009-03-29
#emv交叉平均线(emv为14日累积，ma=9) 10>20>60>120,120向上，g
双叉
pre_ev:
        评估:总盈亏值=13749,交易次数=910        期望值=197
                总盈亏率(1/1000)=13749,平均盈亏率(1/1000)=15,盈利交易率(1/1000)=304
                赢利次数=277,赢利总值=62191
                亏损次数=631,亏损总值=48442
                平盘次数=2
添加cs:<6600
pre_ev:
        评估:总盈亏值=8768,交易次数=65  期望值=1786
                总盈亏率(1/1000)=8768,平均盈亏率(1/1000)=134,盈利交易率(1/1000)=446
                赢利次数=29,赢利总值=11482
                亏损次数=36,亏损总值=2714
                平盘次数=0

上叉
        评估:总盈亏值=4889,交易次数=43  期望值=1430
                总盈亏率(1/1000)=4889,平均盈亏率(1/1000)=113,盈利交易率(1/1000)=441
                赢利次数=19,赢利总值=6802
                亏损次数=24,亏损总值=1913
                平盘次数=0

下叉，但semv向上，说明是寻找支撑
pre_ev:
        评估:总盈亏值=5122,交易次数=26  期望值=3126
                总盈亏率(1/1000)=5122,平均盈亏率(1/1000)=197,盈利交易率(1/1000)=461
                赢利次数=12,赢利总值=6011
                亏损次数=14,亏损总值=889
                平盘次数=0


#emv上叉0
pre_ev:
        评估:总盈亏值=9551,交易次数=38  期望值=3861
                总盈亏率(1/1000)=9551,平均盈亏率(1/1000)=251,盈利交易率(1/1000)=447
                赢利次数=17,赢利总值=10924
                亏损次数=21,亏损总值=1373
                平盘次数=0

3300-6600,双叉
pre_ev:
        评估:总盈亏值=7956,交易次数=22  期望值=5469
                总盈亏率(1/1000)=7956,平均盈亏率(1/1000)=361,盈利交易率(1/1000)=409
                赢利次数=9,赢利总值=8817
                亏损次数=13,亏损总值=861
                平盘次数=0
                闭合交易明细:

只有上叉
<6600
        评估:总盈亏值=9435,交易次数=33  期望值=4130
                总盈亏率(1/1000)=9435,平均盈亏率(1/1000)=285,盈利交易率(1/1000)=454
                赢利次数=15,赢利总值=10694
                亏损次数=18,亏损总值=1259
                平盘次数=0
                闭合交易明细:

3300-6600
pre_ev:
        评估:总盈亏值=7971,交易次数=18  期望值=5972
                总盈亏率(1/1000)=7971,平均盈亏率(1/1000)=442,盈利交易率(1/1000)=444
                赢利次数=8,赢利总值=8718
                亏损次数=10,亏损总值=747
                平盘次数=0

#不设10>20>60>120
pre_ev:
        评估:总盈亏值=7830,交易次数=41  期望值=3015
                总盈亏率(1/1000)=7830,平均盈亏率(1/1000)=190,盈利交易率(1/1000)= 292
                赢利次数=12,赢利总值=9673
                亏损次数=29,亏损总值=1843
                平盘次数=0


g去掉5>20,cs去掉5>20
pre_ev:
        评估:总盈亏值=18589,交易次数=140        期望值=2000
                总盈亏率(1/1000)=18589,平均盈亏率(1/1000)=132,盈利交易率(1/1000)=442
                赢利次数=62,赢利总值=23670
                亏损次数=76,亏损总值=5081
                平盘次数=2

g去掉5>20,cs不变
     评估:总盈亏值=3981,交易次数=42  期望值=1362
    总盈亏率(1/1000)=3981,平均盈亏率(1/1000)=94,盈利交易率(1/1000)=452
                赢利次数=19,赢利总值=5573
                亏损次数=23,亏损总值=1592

g去掉5>20,cs:5<20
pre_ev:
        评估:总盈亏值=8494,交易次数=88  期望值=1454
                总盈亏率(1/1000)=8494,平均盈亏率(1/1000)=96,盈利交易率(1/1000)=454
                赢利次数=40,赢利总值=11701
                亏损次数=48,亏损总值=3207
                平盘次数=0

#emv过零线时vmacd/macd>0且dea向上
cs<6600
pre_ev:
        评估:总盈亏值=8537,交易次数=36  期望值=3537
                总盈亏率(1/1000)=8537,平均盈亏率(1/1000)=237,盈利交易率(1/1000)=444
                赢利次数=16,赢利总值=9892
                亏损次数=20,亏损总值=1355
                平盘次数=0
cs:3300-6600
pre_ev:
        评估:总盈亏值=7974,交易次数=21  期望值=5414
                总盈亏率(1/1000)=7974,平均盈亏率(1/1000)=379,盈利交易率(1/1000)=428
                赢利次数=9,赢利总值=8817
                亏损次数=12,亏损总值=843
                平盘次数=0
                闭合交易明细:




#wvad交叉，(wvad为24日累积，ma=6) 10>20>60>120,120向上
pre_ev:
        评估:总盈亏值=3977,交易次数=7967        期望值=0
                总盈亏率(1/1000)=3977,平均盈亏率(1/1000)=0,盈利交易率(1/1000)=274
                赢利次数=2187,赢利总值=419352
                亏损次数=5763,亏损总值=415375
                平盘次数=17

添加g
pre_ev:
        评估:总盈亏值=1760,交易次数=905 期望值=12
                总盈亏率(1/1000)=1760,平均盈亏率(1/1000)=1,盈利交易率(1/1000)=275
                赢利次数=249,赢利总值=53893
                亏损次数=655,亏损总值=52133
                平盘次数=1
添加cs<6600:
        评估:总盈亏值=2902,交易次数=37  期望值=987
                总盈亏率(1/1000)=2902,平均盈亏率(1/1000)=78,盈利交易率(1/1000)=459
                赢利次数=17,赢利总值=4490
                亏损次数=20,亏损总值=1588
                平盘次数=0

cs:3300-6600
        评估:总盈亏值=3270,交易次数=29  期望值=1417
                总盈亏率(1/1000)=3270,平均盈亏率(1/1000)=112,盈利交易率(1/1000)=482
                赢利次数=14,赢利总值=4465
                亏损次数=15,亏损总值=1195
                平盘次数=0
                闭合交易明细:

之前都是叉，而没有看上叉还是下叉，这次确定是上叉
pre_ev:
        评估:总盈亏值=2333,交易次数=21  期望值=1387
                总盈亏率(1/1000)=2333,平均盈亏率(1/1000)=111,盈利交易率(1/1000)=428
                赢利次数=9,赢利总值=3301
                亏损次数=12,亏损总值=968
                平盘次数=0
                闭合交易明细:


g+cs,g去掉5>20,cs去掉5>20,cs<6600
        评估:总盈亏值=10840,交易次数=66 期望值=2129
                总盈亏率(1/1000)=10840,平均盈亏率(1/1000)=164,盈利交易率(1/1000)=409
                赢利次数=27,赢利总值=13852
                亏损次数=39,亏损总值=3012
                平盘次数=0

g+cs,g去掉5>20,cs<6600
pre_ev:
        评估:总盈亏值=2173,交易次数=21  期望值=1144
                总盈亏率(1/1000)=2173,平均盈亏率(1/1000)=103,盈利交易率(1/1000)=476
                赢利次数=10,赢利总值=3172
                亏损次数=11,亏损总值=999
                平盘次数=0

g+cs,g去掉5>20,cs变为5<20,cs<6600
pre_ev:
        评估:总盈亏值=8662,交易次数=36  期望值=3243
                总盈亏率(1/1000)=8662,平均盈亏率(1/1000)=240,盈利交易率(1/1000)=388
                赢利次数=14,赢利总值=10295
                亏损次数=22,亏损总值=1633
                平盘次数=0

下叉
pre_ev:
        评估:总盈亏值=340,交易次数=24   期望值=200
                总盈亏率(1/1000)=340,平均盈亏率(1/1000)=14,盈利交易率(1/1000)=375
                赢利次数=9,赢利总值=1391
                亏损次数=15,亏损总值=1051
                平盘次数=0


#去掉10>20>60>120
pre_ev:
        评估:总盈亏值=4399,交易次数=57  期望值=1149
                总盈亏率(1/1000)=4399,平均盈亏率(1/1000)=77,盈利交易率(1/1000)=403
                赢利次数=23,赢利总值=6702
                亏损次数=34,亏损总值=2303
                平盘次数=0

#添加20>60>120
pre_ev:
        评估:总盈亏值=3155,交易次数=31  期望值=1311
                总盈亏率(1/1000)=3155,平均盈亏率(1/1000)=101,盈利交易率(1/1000)=451
                赢利次数=14,赢利总值=4465
                亏损次数=17,亏损总值=1310
                平盘次数=0



#清理退市股票
select * from dune_stockcode where is_active=0

#
000765  *ST华信 2005-07-04  2005-09-05   400038    华信3  国泰君安证券
000769  *ST大菲 2005-09-21  2005-11-28   400046    大菲1      国信证券
000827  *ST长兴 2005-09-21  2005-11-28   400043    长兴1  申银万国证券
000832  *ST龙涤 2006-06-29  2006-11-08   400050    龙涤5  申银万国证券
600092 S*ST精密 2006-11-30  2007-02-02   400051    精密1  申银万国证券
600625   PT水仙 2001-04-23  2001-12-10   400008   水仙A3  申银万国证券
600646   ST国嘉 2003-09-22  2004-03-17   400017    国嘉1  申银万国证券
600659  *ST花雕 2006-03-23  2006-06-02   400049    花雕1  申银万国证券
600669  *ST鞍成 2004-09-15  2004-11-22   400031  鞍合成1  申银万国证券
600670  *ST斯达 2004-09-24  2004-12-01   400033    斯达3  国泰君安证券
600672  *ST华圣 2005-08-05  2005-10-12   400039    华圣3      国信证券
600700  *ST数码 2005-09-20  2005-11-25   400041    数码3      兴业证券
600709   ST生态 2003-05-23  2004-05-28   400027    生态1  国泰君安证券
600752  *ST哈慈 2005-09-22  2005-11-29   400044    哈慈1  申银万国证券
600772 S*ST龙昌 2006-11-30  2007-02-09   400052    龙昌1  国泰君安证券
600788  *ST达曼 2005-03-25  2005-06-03   400037  达尔曼3  申银万国证券
600799  *ST龙科 2005-12-31  2006-08-04   400048    龙科1      渤海证券
600813 ST鞍一工 2002-09-16  2004-05-26   400021  鞍一工3  申银万国证券
600852  *ST中川 2005-09-16  2005-11-23   400040    中川3      国信证券
600878  *ST北科 2004-09-15  2004-11-22   400030    北科1      国信证券
600899  *ST信联 2005-09-21  2005-11-28   400042    信联1  国泰君安证券
200003 PT金田Ｂ 2002-06-14  2004-01-16   420016   金田B3      国信证券
200013 *ST石化B 2004-09-20  2004-11-26   420032   石化B3      国信证券
200015  PT中浩B 2001-10-22  2002-11-14   420011   中浩B3      国信证券
200057 *ST大洋B 2005-09-21  2005-11-28   420047   大洋B1      国信证券
900931  PT水仙B 2001-04-23  2001-12-10   420008   水仙B3  申银万国证券
000003 PT金田Ａ 2002-06-14  2004-01-16   400016   金田A3      国信证券
000013 *ST石化A 2004-09-20  2004-11-26   400032   石化A3      国信证券
000015  PT中浩A 2001-10-22  2002-11-14   400011   中浩A3      国信证券
000047   ST中侨 2003-05-30  2004-05-26   400026    中侨3  中国银河证券
000405   ST鑫光 2004-03-19  2004-05-26   400028    鑫光3      广发证券
000412   ST五环 2003-09-19  2004-05-26   400020    五环1      光大证券
000535  *ST猴王 2005-09-21  2005-11-28   400045    猴王1      国信证券
000556   PT南洋 2002-05-29  2004-05-28   400023    南洋3      国信证券
000588 PT粤金曼 2001-06-15  2002-09-20   400012  粤金曼3  申银万国证券
000621  *ST比特 2004-09-27  2004-12-03   400035    比特3      国信证券
000653   ST九州 2002-09-13  2004-05-21   400019    九州1      兴业证券
000658   ST海洋 2002-09-20  2004-05-21   400022    海洋3      长江证券
000660  *ST南华 2004-09-13  2004-11-19   400029    汇集3      国信证券
000675   ST银山 2002-08-20  2004-05-12   400018    银化3  申银万国证券
000689   ST宏业 2002-09-05  2004-05-28   400025    宏业3      海通证券
000730  *ST环保 2004-09-24  2004-12-01   400036    环保1      海通证券

update dune_stockcode set is_active=0 where code in ('SZ000765', 'SZ000769', 'SZ000827', 'SZ000832', 'SH600092', 'SH600625', 'SH600646', 'SH600659', 'SH600669', 'SH600670', 'SH600672', 'SH600700', 'SH600709', 'SH600752', 'SH600772', 'SH600788', 'SH600799', 'SH600813', 'SH600852', 'SH600878', 'SH600899', 'SZ200003', 'SZ200013', 'SZ200015', 'SZ200057', 'SH900931', 'SZ000003', 'SZ000013', 'SZ000015', 'SZ000047', 'SZ000405', 'SZ000412', 'SZ000535', 'SZ000556', 'SZ000588', 'SZ000621', 'SZ000653', 'SZ000658', 'SZ000660', 'SZ000675', 'SZ000689', 'SZ000730')

#ma3
ma3,t120>0
pre_ev:
        评估:总盈亏值=121201,交易次数=10085     期望值=190
                总盈亏率(1/1000)=121201,平均盈亏率(1/1000)=12,盈利交易率(1/1000)=283
                赢利次数=2857,赢利总值=580851
                亏损次数=7199,亏损总值=459650
                平盘次数=29

g + ma3,t120>0
        评估:总盈亏值=3896,交易次数=461 期望值=112
                总盈亏率(1/1000)=3896,平均盈亏率(1/1000)=8,盈利交易率(1/1000)=158
                赢利次数=73,赢利总值=19187
                亏损次数=214,亏损总值=15291
                平盘次数=174
                闭合交易明细:


cs<6600 + ma3,t120>0    没啥效果
pre_ev:
        评估:总盈亏值=2231,交易次数=293 期望值=118
                总盈亏率(1/1000)=2231,平均盈亏率(1/1000)=7,盈利交易率(1/1000)=300
                赢利次数=88,赢利总值=14353
                亏损次数=205,亏损总值=12122
                平盘次数=0

#xma60
10>20>60>120,t120>0
5天内碰ma60*1.15线后拉起
        评估:总盈亏值=204645,交易次数=5269      期望值=481
                总盈亏率(1/1000)=204645,平均盈亏率(1/1000)=38,盈利交易率(1/1000)=306
                赢利次数=1614,赢利总值=492477
                亏损次数=3640,亏损总值=287832
                平盘次数=15

g
pre_ev:
        评估:总盈亏值=23378,交易次数=327        期望值=887
                总盈亏率(1/1000)=23378,平均盈亏率(1/1000)=71,盈利交易率(1/1000)=360
                赢利次数=118,赢利总值=40051
                亏损次数=208,亏损总值=16673
                平盘次数=1
                闭合交易明细:

g+cs<6600
        评估:总盈亏值=7604,交易次数=28  期望值=5211
                总盈亏率(1/1000)=7604,平均盈亏率(1/1000)=271,盈利交易率(1/1000)=642
                赢利次数=18,赢利总值=8131
                亏损次数=10,亏损总值=527
                平盘次数=0
                闭合交易明细:

cs<6600:
pre_ev:
        评估:总盈亏值=40417,交易次数=205        期望值=2940
                总盈亏率(1/1000)=40417,平均盈亏率(1/1000)=197,盈利交易率(1/1000)=517
                赢利次数=106,赢利总值=47061
                亏损次数=99,亏损总值=6644
                平盘次数=0
                闭合交易明细:

g+cs<10000
pre_ev:
        评估:总盈亏值=7680,交易次数=38  期望值=3482
                总盈亏率(1/1000)=7680,平均盈亏率(1/1000)=202,盈利交易率(1/1000)=578
                赢利次数=22,赢利总值=8612
                亏损次数=16,亏损总值=932
                平盘次数=0

原g,简化cs:10>20>60>120>250 #原先是5>20...
pre_ev:
        评估:总盈亏值=5272,交易次数=25  期望值=3559
                总盈亏率(1/1000)=5272,平均盈亏率(1/1000)=210,盈利交易率(1/1000)=600
                赢利次数=15,赢利总值=5871
                亏损次数=10,亏损总值=599
                平盘次数=0

原cs,简化g = gand(stock.g5 >= stock.g20,stock.g20 >= stock.g60)
pre_ev:
        评估:总盈亏值=16275,交易次数=74 期望值=3590
                总盈亏率(1/1000)=16275,平均盈亏率(1/1000)=219,盈利交易率(1/1000)=554
                赢利次数=41,赢利总值=18312
                亏损次数=33,亏损总值=2037
                平盘次数=0

cs,g = gand(stock.g20 >= stock.g60,stock.g60 >= stock.g120,stock.g120 >= stock.g250)    ##最佳
pre_ev:
        评估:总盈亏值=11279,交易次数=40 期望值=5734
                总盈亏率(1/1000)=11279,平均盈亏率(1/1000)=281,盈利交易率(1/1000)=600
                赢利次数=24,赢利总值=12072
                亏损次数=16,亏损总值=793
                平盘次数=0

extend_days 5==>10
pre_ev:
        评估:总盈亏值=13441,交易次数=50 期望值=5360
                总盈亏率(1/1000)=13441,平均盈亏率(1/1000)=268,盈利交易率(1/1000)=580
                赢利次数=29,赢利总值=14504
                亏损次数=21,亏损总值=1063
                平盘次数=0
                闭合交易明细:

extend_days ==>8
pre_ev:
        评估:总盈亏值=13235,交易次数=46 期望值=5627
                总盈亏率(1/1000)=13235,平均盈亏率(1/1000)=287,盈利交易率(1/1000)=608
                赢利次数=28,赢利总值=14170
                亏损次数=18,亏损总值=935
                平盘次数=0

extend_days ==> 7   ###
pre_ev:
        评估:总盈亏值=13321,交易次数=45 期望值=6040
                总盈亏率(1/1000)=13321,平均盈亏率(1/1000)=296,盈利交易率(1/1000)=622
                赢利次数=28,赢利总值=14170
                亏损次数=17,亏损总值=849
                平盘次数=0
        

        
        #金手指
        评估:总盈亏值=33283,交易次数=173        期望值=2493
                总盈亏率(1/1000)=33283,平均盈亏率(1/1000)=192,盈利交易率(1/1000)=526
                赢利次数=91,赢利总值=39607
                亏损次数=82,亏损总值=6324
                平盘次数=0

        #金手指+cs<6600
        评估:总盈亏值=5530,交易次数=17  期望值=8333
                总盈亏率(1/1000)=5530,平均盈亏率(1/1000)=325,盈利交易率(1/1000)=705
                赢利次数=12,赢利总值=5727
                亏损次数=5,亏损总值=197
                平盘次数=0
        
        #银手指
        评估:总盈亏值=23766,交易次数=87 期望值=4706
                总盈亏率(1/1000)=23766,平均盈亏率(1/1000)=273,盈利交易率(1/1000)=574
                赢利次数=50,赢利总值=25929
                亏损次数=37,亏损总值=2163
                平盘次数=0


    #放松cs,cs<10000
    pre_ev:
        评估:总盈亏值=12025,交易次数=85 期望值=2043 
        总盈亏率(1/1000)=12025,平均盈亏率(1/1000)=141,盈利交易率(1/1000)=447
                赢利次数=38,赢利总值=15297
                亏损次数=47,亏损总值=3272
                平盘次数=0

    #g改为原始的5>20>60>120>250
    pre_ev:
        评估:总盈亏值=9592,交易次数=32  期望值=5641
                总盈亏率(1/1000)=9592,平均盈亏率(1/1000)=299,盈利交易率(1/1000)=656
                赢利次数=21,赢利总值=10175
                亏损次数=11,亏损总值=583
                平盘次数=0

去掉t120:
pre_ev:
        评估:总盈亏值=13146,交易次数=50 期望值=5137
                总盈亏率(1/1000)=13146,平均盈亏率(1/1000)=262,盈利交易率(1/1000)=580
                赢利次数=29,赢利总值=14224
                亏损次数=21,亏损总值=1078
                平盘次数=0

去掉g120>g250
pre_ev:
        评估:总盈亏值=23697,交易次数=89 期望值=4433
                总盈亏率(1/1000)=23697,平均盈亏率(1/1000)=266,盈利交易率(1/1000)=573
                赢利次数=51,赢利总值=25979
                亏损次数=38,亏损总值=2282
                平盘次数=0

    #添加t120
    pre_ev:
        评估:总盈亏值=23816,交易次数=88 期望值=4655
                总盈亏率(1/1000)=23816,平均盈亏率(1/1000)=270,盈利交易率(1/1000)=579
                赢利次数=51,赢利总值=25979
                亏损次数=37,亏损总值=2163
                平盘次数=0

    #原始
    pre_ev:
        评估:总盈亏值=13265,交易次数=49 期望值=5744
                总盈亏率(1/1000)=13265,平均盈亏率(1/1000)=270,盈利交易率(1/1000)=591
                赢利次数=29,赢利总值=14224
                亏损次数=20,亏损总值=959
                平盘次数=0
                闭合交易明细:
    

再去掉c120>c250
pre_ev:
        评估:总盈亏值=37822,交易次数=192        期望值=2800
                总盈亏率(1/1000)=37822,平均盈亏率(1/1000)=196,盈利交易率(1/1000)=484
                赢利次数=93,赢利总值=44812
                亏损次数=99,亏损总值=6990
                平盘次数=0

    #添加t120
    pre_ev:
        评估:总盈亏值=37996,交易次数=189        期望值=2913
                总盈亏率(1/1000)=37996,平均盈亏率(1/1000)=201,盈利交易率(1/1000)=486
                赢利次数=92,赢利总值=44741
                亏损次数=97,亏损总值=6745
                平盘次数=0



保留g120>g250,单独去掉c120>c250
pre_ev:
        评估:总盈亏值=18698,交易次数=97 期望值=3428
                总盈亏率(1/1000)=18698,平均盈亏率(1/1000)=192,盈利交易率(1/1000)=494
                赢利次数=48,赢利总值=21447
                亏损次数=49,亏损总值=2749

将c60>c120>c250改成c60>c250
pre_ev:
        评估:总盈亏值=18198,交易次数=86 期望值=3981
                总盈亏率(1/1000)=18198,平均盈亏率(1/1000)=211,盈利交易率(1/1000)=558
                赢利次数=48,赢利总值=20233
                亏损次数=38,亏损总值=2035
                平盘次数=0

保留cs正常,g60>g120>g250改成g60>g250
pre_ev:
        评估:总盈亏值=21783,交易次数=100        期望值=3390
                总盈亏率(1/1000)=21783,平均盈亏率(1/1000)=217,盈利交易率(1/1000)=560
                赢利次数=56,赢利总值=24641
                亏损次数=44,亏损总值=2858
                平盘次数=0

####说明板块的g60>g250有意义，而g的g60>g250无意义，不如g60>g120

extend_days ==>15
pre_ev:
        评估:总盈亏值=13505,交易次数=55 期望值=4537
                总盈亏率(1/1000)=13505,平均盈亏率(1/1000)=245,盈利交易率(1/1000)=563
                赢利次数=31,赢利总值=14821
                亏损次数=24,亏损总值=1316
                平盘次数=0
                闭合交易明细:


extend_days ==>20
pre_ev:
        评估:总盈亏值=13464,交易次数=58 期望值=4218
                总盈亏率(1/1000)=13464,平均盈亏率(1/1000)=232,盈利交易率(1/1000)=551
                赢利次数=32,赢利总值=14899
                亏损次数=26,亏损总值=1435
                平盘次数=0
                闭合交易明细:



cs,g = gand(stock.g5 >= stock.g60,stock.g60 >= stock.g120,stock.g120 >= stock.g250)
pre_ev:
        评估:总盈亏值=8225,交易次数=37  期望值=4111
                总盈亏率(1/1000)=8225,平均盈亏率(1/1000)=222,盈利交易率(1/1000)= 513
                赢利次数=19,赢利总值=9198
                亏损次数=18,亏损总值=973
                平盘次数=0

cs = gand(c.g20>=c.g60,c.g60>=c.g120,c.g120>=c.g250,s<=6600)
g = gand(stock.g5 >= stock.g60,stock.g60 >= stock.g120,stock.g120 >= stock.g250)   
pre_ev:
        评估:总盈亏值=13542,交易次数=103        期望值=1723
                总盈亏率(1/1000)=13542,平均盈亏率(1/1000)=131,盈利交易率(1/1000)=417
                赢利次数=43,赢利总值=18131
                亏损次数=60,亏损总值=4589
                平盘次数=0

cs = gand(c.g20>=c.g60,c.g60>=c.g120,c.g120>=c.g250,s<=6600)
g = gand(stock.g20 >= stock.g60,stock.g60 >= stock.g120,stock.g120 >= stock.g250)   
        评估:总盈亏值=17753,交易次数=116        期望值=2067
                总盈亏率(1/1000)=17753,平均盈亏率(1/1000)=153,盈利交易率(1/1000) =448
                赢利次数=52,赢利总值=22532
                亏损次数=64,亏损总值=4779
                平盘次数=0

cs = gand(c.g5<c.g20,c.g20>=c.g60,c.g60>=c.g120,c.g120>=c.g250,s<=6600) #5/20反手
g = gand(stock.g20 >= stock.g60,stock.g60 >= stock.g120,stock.g120 >= stock.g250)   
pre_ev:
        评估:总盈亏值=12169,交易次数=69 期望值=2146
                总盈亏率(1/1000)=12169,平均盈亏率(1/1000)=176,盈利交易率(1/1000)=420
                赢利次数=29,赢利总值=15475
                亏损次数=40,亏损总值=3306
                平盘次数=0


##2009-04-03
#1 测试四线理顺并冲击60日高点
    c_extractor = lambda c,s:gand(c.g5 >= c.g20,c.g20>=c.g60,c.g60>=c.g120,c.g120>=c.g250,s<=6600)
    g = gand(stock.g5>=stock.g20,stock.g20 >= stock.g60,stock.g60 >= stock.g120,stock.g120 >= stock.g250)
    ma_above = gand(greater(ma10,ma20),greater(ma20,ma60),greater(ma60,ma120))        
    t120

pre_ev:
        评估:总盈亏值=14511,交易次数=109        期望值=1847
                总盈亏率(1/1000)=14511,平均盈亏率(1/1000)=133,盈利交易率(1/1000)=522
                赢利次数=57,赢利总值=18303
                亏损次数=52,亏损总值=3792
                平盘次数=0


    c_extractor = lambda c,s:gand(c.g5 >= c.g20,c.g20>=c.g60,c.g60>=c.g120,c.g120>=c.g250,s>=3300,s<=6600)
pre_ev:
        评估:总盈亏值=12593,交易次数=86 期望值=2000
                总盈亏率(1/1000)=12593,平均盈亏率(1/1000)=146,盈利交易率(1/1000)=523
                赢利次数=45,赢利总值=15619
                亏损次数=41,亏损总值=3026
                平盘次数=0
                闭合交易明细:

去掉t120
pre_ev:
        评估:总盈亏值=14422,交易次数=111        期望值=1816
                总盈亏率(1/1000)=14422,平均盈亏率(1/1000)=129,盈利交易率(1/1000)=513
                赢利次数=57,赢利总值=18303
                亏损次数=54,亏损总值=3881
                平盘次数=0
                闭合交易明细:



#测试macd
    g = gand(stock.g5 >= stock.g20,stock.g20 >= stock.g60,stock.g60 >= stock.g120,stock.g120 >= stock.g250)
    c_extractor = lambda c,s:gand(c.g5 >= c.g20,c.g20>=c.g60,c.g60>=c.g120,c.g120>=c.g250,s>=3300,s<=6600)
    t120

pre_ev:
        评估:总盈亏值=8782,交易次数=51  期望值=2915
                总盈亏率(1/1000)=8782,平均盈亏率(1/1000)=172,盈利交易率(1/1000)=431
                赢利次数=22,赢利总值=10521
                亏损次数=29,亏损总值=1739
                平盘次数=0

添加ma_above
pre_ev:
        评估:总盈亏值=9159,交易次数=37  期望值=3478
                总盈亏率(1/1000)=9159,平均盈亏率(1/1000)=247,盈利交易率(1/1000)= 540
                赢利次数=20,赢利总值=10379
                亏损次数=17,亏损总值=1220
                平盘次数=0

cs<=6600
pre_ev:
        评估:总盈亏值=10899,交易次数=44 期望值=3207
                总盈亏率(1/1000)=10899,平均盈亏率(1/1000)=247,盈利交易率(1/1000)=522
                赢利次数=23,赢利总值=12526
                亏损次数=21,亏损总值=1627
                平盘次数=0

去掉t120:
pre_ev:
        评估:总盈亏值=10914,交易次数=45 期望值=3142
                总盈亏率(1/1000)=10914,平均盈亏率(1/1000)=242,盈利交易率(1/1000=533
                赢利次数=24,赢利总值=12541
                亏损次数=21,亏损总值=1627
                平盘次数=0


#测试gtest
g60:5 X 20
    g = gand(stock.g5 >= stock.g20,stock.g20 >= stock.g60,stock.g60 >= stock.g120,stock.g120 >= stock.g250)
    t120
    ma_above

pre_ev:
        评估:总盈亏值=34261,交易次数=716        期望值=602
                总盈亏率(1/1000)=34261,平均盈亏率(1/1000)=47,盈利交易率(1/1000)=350
                赢利次数=251,赢利总值=70706
                亏损次数=464,亏损总值=36445
                平盘次数=1

添加cs  ###
pre_ev:
        评估:总盈亏值=8645,交易次数=43  期望值=3722
                总盈亏率(1/1000)=8645,平均盈亏率(1/1000)=201,盈利交易率(1/1000)=604
                赢利次数=26,赢利总值=9575
                亏损次数=17,亏损总值=930
                平盘次数=0
去掉ma_above
pre_ev:
        评估:总盈亏值=8253,交易次数=80  期望值=1839
                总盈亏率(1/1000)=8253,平均盈亏率(1/1000)=103,盈利交易率(1/1000)=475
                赢利次数=38,赢利总值=10636
                亏损次数=42,亏损总值=2383
                平盘次数=0
ma_above改为10>20>60 (即去掉60>120) #会导致信号发出时间的变化
        评估:总盈亏值=5666,交易次数=46  期望值=2236
                总盈亏率(1/1000)=5666,平均盈亏率(1/1000)=123,盈利交易率(1/1000)=391
                赢利次数=18,赢利总值=7222
                亏损次数=28,亏损总值=1556
                平盘次数=0
                闭合交易明细:


在此基础上，t120改为t60
pre_ev:
        评估:总盈亏值=7701,交易次数=64  期望值=2105
                总盈亏率(1/1000)=7701,平均盈亏率(1/1000)=120,盈利交易率(1/1000)= 437
                赢利次数=28,赢利总值=9755
                亏损次数=36,亏损总值=2054
                平盘次数=0
    与t120+ma_above相比缺乏意义。

去掉t120:


#g,cs,t120,ma_above
g250:5 X 20
pre_ev:
        评估:总盈亏值=5273,交易次数=39  期望值=2596
                总盈亏率(1/1000)=5273,平均盈亏率(1/1000)=135,盈利交易率(1/1000)=461
                赢利次数=18,赢利总值=6371
                亏损次数=21,亏损总值=1098
                平盘次数=0

g250:5 X 67
pre_ev:
        评估:总盈亏值=3742,交易次数=18  期望值=2875
                总盈亏率(1/1000)=3742,平均盈亏率(1/1000)=207,盈利交易率(1/1000)=555
                赢利次数=10,赢利总值=4322
                亏损次数=8,亏损总值=580
                平盘次数=0
g250:10 X 67
pre_ev:
        评估:总盈亏值=2905,交易次数=17  期望值=2500
                总盈亏率(1/1000)=2905,平均盈亏率(1/1000)=170,盈利交易率(1/1000)=764
                赢利次数=13,赢利总值=3177
                亏损次数=4,亏损总值=272
                平盘次数=0

去掉t120,无变化
pre_ev:
        评估:总盈亏值=2905,交易次数=17  期望值=2500
                总盈亏率(1/1000)=2905,平均盈亏率(1/1000)=170,盈利交易率(1/1000)=
764
                赢利次数=13,赢利总值=3177
                亏损次数=4,亏损总值=272
                平盘次数=0


#g,cs,ma10>20>60>120
pre_ev:
        评估:总盈亏值=28557,交易次数=409        期望值=985
                总盈亏率(1/1000)=28557,平均盈亏率(1/1000)=69,盈利交易率(1/1000)=344
                赢利次数=141,赢利总值=47570
                亏损次数=268,亏损总值=19013
                平盘次数=0


##svama2
20 X 100
    g = gand(stock.g5>=stock.g20,stock.g20 >= stock.g60,stock.g60 >= stock.g120)
    ma_above = gand(greater(ma10,ma20),greater(ma20,ma60),greater(ma60,ma120))    
    t120

        评估:总盈亏值=71417,交易次数=901        期望值=1097
                总盈亏率(1/1000)=71417,平均盈亏率(1/1000)=79,盈利交易率(1/1000)=388
                赢利次数=350,赢利总值=111083
                亏损次数=550,亏损总值=39666
                平盘次数=1

添加cs
pre_ev:
        评估:总盈亏值=20804,交易次数=104        期望值=2777
                总盈亏率(1/1000)=20804,平均盈亏率(1/1000)=200,盈利交易率(1/1000)=538
                赢利次数=56,赢利总值=24219
                亏损次数=47,亏损总值=3415
                平盘次数=1

        #去掉t120
        pre_ev:
        评估:总盈亏值=23229,交易次数=112        期望值=2875
                总盈亏率(1/1000)=23229,平均盈亏率(1/1000)=207,盈利交易率(1/1000)=571
                赢利次数=64,赢利总值=26644
                亏损次数=47,亏损总值=3415
                平盘次数=1
        
        #ma_above改为10>20>60,去掉120
        pre_ev:
        评估:总盈亏值=25824,交易次数=221        期望值=1731
                总盈亏率(1/1000)=25824,平均盈亏率(1/1000)=116,盈利交易率(1/1000)=425
                赢利次数=94,赢利总值=34306
                亏损次数=125,亏损总值=8482
                平盘次数=2


        #ma_above改为 10>20>60>120>250
        pre_ev:
        评估:总盈亏值=17221,交易次数=89 期望值=2608
                总盈亏率(1/1000)=17221,平均盈亏率(1/1000)=193,盈利交易率(1/1000)=550
                赢利次数=49,赢利总值=20129
                亏损次数=39,亏损总值=2908
                平盘次数=1

        #ma_above: 5>10>20>60>120
        pre_ev:
        评估:总盈亏值=14359,交易次数=66 期望值=2893
                总盈亏率(1/1000)=14359,平均盈亏率(1/1000)=217,盈利交易率(1/1000)=560
                赢利次数=37,赢利总值=16536
                亏损次数=29,亏损总值=2177
                平盘次数=0


        #ma_above:20>60>120     #没有意义，相比10>20>60>120，添加的行中得失参半
        pre_ev:
        评估:总盈亏值=24214,交易次数=137        期望值=2478
                总盈亏率(1/1000)=24214,平均盈亏率(1/1000)=176,盈利交易率(1/1000)=532
                赢利次数=73,赢利总值=28713
                亏损次数=63,亏损总值=4499
                平盘次数=1

        #确定ma_above为10>20>60>120
        #测试g,目前为20>60>120
        pre_ev:
        评估:总盈亏值=23229,交易次数=112        期望值=2875
                总盈亏率(1/1000)=23229,平均盈亏率(1/1000)=207,盈利交易率(1/1000)=571
                赢利次数=64,赢利总值=26644
                亏损次数=47,亏损总值=3415
                平盘次数=1
                闭合交易明细:
        
        #添加 5>20,无意义
        pre_ev:
        评估:总盈亏值=11720,交易次数=64 期望值=2731
                总盈亏率(1/1000)=11720,平均盈亏率(1/1000)=183,盈利交易率(1/1000)=562
                赢利次数=36,赢利总值=13605
                亏损次数=28,亏损总值=1885
                平盘次数=0
        #添加120>250    #有意义，但筛除掉部分是26:25/10xxx:16xx，也相当有用
        pre_ev:
        评估:总盈亏值=14626,交易次数=60 期望值=3075
                总盈亏率(1/1000)=14626,平均盈亏率(1/1000)=243,盈利交易率(1/1000)=633
                赢利次数=38,赢利总值=16364
                亏损次数=22,亏损总值=1738
                平盘次数=0
        
        #确定g为20>60>120，且120>250为进一步的确认
        在此基础上，去掉cs
        pre_ev:
        评估:总盈亏值=126956,交易次数=2312      期望值=750
                总盈亏率(1/1000)=126956,平均盈亏率(1/1000)=54,盈利交易率(1/1000)=332
                赢利次数=768,赢利总值=238994
                亏损次数=1539,亏损总值=112038
                平盘次数=5
        


        添加g20:3300-6600
        pre_ev:
        评估:总盈亏值=52550,交易次数=342        期望值=2185
                总盈亏率(1/1000)=52550,平均盈亏率(1/1000)=153,盈利交易率(1/1000)=494
                赢利次数=169,赢利总值=64675
                亏损次数=173,亏损总值=12125
                平盘次数=0

        g20<3300:
        评估:总盈亏值=358,交易次数=50   期望值=162
                总盈亏率(1/1000)=358,平均盈亏率(1/1000)=7,盈利交易率(1/1000)=200

                赢利次数=10,赢利总值=2094
                亏损次数=40,亏损总值=1736
                平盘次数=0

        g20>8500:
        pre_ev:
        评估:总盈亏值=37414,交易次数=1442       期望值=324
                总盈亏率(1/1000)=37414,平均盈亏率(1/1000)=25,盈利交易率(1/1000)=262
                赢利次数=379,赢利总值=119888
                亏损次数=1060,亏损总值=82474
                平盘次数=3
        
        g20:4000-7000
        pre_ev:
        评估:总盈亏值=59399,交易次数=395        期望值=2173
                总盈亏率(1/1000)=59399,平均盈亏率(1/1000)=150,盈利交易率(1/1000)=501
                赢利次数=198,赢利总值=72865
                亏损次数=195,亏损总值=13466
                平盘次数=2
        g20:4000-7000,g60<=3300
        pre_ev:
        评估:总盈亏值=9481,交易次数=38  期望值=6225 ##
                总盈亏率(1/1000)=9481,平均盈亏率(1/1000)=249,盈利交易率(1/1000)=631
                赢利次数=24,赢利总值=10052
                亏损次数=14,亏损总值=571
                平盘次数=0
        
        g20:4500-7500
        pre_ev:
        评估:总盈亏值=68454,交易次数=522        期望值=1871
                总盈亏率(1/1000)=68454,平均盈亏率(1/1000)=131,盈利交易率(1/1000)=513
                赢利次数=268,赢利总值=86268
                亏损次数=252,亏损总值=17814
                平盘次数=2
        g20:4000-7500:
        pre_ev:
        评估:总盈亏值=72372,交易次数=552        期望值=1898
                总盈亏率(1/1000)=72372,平均盈亏率(1/1000)=131,盈利交易率(1/1000)=509
                赢利次数=281,赢利总值=91082
                亏损次数=269,亏损总值=18710
                平盘次数=2

        g20:3000-7500:
        评估:总盈亏值=73390,交易次数=586        期望值=1811
                总盈亏率(1/1000)=73390,平均盈亏率(1/1000)=125,盈利交易率(1/1000)=498
                赢利次数=292,赢利总值=93560
                亏损次数=292,亏损总值=20170
                平盘次数=2

        g20:2500-7500:
        评估:总盈亏值=73724,交易次数=588        期望值=1838
                总盈亏率(1/1000)=73724,平均盈亏率(1/1000)=125,盈利交易率(1/1000)=496
                赢利次数=292,赢利总值=93723
                亏损次数=294,亏损总值=19999
                平盘次数=2

        g20:2000-7000:
        评估:总盈亏值=60820,交易次数=442        期望值=2075
                总盈亏率(1/1000)=60820,平均盈亏率(1/1000)=137,盈利交易率(1/1000)=477
                赢利次数=211,赢利总值=76035
                亏损次数=229,亏损总值=15215
                平盘次数=2
                闭合交易明细:
        g20:3000-8000
        pre_ev:
        评估:总盈亏值=91939,交易次数=721        期望值=1895
                总盈亏率(1/1000)=91939,平均盈亏率(1/1000)=127,盈利交易率(1/1000)=479
                赢利次数=346,赢利总值=117285
                亏损次数=373,亏损总值=25346
                平盘次数=2
        
        g20:3500-8500
        评估:总盈亏值=110975,交易次数=920       期望值=1764
                总盈亏率(1/1000)=110975,平均盈亏率(1/1000)=120,盈利交易率(1/1000)=458
                赢利次数=422,赢利总值=144939
                亏损次数=496,亏损总值=33964
                平盘次数=2
                闭合交易明细:


        g20:4500-7500,g20-g60>1500
        pre_ev:
        评估:总盈亏值=22931,交易次数=94 期望值=3283
                总盈亏率(1/1000)=22931,平均盈亏率(1/1000)=243,盈利交易率(1/1000)=574
                赢利次数=54,赢利总值=25891
                亏损次数=40,亏损总值=2960
                平盘次数=0
                闭合交易明细:
        

        g20:3300-6600,g60:3300-6600
        pre_ev:
        评估:总盈亏值=41782,交易次数=286        期望值=2027
                总盈亏率(1/1000)=41782,平均盈亏率(1/1000)=146,盈利交易率(1/1000)=479
                赢利次数=137,赢利总值=52530
                亏损次数=149,亏损总值=10748
                平盘次数=0
        
        
        g20<=8000,g20-g60>1000,g60-g120>1000
        评估:总盈亏值=38016,交易次数=154        期望值=3514
                总盈亏率(1/1000)=38016,平均盈亏率(1/1000)=246,盈利交易率(1/1000)=577
                赢利次数=89,赢利总值=42593
                亏损次数=65,亏损总值=4577
                平盘次数=0
        

        g20:3000-7000,g20-g60>1000,g60-g120>1000
        评估:总盈亏值=42129,交易次数=220        期望值=2728
                总盈亏率(1/1000)=42129,平均盈亏率(1/1000)=191,盈利交易率(1/1000=536
                赢利次数=118,赢利总值=49293
                亏损次数=102,亏损总值=7164
                平盘次数=0



        g20:3000-8000,g20-g60>1000,g60-g120>1000    ####
        评估:总盈亏值=38016,交易次数=154        期望值=3514
                总盈亏率(1/1000)=38016,平均盈亏率(1/1000)=246,盈利交易率(1/1000)=577
                赢利次数=89,赢利总值=42593
                亏损次数=65,亏损总值=4577
                平盘次数=0

            #不设g20约束，g20:0-10000
            评估:总盈亏值=52821,交易次数=420        期望值=1712
                总盈亏率(1/1000)=52821,平均盈亏率(1/1000)=125,盈利交易率(1/1000)=442
                赢利次数=186,赢利总值=69982
                亏损次数=233,亏损总值=17161
                平盘次数=1


        g20:3000-8000,g20-g60>500,g60-g120>500
        评估:总盈亏值=62697,交易次数=381        期望值=2277
                总盈亏率(1/1000)=62697,平均盈亏率(1/1000)=164,盈利交易率(1/1000)=519
                赢利次数=198,赢利总值=75809
                亏损次数=182,亏损总值=13112
                平盘次数=1

        
        g20:4000-7500,,g20-g60>1000,g60-g120>1000
        评估:总盈亏值=28503,交易次数=117        期望值=3283
                总盈亏率(1/1000)=28503,平均盈亏率(1/1000)=243,盈利交易率(1/1000)=606
                赢利次数=71,赢利总值=31922
                亏损次数=46,亏损总值=3419
                平盘次数=0

        
        g20>g60+1500,g60>g120+1500,g20<7500
        pre_ev:
        评估:总盈亏值=8015,交易次数=32  期望值=2808
                总盈亏率(1/1000)=8015,平均盈亏率(1/1000)=250,盈利交易率(1/1000)=656
                赢利次数=21,赢利总值=8998
                亏损次数=11,亏损总值=983
                平盘次数=0

        g20>g60+2000,g60>g120+1000,g20<7500 #过犹不及
        评估:总盈亏值=6302,交易次数=25  期望值=2520
                总盈亏率(1/1000)=6302,平均盈亏率(1/1000)=252,盈利交易率(1/1000)=720
                赢利次数=18,赢利总值=7002
                亏损次数=7,亏损总值=700
                平盘次数=0
                闭合交易明细:

        g20>g60+2000,g20<8000
        评估:总盈亏值=27179,交易次数=140        期望值=2852
                总盈亏率(1/1000)=27179,平均盈亏率(1/1000)=194,盈利交易率(1/1000)=521
                赢利次数=73,赢利总值=31767
                亏损次数=67,亏损总值=4588
                平盘次数=0

        g20>g60+1000,g60>g120+1000,g20>7000
        评估:总盈亏值=34780,交易次数=356        期望值=1328
                总盈亏率(1/1000)=34780,平均盈亏率(1/1000)=97,盈利交易率(1/1000)=410
                赢利次数=146,赢利总值=50118
                亏损次数=209,亏损总值=15338
                平盘次数=1
        
        g20>g60+1000,g60>g120+1000,g20:3300-6600
        评估:总盈亏值=12060,交易次数=41 期望值=4260
                总盈亏率(1/1000)=12060,平均盈亏率(1/1000)=294,盈利交易率(1/1000)=658
                赢利次数=27,赢利总值=13039
                亏损次数=14,亏损总值=979
                平盘次数=0

        #因此g20>g60+1000,g60>g120+1000,g20:3000-8000 + ma_above(10>20>60>120)是黄金手，区分度为8674/2680705 = 1/309
                #20090416 29915/2682256 = 1/89
        #测试cs
        在此基础上添加cs没有增值效用
    
        #去掉g, cs: 5>20>60>120>250 + ma_above
        评估:总盈亏值=45369,交易次数=689        期望值=890
                总盈亏率(1/1000)=45369,平均盈亏率(1/1000)=65,盈利交易率(1/1000)=345
                赢利次数=238,赢利总值=78509
                亏损次数=448,亏损总值=33140
                平盘次数=3

        #5>20>60>120>250，间隔都是500
        评估:总盈亏值=8416,交易次数=66  期望值=1953
                总盈亏率(1/1000)=8416,平均盈亏率(1/1000)=127,盈利交易率(1/1000)=378
                赢利次数=25,赢利总值=11024
                亏损次数=40,亏损总值=2608
                平盘次数=1
                闭合交易明细:
        #5>20>60>120>250,其中20-60-120间隔为1000
        评估:总盈亏值=6721,交易次数=102 期望值=942
                总盈亏率(1/1000)=6721,平均盈亏率(1/1000)=65,盈利交易率(1/1000)=323
                赢利次数=33,赢利总值=11541
                亏损次数=69,亏损总值=4820
                平盘次数=0

        #20>60>120>250,其中20-60-120间隔为1000
        评估:总盈亏值=15930,交易次数=342        期望值=657
                总盈亏率(1/1000)=15930,平均盈亏率(1/1000)=46,盈利交易率(1/1000)=315
                赢利次数=108,赢利总值=32459
                亏损次数=234,亏损总值=16529
                平盘次数=0

        #20>60>120>250,其中20-60-120间隔为1000,s>=3300,s<=6600
        评估:总盈亏值=11370,交易次数=118        期望值=1371
                总盈亏率(1/1000)=11370,平均盈亏率(1/1000)=96,盈利交易率(1/1000)=398
                赢利次数=47,赢利总值=16381
                亏损次数=71,亏损总值=5011
                平盘次数=0
        
        #cs不能作为单独的筛选条件
        ##只能和g(20>60>120)一起，另作第二筛选条件。等同于g20:3000-8000,但过滤性太强
        c_extractor = lambda c,s:gand(c.g20>=c.g60+1000,c.g60>=c.g120+1000,c.g120>=c.g250,s>=3300,s<=6600)
        ma_above
        评估:总盈亏值=2415,交易次数=13  期望值=3135
                总盈亏率(1/1000)=2415,平均盈亏率(1/1000)=185,盈利交易率(1/1000)=461
                赢利次数=6,赢利总值=2828
                亏损次数=7,亏损总值=413
                平盘次数=0

        cs:5>20>60>120>250,s<=6600,g:20>60>120      ###银手指用法，区分度为4832/2680705 = 1/554，g是否需要添加g5>g20?不需要
        评估:总盈亏值=23229,交易次数=112        期望值=2875     ###
                总盈亏率(1/1000)=23229,平均盈亏率(1/1000)=207,盈利交易率(1/1000)=571
                赢利次数=64,赢利总值=26644
                亏损次数=47,亏损总值=3415
                平盘次数=1
        #0406结果, 不要添加t120，效果会变差
        
        cs:5>20>60>120>250, s:3300-6600, g:20>60+1000,60>120+1000
        评估:总盈亏值=7894,交易次数=24  期望值=4259
                总盈亏率(1/1000)=7894,平均盈亏率(1/1000)=328,盈利交易率(1/1000)=625
                赢利次数=15,赢利总值=8589
                亏损次数=9,亏损总值=695
                平盘次数=0


        cs:5>20>60>120>250, s<=6600, g:20>60+1000,60>120+1000
        评估:总盈亏值=8125,交易次数=28  期望值=3258
                总盈亏率(1/1000)=8125,平均盈亏率(1/1000)=290,盈利交易率(1/1000)=607
                赢利次数=17,赢利总值=9110
                亏损次数=11,亏损总值=985
                平盘次数=0
                闭合交易明细:


12X170
re_ev:
       评估:总盈亏值=15896,交易次数=85 期望值=2710
               总盈亏率(1/1000)=15896,平均盈亏率(1/1000)=187,盈利交易率(1/1000)=458
               赢利次数=39,赢利总值=19036
               亏损次数=45,亏损总值=3140
               平盘次数=1

        #去掉t120
        评估:总盈亏值=17176,交易次数=95 期望值=2608
                总盈亏率(1/1000)=17176,平均盈亏率(1/1000)=180,盈利交易率(1/1000)=494
                赢利次数=47,赢利总值=20419
                亏损次数=47,亏损总值=3243
                平盘次数=1



关于分析
1 
#情形1  g20-60-120温和放大,每次都在1000-1800(1200)以内,或者60-120 快速(>1500),20-60慢速(<1000)，g20低位更佳
#情形2  g20-60-120, 60>120 1000以上,20<60 1500以内
#情形3  g20-60-120, 节奏加快,如20>60+2000,60>120+1000, 这个有风险,而且不小. 加快后仍然是小幅没问题
不能太小,都小于3000就没劲了
而且g60不能比g120小,小了也不行
g20不能超过8000,否则没戏
#情形4 g20-60-120 等幅且大幅,都大于2000
#情形5 始终在4000-7000范围内小幅增长？


#20090406
##测试对象  svama2  20 X 100
#1 反速测试
    g = gand(stock.g20 >= stock.g60,stock.g60 >= stock.g120,stock.g20-stock.g60>=(stock.g60-stock.g120)*3/2)

        评估:总盈亏值=65441,交易次数=903        期望值=947
                总盈亏率(1/1000)=65441,平均盈亏率(1/1000)=72,盈利交易率(1/1000)=374
                赢利次数=338,赢利总值=108764
                亏损次数=563,亏损总值=43323
                平盘次数=2
    
    #反了
    g = gand(stock.g60 >= stock.g20,stock.g60 >= stock.g120,stock.g20>=3000,stock.g20<=8000)
        评估:总盈亏值=37654,交易次数=757        期望值=700
                总盈亏率(1/1000)=37654,平均盈亏率(1/1000)=49,盈利交易率(1/1000)=336
                赢利次数=255,赢利总值=73033
                亏损次数=500,亏损总值=35379
                平盘次数=2
    
    g = gand(stock.g60 >= stock.g20,stock.g60 >= stock.g120,stock.g60-stock.g20>=(stock.g60-stock.g120),stock.g60-stock.g20<=(stock.g60-stock.g120)*2,stock.g20>=3000,stock.g20<=8000)
        评估:总盈亏值=21888,交易次数=302        期望值=1028
                总盈亏率(1/1000)=21888,平均盈亏率(1/1000)=72,盈利交易率(1/1000)=370
                赢利次数=112,赢利总值=35076
                亏损次数=188,亏损总值=13188
                平盘次数=2
                闭合交易明细:
    
#2  调整测试
        g = gand(stock.g20 >= stock.g60,stock.g60 >= stock.g120,stock.g20>=3000,stock.g20<=8000,stock.g20-stock.g60>=stock.g60-stock.g120) 
        评估:总盈亏值=63747,交易次数=440        期望值=2149
                总盈亏率(1/1000)=63747,平均盈亏率(1/1000)=144,盈利交易率(1/1000)=506
                赢利次数=223,赢利总值=78380
                亏损次数=216,亏损总值=14633
                平盘次数=1

        g = gand(stock.g20 >= stock.g60,stock.g60 >= stock.g120,stock.g20>=3000,stock.g20<=8000,stock.g20-stock.g60<=stock.g60-stock.g120)
        评估:总盈亏值=46432,交易次数=355        期望值=1884
                总盈亏率(1/1000)=46432,平均盈亏率(1/1000)=130,盈利交易率(1/1000)=481
                赢利次数=171,赢利总值=59241
                亏损次数=183,亏损总值=12809

        #g = gand(stock.g20 >= stock.g60+1000,stock.g60 >= stock.g120+1000,stock.g20>=3000,stock.g20<=8000,stock.g20-stock.g60>=stock.g60-stock.g120)
        评估:总盈亏值=22365,交易次数=84 期望值=3800
                总盈亏率(1/1000)=22365,平均盈亏率(1/1000)=266,盈利交易率(1/1000)=583
                赢利次数=49,赢利总值=24822
                亏损次数=35,亏损总值=2457
                平盘次数=0
        
        #g = gand(stock.g20 >= stock.g60+1000,stock.g60 >= stock.g120+1000,stock.g20>=3000,stock.g20<=8000,stock.g20-stock.g60<=stock.g60-stock.g120)
        评估:总盈亏值=17594,交易次数=75 期望值=3342
                总盈亏率(1/1000)=17594,平均盈亏率(1/1000)=234,盈利交易率(1/1000)=600
                赢利次数=45,赢利总值=19714
                亏损次数=30,亏损总值=2120
                平盘次数=0

        
        g = gand(stock.g20 >= stock.g60+1200,stock.g60 >= stock.g120+1200,stock.g20>=3000,stock.g20<=8000,stock.g20-stock.g60>=stock.g60-stock.g120)
        评估:总盈亏值=11980,交易次数=42 期望值=4253
                总盈亏率(1/1000)=11980,平均盈亏率(1/1000)=285,盈利交易率(1/1000)=547
                赢利次数=23,赢利总值=13253
                亏损次数=19,亏损总值=1273
                平盘次数=0
                闭合交易明细:

        g = gand(stock.g20 >= stock.g60+1200,stock.g60 >= stock.g120+600,stock.g60<=stock.g120+1200,stock.g20>=3000,stock.g20<=8000)     
        评估:总盈亏值=21795,交易次数=111        期望值=2760
                总盈亏率(1/1000)=21795,平均盈亏率(1/1000)=196,盈利交易率(1/1000)=540
                赢利次数=60,赢利总值=25464
                亏损次数=51,亏损总值=3669
                平盘次数=0
                闭合交易明细:
        


#3 小步测试
    g = gand(stock.g20 >= stock.g60,stock.g60 >= stock.g120,stock.g20-stock.g60<=(stock.g60-stock.g120)*2/3)
pre_ev:
        评估:总盈亏值=48109,交易次数=1209       期望值=527
                总盈亏率(1/1000)=48109,平均盈亏率(1/1000)=39,盈利交易率(1/1000)=291
                赢利次数=352,赢利总值=111729
                亏损次数=855,亏损总值=63620
                平盘次数=2

    g = gand(stock.g20 >= stock.g60,stock.g60 >= stock.g120,stock.g20-stock.g60<=(stock.g60-stock.g120)*2/3,stock.g20-stock.g120>=2000)
        评估:总盈亏值=26720,交易次数=563        期望值=618
                总盈亏率(1/1000)=26720,平均盈亏率(1/1000)=47,盈利交易率(1/1000)=335
                赢利次数=189,赢利总值=55466
                亏损次数=374,亏损总值=28746
                平盘次数=0

    g = gand(stock.g20 >= stock.g60,stock.g60 >= stock.g120,stock.g20-stock.g60<=500,stock.g20-stock.g60<=(stock.g60-stock.g120)*2/3)
        评估:总盈亏值=28872,交易次数=834        期望值=459
                总盈亏率(1/1000)=28872,平均盈亏率(1/1000)=34,盈利交易率(1/1000)=272
                赢利次数=227,赢利总值=73779
                亏损次数=606,亏损总值=44907
                平盘次数=1
                闭合交易明细:

#4 平衡测试
    g = gand(stock.g20 >= stock.g60,stock.g60 >= stock.g120,stock.g20>=3000,stock.g20<=8000,stock.g60>=3000,stock.g120>=3000)
pre_ev:
        评估:总盈亏值=67223,交易次数=576        期望值=1633
                总盈亏率(1/1000)=67223,平均盈亏率(1/1000)=116,盈利交易率(1/1000)=456
                赢利次数=263,赢利总值=89511
                亏损次数=311,亏损总值=22288
                平盘次数=2


#20090406
#对已有的csvamax系列,因为其筛选条件类似银手指,所以不再适用金手指(会导致结果为空),只能起到事后筛选作用


#股票120涨跌家数的线，及其5和20日均线，可以作为非常重要的撤离标志
它在2007.09中旬就发出了显著的下跌信号
同时，5上叉20，并一直在20日上，可作为强势信号
为敏感计，1日上叉20也可

sdatas = srun.extract_collect(sdata.values(),CLOSE)
x120a=(increase(sdatas,120)>0).sum(0)
x120=x120a*1000/length  #规范化为百分比
ma120_5= ma(x120,5)
ma120_20= ma(x120,20)

###
惊呆，大盘的60均线向上居然和金手指暗合？至少对tsvama 20X100，对其中选出的154个交易没有筛选作用
    gfilter = strend(ma(ref.transaction[CLOSE],60))>0
120，250都很符合

#另，尝试选择大盘大跌日实体为攻击态小阴小阳的，小阳为佳，长上影也不错
#比如090408的抚顺特钢，上海梅林，新潮实业，长城电脑、广东甘化、西藏旅游
并且n线理顺之后，大部分时间小阴小阳，并且总体幅度不大

#或者，在裸信号发出后，要求10日内g信号也发出，否则作废。这个相当于宽松了

#对排名都大于8500的，也测试一下 （中国软件20090311）


#2009-04-15
#需要处理指数的成交量问题
因为其成交量很大,会导致在计算中溢出,所以在读入时必须处理
首先修改fxj.py,碰到指数时/1000
然后
select * from dune_sdayquote where sstock like 'SZ399%' or 'SH000%'

select * from dune_xdayquote dx
join dune_stockcode dsc on dx.tstock_id = dsc.id
where code like 'SZ399%' or code like 'SH000%'


select * from dune_xdayquote dx
join dune_stockcode dsc on dx.tstock_id = dsc.id
where code='SH000004'

#select * from dune_sdayquote where tvolume>20000000

update dune_sdayquote set tvolume = tvolume / 1000 where sstock like 'SZ399%' or sstock like 'SH000%'

update dune_xdayquote set tvolume = tvolume / 1000 where tstock_id in (select id from dune_stockcode where code like 'SZ399%' or code like 'SH000%')

select * from dune_sdayquote where sstock='SH000004' and tdate>20090401


#2009-04-16
#1 对筛选条件的再考虑
金手指+ma_above
g20>g60+1000 and g60>g120+1000 and g20>=3000 and g20 <=8000，ma_above
信号: 29915
总数: 2682256
区分度: 1/89

银手指+ma_above
lambda c,s:gand(c.g5 >= c.g20,c.g20>=c.g60,c.g60>=c.g120,c.g120>=c.g250,s<=6600), ma_above
信号:76533
总数: 2682256
区分度:1/35

金手指+银手指+ma_above
信号: 1405
总数: 2682256
区分度: 1/1909  #因此不能同时用于上
评估:总盈亏值=31667,交易次数=290        期望值=1535
                总盈亏率(1/1000)=31667,平均盈亏率(1/1000)=109,盈利交易率(1/1000)=365
                赢利次数=106,赢利总值=44814
                亏损次数=183,亏损总值=13147
                平盘次数=1

金手指+银手指
信号: 7732
总数: 2682256
区分度: 1/346
期望为负，不能用于直接交易


金手指+银手指+t120
信号: 1590
总数: 2682256
区分度: 1/1686
评估:总盈亏值=39290,交易次数=477        期望值=1154
                总盈亏率(1/1000)=39290,平均盈亏率(1/1000)=82,盈利交易率(1/1000)=314
                赢利次数=150,赢利总值=62705
                亏损次数=326,亏损总值=23415
                平盘次数=1

金手指+银手指+ref.t120
信号: 3800
总数: 2682256
区分度: 1/705
        评估:总盈亏值=35317,交易次数=1322       期望值=426
                总盈亏率(1/1000)=35317,平均盈亏率(1/1000)=26,盈利交易率(1/1000)=298
                赢利次数=395,赢利总值=92452
                亏损次数=922,亏损总值=57135
                平盘次数=5
                闭合交易明细:


金手指+银手指+ma_above+ma5>ma10
信号: 516
总数: 2682256
区分度: 1/5198
评估:总盈亏值=29163,交易次数=206        期望值=1880
                总盈亏率(1/1000)=29163,平均盈亏率(1/1000)=141,盈利交易率(1/1000)=422
                赢利次数=87,赢利总值=38080
                亏损次数=118,亏损总值=8917
                平盘次数=1
                闭合交易明细:


拇指+银手指+ma_above+ma5>ma10
信号: 6508
总数: 2682256
区分度: 1/412
评估:总盈亏值=24639,交易次数=413        期望值=880
                总盈亏率(1/1000)=24639,平均盈亏率(1/1000)=59,盈利交易率(1/1000)=334
                赢利次数=138,赢利总值=42948
                亏损次数=273,亏损总值=18309
                平盘次数=2


拇指+银手指+ma_above        #以此为筛网为好,t120可自愿加入
信号: 16779
总数: 2682256
区分度: 1/159
pre_ev:
        评估:总盈亏值=21037,交易次数=508        期望值=611
                总盈亏率(1/1000)=21037,平均盈亏率(1/1000)=41,盈利交易率(1/1000)=301
                赢利次数=153,赢利总值=44705
                亏损次数=353,亏损总值=23668
                平盘次数=2


拇指+银手指+ma_above+t120
信号: 2695
总数: 2682256
区分度: 1/995
        评估:总盈亏值=21028,交易次数=466        期望值=681
                总盈亏率(1/1000)=21028,平均盈亏率(1/1000)=45,盈利交易率(1/1000)=311
                赢利次数=145,赢利总值=42395
                亏损次数=319,亏损总值=21367
                平盘次数=2
                闭合交易明细:


gauze:

pre_ev:
        评估:总盈亏值=15035,交易次数=783        期望值=271
                总盈亏率(1/1000)=15035,平均盈亏率(1/1000)=19,盈利交易率(1/1000)=268
                赢利次数=210,赢利总值=55529
                亏损次数=573,亏损总值=40494
                平盘次数=0

#2 新的测试
#2.1 大盘大跌日实体为攻击态小阴小阳的，小阳为佳，长上影也不错
    signals = gand(stock.ks >= -5,stock.ks<=5,stock.ref.ks<-30)

#a      sbuy = gand(signals,stock.thumb,stock.t120)
        评估:总盈亏值=11226,交易次数=82 期望值=1789
                总盈亏率(1/1000)=11226,平均盈亏率(1/1000)=136,盈利交易率(1/1000)=512
                赢利次数=42,赢利总值=14291
                亏损次数=40,亏损总值=3065
                平盘次数=0

        #若去掉ks<=5上限,则
        评估:总盈亏值=28988,交易次数=185        期望值=2136
                总盈亏率(1/1000)=28988,平均盈亏率(1/1000)=156,盈利交易率(1/1000)=481
                赢利次数=89,赢利总值=36047
                亏损次数=96,亏损总值=7059
                平盘次数=0
        
        #[-5,101)
        评估:总盈亏值=37026,交易次数=218        期望值=2380
                总盈亏率(1/1000)=37026,平均盈亏率(1/1000)=169,盈利交易率(1/1000)=504
                赢利次数=110,赢利总值=44760
                亏损次数=108,亏损总值=7734
                平盘次数=0

        #ks改为[-5,20]
        评估:总盈亏值=25628,交易次数=124        期望值=2861
                总盈亏率(1/1000)=25628,平均盈亏率(1/1000)=206,盈利交易率(1/1000)=540
                赢利次数=67,赢利总值=29767
                亏损次数=57,亏损总值=4139
                平盘次数=0

        #ks:[0,20)
        评估:总盈亏值=19315,交易次数=108        期望值=2405
                总盈亏率(1/1000)=19315,平均盈亏率(1/1000)=178,盈利交易率(1/1000)=527
                赢利次数=57,赢利总值=23101
                亏损次数=51,亏损总值=3786
                平盘次数=0

        #ks:(5,20)          #ref.ks<=-30
        评估:总盈亏值=18651,交易次数=53 期望值=5571
                总盈亏率(1/1000)=18651,平均盈亏率(1/1000)=351,盈利交易率(1/1000)=603
                赢利次数=32,赢利总值=19981
                亏损次数=21,亏损总值=1330
                平盘次数=0

                #ref.ks < -30
                评估:总盈亏值=16664,交易次数=44 期望值=6000
                    总盈亏率(1/1000)=16664,平均盈亏率(1/1000)=378,盈利交易率(1/1000)=613
                    赢利次数=27,赢利总值=17738
                    亏损次数=17,亏损总值=1074
                    平盘次数=0
        #ks:[5,20)      
        评估:总盈亏值=18670,交易次数=56 期望值=5123
                总盈亏率(1/1000)=18670,平均盈亏率(1/1000)=333,盈利交易率(1/1000)=589
                赢利次数=33,赢利总值=20185
                亏损次数=23,亏损总值=1515
                平盘次数=0


        #ks:[5,20]          ####最佳
        评估:总盈亏值=20610,交易次数=66 期望值=4394
                总盈亏率(1/1000)=20610,平均盈亏率(1/1000)=312,盈利交易率(1/1000)=590
                赢利次数=39,赢利总值=22542
                亏损次数=27,亏损总值=1932
                平盘次数=0

        #ks:[5,30)
        评估:总盈亏值=18983,交易次数=71 期望值=3814
                总盈亏率(1/1000)=18983,平均盈亏率(1/1000)=267,盈利交易率(1/1000)=521
                赢利次数=37,赢利总值=21377
                亏损次数=34,亏损总值=2394
                平盘次数=0

        #ks:[5,25)
        评估:总盈亏值=18699,交易次数=61 期望值=4250
                总盈亏率(1/1000)=18699,平均盈亏率(1/1000)=306,盈利交易率(1/1000)=540
                赢利次数=33,赢利总值=20729
                亏损次数=28,亏损总值=2030
                平盘次数=0

        #ks:[-5:0):
        评估:总盈亏值=6313,交易次数=16  期望值=6793
                总盈亏率(1/1000)=6313,平均盈亏率(1/1000)=394,盈利交易率(1/1000)=625
                赢利次数=10,赢利总值=6666
                亏损次数=6,亏损总值=353
                平盘次数=0
                闭合交易明细:

        #ks:[-10:0)
        评估:总盈亏值=14156,交易次数=87 期望值=2025
                总盈亏率(1/1000)=14156,平均盈亏率(1/1000)=162,盈利交易率(1/1000)=540
                赢利次数=47,赢利总值=17357
                亏损次数=40,亏损总值=3201
                平盘次数=0
                闭合交易明细:

        #ks:[-7:0]
        评估:总盈亏值=9877,交易次数=69  期望值=1743
                总盈亏率(1/1000)=9877,平均盈亏率(1/1000)=143,盈利交易率(1/1000)=507
                赢利次数=35,赢利总值=12686
                亏损次数=34,亏损总值=2809
                平盘次数=0
        
        #ks:[-6:0]
        评估:总盈亏值=9396,交易次数=64  期望值=1848
                总盈亏率(1/1000)=9396,平均盈亏率(1/1000)=146,盈利交易率(1/1000)=500
                赢利次数=32,赢利总值=11934
                亏损次数=32,亏损总值=2538
                平盘次数=0

        #ks:[-5,0]+[5,20] ref.ks<=-30
        评估:总盈亏值=27336,交易次数=123        期望值=3000
                总盈亏率(1/1000)=27336,平均盈亏率(1/1000)=222,盈利交易率(1/100=544
                赢利次数=67,赢利总值=31496
                亏损次数=56,亏损总值=4160
                平盘次数=0
                闭合交易明细:

        #ks:[-5,0)+[5,20)   ref.ks<=-30     ########选择A
        评估:总盈亏值=26818,交易次数=74 期望值=5838
                总盈亏率(1/1000)=26818,平均盈亏率(1/1000)=362,盈利交易率(1/1000)=621
                赢利次数=46,赢利总值=28575
                亏损次数=28,亏损总值=1757
                平盘次数=0

        #ks:[-5,0)+[5,20)   ref.ks<-30
        评估:总盈亏值=22792,交易次数=62 期望值=5734
                总盈亏率(1/1000)=22792,平均盈亏率(1/1000)=367,盈利交易率(1/1000)=596
                赢利次数=37,赢利总值=24404
                亏损次数=25,亏损总值=1612
                平盘次数=0



        #[20,101)
        评估:总盈亏值=14412,交易次数=88 期望值=2263
                总盈亏率(1/1000)=14412,平均盈亏率(1/1000)=163,盈利交易率(1/1000)=488
                赢利次数=43,赢利总值=17660
                亏损次数=45,亏损总值=3248
                平盘次数=0

        #[5,101)
        评估:总盈亏值=32942,交易次数=145        期望值=3242
                总盈亏率(1/1000)=32942,平均盈亏率(1/1000)=227,盈利交易率(1/1000)=517
                赢利次数=75,赢利总值=37904
                亏损次数=70,亏损总值=4962
                平盘次数=0


#a1     去掉thumb
        signals = gand(stock.ks >=5,stock.ks<=20,stock.ref.ks<=-30)
        sbuy = gand(signals,stock.t120)

        评估:总盈亏值=113108,交易次数=1476      期望值=894
                总盈亏率(1/1000)=113108,平均盈亏率(1/1000)=76,盈利交易率(1/1000)=344
                赢利次数=509,赢利总值=195478
                亏损次数=966,亏损总值=82370
                平盘次数=1
        


#a2 添加g
    signals = gand(stock.ks >=5,stock.ks<=20,stock.ref.ks<=-30)
    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g120 >= s.g250)
    sbuy = gand(signals,stock.t120,g)

        评估:总盈亏值=30914,交易次数=256        期望值=1481
                总盈亏率(1/1000)=30914,平均盈亏率(1/1000)=120,盈利交易率(1/1000)=386
                赢利次数=99,赢利总值=43783
                亏损次数=157,亏损总值=12869
                平盘次数=0
                闭合交易明细:


    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g120 >= s.g250,s.g20<=8500)
        评估:总盈亏值=21872,交易次数=92 期望值=3338
                总盈亏率(1/1000)=21872,平均盈亏率(1/1000)=237,盈利交易率(1/1000)=521
                赢利次数=48,赢利总值=25035
                亏损次数=44,亏损总值=3163
                平盘次数=0
    

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g120 >= s.g250,s.g20<=8500,s.g20>3000)
        评估:总盈亏值=21955,交易次数=90 期望值=3328
                总盈亏率(1/1000)=21955,平均盈亏率(1/1000)=243,盈利交易率(1/1000)=533
                赢利次数=48,赢利总值=25035
                亏损次数=42,亏损总值=3080
                平盘次数=0

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g120 >= s.g250,s.g20<=8000,s.g20>=3000)   #等效于thumb,果然thumb最佳
        评估:总盈亏值=20610,交易次数=66 期望值=4394
                总盈亏率(1/1000)=20610,平均盈亏率(1/1000)=312,盈利交易率(1/1000)=590
                赢利次数=39,赢利总值=22542
                亏损次数=27,亏损总值=1932
                平盘次数=0



#b      
    signals = gand(stock.ks >=5,stock.ks<=20,stock.ref.ks<=-30)
    sbuy = gand(signals,stock.thumb,stock.above)
        ks:[-5,5]
        评估:总盈亏值=9662,交易次数=60  期望值=1987
                总盈亏率(1/1000)=9662,平均盈亏率(1/1000)=161,盈利交易率(1/1000)=516
                赢利次数=31,赢利总值=12029
                亏损次数=29,亏损总值=2367
                平盘次数=0
                闭合交易明细:

        #[-5,100)
        评估:总盈亏值=20375,交易次数=124        期望值=2309
                总盈亏率(1/1000)=20375,平均盈亏率(1/1000)=164,盈利交易率(1/1000=516
                赢利次数=64,赢利总值=24645
                亏损次数=60,亏损总值=4270
                平盘次数=0
        
        #[5,20]
        评估:总盈亏值=12328,交易次数=43 期望值=4468
                总盈亏率(1/1000)=12328,平均盈亏率(1/1000)=286,盈利交易率(1/1000)=534
                赢利次数=23,赢利总值=13611
                亏损次数=20,亏损总值=1283
                平盘次数=0

        #[-5,0]
        评估:总盈亏值=8628,交易次数=48  期望值=2130
                总盈亏率(1/1000)=8628,平均盈亏率(1/1000)=179,盈利交易率(1/1000)=500
                赢利次数=24,赢利总值=10649
                亏损次数=24,亏损总值=2021
        
        #[20,101)
        评估:总盈亏值=13800,交易次数=59 期望值=3426
                总盈亏率(1/1000)=13800,平均盈亏率(1/1000)=233,盈利交易率(1/1000)=610
                赢利次数=36,赢利总值=15365
                亏损次数=23,亏损总值=1565
                平盘次数=0

        #[5,101)
        评估:总盈亏值=24578,交易次数=95 期望值=4095
                总盈亏率(1/1000)=24578,平均盈亏率(1/1000)=258,盈利交易率(1/1000)=578
                赢利次数=55,赢利总值=27125
                亏损次数=40,亏损总值=2547
                平盘次数=0

        #[5,60]
        评估:总盈亏值=23714,交易次数=87 期望值=4533
                总盈亏率(1/1000)=23714,平均盈亏率(1/1000)=272,盈利交易率(1/1000)=574
                赢利次数=50,赢利总值=25961
                亏损次数=37,亏损总值=2247
                平盘次数=0

        #[5,75], ref:[,-30]     #同[5,75)
        评估:总盈亏值=23919,交易次数=92 期望值=4111
                总盈亏率(1/1000)=23919,平均盈亏率(1/1000)=259,盈利交易率(1/1000)=565
                赢利次数=52,赢利总值=26461
                亏损次数=40,亏损总值=2542
                平盘次数=0

        #(5,75]
        评估:总盈亏值=24187,交易次数=89 期望值=4442     ###
                总盈亏率(1/1000)=24187,平均盈亏率(1/1000)=271,盈利交易率(1/1000)=584
                赢利次数=52,赢利总值=26461
                亏损次数=37,亏损总值=2274
                平盘次数=0

        #[5,75),ref.ks<=-30


        [-5,75]
        评估:总盈亏值=27067,交易次数=140        期望值=2838
                总盈亏率(1/1000)=27067,平均盈亏率(1/1000)=193,盈利交易率(1/1000)=542
                赢利次数=76,赢利总值=31440
                亏损次数=64,亏损总值=4373
                平盘次数=0

        [-1,75]
        评估:总盈亏值=23768,交易次数=130        期望值=2600
                总盈亏率(1/1000)=23768,平均盈亏率(1/1000)=182,盈利交易率(1/1000)=538
                赢利次数=70,赢利总值=27994
                亏损次数=60,亏损总值=4226
                平盘次数=0
        
        ##[0,75]          #####选择此处
        评估:总盈亏值=27223,交易次数=106        期望值=4063
                总盈亏率(1/1000)=27223,平均盈亏率(1/1000)=256,盈利交易率(1/1000)=584
                赢利次数=62,赢利总值=30004
                亏损次数=44,亏损总值=2781
                平盘次数=0
        
        
        #去掉thumb
        signals = gand(stock.ks >0,stock.ks<=75,stock.ref.ks<=-30)
        sbuy = gand(signals,stock.above)

        评估:总盈亏值=120425,交易次数=1964      期望值=701
                总盈亏率(1/1000)=120425,平均盈亏率(1/1000)=61,盈利交易率(1/1000)=384
                赢利次数=755,赢利总值=225451
                亏损次数=1204,亏损总值=105026
                平盘次数=5


#b.1    above + t120
    signals = gand(stock.ks >-5,stock.ks<=75,stock.ref.ks<=-30)
    sbuy = gand(signals,stock.above,stock.thumb,stock.t120)


        #(0,75] 添加t120
        评估:总盈亏值=27306,交易次数=105        期望值=4193
                总盈亏率(1/1000)=27306,平均盈亏率(1/1000)=260,盈利交易率(1/1000)=590
                赢利次数=62,赢利总值=30004
                亏损次数=43,亏损总值=2698
                平盘次数=0

        #(-5,75]
        评估:总盈亏值=27280,交易次数=138        期望值=2940
                总盈亏率(1/1000)=27280,平均盈亏率(1/1000)=197,盈利交易率(1/1000)=550
                赢利次数=76,赢利总值=31440
                亏损次数=62,亏损总值=4160
                平盘次数=0


#c      sbuy = gand(signals,stock.golden,stock.above)

#d      单独使用silver
        signals = gand(stock.ks >=5,stock.ks<=20,stock.ref.ks<=-30)
        sbuy = gand(signals,stock.silver,stock.t120)
        评估:总盈亏值=8297,交易次数=65  期望值=2540
                总盈亏率(1/1000)=8297,平均盈亏率(1/1000)=127,盈利交易率(1/1000)=353
                赢利次数=23,赢利总值=10422
                亏损次数=42,亏损总值=2125
                平盘次数=0
                闭合交易明细:

#d1 thumb+silver+t120   #反作用
        评估:总盈亏值=998,交易次数=8    期望值=1512
                总盈亏率(1/1000)=998,平均盈亏率(1/1000)=124,盈利交易率(1/1000)=500
                赢利次数=4,赢利总值=1326
                亏损次数=4,亏损总值=328
                平盘次数=0
                闭合交易明细:


#e  合并结果
    threshold = -30
    s11 = gand(stock.ks >=-5,stock.ks<0,stock.ref.ks<=threshold)
    s12 = gand(stock.ks >=5,stock.ks<20,stock.ref.ks<=threshold)
    s1 = bor(s11,s12)
    s_tt = gand(s1,stock.thumb,stock.t120)
    s21 = gand(stock.ks>=5,stock.ks<75,stock.ref.ks<=threshold)
    s_aa = gand(s21,stock.thumb,stock.above)
    sbuy = bor(s_aa,s_tt)

        评估:总盈亏值=40450,交易次数=132        期望值=4935
                总盈亏率(1/1000)=40450,平均盈亏率(1/1000)=306,盈利交易率(1/1000)=606
                赢利次数=80,赢利总值=43722
                亏损次数=52,亏损总值=3272
                平盘次数=0

            #thumb改为golden
            评估:总盈亏值=23213,交易次数=76 期望值=4919
                总盈亏率(1/1000)=23213,平均盈亏率(1/1000)=305,盈利交易率(1/1000)=592
                赢利次数=45,赢利总值=25162
                亏损次数=31,亏损总值=1949
                平盘次数=0
            
            #都改成above
            评估:总盈亏值=32075,交易次数=107        期望值=4901
                总盈亏率(1/1000)=32075,平均盈亏率(1/1000)=299,盈利交易率(1/1000)=588
                赢利次数=63,赢利总值=34764
                亏损次数=44,亏损总值=2689
                平盘次数=0
            #都改成t120
            评估:总盈亏值=41157,交易次数=154        期望值=3985
                总盈亏率(1/1000)=41157,平均盈亏率(1/1000)=267,盈利交易率(1/1000)=551
                赢利次数=85,赢利总值=45793
                亏损次数=69,亏损总值=4636
                平盘次数=0
        #添加条件ref.t120
            评估:总盈亏值=40533,交易次数=131        期望值=4983
                总盈亏率(1/1000)=40533,平均盈亏率(1/1000)=309,盈利交易率(1/1000)=610
                赢利次数=80,赢利总值=43722
                亏损次数=51,亏损总值=3189
                平盘次数=0
            将ref.t120改为strend(ref.ma60)>0        #貌似一样
                评估:总盈亏值=40533,交易次数=131        期望值=4983
                    总盈亏率(1/1000)=40533,平均盈亏率(1/1000)=309,盈利交易率(1/1000)=610
                    赢利次数=80,赢利总值=43722
                    亏损次数=51,亏损总值=3189
                    平盘次数=0
        
        #添加条件ref.above              ##########
        评估:总盈亏值=40697,交易次数=129        期望值=5163
                总盈亏率(1/1000)=40697,平均盈亏率(1/1000)=315,盈利交易率(1/1000)=620
                赢利次数=80,赢利总值=43722
                亏损次数=49,亏损总值=3025
                平盘次数=0
                闭合交易明细:


        #改为    sbuy = gand(signals,greater(ref.ma10,ref.ma20),greater(ref.ma20,ref.ma60))，效果同上
            评估:总盈亏值=40697,交易次数=129        期望值=5163
                总盈亏率(1/1000)=40697,平均盈亏率(1/1000)=315,盈利交易率(1/1000)=620
                赢利次数=80,赢利总值=43722
                亏损次数=49,亏损总值=3025
                平盘次数=0

        #添加范围删除       below = (t[CLOSE] - t[LOW]) * BASE / t[CLOSE]
            sbuy = gand(signals,greater(ref.ma10,ref.ma20),greater(ref.ma20,ref.ma60),below<10)
            评估:总盈亏值=5753,交易次数=13  期望值=13000
                总盈亏率(1/1000)=5753,平均盈亏率(1/1000)=442,盈利交易率(1/1000)=692
                赢利次数=9,赢利总值=5891
                亏损次数=4,亏损总值=138
                平盘次数=0

            #sbuy = gand(signals,greater(ref.ma10,ref.ma20),greater(ref.ma20,ref.ma60),below<20)
            评估:总盈亏值=11835,交易次数=26 期望值=17500
                总盈亏率(1/1000)=11835,平均盈亏率(1/1000)=455,盈利交易率(1/1000)=769
                赢利次数=20,赢利总值=11993
                亏损次数=6,亏损总值=158
                平盘次数=0
                闭合交易明细:
            
            #sbuy = gand(signals,greater(ref.ma10,ref.ma20),greater(ref.ma20,ref.ma60),below<50)
            评估:总盈亏值=33137,交易次数=99 期望值=5964
                总盈亏率(1/1000)=33137,平均盈亏率(1/1000)=334,盈利交易率(1/1000)=626
                赢利次数=62,赢利总值=35238
                亏损次数=37,亏损总值=2101
                平盘次数=0
                闭合交易明细:

        #添加下影线删除     oc = np.select([t[CLOSE]<t[OPEN]],[t[CLOSE]],default=t[OPEN])
                            below = (oc - t[LOW]) * BASE / rollx(t[CLOSE])
        
            sbuy = gand(signals,greater(ref.ma10,ref.ma20),greater(ref.ma20,ref.ma60),below<10)
            评估:总盈亏值=15007,交易次数=35 期望值=7379
                总盈亏率(1/1000)=15007,平均盈亏率(1/1000)=428,盈利交易率(1/1000)=657
                赢利次数=23,赢利总值=15704
                亏损次数=12,亏损总值=697
                平盘次数=0

            sbuy = gand(signals,greater(ref.ma10,ref.ma20),greater(ref.ma20,ref.ma60),below<20)
            评估:总盈亏值=27839,交易次数=73 期望值=6927
                总盈亏率(1/1000)=27839,平均盈亏率(1/1000)=381,盈利交易率(1/1000)=739
                赢利次数=54,赢利总值=28885
                亏损次数=19,亏损总值=1046
                平盘次数=0

            sbuy = gand(signals,greater(ref.ma10,ref.ma20),greater(ref.ma20,ref.ma60),below<30)
            评估:总盈亏值=32960,交易次数=93 期望值=5900
                总盈亏率(1/1000)=32960,平均盈亏率(1/1000)=354,盈利交易率(1/1000)=666
                赢利次数=62,赢利总值=34836
                亏损次数=31,亏损总值=1876
                平盘次数=0

            sbuy = gand(signals,greater(ref.ma10,ref.ma20),greater(ref.ma20,ref.ma60),below<40)
            评估:总盈亏值=38145,交易次数=116        期望值=5655
                总盈亏率(1/1000)=38145,平均盈亏率(1/1000)=328,盈利交易率(1/1000)=629
                赢利次数=73,赢利总值=40644
                亏损次数=43,亏损总值=2499
                平盘次数=0
                闭合交易明细:


    threshold=-25   #增加部分无意义
        评估:总盈亏值=47521,交易次数=203        期望值=3391
                总盈亏率(1/1000)=47521,平均盈亏率(1/1000)=234,盈利交易率(1/1000)=571
                赢利次数=116,赢利总值=53608
                亏损次数=87,亏损总值=6087
                平盘次数=0
                闭合交易明细:
    
    threshold = -35     #说明大盘跌幅越大,这类选出的股票其弹性越好
        评估:总盈亏值=25820,交易次数=75 期望值=5212
                总盈亏率(1/1000)=25820,平均盈亏率(1/1000)=344,盈利交易率(1/1000)=626
                赢利次数=47,赢利总值=27682
                亏损次数=28,亏损总值=1862
                平盘次数=0
                闭合交易明细:


    threshold = -40     
        评估:总盈亏值=24145,交易次数=56 期望值=7305
                总盈亏率(1/1000)=24145,平均盈亏率(1/1000)=431,盈利交易率(1/1000)=642
                赢利次数=36,赢利总值=25336
                亏损次数=20,亏损总值=1191
                平盘次数=0


    threshold = -50                 #再往上,意义就不大. 很大程度上昭示着大盘崩溃
        评估:总盈亏值=4950,交易次数=14  期望值=4525
                总盈亏率(1/1000)=4950,平均盈亏率(1/1000)=353,盈利交易率(1/1000)=642
                赢利次数=9,赢利总值=5343
                亏损次数=5,亏损总值=393
    

#比如090408的抚顺特钢，上海梅林，新潮实业，长城电脑、广东甘化、西藏旅游
并且n线理顺之后，大部分时间小阴小阳，并且总体幅度不大

#或者，在裸信号发出后，要求10日内g信号也发出，否则作废。这个相当于宽松了
#对排名都大于8500的，也测试一下 （中国软件20090311）



### 探查它20090218之后的downlimit,看为什么没有卖出
SH600565	B	20090218	price=4710	volume=1000

没问题，其当日(o+c)/2=5.12, atr=0.305, 5.12-.305*1.2 = 4.75左右

#2009-04-24
#大跌后不靠spring和gcs选出的股票，尤其是vama系列(s,cs,v)选出的，很有前途
如 0423选出的600146

#2009-04-25
大盘
一根放量阳线，是上涨信号。所谓放量，貌似应当在前日110%以上？还是仅仅大于即可？
连续上量阳线，是强势信号
单根放量阴线或两根缩量阴线，都是下跌信号，如果是连续两根阴线，后者放量，则是强势下跌信号
另，设置强势数：
    阳为1，增量阳为2
    阴为-1，增量阴为-2
    然后统计最近7/13天内的总数，看有无筛选作用



#20090428

golden/thumb
    si = score2(t[CLOSE],t[VOLUME])
    mxi = gand(msum(si,5)>=-2,msum(si,5)<=1)
    sbuy = gand(stock.golden,stock.silver,stock.above,ma5>stock.ma10,stock.ref.t120,mxi)

[-2,1]
        评估:总盈亏值=20915,交易次数=97 期望值=3028
                总盈亏率(1/1000)=20915,平均盈亏率(1/1000)=215,盈利交易率(1/1000)=474
                赢利次数=46,赢利总值=24573
                亏损次数=51,亏损总值=3658
                平盘次数=0
[-2,0]
        评估:总盈亏值=14094,交易次数=71 期望值=2911
                总盈亏率(1/1000)=14094,平均盈亏率(1/1000)=198,盈利交易率(1/1000)=492
                赢利次数=35,赢利总值=16562
                亏损次数=36,亏损总值=2468
                平盘次数=0

[-3,0]
        评估:总盈亏值=17333,交易次数=83 期望值=3200
                总盈亏率(1/1000)=17333,平均盈亏率(1/1000)=208,盈利交易率(1/1000)=542
                赢利次数=45,赢利总值=19747
                亏损次数=37,亏损总值=2414
                平盘次数=1

[:0]    ####    xgcs
        评估:总盈亏值=19350,交易次数=87 期望值=3313
                总盈亏率(1/1000)=19350,平均盈亏率(1/1000)=222,盈利交易率(1/1000)=540
                赢利次数=47,赢利总值=21991
                亏损次数=39,亏损总值=2641
                平盘次数=1

    thumb:
        评估:总盈亏值=20131,交易次数=173        期望值=2000
                总盈亏率(1/1000)=20131,平均盈亏率(1/1000)=116,盈利交易率(1/1000)=456
                赢利次数=79,赢利总值=25626
                亏损次数=94,亏损总值=5495
                平盘次数=0
    

[:1]
        评估:总盈亏值=22924,交易次数=111        期望值=2942
                总盈亏率(1/1000)=22924,平均盈亏率(1/1000)=206,盈利交易率(1/1000)=486
                赢利次数=54,赢利总值=26868
                亏损次数=56,亏损总值=3944
                平盘次数=1
                闭合交易明细:
                        stock=SH600036 盈亏值=10992320:,盈亏率(1/1000):476

[1:]
        评估:总盈亏值=21331,交易次数=160        期望值=1773
                总盈亏率(1/1000)=21331,平均盈亏率(1/1000)=133,盈利交易率(1/1000)=418
                赢利次数=67,赢利总值=28310
                亏损次数=93,亏损总值=6979
                平盘次数=0
                闭合交易明细:

[3:]
        评估:总盈亏值=12813,交易次数=128        期望值=1282
                总盈亏率(1/1000)=12813,平均盈亏率(1/1000)=100,盈利交易率(1/1000)=421
                赢利次数=54,赢利总值=18606
                亏损次数=74,亏损总值=5793
                平盘次数=0
                闭合交易明细:


#2009-04-30
#对于check2的结果
目测感觉
g20-60-120的数据，首先间隔>1000(至少500)为好
其次，g20>5000为好
再次，三者均衡为好，g120不能太小。g20-60-120的差距也不能太大，临近减法大于被减数
    另，如果有差值大于2000，貌似也有问题？
第四，弱市里面g120不能太高？>4000可能是个问题？

评估结果:   
    g20:[g60:g60+500],g60:[g120:g120+500] 较好,且此时g120:[6000-8000]为好

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g120 >= s.g250,s.g20>=3000,s.g20<=8000)
    signals = gand(g,stock.above,stock.ref.t120)

        评估:总盈亏值=-4839,交易次数=2749       期望值=-31
                总盈亏率(1/1000)=-4839,平均盈亏率(1/1000)=-2,盈利交易率(1/1000)=332
                赢利次数=914,赢利总值=113674
                亏损次数=1822,亏损总值=118513
                平盘次数=13



    g = gand(s.g20 >= s.g60+500,s.g60 >= s.g120+500,s.g120 >= s.g250,s.g20>=3000,s.g20<=8000)
        评估:总盈亏值=-7268,交易次数=1503       期望值=-76
                总盈亏率(1/1000)=-7268,平均盈亏率(1/1000)=-5,盈利交易率(1/1000)=324
                赢利次数=487,赢利总值=59817
                亏损次数=1011,亏损总值=67085
                平盘次数=5
                闭合交易明细:


    g = gand(s.g20 >= s.g60+1000,s.g60 >= s.g120+1000,s.g120 >= s.g250,s.g20>=3000,s.g20<=8000)
        评估:总盈亏值=9947,交易次数=693 期望值=212
                总盈亏率(1/1000)=9947,平均盈亏率(1/1000)=14,盈利交易率(1/1000)=307
                赢利次数=213,赢利总值=41663
                亏损次数=479,亏损总值=31716
                平盘次数=1
                闭合交易明细:

    g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120 >= s.g250,s.g20>=3000,s.g20<=8000)
        评估:总盈亏值=23806,交易次数=595        期望值=579
                总盈亏率(1/1000)=23806,平均盈亏率(1/1000)=40,盈利交易率(1/1000)=321
                赢利次数=191,赢利总值=51485
                亏损次数=401,亏损总值=27679
                平盘次数=3

    g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120 >= s.g250,s.g120>=2000,s.g20<=8000)
        评估:总盈亏值=25475,交易次数=613        期望值=594
                总盈亏率(1/1000)=25475,平均盈亏率(1/1000)=41,盈利交易率(1/1000)=327
                赢利次数=201,赢利总值=53787
                亏损次数=409,亏损总值=28312
                平盘次数=3

    g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120 >= s.g250,s.g120>=3000,s.g20<=8000)
        评估:总盈亏值=25429,交易次数=583        期望值=623
                总盈亏率(1/1000)=25429,平均盈亏率(1/1000)=43,盈利交易率(1/1000)=325
                赢利次数=190,赢利总值=52470
                亏损次数=390,亏损总值=27041
                平盘次数=3


        g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120 >= s.g250,s.g20>=3000,s.g20<=5000)
        评估:总盈亏值=7627,交易次数=144 期望值=693
                总盈亏率(1/1000)=7627,平均盈亏率(1/1000)=52,盈利交易率(1/1000)=333
                赢利次数=48,赢利总值=14870
                亏损次数=96,亏损总值=7243
                平盘次数=0

    g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120 >= s.g250,s.g120>=s.g250+500,s.g120>=3000,s.g20<=8000)
        评估:总盈亏值=24720,交易次数=485        期望值=735
                总盈亏率(1/1000)=24720,平均盈亏率(1/1000)=50,盈利交易率(1/1000)=329
                赢利次数=160,赢利总值=46767
                亏损次数=322,亏损总值=22047
                平盘次数=3
                闭合交易明细:

    g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120>=s.g250+500,s.g250>=1000,s.g20<=8000)
        评估:总盈亏值=26343,交易次数=489        期望值=768
                总盈亏率(1/1000)=26343,平均盈亏率(1/1000)=53,盈利交易率(1/1000)=333
                赢利次数=163,赢利总值=48716
                亏损次数=323,亏损总值=22373
                平盘次数=3

    g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120>=s.g250+500,s.g250>=1500,s.g20<=8000)
        评估:总盈亏值=25007,交易次数=476        期望值=753
                总盈亏率(1/1000)=25007,平均盈亏率(1/1000)=52,盈利交易率(1/1000)=329
                赢利次数=157,赢利总值=46857
                亏损次数=316,亏损总值=21850
                平盘次数=3

        g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120 >= s.g250,s.g60>=3000,s.g60<=5000)
        评估:总盈亏值=9850,交易次数=169 期望值=840
                总盈亏率(1/1000)=9850,平均盈亏率(1/1000)=58,盈利交易率(1/1000)=343
                赢利次数=58,赢利总值=17559
                亏损次数=111,亏损总值=7709
                平盘次数=0


    g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120 >= s.g250,s.g20>=3000,s.g20<=8000,s.g120>=3000)
            评估:总盈亏值=25429,交易次数=583        期望值=623
                总盈亏率(1/1000)=25429,平均盈亏率(1/1000)=43,盈利交易率(1/1000)=325
                    赢利次数=190,赢利总值=52470
                    亏损次数=390,亏损总值=27041
                    平盘次数=3

    g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120 >= s.g250,s.g20>=3000,s.g20<=8000,s.g120>=4000)
        评估:总盈亏值=22006,交易次数=520        期望值=608
                总盈亏率(1/1000)=22006,平均盈亏率(1/1000)=42,盈利交易率(1/1000)=325
                赢利次数=169,赢利总值=46039
                亏损次数=348,亏损总值=24033
                平盘次数=3

    g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120 >= s.g250,s.g20>=3000,s.g20<=8000,s.g120>=5000)
            交易次数=423    期望值=823
                总盈亏率(1/1000)=23783,平均盈亏率(1/1000)=56,盈利交易率(1/1000)=328
                赢利次数=139,赢利总值=43134
                亏损次数=281,亏损总值=19351
                平盘次数=3
                闭合交易明细:

    g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120 >= s.g250,s.g20>=6000,s.g20<=8000)
        评估:总盈亏值=21385,交易次数=379        期望值=811
                总盈亏率(1/1000)=21385,平均盈亏率(1/1000)=56,盈利交易率(1/1000)=329
                赢利次数=125,赢利总值=38956
                亏损次数=252,亏损总值=17571
                平盘次数=2

    g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120 >= s.g250,s.g20>=6000,s.g20<=8500)
        评估:总盈亏值=25722,交易次数=541        期望值=671
                总盈亏率(1/1000)=25722,平均盈亏率(1/1000)=47,盈利交易率(1/1000)=301
                赢利次数=163,赢利总值=52067
                亏损次数=375,亏损总值=26345
                平盘次数=3

    g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120 >= s.g250,s.g20>=5000,s.g20<=8000)

        评估:总盈亏值=22458,交易次数=480        期望值=686
                总盈亏率(1/1000)=22458,平均盈亏率(1/1000)=46,盈利交易率(1/1000)=331
                赢利次数=159,赢利总值=43953
                亏损次数=318,亏损总值=21495
                平盘次数=3

    g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120 >= s.g250,s.g20>=3000,s.g20<=8000,s.g120>=6000)
        评估:总盈亏值=19280,交易次数=329        期望值=828
                总盈亏率(1/1000)=19280,平均盈亏率(1/1000)=58,盈利交易率(1/1000)=316
                赢利次数=104,赢利总值=34921
                亏损次数=223,亏损总值=15641

    g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120 >= s.g250)
        评估:总盈亏值=-20249,交易次数=2095      期望值=-141
                总盈亏率(1/1000)=-20249,平均盈亏率(1/1000)=-10,盈利交易率(1/1000)=262
                赢利次数=550,赢利总值=89475
                亏损次数=1537,亏损总值=109724
                平盘次数=8

    g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120 >= s.g250,s.g20>=2000,s.g20<=9000)
        评估:总盈亏值=26696,交易次数=1025       期望值=371
                总盈亏率(1/1000)=26696,平均盈亏率(1/1000)=26,盈利交易率(1/1000)=293
                赢利次数=301,赢利总值=77069
                亏损次数=719,亏损总值=50373
                平盘次数=5

    g = gand(s.g20 >= s.g60-500,s.g20 <= s.g60+500,s.g60 >= s.g120-500,s.g60<=s.g120+500,s.g120 >= s.g250,s.g20>=3000,s.g20<=8000)
        评估:总盈亏值=19268,交易次数=1463       期望值=203
                总盈亏率(1/1000)=19268,平均盈亏率(1/1000)=13,盈利交易率(1/1000)=304
                赢利次数=446,赢利总值=84428
                亏损次数=1013,亏损总值=65160
                平盘次数=4

    g = gand(s.g20 >= s.g60-100,s.g20 <= s.g60+500,s.g60 >= s.g120-100,s.g60<=s.g120+500,s.g120 >= s.g250,s.g20>=3000,s.g20<=8000)
        评估:总盈亏值=18960,交易次数=751        期望值=378
                总盈亏率(1/1000)=18960,平均盈亏率(1/1000)=25,盈利交易率(1/1000)=296
                赢利次数=223,赢利总值=54139
                亏损次数=526,亏损总值=35179
                平盘次数=2
                闭合交易明细:

    g = gand(s.g20 >= s.g60+1000,s.g60 >= s.g120+1000,s.g120 >= s.g250,s.g120>=1000,s.g20<=2*s.g60,s.g60<=2*s.g120,s.g20>=3000,s.g20<=8000)
        评估:总盈亏值=11945,交易次数=604        期望值=279
                总盈亏率(1/1000)=11945,平均盈亏率(1/1000)=19,盈利交易率(1/1000)=329
                赢利次数=199,赢利总值=39745
                亏损次数=404,亏损总值=27800
                平盘次数=1


    g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120 >= s.g250,s.g120>=2000,s.g120<=7000)
        评估:总盈亏值=24568,交易次数=499        期望值=700
                总盈亏率(1/1000)=24568,平均盈亏率(1/1000)=49,盈利交易率(1/1000)=336
                赢利次数=168,赢利总值=47556
                亏损次数=328,亏损总值=22988
                平盘次数=3

g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120>=s.g250+500,s.g250>=1000,s.g20<=8000)
signals = gand(g,stock.ref.t120)
        评估:总盈亏值=21145,交易次数=1000       期望值=350
                总盈亏率(1/1000)=21145,平均盈亏率(1/1000)=21,盈利交易率(1/1000)=290
                赢利次数=290,赢利总值=64051
                亏损次数=707,亏损总值=42906
                平盘次数=3


g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120>=s.g250+500,s.g250>=1000,s.g20<=8000)   ###
signals = gand(g,stock.t120)
        评估:总盈亏值=20139,交易次数=892        期望值=349
                总盈亏率(1/1000)=20139,平均盈亏率(1/1000)=22,盈利交易率(1/1000)=282
                赢利次数=252,赢利总值=60354
                亏损次数=637,亏损总值=40215
                平盘次数=3
                闭合交易明细:

signals = gand(g,stock.ref.t120,strend(stock.ref.ma60)>0)
        评估:总盈亏值=25281,交易次数=861        期望值=475
                总盈亏率(1/1000)=25281,平均盈亏率(1/1000)=29,盈利交易率(1/1000)=304
                赢利次数=262,赢利总值=62056
                亏损次数=597,亏损总值=36775
                平盘次数=2

signals = gand(g,stock.ref.t120,strend(ma(stock.ref.transaction[CLOSE],250))>0)
        评估:总盈亏值=25635,交易次数=786        期望值=507
                总盈亏率(1/1000)=25635,平均盈亏率(1/1000)=32,盈利交易率(1/1000)=311
                赢利次数=245,赢利总值=59696
                亏损次数=539,亏损总值=34061
                平盘次数=2

signals = gand(g,stock.ref.t120,strend(stock.ref.ma60)>0,strend(stock.ref.ma20)>0)
        评估:总盈亏值=26334,交易次数=751        期望值=564
                总盈亏率(1/1000)=26334,平均盈亏率(1/1000)=35,盈利交易率(1/1000)=310
                赢利次数=233,赢利总值=58738
                亏损次数=516,亏损总值=32404
                平盘次数=2

signals = gand(g,stock.ref.t120,strend(stock.ref.ma60)>0,strend(ma(stock.ref.transaction[CLOSE],250))>0)    ###
        评估:总盈亏值=31517,交易次数=719        期望值=661
                总盈亏率(1/1000)=31517,平均盈亏率(1/1000)=43,盈利交易率(1/1000)=346
                赢利次数=249,赢利总值=62206
                亏损次数=468,亏损总值=30689
                平盘次数=2


g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120>=s.g250+500,s.g250>=1000,s.g20<=8000)
signals = gand(g,stock.above)
        评估:总盈亏值=25297,交易次数=508        期望值=710
                总盈亏率(1/1000)=25297,平均盈亏率(1/1000)=49,盈利交易率(1/1000)=324
                赢利次数=165,赢利总值=48786
                亏损次数=340,亏损总值=23489
                平盘次数=3
                闭合交易明细:

g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120>=s.g250+500,s.g250>=1000,s.g20<=8000)
signals = gand(g,stock.above,stock.t120)
        评估:总盈亏值=24554,交易次数=492        期望值=720
                总盈亏率(1/1000)=24554,平均盈亏率(1/1000)=49,盈利交易率(1/1000)=323
                赢利次数=159,赢利总值=47132
                亏损次数=330,亏损总值=22578
                平盘次数=3


####
g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120>=s.g250+500,s.g250>=1000,s.g20<=8000)
signals = gand(g,stock.ref.t120,strend(stock.ref.ma60)>0,strend(stock.ref.ma20)>0,strend(ma(stock.ref.transaction[CLOSE],250))>0)
        评估:总盈亏值=30205,交易次数=641        期望值=712
                总盈亏率(1/1000)=30205,平均盈亏率(1/1000)=47,盈利交易率(1/1000)=344
                赢利次数=221,赢利总值=57951
                亏损次数=419,亏损总值=27746
                平盘次数=1
                闭合交易明细:

signals = gand(g,stock.ref.t120,strend(stock.ref.ma60)>0,strend(stock.ref.ma10)>0,strend(stock.ref.ma20)>0,strend(ma(stock.ref.transaction[CLOSE],250))>0)
        评估:总盈亏值=28528,交易次数=589        期望值=716
                总盈亏率(1/1000)=28528,平均盈亏率(1/1000)=48,盈利交易率(1/1000)=351
                赢利次数=207,赢利总值=54156
                亏损次数=382,亏损总值=25628
                平盘次数=0
                闭合交易明细:

g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120>=s.g250+500,s.g250>=1000,s.g20<=8000)
    signals = gand(g,stock.ref.above)
        评估:总盈亏值=29664,交易次数=639        期望值=686
                总盈亏率(1/1000)=29664,平均盈亏率(1/1000)=46,盈利交易率(1/1000)=320
                赢利次数=205,赢利总值=58805
                亏损次数=433,亏损总值=29141
                平盘次数=1

g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) #####
signals = gand(g,stock.above,ma5>stock.ma10,stock.ref.t120)

        评估:总盈亏值=50190,交易次数=1139       期望值=676
                总盈亏率(1/1000)=50190,平均盈亏率(1/1000)=44,盈利交易率(1/1000)=345
                赢利次数=394,赢利总值=98983
                亏损次数=741,亏损总值=48793
                平盘次数=4

g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) #####
signals = gand(g,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120)
        评估:总盈亏值=64216,交易次数=1383       期望值=707
                总盈亏率(1/1000)=64216,平均盈亏率(1/1000)=46,盈利交易率(1/1000)=365
                赢利次数=505,赢利总值=121672
                亏损次数=873,亏损总值=57456
                平盘次数=5

g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) #####
signals = gand(g,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=64753,交易次数=1242       期望值=787
                总盈亏率(1/1000)=64753,平均盈亏率(1/1000)=52,盈利交易率(1/1000)=370
                赢利次数=460,赢利总值=116551
                亏损次数=777,亏损总值=51798
                平盘次数=5


#2009-05-03
#1 ！！！强
def xgcs0(stock,dates):
    ''' 下穿0线
        评估:总盈亏值=23464,交易次数=81 期望值=4013
                总盈亏率(1/1000)=23464,平均盈亏率(1/1000)=289,盈利交易率(1/1000)=617
                赢利次数=50,赢利总值=25703
                亏损次数=31,亏损总值=2239
                平盘次数=0
    '''
    t = stock.transaction
    ma5 = ma(t[CLOSE],5)
    linelog(stock.code)

    si = score2(t[CLOSE],t[VOLUME])
    zs = cached_zeros(len(t[CLOSE]))
    mxi = cross(zs,si)<0

    sbuy = gand(stock.golden,stock.silver,stock.above,ma5>stock.ma10,stock.ref.t120,mxi)
    return sbuy

#2 就单独条件而言
g = gand(s.g20 >= s.g60,s.g20 <= s.g60+500,s.g60 >= s.g120,s.g60<=s.g120+500,s.g120>=s.g250+500,s.g250>=1000,s.g20<=8000)
要优于golden
但几乎被筛光了

g = gand(s.g20 >= s.g60+1000,s.g60 >= s.g120+1000,s.g20>=3000,s.g20<=8000)  #golden
signals = gand(g,stock.ref.t120,strend(stock.ref.ma60)>0,strend(stock.ref.ma20)>0,strend(ma(stock.ref.transaction[CLOSE],250))>0)
        评估:总盈亏值=17955,交易次数=4429       期望值=63
                总盈亏率(1/1000)=17955,平均盈亏率(1/1000)=4,盈利交易率(1/1000)=319
                赢利次数=1414,赢利总值=208864
                亏损次数=3000,亏损总值=190909
                平盘次数=15
                闭合交易明细:


g = gand(s.g20 >= s.g60+1000,s.g60 >= s.g120+1000,s.g20>=3000,s.g20<=8000)  #golden
signals = gand(g,stock.ref.t120,stock.above)
        评估:总盈亏值=26962,交易次数=1472       期望值=276
                总盈亏率(1/1000)=26962,平均盈亏率(1/1000)=18,盈利交易率(1/1000)=341
                赢利次数=502,赢利总值=90618
                亏损次数=967,亏损总值=63656
                平盘次数=3
                闭合交易明细:

ks = np.abs((s.g20-s.g60) * 1000/(s.g60-s.g120))
g = gand(s.g20 >= s.g60+1000,s.g60 >= s.g120+1000,s.g20>=3000,s.g20<=8000,ks>=900,ks<=1100)
signals = gand(g,stock.ref.t120,strend(stock.ref.ma60)>0,strend(stock.ref.ma20)>0,strend(ma(stock.ref.transaction[CLOSE],250))>0)
        评估:总盈亏值=43064,交易次数=1291       期望值=507
                总盈亏率(1/1000)=43064,平均盈亏率(1/1000)=33,盈利交易率(1/1000)=340
                赢利次数=439,赢利总值=98455
                亏损次数=851,亏损总值=55391
                平盘次数=1


g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) #####
signals = gand(g,stock.ref.t120,strend(stock.ref.ma60)>0,strend(stock.ref.ma20)>0,strend(ma(stock.ref.transaction[CLOSE],250))>0)
    评估:总盈亏值=80002,交易次数=2217       期望值=580
                总盈亏率(1/1000)=80002,平均盈亏率(1/1000)=36,盈利交易率(1/1000)=356
                赢利次数=790,赢利总值=169139
                亏损次数=1422,亏损总值=89137
                平盘次数=5
                闭合交易明细:


g = gand(s.g20 >= s.g60-1000,s.g60 >= s.g120-1000,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000)
signals = gand(g,stock.ref.t120,strend(stock.ref.ma60)>0,strend(stock.ref.ma20)>0,strend(ma(stock.ref.transaction[CLOSE],250))>0)
        评估:总盈亏值=132464,交易次数=9171      期望值=215
                总盈亏率(1/1000)=132464,平均盈亏率(1/1000)=14,盈利交易率(1/1000)=342
                赢利次数=3142,赢利总值=527380
                亏损次数=6004,亏损总值=394916
                平盘次数=25


g = gand(s.g20 >= s.g60-500,s.g60 >= s.g120-500,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000,s.g20>=s.g120)
signals = gand(g,stock.ref.t120,strend(stock.ref.ma60)>0,strend(stock.ref.ma20)>0,strend(ma(stock.ref.transaction[CLOSE],250))>0)

        评估:总盈亏值=100430,交易次数=4785      期望值=322
                总盈亏率(1/1000)=100430,平均盈亏率(1/1000)=20,盈利交易率(1/1000)=340
                赢利次数=1629,赢利总值=296962
                亏损次数=3140,亏损总值=196532
                平盘次数=16

g = gand(s.g20 >= s.g60-500,s.g60 >= s.g120-500,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+500,s.g20>=s.g120-500)
signals = gand(g,stock.ref.t120,strend(stock.ref.ma60)>0,strend(stock.ref.ma20)>0,strend(ma(stock.ref.transaction[CLOSE],250))>0)
        评估:总盈亏值=78909,交易次数=3458       期望值=349
                总盈亏率(1/1000)=78909,平均盈亏率(1/1000)=22,盈利交易率(1/1000)=332
                赢利次数=1151,赢利总值=225152
                亏损次数=2298,亏损总值=146243
                平盘次数=9


#测试  g20/g60,g60/g120都在90-110%,但g20-g120:[0-1000]?
    ks20 = s.g20 * 1000 / s.g60
    ks60 = s.g60 * 1000 / s.g120
    g = gand(ks20>=900,ks20<=1100,ks60>=900,ks60<=1100,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+500,s.g20>=s.g120-500)
    signals = gand(g,stock.ref.t120,strend(stock.ref.ma60)>0,strend(stock.ref.ma20)>0,strend(ma(stock.ref.transaction[CLOSE],250))>0)
        评估:总盈亏值=72685,交易次数=3129       期望值=359
                总盈亏率(1/1000)=72685,平均盈亏率(1/1000)=23,盈利交易率(1/1000)=323
                赢利次数=1012,赢利总值=208869
                亏损次数=2112,亏损总值=136184
                平盘次数=5
                闭合交易明细:

    ks20 = s.g20 * 1000 / s.g60
    ks60 = s.g60 * 1000 / s.g120
    g = gand(ks20>=900,ks20<=1100,ks60>=900,ks60<=1100,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000,s.g20>=s.g120)
    signals = gand(g,stock.ref.t120,strend(stock.ref.ma60)>0,strend(stock.ref.ma20)>0,strend(ma(stock.ref.transaction[CLOSE],250))>0)
        评估:总盈亏值=58978,交易次数=2310       期望值=390
                总盈亏率(1/1000)=58978,平均盈亏率(1/1000)=25,盈利交易率(1/1000)=328
                赢利次数=758,赢利总值=159543
                亏损次数=1549,亏损总值=100565
                平盘次数=3

    ks20 = s.g20 * 1000 / s.g60
    ks60 = s.g60 * 1000 / s.g120
    g = gand(ks20>=990,ks20<=1100,ks60>=990,ks60<=1100,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000,s.g20>=s.g120)
    signals = gand(g,stock.ref.t120,strend(stock.ref.ma60)>0,strend(stock.ref.ma20)>0,strend(ma(stock.ref.transaction[CLOSE],250))>0)
        评估:总盈亏值=63138,交易次数=1559       期望值=597
                总盈亏率(1/1000)=63138,平均盈亏率(1/1000)=40,盈利交易率(1/1000)=347
                赢利次数=542,赢利总值=131155
                亏损次数=1014,亏损总值=68017
                平盘次数=3

    ks20 = s.g20 * 1000 / s.g60
    ks60 = s.g60 * 1000 / s.g120
    g = gand(ks20>=950,ks20<=1100,ks60>=950,ks60<=1100,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000,s.g20>=s.g120)
    signals = gand(g,stock.ref.t120,strend(stock.ref.ma60)>0,strend(stock.ref.ma20)>0,strend(ma(stock.ref.transaction[CLOSE],250))>0)
    评估:总盈亏值=68385,交易次数=2081       期望值=500
                总盈亏率(1/1000)=68385,平均盈亏率(1/1000)=32,盈利交易率(1/1000)=340
                赢利次数=708,赢利总值=156837
                亏损次数=1370,亏损总值=88452
                平盘次数=3

    ks20 = s.g20 * 1000 / s.g60
    ks60 = s.g60 * 1000 / s.g120
    ks120 = s.g20 * 1000 / s.g120
    g = gand(ks20>=950,ks20<=1100,ks60>=950,ks60<=1100,s.g20>=3000,s.g20<=8000,ks120<=1100,s.g20>=s.g120)
    signals = gand(g,stock.ref.t120,strend(stock.ref.ma60)>0,strend(stock.ref.ma20)>0,strend(ma(stock.ref.transaction[CLOSE],250))>0)
        评估:总盈亏值=55052,交易次数=1708       期望值=484
                总盈亏率(1/1000)=55052,平均盈亏率(1/1000)=32,盈利交易率(1/1000)=326
                赢利次数=557,赢利总值=131015
                亏损次数=1146,亏损总值=75963
                平盘次数=5

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+2000) 
    signals = gand(g,stock.ref.t120,strend(stock.ref.ma60)>0,strend(stock.ref.ma20)>0,strend(ma(stock.ref.transaction[CLOSE],250))>0)
        评估:总盈亏值=90736,交易次数=5376       期望值=253
                总盈亏率(1/1000)=90736,平均盈亏率(1/1000)=16,盈利交易率(1/1000)=354
                赢利次数=1904,赢利总值=309028
                亏损次数=3452,亏损总值=218292
                平盘次数=20
                闭合交易明细:

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20>=s.g120+2000) 
        评估:总盈亏值=71008,交易次数=8127       期望值=125
                总盈亏率(1/1000)=71008,平均盈亏率(1/1000)=8,盈利交易率(1/1000)=339
                赢利次数=2756,赢利总值=412980
                亏损次数=5335,亏损总值=341972
                平盘次数=36

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20>=s.g120+2000,s.g20-s.g60<=s.g60-s.g120) 
        评估:总盈亏值=39728,交易次数=4980       期望值=112
                总盈亏率(1/1000)=39728,平均盈亏率(1/1000)=7,盈利交易率(1/1000)=326
                赢利次数=1626,赢利总值=246904
                亏损次数=3334,亏损总值=207176


    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    ma5=ma(t[CLOSE],5)
    signals = gand(g,stock.silver,stock.above,ma5>stock.ma10,stock.ref.t120)
        评估:总盈亏值=16743,交易次数=145        期望值=1575
                总盈亏率(1/1000)=16743,平均盈亏率(1/1000)=115,盈利交易率(1/1000)=406
                赢利次数=59,赢利总值=23024
                亏损次数=86,亏损总值=6281
                平盘次数=0


    ma5=ma(t[CLOSE],5)
    signals = gand(stock.golden,stock.silver,stock.above,ma5>stock.ma10,stock.ref.t120)
        评估:总盈亏值=27398,交易次数=202        期望值=1800
                总盈亏率(1/1000)=27398,平均盈亏率(1/1000)=135,盈利交易率(1/1000)=420
                赢利次数=85,赢利总值=36101
                亏损次数=116,亏损总值=8703
                平盘次数=1


    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    signals = gand(g,stock.silver,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120)
        评估:总盈亏值=21405,交易次数=156        期望值=1876
                总盈亏率(1/1000)=21405,平均盈亏率(1/1000)=137,盈利交易率(1/1000)=442
                赢利次数=69,赢利总值=27836
                亏损次数=87,亏损总值=6431
                平盘次数=0
                闭合交易明细:


#加上macd
    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[VOLUME])
    signals = gand(g,strend(pdiff-pdea)<0,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=71376,交易次数=936        期望值=1151
                总盈亏率(1/1000)=71376,平均盈亏率(1/1000)=76,盈利交易率(1/1000)=383
                赢利次数=359,赢利总值=109855
                亏损次数=575,亏损总值=38479
                平盘次数=2

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,strend(pdiff-pdea)<0,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=79049,交易次数=835        期望值=1382
                总盈亏率(1/1000)=79049,平均盈亏率(1/1000)=94,盈利交易率(1/1000)=431
                赢利次数=360,赢利总值=111362
                亏损次数=473,亏损总值=32313
                平盘次数=2

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdiff>=pdea,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=48396,交易次数=946        期望值=761
                总盈亏率(1/1000)=48396,平均盈亏率(1/1000)=51,盈利交易率(1/1000)=361
                赢利次数=342,赢利总值=88906
                亏损次数=599,亏损总值=40510
                平盘次数=5


    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdiff-pdea>=-200,pdiff<=pdea,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=55365,交易次数=490        期望值=1696
                总盈亏率(1/1000)=55365,平均盈亏率(1/1000)=112,盈利交易率(1/1000)=418
                赢利次数=205,赢利总值=73990
                亏损次数=282,亏损总值=18625
                平盘次数=3

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdiff<pdea,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=53529,交易次数=483        期望值=1617
                总盈亏率(1/1000)=53529,平均盈亏率(1/1000)=110,盈利交易率(1/1000)=420
                赢利次数=203,赢利总值=72522
                亏损次数=278,亏损总值=18993
                平盘次数=2

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[VOLUME])
    signals = gand(g,pdiff<pdea,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=67461,交易次数=758        期望值=1257
                总盈亏率(1/1000)=67461,平均盈亏率(1/1000)=88,盈利交易率(1/1000)=412
                赢利次数=313,赢利总值=98417
                亏损次数=442,亏损总值=30956
                平盘次数=3


    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[VOLUME])
    signals = gand(g,pdea<0,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=50440,交易次数=483        期望值=1552
                总盈亏率(1/1000)=50440,平均盈亏率(1/1000)=104,盈利交易率(1/1000)=412
                赢利次数=199,赢利总值=69525
                亏损次数=281,亏损总值=19085
                平盘次数=3


    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdea>100,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=76053,交易次数=775        期望值=1342
                总盈亏率(1/1000)=76053,平均盈亏率(1/1000)=98,盈利交易率(1/1000)=416
                赢利次数=323,赢利总值=109334
                亏损次数=450,亏损总值=33281
                平盘次数=2

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdea>300,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=29722,交易次数=369        期望值=930
                总盈亏率(1/1000)=29722,平均盈亏率(1/1000)=80,盈利交易率(1/1000)=476
                赢利次数=176,赢利总值=46456
                亏损次数=193,亏损总值=16734
                平盘次数=0

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000)     #####
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdea>300,pdea<500,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=30021,交易次数=215        期望值=1759
                总盈亏率(1/1000)=30021,平均盈亏率(1/1000)=139,盈利交易率(1/1000)=544
                赢利次数=117,赢利总值=37812
                亏损次数=98,亏损总值=7791
                平盘次数=0

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdea>100,pdea<500,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=72240,交易次数=607        期望值=1750
                总盈亏率(1/1000)=72240,平均盈亏率(1/1000)=119,盈利交易率(1/1000)=418
                赢利次数=254,赢利总值=96440
                亏损次数=351,亏损总值=24200
                平盘次数=2
                闭合交易明细:

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdea>=0,pdea<=500,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=59899,交易次数=1054       期望值=888
                总盈亏率(1/1000)=59899,平均盈亏率(1/1000)=56,盈利交易率(1/1000)=363
                赢利次数=383,赢利总值=101952
                亏损次数=666,亏损总值=42053
                平盘次数=5
                闭合交易明细:

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdea>=150,pdea<=500,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=64304,交易次数=439        期望值=2000
                总盈亏率(1/1000)=64304,平均盈亏率(1/1000)=146,盈利交易率(1/1000)=446
                赢利次数=196,赢利总值=82162
                亏损次数=242,亏损总值=17858
                平盘次数=1

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000)     ####
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdea>=200,pdea<=500,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=47842,交易次数=336        期望值=1893
                总盈亏率(1/1000)=47842,平均盈亏率(1/1000)=142,盈利交易率(1/1000)=502
                赢利次数=169,赢利总值=60375
                亏损次数=166,亏损总值=12533
                平盘次数=1

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdea>=250,pdea<=500,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=38651,交易次数=270        期望值=1833
                总盈亏率(1/1000)=38651,平均盈亏率(1/1000)=143,盈利交易率(1/1000)=511
                赢利次数=138,赢利总值=48917
                亏损次数=131,亏损总值=10266
                平盘次数=1

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdiff>=200,pdiff<=500,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=58796,交易次数=366        期望值=2191
                总盈亏率(1/1000)=58796,平均盈亏率(1/1000)=160,盈利交易率(1/1000)=464
                赢利次数=170,赢利总值=73051
                亏损次数=195,亏损总值=14255
                平盘次数=1


    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdiff>=250,pdiff<=500,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=45005,交易次数=283        期望值=2148
                总盈亏率(1/1000)=45005,平均盈亏率(1/1000)=159,盈利交易率(1/1000)=494
                赢利次数=140,赢利总值=55657
                亏损次数=143,亏损总值=10652
                平盘次数=0
                闭合交易明细:

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000)     ######
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdiff>=300,pdiff<=500,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=33206,交易次数=222        期望值=2013
                总盈亏率(1/1000)=33206,平均盈亏率(1/1000)=149,盈利交易率(1/1000)=513
                赢利次数=114,赢利总值=41288
                亏损次数=108,亏损总值=8082
                平盘次数=0


    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdiff>=250,pdiff<=450,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=46127,交易次数=250        期望值=2591
                总盈亏率(1/1000)=46127,平均盈亏率(1/1000)=184,盈利交易率(1/1000)=512
                赢利次数=128,赢利总值=54846
                亏损次数=122,亏损总值=8719
                平盘次数=0
                闭合交易明细:

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdiff>=200,pdiff<=400,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=56343,交易次数=302        期望值=2657
                总盈亏率(1/1000)=56343,平均盈亏率(1/1000)=186,盈利交易率(1/1000)=456
                赢利次数=138,赢利总值=67889
                亏损次数=163,亏损总值=11546
                平盘次数=1


    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdiff>=250,pdiff<=400,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=44213,交易次数=222        期望值=2802
                总盈亏率(1/1000)=44213,平均盈亏率(1/1000)=199,盈利交易率(1/1000)=504
                赢利次数=112,赢利总值=52066
                亏损次数=110,亏损总值=7853
                平盘次数=0

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdiff>=300,pdiff<=400,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=33066,交易次数=160        期望值=3029
                总盈亏率(1/1000)=33066,平均盈亏率(1/1000)=206,盈利交易率(1/1000)=537
                赢利次数=86,赢利总值=38147
                亏损次数=74,亏损总值=5081
                平盘次数=0

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdiff>=250,pdiff<=350,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=45663,交易次数=187        期望值=3297
                总盈亏率(1/1000)=45663,平均盈亏率(1/1000)=244,盈利交易率(1/1000)=550
                赢利次数=103,赢利总值=51902
                亏损次数=84,亏损总值=6239
                平盘次数=0

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdiff>=250,pdiff<=360,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=47020,交易次数=195        期望值=3301
                总盈亏率(1/1000)=47020,平均盈亏率(1/1000)=241,盈利交易率(1/1000)=543
                赢利次数=106,赢利总值=53522
                亏损次数=89,亏损总值=6502
                平盘次数=0

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdiff>=240,pdiff<=360,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=52352,交易次数=211        期望值=3444
                总盈亏率(1/1000)=52352,平均盈亏率(1/1000)=248,盈利交易率(1/1000)=545
                赢利次数=115,赢利总值=59318
                亏损次数=96,亏损总值=6966
                平盘次数=0

    g = gand(s.g20 >= s.g60,s.g60 >= s.g120,s.g20>=3000,s.g20<=8000,s.g20<=s.g120+1000) 
    pdiff,pdea = cmacd(t[CLOSE])
    signals = gand(g,pdiff>=225,pdiff<=350,stock.above,stock.ref.t120,strend(stock.ma20)>0,strend(stock.ma60)>0,stock.t120,stock.ref.above)
        评估:总盈亏值=58352,交易次数=229        期望值=3577
                总盈亏率(1/1000)=58352,平均盈亏率(1/1000)=254,盈利交易率(1/1000)=545
                赢利次数=125,赢利总值=65828
                亏损次数=104,亏损总值=7476
                平盘次数=0


#2009-05-07
#1 从-1.2R-->3R的止损曲线处理, 如将上升的1/3用来提升止损位
   用tracelimit_r来表现 
   proportion=400时(涨幅的0.4用于提升止损位)，效果比原先的差很多，成功率和R都明显下降
#2 新高周期。已经实现，还没找到如何应用,貌似简单方式没有价值.
    down_period
#3 60日均线上方的股票总数/60日新高家数.
   非常有借鉴意义
for s in sdata.values():
    srun.shigh(s,dates)

from wolfox.fengine.core.source import extract_collect as ec
nx = ec(sdata.values(),'shigh')   
sx = np.sum(nx,0)
xdif,xdea = cmacd(sx)
xdif2,xdea2 = cmacd(sx,19,39,9)
s5 = ma(sx,5)
s60 = ma(sx,60)
t60 = strend(s60)

for d,i,xf,xa,i5,i60,it60 in zip(dates,sx,xdif,xdea,s5,s60,t60)[:-200]:
    print d,i,xf,xa,i5,i60,it60

    
    上升形态中,s60拐头确认(strend=-3)是非常重要的信号(070528), 调整之后的拐头没有意义
               diff 死叉 dea, diff拐头, dea穿越0线,都是重要信号
               其中dea上穿0线是典型走好信号,下穿零线是典型走坏信号 (cmacd12/26/9和19/39/9单独发出的均可)
               s5死叉/金叉s60,diff金叉/diff死叉dea和diff/dea拐头是需要验证的信号,但一旦与其它信号加强,则很重要
               作为先导信号,则可逐步出货,但作为大盘调整同时的信号,则需立即出货
    另, 中等尺度下创新高家数与大盘新高的背离,也是应该谨慎的信号. 
        即大盘调整后创新高,但新高家数比上一次新高时少了
        或者5/20日新高数高点(或极值点,续走5日后判断出极点)比上一个5/20日新高数高点要小,而大盘在创新高. 

    另,其它的数据透视,新高数未创新高的周期
from wolfox.fengine.core.d1idiom import down_period as dp
dx = dp(sx,5)
    新低数
for s in sdata.values():
    srun.slow(s,dates)
from wolfox.fengine.core.source import extract_collect as ec
nl = ec(sdata.values(),'slow')   
sl = np.sum(nl,0)
l60 = ma(sl,60)
ldif,ldea = cmacd(sl)
for d,i,xf,xa,i5,i60,it60,il,il60 in zip(dates,sx,xdif,xdea,s5,s60,t60,sl,l60)[:-200]:
    print d,i,xf,xa,i5,i60,it60,il,il60

sl大于1000时是短期见底信号

#3.1 待实现
板块新高指数
不知道计算出来之后怎么应用

#4 攻击日形态
   连续下跌(>=3)过程中，某日的收盘价低于前一日最低价，若次日冲破改日最高价，则为攻击日
   缺乏价值 

#5 macd的转向应用,以strend穿越3时为信号？
   实战价值不高. strend(dea)穿越3时，结合其他条件，准确率为50X，R=13XX.

####发现除权对算法的敏感性
有些算法具有除权敏感性，有些比较鲁棒
总的来说，交易次数越少的，敏感性越高。而交易次数多的，即便有大比例替换效应出现，成功率和R仍然比较稳定。
但交易次数非常少的，倒也有稳定性
csvama系列受到影响最大，这个对g排名也有影响。 导致gx250变化非常大
原因也比较简单，因为除权导致某些板块的放大巨大（如基金变成1分，那么本来从1.00-1.01是1%，现在从0.01-0.02变成100%）
影响最大的是基金，很多基金除权以后2005-2007的价格变成负数了。另一个就是600497驰宏锌锗,2005之前的也变成负数
必须妥善解决这个问题。
或者只对股份变化除权？不对分红除权？
需要一种对价格进行标准化的方法来消除除权效应，这个标准化的基础应当是每日的涨跌幅度，只在除权日进行衔接特殊处理。
或者粗略的做法是计算距离涨幅前(甚至是)
    对股票<600的都改成600
    对基金<300的数据都改成300
这样作以后，丧失了算法的历史稳定性，特别是本来选出的股票如果被影响到，则可能就选不出来了

#2009-05-13
#退出问题
利用 买入后每日高点 - 当日atr* times 作为比较止损线的基准
还是    买入后最高点 - 每日atr * times 作为比较基准
两者区别不大。
